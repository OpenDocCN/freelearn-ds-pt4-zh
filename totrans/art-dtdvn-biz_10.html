<html><head></head><body>
<div id="_idContainer254">
<h1 class="chapter-number" id="_idParaDest-96"><a id="_idTextAnchor1316"/><span class="koboSpan" id="kobo.1.1">10</span></h1>
<h1 id="_idParaDest-97"><a id="_idTextAnchor1317"/><span class="koboSpan" id="kobo.2.1">Web Analytics Optimization</span></h1>
<p><span class="koboSpan" id="kobo.3.1">A data-driven marketing optimization is an analytical approach to marketing that values decisions that can be supported with trustworthy and verifiable data. </span><span class="koboSpan" id="kobo.3.2">It places high importance on choices that can be substantiated by empirical evidence, whether traffic sources, page views, or time spent per session. </span><span class="koboSpan" id="kobo.3.3">The effectiveness of data collection, processing, and interpretation to maximize marketing results are key components of the data-based </span><span class="No-Break"><span class="koboSpan" id="kobo.4.1">approach’s success.</span></span></p>
<p><span class="koboSpan" id="kobo.5.1">In this chapter, we will be learning about </span><span class="No-Break"><span class="koboSpan" id="kobo.6.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.7.1">Understanding what web </span><span class="No-Break"><span class="koboSpan" id="kobo.8.1">analytics is</span></span></li>
<li><span class="koboSpan" id="kobo.9.1">How web analytics data is used to improve </span><span class="No-Break"><span class="koboSpan" id="kobo.10.1">business operations</span></span></li>
<li><span class="koboSpan" id="kobo.11.1">Calculating the user’s </span><strong class="bold"><span class="koboSpan" id="kobo.12.1">customer lifetime value</span></strong><span class="koboSpan" id="kobo.13.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.14.1">CLV</span></strong><span class="koboSpan" id="kobo.15.1">) based on web </span><span class="No-Break"><span class="koboSpan" id="kobo.16.1">analytics data</span></span></li>
<li><span class="koboSpan" id="kobo.17.1">Predicting the user’s CLV based on this </span><span class="No-Break"><span class="koboSpan" id="kobo.18.1">historical data</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.19.1">Let’s determine what the requirements will be for understanding these steps and following </span><span class="No-Break"><span class="koboSpan" id="kobo.20.1">the chapter.</span></span></p>
<p><span class="koboSpan" id="kobo.21.1">This chapter covers the </span><span class="No-Break"><span class="koboSpan" id="kobo.22.1">following topics:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.23.1">Understanding </span><span class="No-Break"><span class="koboSpan" id="kobo.24.1">web analytics</span></span></li>
<li><span class="koboSpan" id="kobo.25.1">Using web analytics to improve </span><span class="No-Break"><span class="koboSpan" id="kobo.26.1">business decisions</span></span></li>
<li><span class="koboSpan" id="kobo.27.1">Exploring </span><span class="No-Break"><span class="koboSpan" id="kobo.28.1">the data</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.29.1">Calculating CLV</span></span></li>
<li><span class="koboSpan" id="kobo.30.1">Predicting </span><span class="No-Break"><span class="koboSpan" id="kobo.31.1">customer revenue</span></span></li>
</ul>
<h1 id="_idParaDest-98"><a id="_idTextAnchor1318"/><span class="koboSpan" id="kobo.32.1">Technical requirements</span></h1>
<p><span class="koboSpan" id="kobo.33.1">In order to be able to follow the steps in this chapter, you will need to meet the </span><span class="No-Break"><span class="koboSpan" id="kobo.34.1">next requirements:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.35.1">A Jupyter Notebook instance running Python 3.7 and above. </span><span class="koboSpan" id="kobo.35.2">You can use the Google Colab notebook to run the steps as well if you have a Google </span><span class="No-Break"><span class="koboSpan" id="kobo.36.1">Drive account.</span></span></li>
<li><span class="koboSpan" id="kobo.37.1">Understanding of basic math and </span><span class="No-Break"><span class="koboSpan" id="kobo.38.1">statistical concepts.</span></span></li>
</ul>
<h1 id="_idParaDest-99"><a id="_idTextAnchor1319"/><span class="koboSpan" id="kobo.39.1">Understanding web analytics</span></h1>
<p><span class="koboSpan" id="kobo.40.1">For e-commerce, understanding user base</span><a id="_idIndexMarker456"/><span class="koboSpan" id="kobo.41.1"> behavior is fundamental. </span><span class="koboSpan" id="kobo.41.2">Data from web analytics is frequently shown on dashboards that can be altered on the basis of a user persona or time period, along with other factors. </span><span class="koboSpan" id="kobo.41.3">These dashboards are then used to make product and market decisions, so the accuracy of this data is of paramount importance. </span><span class="koboSpan" id="kobo.41.4">The data can be divided into groups, including </span><span class="No-Break"><span class="koboSpan" id="kobo.42.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.43.1">By examining the number of visits, the proportion of new versus returning visitors, the origin of the visitors, and the browser or device they are using (desktop vs. </span><span class="koboSpan" id="kobo.43.2">mobile), it is possible to understand </span><span class="No-Break"><span class="koboSpan" id="kobo.44.1">audience data</span></span></li>
<li><span class="koboSpan" id="kobo.45.1">Common landing pages, commonly visited pages, common exit pages, the amount of time spent per visit, the number of pages per visit, and the bounce rate can all be used to study </span><span class="No-Break"><span class="koboSpan" id="kobo.46.1">audience behavior</span></span></li>
<li><span class="koboSpan" id="kobo.47.1">Campaign data to understand which campaigns have generated the most traffic, the best websites working as referral sources, which keyword searches led to visits, and a breakdown of the campaign’s mediums, such as email versus </span><span class="No-Break"><span class="koboSpan" id="kobo.48.1">social media</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.49.1">This information can then be used by sales, product, and marketing teams to gain knowledge about how the users interact with the product, how to tailor messages, and how to </span><span class="No-Break"><span class="koboSpan" id="kobo.50.1">improve products.</span></span></p>
<p><span class="koboSpan" id="kobo.51.1">One of the best and most potent tools available for tracking and analyzing website traffic is Google Analytics. </span><span class="koboSpan" id="kobo.51.2">You can learn a ton about your website’s visitors from this, including who they are, what they are looking for, and how they found you. </span><span class="koboSpan" id="kobo.51.3">Google Analytics should be used by every company</span><a id="_idIndexMarker457"/><span class="koboSpan" id="kobo.52.1"> that wants to develop and improve its </span><span class="No-Break"><span class="koboSpan" id="kobo.53.1">online presence.</span></span></p>
<p><span class="koboSpan" id="kobo.54.1">The most crucial information</span><a id="_idIndexMarker458"/><span class="koboSpan" id="kobo.55.1"> that Google Analytics will provide you with is </span><span class="No-Break"><span class="koboSpan" id="kobo.56.1">listed here:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.57.1">Where your visitors are coming from – very important if you’re targeting a </span><span class="No-Break"><span class="koboSpan" id="kobo.58.1">specific audience.</span></span></li>
<li><span class="koboSpan" id="kobo.59.1">How people find your website is crucial information for figuring out whether your efforts are successful. </span><span class="koboSpan" id="kobo.59.2">It indicates whether users arrived at your site directly, via a link from another website (such as Twitter or Facebook), or via </span><span class="No-Break"><span class="koboSpan" id="kobo.60.1">search engines.</span></span></li>
<li><span class="koboSpan" id="kobo.61.1">Browsers used by your visitors – by understanding which browsers they use, you can decide which ones you should </span><span class="No-Break"><span class="koboSpan" id="kobo.62.1">concentrate on.</span></span></li>
<li><span class="koboSpan" id="kobo.63.1">Which search engine terms people used to find your website are essential information for SEO. </span><span class="koboSpan" id="kobo.63.2">Finding out what search terms people use to find your website helps you gauge </span><span class="No-Break"><span class="koboSpan" id="kobo.64.1">your progress.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.65.1">In the next section, we will dive into how we can use Google Analytics data to understand our </span><span class="No-Break"><span class="koboSpan" id="kobo.66.1">customer base</span><a id="_idTextAnchor1320"/><span class="koboSpan" id="kobo.67.1">s.</span></span></p>
<h1 id="_idParaDest-100"><a id="_idTextAnchor1321"/><span class="koboSpan" id="kobo.68.1">Using web analytics to improve business operations</span></h1>
<p><span class="koboSpan" id="kobo.69.1">By utilizing insights from digital analytics</span><a id="_idIndexMarker459"/><span class="koboSpan" id="kobo.70.1"> and user input, we can increase</span><a id="_idIndexMarker460"/><span class="koboSpan" id="kobo.71.1"> the performance of our websites and apps through conversion rate optimization. </span><span class="koboSpan" id="kobo.71.2">This is done by using the current traffic and maximizing it, with the intention of leading to a rise in sales, leads, or any </span><span class="No-Break"><span class="koboSpan" id="kobo.72.1">other goal.</span></span></p>
<p><span class="koboSpan" id="kobo.73.1">With the help of digital analytics dashboards and analysis, we can monitor user activity, including their source, where they go on our website or app, and how they move around the various pages. </span><span class="koboSpan" id="kobo.73.2">We can determine where there is the most potential and what needs to be changed to meet the specified aims and objectives thanks to the content and user </span><span class="No-Break"><span class="koboSpan" id="kobo.74.1">behavior analysis.</span></span></p>
<p><span class="koboSpan" id="kobo.75.1">Tagging for a business’s website or app has context</span><a id="_idIndexMarker461"/><span class="koboSpan" id="kobo.76.1"> thanks to the definition and execution of a measurement plan. </span><span class="koboSpan" id="kobo.76.2">This enables companies to perform a </span><strong class="bold"><span class="koboSpan" id="kobo.77.1">strengths, weakness, opportunities, and threats</span></strong><span class="koboSpan" id="kobo.78.1"> (</span><strong class="bold"><span class="koboSpan" id="kobo.79.1">SWOT</span></strong><span class="koboSpan" id="kobo.80.1">) analysis, which will lead to fixing your goals and objectives and indicate which user segments must be targeted with particular content and messaging both inside and outside the website </span><span class="No-Break"><span class="koboSpan" id="kobo.81.1">or app.</span></span></p>
<p><span class="koboSpan" id="kobo.82.1">An A/B or multivariate</span><a id="_idIndexMarker462"/><span class="koboSpan" id="kobo.83.1"> test is also possible</span><a id="_idIndexMarker463"/><span class="koboSpan" id="kobo.84.1"> when the opportunity or threat has been identified. </span><span class="koboSpan" id="kobo.84.2">With this, we may display two (or more) different iterations of a website’s functionality to various user groups and then assess which one performs better. </span><span class="koboSpan" id="kobo.84.3">We can make data-driven decisions using this method while ignoring factors such as </span><span class="No-Break"><span class="koboSpan" id="kobo.85.1">seasonal impacts.</span></span></p>
<p><span class="koboSpan" id="kobo.86.1">Now that we have the context of the application, let’s start by looking at the dataset and understanding our needs, our objectives, and the limitations of </span><span class="No-Break"><span class="koboSpan" id="kobo.87.1">the an</span><a id="_idTextAnchor1322"/><span class="koboSpan" id="kobo.88.1">alysis.</span></span></p>
<h1 id="_idParaDest-101"><a id="_idTextAnchor1323"/><span class="koboSpan" id="kobo.89.1">Exploring the data</span></h1>
<p><span class="koboSpan" id="kobo.90.1">We will use the following</span><a id="_idIndexMarker464"/><span class="koboSpan" id="kobo.91.1"> Python modules</span><a id="_idIndexMarker465"/><span class="koboSpan" id="kobo.92.1"> in the </span><span class="No-Break"><span class="koboSpan" id="kobo.93.1">next example:</span></span></p>
<ul>
<li><strong class="bold"><span class="koboSpan" id="kobo.94.1">pandas</span></strong><span class="koboSpan" id="kobo.95.1">: Python package for data analysis</span><a id="_idIndexMarker466"/><span class="koboSpan" id="kobo.96.1"> and </span><span class="No-Break"><span class="koboSpan" id="kobo.97.1">data manipulation.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.98.1">NumPy</span></strong><span class="koboSpan" id="kobo.99.1">: This is a library that adds support</span><a id="_idIndexMarker467"/><span class="koboSpan" id="kobo.100.1"> for large, multi-dimensional arrays and matrices, along with a large collection of high-level mathematical functions to operate on </span><span class="No-Break"><span class="koboSpan" id="kobo.101.1">these arrays.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.102.1">Statsmodels</span></strong><span class="koboSpan" id="kobo.103.1">: Python package that provides a complement</span><a id="_idIndexMarker468"/><span class="koboSpan" id="kobo.104.1"> to SciPy for statistical computations, including descriptive statistics and estimation and inference for statistical models. </span><span class="koboSpan" id="kobo.104.2">It provides classes and functions for the estimation of many different </span><span class="No-Break"><span class="koboSpan" id="kobo.105.1">statistical models.</span></span></li>
<li><strong class="bold"><span class="koboSpan" id="kobo.106.1">Seaborn and Matplotlib</span></strong><span class="koboSpan" id="kobo.107.1">: Python packages for effective</span><a id="_idIndexMarker469"/> <span class="No-Break"><span class="koboSpan" id="kobo.108.1">data</span></span><span class="No-Break"><a id="_idIndexMarker470"/></span><span class="No-Break"><span class="koboSpan" id="kobo.109.1"> visualization.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.110.1">We’ll get started using the </span><span class="No-Break"><span class="koboSpan" id="kobo.111.1">following steps:</span></span></p>
<ol>
<li><span class="koboSpan" id="kobo.112.1">The following block of code will load all the required packages, as well as load the data</span><a id="_idIndexMarker471"/><span class="koboSpan" id="kobo.113.1"> and show the first five rows of it. </span><span class="koboSpan" id="kobo.113.2">For readability purposes, we will limit the maximum number of rows to be shown to </span><strong class="source-inline"><span class="koboSpan" id="kobo.114.1">20</span></strong><span class="koboSpan" id="kobo.115.1">, set the limit of maximum columns to </span><strong class="source-inline"><span class="koboSpan" id="kobo.116.1">50</span></strong><span class="koboSpan" id="kobo.117.1">, and show the floats with </span><strong class="source-inline"><span class="koboSpan" id="kobo.118.1">2</span></strong><span class="koboSpan" id="kobo.119.1"> digit</span><a id="_idTextAnchor1324"/><span class="koboSpan" id="kobo.120.1">s </span><span class="No-Break"><span class="koboSpan" id="kobo.121.1">of precision:</span></span><pre class="console"><span class="koboSpan" id="kobo.122.1">
impo</span><a id="_idTextAnchor1325"/><span class="koboSpan" id="kobo.123.1">rt pandas as pd</span></pre><pre class="console"><span class="koboSpan" id="kobo.124.1">
pd.options.displa</span><a id="_idTextAnchor1326"/><span class="koboSpan" id="kobo.125.1">y.max_rows = 20</span></pre><pre class="console"><span class="koboSpan" id="kobo.126.1">
pd.options.display.m</span><a id="_idTextAnchor1327"/><span class="koboSpan" id="kobo.127.1">ax_columns = 50</span></pre><pre class="console"><span class="koboSpan" id="kobo.128.1">
pd.options.displa</span><a id="_idTextAnchor1328"/><span class="koboSpan" id="kobo.129.1">y.precision = 2</span></pre><pre class="console"><span class="koboSpan" id="kobo.130.1">
df = pd.read_csv('google_analytics_c</span><a id="_idTextAnchor1329"/><span class="koboSpan" id="kobo.131.1">lean_data.csv')</span></pre><pre class="console"><span class="koboSpan" id="kobo.132.1">
df["date"] = pd.to_datetime(df["date"], format="%Y%m%d") # seting the column as </span><a id="_idTextAnchor1330"/><span class="koboSpan" id="kobo.133.1">pandas datetime</span></pre><pre class="console"><span class="koboSpan" id="kobo.134.1">
df.head()</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.135.1">The preceding code will load the file, convert the date column into the correct data type, and prompt us to the</span><a id="_idTextAnchor1331"/> <span class="No-Break"><span class="koboSpan" id="kobo.136.1">first rows.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer238">
<span class="koboSpan" id="kobo.137.1"><img alt="Figure 10.1: Google Analytics sample data " src="image/B19026_10_1.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.138.1">Figure 10.1: Google Analytics sample data</span></p>
<p><span class="koboSpan" id="kobo.139.1">We can see that it’s a demo of the data that we can obtain from Google Analytics, as some columns are </span><span class="No-Break"><span class="koboSpan" id="kobo.140.1">not available.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.141.1">We will explore the s</span><a id="_idTextAnchor1332"/><span class="koboSpan" id="kobo.142.1">et </span><span class="No-Break"><span class="koboSpan" id="kobo.143.1">of columns:</span></span><pre class="console"><span class="koboSpan" id="kobo.144.1">
df.columns</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.145.1">This line will show us the name of all the columns i</span><a id="_idTextAnchor1333"/><span class="koboSpan" id="kobo.146.1">n </span><span class="No-Break"><span class="koboSpan" id="kobo.147.1">the file.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer239">
<span class="koboSpan" id="kobo.148.1"><img alt="Figure 10.2: Column names " src="image/B19026_10_2.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.149.1">Figure 10.2: Column names</span></p>
<p><span class="koboSpan" id="kobo.150.1">From the information</span><a id="_idIndexMarker472"/><span class="koboSpan" id="kobo.151.1"> that we obtain about the columns and the data from the Kaggle competition, we can describe the columns in </span><span class="No-Break"><span class="koboSpan" id="kobo.152.1">the dataset:</span></span></p>
<ul>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.153.1">fullVisitorId</span></strong><span class="koboSpan" id="kobo.154.1">: Identifier for </span><span class="No-Break"><span class="koboSpan" id="kobo.155.1">each user.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.156.1">channelGrouping</span></strong><span class="koboSpan" id="kobo.157.1">: The channel from which the customer </span><span class="No-Break"><span class="koboSpan" id="kobo.158.1">was redirected.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.159.1">date</span></strong><span class="koboSpan" id="kobo.160.1">: The date of </span><span class="No-Break"><span class="koboSpan" id="kobo.161.1">the visit.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.162.1">Device</span></strong><span class="koboSpan" id="kobo.163.1">: Type of </span><span class="No-Break"><span class="koboSpan" id="kobo.164.1">device used.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.165.1">geoNetwork</span></strong><span class="koboSpan" id="kobo.166.1">: Location of </span><span class="No-Break"><span class="koboSpan" id="kobo.167.1">the customer.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.168.1">socialEngagementType</span></strong><span class="koboSpan" id="kobo.169.1">: Is the customer </span><span class="No-Break"><span class="koboSpan" id="kobo.170.1">socially engaged?</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.171.1">trafficSource</span></strong><span class="koboSpan" id="kobo.172.1">: This shows the source of </span><span class="No-Break"><span class="koboSpan" id="kobo.173.1">the traffic.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.174.1">visitId</span></strong><span class="koboSpan" id="kobo.175.1">: Identifier of the </span><span class="No-Break"><span class="koboSpan" id="kobo.176.1">specific visit.</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.177.1">visitNumber</span></strong><span class="koboSpan" id="kobo.178.1">: Count of sessions for the </span><span class="No-Break"><span class="koboSpan" id="kobo.179.1">specific customer.</span></span></li>
</ul>
<ol>
<li value="3"><span class="koboSpan" id="kobo.180.1">Now that we have the information</span><a id="_idIndexMarker473"/><span class="koboSpan" id="kobo.181.1"> about the columns, we can plot the revenue columns to look at </span><span class="No-Break"><span class="koboSpan" id="kobo.182.1">thei</span><a id="_idTextAnchor1334"/><span class="koboSpan" id="kobo.183.1">r distribution:</span></span><pre class="console"><span class="koboSpan" id="kobo.184.1">
df['totals.transactionRevenue'].plot(figsize=(12,4))</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.185.1">This line will use pandas </span><strong class="source-inline"><span class="koboSpan" id="kobo.186.1">plot</span></strong><span class="koboSpan" id="kobo.187.1"> methods to show the distribution of</span><a id="_idTextAnchor1335"/> <span class="No-Break"><span class="koboSpan" id="kobo.188.1">the column.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer240">
<span class="koboSpan" id="kobo.189.1"><img alt="Figure 10.3: Revenue distribution " src="image/B19026_10_3.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.190.1">Figure 10.3: Revenue distribution</span></p>
<p><span class="koboSpan" id="kobo.191.1">Many companies have found the 80/20 rule to be true: only a tiny proportion of clients generate the majority of the revenue, and we can verify this by looking at the data, with a small proportion of clients generating the most amount of revenue. </span><span class="koboSpan" id="kobo.191.2">The problem for marketing teams is allocating the proper funds to promotional activities. </span><span class="koboSpan" id="kobo.191.3">In this instance, the ratio is </span><span class="No-Break"><span class="koboSpan" id="kobo.192.1">significantly lower.</span></span></p>
<ol>
<li value="4"><span class="koboSpan" id="kobo.193.1">The statistical link between the data points is depicted using a relational plot. </span><span class="koboSpan" id="kobo.193.2">Data visualization is crucial for spotting trends and patterns. </span><span class="koboSpan" id="kobo.193.3">This graphic gives users access to additional axes-level functions that, using semantic subset mappings, can illustrate the relationship between two variables. </span><span class="koboSpan" id="kobo.193.4">Passing the entire dataset in long-form mode will aggregate over repeated values (each year) to show the mean and 95% </span><span class="No-Break"><span class="koboSpan" id="kobo.194.1">confidence interval.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.195.1">Here, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.196.1">seaborn</span></strong><span class="koboSpan" id="kobo.197.1"> package to create a relation plot with 95% confidence interval areas for the </span><span class="No-Break"><span class="koboSpan" id="kobo.198.1">r</span><a id="_idTextAnchor1336"/><span class="koboSpan" id="kobo.199.1">evenue column:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.200.1">
import </span><a id="_idTextAnchor1337"/><span class="koboSpan" id="kobo.201.1">seaborn as sns
sns.relplot(x='date', y='totals.transactionRevenue', data=df,kind='line',height=8, aspect=2.2)</span></pre>
<p><span class="koboSpan" id="kobo.202.1">This showcases the distribution</span><a id="_idIndexMarker474"/><span class="koboSpan" id="kobo.203.1"> of the transactions with a confidence interval</span><a id="_idTextAnchor1338"/> <span class="No-Break"><span class="koboSpan" id="kobo.204.1">as follows:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer241">
<span class="koboSpan" id="kobo.205.1"><img alt="Figure 10.4: Revenue distribution with a confidence interval " src="image/B19026_10_4.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.206.1">Figure 10.4: Revenue distribution with a confidence interval</span></p>
<p><span class="koboSpan" id="kobo.207.1">One of the problems we see here is that because of the difference in value, the data is difficult to see, so we will implement a logarithmic scale. </span><span class="koboSpan" id="kobo.207.2">When examining a wide</span><a id="_idIndexMarker475"/><span class="koboSpan" id="kobo.208.1"> range of values, a nonlinear scale called a logarithmic scale is frequently utilized. </span><span class="koboSpan" id="kobo.208.2">Each interval is raised by a factor of the logarithm’s base rather than by equal increments. </span><span class="koboSpan" id="kobo.208.3">A base ten and base e scale are </span><span class="No-Break"><span class="koboSpan" id="kobo.209.1">frequently employed.</span></span></p>
<p><span class="koboSpan" id="kobo.210.1">Sometimes, the data you are displaying is much less or greater than the rest of the data – when the percentage changes between values are significant, logarithmic scales also might be helpful. </span><span class="koboSpan" id="kobo.210.2">If the data on the visualization falls within a very wide range, we can use a </span><span class="No-Break"><span class="koboSpan" id="kobo.211.1">logarithmic scale.</span></span></p>
<p><span class="koboSpan" id="kobo.212.1">Another benefit</span><a id="_idIndexMarker476"/><span class="koboSpan" id="kobo.213.1"> is that when displaying less significant price rises or declines, logarithmic pricing scales perform better than linear price scales. </span><span class="koboSpan" id="kobo.213.2">They can assist you in determining how far the price must rise or fall in order to meet a buy or sell target. </span><span class="koboSpan" id="kobo.213.3">However, logarithmic price scales may become crowded and challenging to read if prices are close together. </span><span class="koboSpan" id="kobo.213.4">When utilizing a logarithmic scale, when the percent change between the values is the same, the vertical distance between the prices on the scale will </span><span class="No-Break"><span class="koboSpan" id="kobo.214.1">be equal.</span></span></p>
<ol>
<li value="5"><span class="koboSpan" id="kobo.215.1">Here, we will implement the logarithmic scale using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.216.1">numpy</span></strong><span class="koboSpan" id="kobo.217.1"> library on the</span><a id="_idTextAnchor1339"/> <span class="No-Break"><span class="koboSpan" id="kobo.218.1">revenue column:</span></span><pre class="console"><span class="koboSpan" id="kobo.219.1">
im</span><a id="_idTextAnchor1340"/><span class="koboSpan" id="kobo.220.1">port numpy as np</span></pre><pre class="console"><span class="koboSpan" id="kobo.221.1">
df['totals.transactionRevenue'] = np.log(df['totals.trans</span><a id="_idTextAnchor1341"/><span class="koboSpan" id="kobo.222.1">actionRevenue'])</span></pre><pre class="console"><span class="koboSpan" id="kobo.223.1">
df['totals.transactionRevenue'].plot(figsize=(12,4))</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.224.1">Here, we can see the transactions on a </span><span class="No-Break"><span class="koboSpan" id="kobo.225.1">logari</span><a id="_idTextAnchor1342"/><span class="koboSpan" id="kobo.226.1">thmic scale.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer242">
<span class="koboSpan" id="kobo.227.1"><img alt="Figure 10.5: Logarithmic scale revenue " src="image/B19026_10_5.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.228.1">Figure 10.5: Logarithmic scale revenue</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.229.1">We can now use the relationship plot to visualize the logarithmic transaction values with their confidence </span><span class="No-Break"><span class="koboSpan" id="kobo.230.1">i</span><a id="_idTextAnchor1343"/><span class="koboSpan" id="kobo.231.1">nterval better:</span></span><pre class="console"><span class="koboSpan" id="kobo.232.1">
sns.relplot(x='date', y='totals.transactionRevenue', data=df,kind='line',height=8, aspect=2.2)</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.233.1">We can get better visibility</span><a id="_idIndexMarker477"/><span class="koboSpan" id="kobo.234.1"> with </span><strong class="source-inline"><span class="koboSpan" id="kobo.235.1">relplot</span></strong><span class="koboSpan" id="kobo.236.1">, which will plot the mean data as a line and show the confidence intervals where 95% percent of the</span><a id="_idTextAnchor1344"/> <span class="No-Break"><span class="koboSpan" id="kobo.237.1">data exists.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer243">
<span class="koboSpan" id="kobo.238.1"><img alt="Figure 10.6: Logarithmic scale revenue with a confidence interval " src="image/B19026_10_6.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.239.1">Figure 10.6: Logarithmic scale revenue with a confidence interval</span></p>
<ol>
<li value="7"><span class="koboSpan" id="kobo.240.1">Another way to visualize</span><a id="_idIndexMarker478"/><span class="koboSpan" id="kobo.241.1"> this is by using scatter plots, which will be helpful for </span><span class="No-Break"><span class="koboSpan" id="kobo.242.1">ident</span><a id="_idTextAnchor1345"/><span class="koboSpan" id="kobo.243.1">ifying outliers:</span></span><pre class="console"><span class="koboSpan" id="kobo.244.1">
import matplotlib.pyplot as plt</span><a id="_idTextAnchor1346"/><span class="koboSpan" id="kobo.245.1"> # visualization</span></pre><pre class="console"><span class="koboSpan" id="kobo.246.1">
data = df.groupby("fullVisitorId")["totals.transactionRevenue"].sum</span><a id="_idTextAnchor1347"/><span class="koboSpan" id="kobo.247.1">().reset_index()</span></pre><pre class="console"><span class="koboSpan" id="kobo.248.1">
f, ax = plt.subplots(</span><a id="_idTextAnchor1348"/><span class="koboSpan" id="kobo.249.1">figsize=(12, 6))</span></pre><pre class="console"><span class="koboSpan" id="kobo.250.1">
fig =sns.scatterplot(x='fullVisitorId', y='totals.transactionRevenue',size=4,alpha=.8,color='red', data=data)</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.251.1">The scatter plot shows us that there are </span><span class="No-Break"><span class="koboSpan" id="kobo.252.1">s</span><a id="_idTextAnchor1349"/><span class="koboSpan" id="kobo.253.1">ome outliers.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer244">
<span class="koboSpan" id="kobo.254.1"><img alt="Figure 10.7: Transactions as scatter plot " src="image/B19026_10_7.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.255.1">Figure 10.7: Transactions as scatter plot</span></p>
<p><span class="koboSpan" id="kobo.256.1">Here, we can see more clearly</span><a id="_idIndexMarker479"/><span class="koboSpan" id="kobo.257.1"> that there are just a couple of users who generate an incredibly high amount of revenue with </span><span class="No-Break"><span class="koboSpan" id="kobo.258.1">their orders.</span></span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.259.1">Now, we can look at the expenditure patterns of the</span><a id="_idTextAnchor1350"/><span class="koboSpan" id="kobo.260.1"> top </span><span class="No-Break"><span class="koboSpan" id="kobo.261.1">50 clients:</span></span><pre class="console"><span class="koboSpan" id="kobo.262.1">
top_50_customers = data.sort_values(['totals.transactionRevenue'],ascending</span><a id="_idTextAnchor1351"/><span class="koboSpan" id="kobo.263.1">=False).head(50)</span></pre><pre class="console"><span class="koboSpan" id="kobo.264.1">
top_50_customers['totals.transactionRevenue'].plot.bar(figsize=(15,6))</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.265.1">The next is a barplot of the </span><span class="No-Break"><span class="koboSpan" id="kobo.266.1">t</span><a id="_idTextAnchor1352"/><span class="koboSpan" id="kobo.267.1">op customers.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer245">
<span class="koboSpan" id="kobo.268.1"><img alt="Figure 10.8: Users with the highest revenue " src="image/B19026_10_8.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.269.1">Figure 10.8: Users with the highest revenue</span></p>
<p><span class="koboSpan" id="kobo.270.1">We can confirm from this graphic that user </span><strong class="bold"><span class="koboSpan" id="kobo.271.1">26437</span></strong><span class="koboSpan" id="kobo.272.1"> is our </span><span class="No-Break"><span class="koboSpan" id="kobo.273.1">biggest customer.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.274.1">Finding potential markets</span><a id="_idIndexMarker480"/><span class="koboSpan" id="kobo.275.1"> for your goods and services with Google Analytics is another fantastic application of the tool. </span><span class="koboSpan" id="kobo.275.2">You can check the number of visits and conversion rates separately by country to choose where to focus your efforts and which locations are worth expanding into if your business runs on a worldwide scale or if you are considering becoming global. </span><span class="koboSpan" id="kobo.275.3">Here, we can analyze the top countries i</span><a id="_idTextAnchor1353"/><span class="koboSpan" id="kobo.276.1">n our </span><span class="No-Break"><span class="koboSpan" id="kobo.277.1">user base:</span></span><pre class="console"><span class="koboSpan" id="kobo.278.1">
global_countries = df['geoNetwork.country'].value_c</span><a id="_idTextAnchor1354"/><span class="koboSpan" id="kobo.279.1">ounts().head(20)</span></pre><pre class="console"><span class="koboSpan" id="kobo.280.1">
global_countries.plot.bar(figsize=(16,6))</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.281.1">The preceding code will show us the countries that the use</span><a id="_idTextAnchor1355"/><span class="koboSpan" id="kobo.282.1">rs </span><span class="No-Break"><span class="koboSpan" id="kobo.283.1">come from.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer246">
<span class="koboSpan" id="kobo.284.1"><img alt="Figure 10.9: Total countries " src="image/B19026_10_9.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.285.1">Figure 10.9: Total countries</span></p>
<p><span class="koboSpan" id="kobo.286.1">We can see that the vast majority of users are concentrated in </span><span class="No-Break"><span class="koboSpan" id="kobo.287.1">the US.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.288.1">Let’s now focus</span><a id="_idIndexMarker481"/><span class="koboSpan" id="kobo.289.1"> on our top clients and see where they come from. </span><span class="koboSpan" id="kobo.289.2">We can do this by masking the users that are in our top 50 users list and then replicating the </span><span class="No-Break"><span class="koboSpan" id="kobo.290.1">pr</span><a id="_idTextAnchor1356"/><span class="koboSpan" id="kobo.291.1">eceding graphic:</span></span><pre class="console"><span class="koboSpan" id="kobo.292.1">
top_50_data = df[df.fullVisitorId.isin(top_50_customers</span><a id="_idTextAnchor1357"/><span class="koboSpan" id="kobo.293.1">.fullVisitorId)]</span></pre><pre class="console"><span class="koboSpan" id="kobo.294.1">
top_50_countries = top_50_data['geoNetwork.country'</span><a id="_idTextAnchor1358"/><span class="koboSpan" id="kobo.295.1">].value_counts()</span></pre><pre class="console"><span class="koboSpan" id="kobo.296.1">
top_50_countries.plot.bar(figsize=(12,6))</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.297.1">The preceding code will show us the top countries </span><a id="_idTextAnchor1359"/><span class="koboSpan" id="kobo.298.1">in </span><span class="No-Break"><span class="koboSpan" id="kobo.299.1">a barplot.</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer247">
<span class="koboSpan" id="kobo.300.1"><img alt="Figure 10.10: Countries of biggest customers " src="image/B19026_10_10.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.301.1">Figure 10.10: Countries of biggest customers</span></p>
<p><span class="koboSpan" id="kobo.302.1">Again, we can determine</span><a id="_idIndexMarker482"/><span class="koboSpan" id="kobo.303.1"> that our biggest clients come from the US, followed by Kenya </span><span class="No-Break"><span class="koboSpan" id="kobo.304.1">and Japan.</span></span></p>
<ol>
<li value="11"><span class="koboSpan" id="kobo.305.1">Now, we will analyze how many of our visitors actually converted, meaning that they actually </span><span class="No-Break"><span class="koboSpan" id="kobo.306.1">b</span><a id="_idTextAnchor1360"/><span class="koboSpan" id="kobo.307.1">ought something:</span></span><pre class="console"><span class="koboSpan" id="kobo.308.1">
zero_revenue_users = (data["totals.transactionRev</span><a id="_idTextAnchor1361"/><span class="koboSpan" id="kobo.309.1">enue"]==0).sum()</span></pre><pre class="console"><span class="koboSpan" id="kobo.310.1">
print("Number of unique customers with non-zero revenue: ", len(data)-zero_revenue_users, "and the ratio is: ", zero_revenue_us</span><a id="_idTextAnchor1362"/><span class="koboSpan" id="kobo.311.1">ers / len(data))</span></pre><pre class="console"><span class="koboSpan" id="kobo.312.1">
&gt;&gt;&gt; Number of unique customers with non-zero revenue:  6876 and the ratio is:  0.9264536003080478</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.313.1">The ratio is that almost 8% of our users have actually bought from the website, which </span><span class="No-Break"><span class="koboSpan" id="kobo.314.1">is good.</span></span></p>
<ol>
<li value="12"><span class="koboSpan" id="kobo.315.1">Now, we will start the process</span><a id="_idIndexMarker483"/><span class="koboSpan" id="kobo.316.1"> of cleaning the data, so we will look for categorical columns with just a single value. </span><span class="koboSpan" id="kobo.316.2">These are columns that don’t provide any data, so we will</span><a id="_idTextAnchor1363"/><span class="koboSpan" id="kobo.317.1"> get rid </span><span class="No-Break"><span class="koboSpan" id="kobo.318.1">of them:</span></span><pre class="console"><span class="koboSpan" id="kobo.319.1">
const_cols = [c for c in df.columns if df[c].nunique(d</span><a id="_idTextAnchor1364"/><span class="koboSpan" id="kobo.320.1">ropna=False)</span><a id="_idTextAnchor1365"/><span class="koboSpan" id="kobo.321.1">==1 ]</span></pre><pre class="console"><span class="koboSpan" id="kobo.322.1">
Const_cols</span></pre><pre class="console"><span class="koboSpan" id="kobo.323.1">
&gt;&gt;&gt; ['socialEngagementType',</span><a id="_idTextAnchor1366"/><span class="koboSpan" id="kobo.324.1"> 'totals.visits']</span></pre><pre class="console"><span class="koboSpan" id="kobo.325.1">
df = df.drop(const_cols, axis=1)</span></pre></li>
<li><span class="koboSpan" id="kobo.326.1">Now, we will simplify the data by removing some of the columns that we w</span><a id="_idTextAnchor1367"/><span class="koboSpan" id="kobo.327.1">ill not </span><span class="No-Break"><span class="koboSpan" id="kobo.328.1">be using:</span></span><pre class="console"><span class="koboSpan" id="kobo.329.1">
drop_cols = ['sessionId','visitId',</span><a id="_idTextAnchor1368"/><span class="koboSpan" id="kobo.330.1">'visitStartTime',</span></pre><pre class="console"><span class="koboSpan" id="kobo.331.1">
'geoNetwork.continent','geoNetwo</span><a id="_idTextAnchor1369"/><span class="koboSpan" id="kobo.332.1">rk.subContinent',</span></pre><pre class="console"><span class="koboSpan" id="kobo.333.1">
'geoNetwork.region','g</span><a id="_idTextAnchor1370"/><span class="koboSpan" id="kobo.334.1">eoNetwork.metro',</span></pre><pre class="console"><span class="koboSpan" id="kobo.335.1">
'geoNetwork.city','geoNetwor</span><a id="_idTextAnchor1371"/><span class="koboSpan" id="kobo.336.1">k.networkDomain']</span></pre><pre class="console"><span class="koboSpan" id="kobo.337.1">
df = df.drop(dr</span><a id="_idTextAnchor1372"/><span class="koboSpan" id="kobo.338.1">op_cols, axis=1)</span></pre><pre class="console"><span class="koboSpan" id="kobo.339.1">
df.columns</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.340.1">The following screenshot shows the column</span><a id="_idTextAnchor1373"/><span class="koboSpan" id="kobo.341.1">s we </span><span class="No-Break"><span class="koboSpan" id="kobo.342.1">have now:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer248">
<span class="koboSpan" id="kobo.343.1"><img alt="Figure 10.11: Final set of columns " src="image/B19026_10_11.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.344.1">Figure 10.11: Final set of columns</span></p>
<ol>
<li value="14"><span class="koboSpan" id="kobo.345.1">Our columns have now been reduced to the ones</span><a id="_idIndexMarker484"/><span class="koboSpan" id="kobo.346.1"> that we actually need. </span><span class="koboSpan" id="kobo.346.2">Now, let’s explore the </span><strong class="source-inline"><span class="koboSpan" id="kobo.347.1">campaign</span></strong><span class="koboSpan" id="kobo.348.1"> column to find which campaign was</span><a id="_idTextAnchor1374"/> <span class="No-Break"><span class="koboSpan" id="kobo.349.1">more successful:</span></span><pre class="console"><span class="koboSpan" id="kobo.350.1">
df['trafficSource.campaign'].value_counts().plot.bar(figsize=(</span><a id="_idTextAnchor1375"/><span class="koboSpan" id="kobo.351.1">10,6),rot=30)</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer249">
<span class="koboSpan" id="kobo.352.1"><img alt="Figure 10.12: Campaign data " src="image/B19026_10_12.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.353.1">Figure 10.12: Campaign data</span></p>
<p><span class="koboSpan" id="kobo.354.1">We can see from the campaign data</span><a id="_idIndexMarker485"/><span class="koboSpan" id="kobo.355.1"> that most of the traffic doesn’t come from campaigns, and some of them actually perform poorly. </span><span class="koboSpan" id="kobo.355.2">This is information that could help the marketing team to optimize these campaign</span><a id="_idTextAnchor1376"/><span class="koboSpan" id="kobo.356.1">s and </span><span class="No-Break"><span class="koboSpan" id="kobo.357.1">save money.</span></span></p>
<h1 id="_idParaDest-102"><a id="_idTextAnchor1377"/><span class="koboSpan" id="kobo.358.1">Calculating CLV</span></h1>
<p><span class="koboSpan" id="kobo.359.1">Customer lifetime value (CLV) is a metric</span><a id="_idIndexMarker486"/><span class="koboSpan" id="kobo.360.1"> used to describe </span><a id="_idIndexMarker487"/><span class="koboSpan" id="kobo.361.1">how much money a company can expect to make overall from a typical customer during the duration that person or account stays a customer. </span><span class="koboSpan" id="kobo.361.2">CLV is the total amount a company makes from a typical customer during the term of that customer’s relationship with the company and it is used in marketing to forecast the net profit that will be generated over the course of a customer’s entire </span><span class="No-Break"><span class="koboSpan" id="kobo.362.1">future relationship.</span></span></p>
<p><span class="koboSpan" id="kobo.363.1">Knowing the CLV of our clients is crucial since it informs our choices regarding how much money to spend on attracting</span><a id="_idIndexMarker488"/><span class="koboSpan" id="kobo.364.1"> new clients and keeping existing ones. </span><span class="koboSpan" id="kobo.364.2">The simplest way to calculate CLV is by multiplying the average value of a purchase by the number of times the customer will make a purchase each year by the average length of the customer relationship (in years </span><span class="No-Break"><span class="koboSpan" id="kobo.365.1">or months).</span></span></p>
<p><span class="koboSpan" id="kobo.366.1">Numerous benefits can be derived from calculating the CLV of various clients, but business decision-making is the key one. </span><span class="koboSpan" id="kobo.366.2">Knowing your CLV allows you to find out things such as </span><span class="No-Break"><span class="koboSpan" id="kobo.367.1">the following:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.368.1">How much you can spend and still have a lucrative connection with a </span><span class="No-Break"><span class="koboSpan" id="kobo.369.1">similar consumer</span></span></li>
<li><span class="koboSpan" id="kobo.370.1">What kinds of products customers with the highest </span><span class="No-Break"><span class="koboSpan" id="kobo.371.1">CLVs want</span></span></li>
<li><span class="koboSpan" id="kobo.372.1">Which products have the </span><span class="No-Break"><span class="koboSpan" id="kobo.373.1">highest profitability</span></span></li>
<li><span class="koboSpan" id="kobo.374.1">Who your most profitable types of </span><span class="No-Break"><span class="koboSpan" id="kobo.375.1">clients are</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.376.1">Spending your resources on selling more to your present client base is the key since the odds of selling to a current customer are 60 to 70 percent, compared to the odds of selling to a new customer, which are 5 to 20 percent. </span><span class="koboSpan" id="kobo.376.2">Several strategies will make it more likely for a consumer to make additional purchases from a company. </span><span class="koboSpan" id="kobo.376.3">Some of these methods are </span><span class="No-Break"><span class="koboSpan" id="kobo.377.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.378.1">Make returning things that they have purchased from you simple for your clients, as making it difficult or expensive for a user to return a product will drastically lower the likelihood that they will make </span><span class="No-Break"><span class="koboSpan" id="kobo.379.1">another purchase.</span></span></li>
<li><span class="koboSpan" id="kobo.380.1">Set expectations for delivery dates with the goal of exceeding expectations by establishing a safety margin. </span><span class="koboSpan" id="kobo.380.2">Promise delivery by May 20 and deliver it by May 1 instead of the other </span><span class="No-Break"><span class="koboSpan" id="kobo.381.1">way around.</span></span></li>
<li><span class="koboSpan" id="kobo.382.1">Create a program with attainable and desired incentives for users to </span><span class="No-Break"><span class="koboSpan" id="kobo.383.1">repeat purchases.</span></span></li>
<li><span class="koboSpan" id="kobo.384.1">To encourage customers to stick with your brand, </span><span class="No-Break"><span class="koboSpan" id="kobo.385.1">provide incentives.</span></span></li>
<li><span class="koboSpan" id="kobo.386.1">Maintain contact with long-term clients to assert that you are still thinking of them. </span><span class="koboSpan" id="kobo.386.2">Give them a simple way to contact you </span><span class="No-Break"><span class="koboSpan" id="kobo.387.1">as well.</span></span></li>
<li><span class="koboSpan" id="kobo.388.1">Focusing on acquiring and keeping repeat consumers who will promote your brand, as well as </span><span class="No-Break"><span class="koboSpan" id="kobo.389.1">long-term clients.</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.390.1">More concretely, the steps</span><a id="_idIndexMarker489"/><span class="koboSpan" id="kobo.391.1"> to calculate the CLV are </span><span class="No-Break"><span class="koboSpan" id="kobo.392.1">as follows:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.393.1">Slice the data into chunks of </span><span class="No-Break"><span class="koboSpan" id="kobo.394.1">3 months.</span></span></li>
<li><span class="koboSpan" id="kobo.395.1">Sum the revenue for each customer in the last </span><span class="No-Break"><span class="koboSpan" id="kobo.396.1">3 months.</span></span></li>
<li><span class="koboSpan" id="kobo.397.1">Generate columns such as days since the last buy, average number of days between buys, and </span><span class="No-Break"><span class="koboSpan" id="kobo.398.1">so on.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.399.1">We’ll run this using the </span><span class="No-Break"><span class="koboSpan" id="kobo.400.1">following steps:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.401.1">To apply this, we will define some helper functions that we will use along with the aggregate method in </span><strong class="source-inline"><span class="koboSpan" id="kobo.402.1">pandas</span></strong><span class="koboSpan" id="kobo.403.1"> to determine </span><a id="_idTextAnchor1378"/><span class="koboSpan" id="kobo.404.1">the CVL of </span><span class="No-Break"><span class="koboSpan" id="kobo.405.1">our users:</span></span><a id="_idTextAnchor1379"/><pre class="console"><span class="koboSpan" id="kobo.406.1">
def groupby_mean(x)</span><a id="_idTextAnchor1380"/><span class="koboSpan" id="kobo.407.1">:</span></pre><pre class="console"><span class="koboSpan" id="kobo.408.1">
    return x.mean()</span></pre><pre class="console">
<a id="_idTextAnchor1381"/><span class="koboSpan" id="kobo.409.1">def groupby_count(x):</span><a id="_idTextAnchor1382"/></pre><pre class="console"><span class="koboSpan" id="kobo.410.1">
    return x.count()</span></pre><pre class="console"><span class="koboSpan" id="kobo.411.1">
def </span><a id="_idTextAnchor1383"/><span class="koboSpan" id="kobo.412.1">purchase_duration(x):</span></pre><pre class="console"><span class="koboSpan" id="kobo.413.1">
    return (x.</span><a id="_idTextAnchor1384"/><span class="koboSpan" id="kobo.414.1">max() - x.min()).days</span></pre><pre class="console">
<a id="_idTextAnchor1385"/><span class="koboSpan" id="kobo.415.1">def avg_frequency(x):</span></pre><pre class="console"><span class="koboSpan" id="kobo.416.1">
    return (x.max() - x.min()).days/x.count()</span></pre></li>
<li><span class="koboSpan" id="kobo.417.1">We want to establish the time frame of analyses as 3 months, so we will create a variab</span><a id="_idTextAnchor1386"/><span class="koboSpan" id="kobo.418.1">le to </span><span class="No-Break"><span class="koboSpan" id="kobo.419.1">establish this:</span></span><pre class="console"><span class="koboSpan" id="kobo.420.1">
clv_freq = '3M'</span></pre></li>
<li><span class="koboSpan" id="kobo.421.1">One thing to note is that we will be using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.422.1">__name__</span></strong><span class="koboSpan" id="kobo.423.1"> property to determine the function name in Python and to keep the column names tidy. </span><span class="koboSpan" id="kobo.423.2">To access the </span><strong class="source-inline"><span class="koboSpan" id="kobo.424.1">__name__</span></strong><span class="koboSpan" id="kobo.425.1"> property, just put in the function name without parentheses and use the  </span><strong class="source-inline"><span class="koboSpan" id="kobo.426.1">__name__</span></strong><span class="koboSpan" id="kobo.427.1"> property. </span><span class="koboSpan" id="kobo.427.2">It will then return the funct</span><a id="_idTextAnchor1387"/><span class="koboSpan" id="kobo.428.1">ion name as </span><span class="No-Break"><span class="koboSpan" id="kobo.429.1">a string:</span></span><pre class="console"><span class="koboSpan" id="kobo.430.1">
groupby_</span><a id="_idTextAnchor1388"/><span class="koboSpan" id="kobo.431.1">mean.__name__ = 'avg'</span></pre><pre class="console"><span class="koboSpan" id="kobo.432.1">
groupby_cou</span><a id="_idTextAnchor1389"/><span class="koboSpan" id="kobo.433.1">nt.__name__ = 'count'</span></pre><pre class="console"><span class="koboSpan" id="kobo.434.1">
purchase_duration.__name__ </span><a id="_idTextAnchor1390"/><span class="koboSpan" id="kobo.435.1">= 'purchase_duration'</span></pre><pre class="console"><span class="koboSpan" id="kobo.436.1">
avg_frequency.__name__ = 'purchase_frequency'</span></pre></li>
<li><span class="koboSpan" id="kobo.437.1">Now, we can create</span><a id="_idIndexMarker490"/><span class="koboSpan" id="kobo.438.1"> our summary DataFrame by applying the </span><strong class="source-inline"><span class="koboSpan" id="kobo.439.1">groupby</span></strong><span class="koboSpan" id="kobo.440.1"> method and aggregating the values using our previou</span><a id="_idTextAnchor1391"/><span class="koboSpan" id="kobo.441.1">sly </span><span class="No-Break"><span class="koboSpan" id="kobo.442.1">defined functions:</span></span><pre class="console"><span class="koboSpan" id="kobo.443.1">
summary_df = df.reset_index().groupby(</span><a id="_idTextAnchor1392"/><span class="koboSpan" id="kobo.444.1">'fullVisitorId').agg({</span></pre><pre class="console"><span class="koboSpan" id="kobo.445.1">
    'totals.transactionRevenue': [min, max, sum, groupby</span><a id="_idTextAnchor1393"/><span class="koboSpan" id="kobo.446.1">_mean, groupby_count],</span></pre><pre class="console"><span class="koboSpan" id="kobo.447.1">
    'date': [min, max, purchase_du</span><a id="_idTextAnchor1394"/><span class="koboSpan" id="kobo.448.1">ration, avg_frequency]</span></pre><pre class="console"><span class="koboSpan" id="kobo.449.1">
})</span></pre></li>
<li><span class="koboSpan" id="kobo.450.1">Lastly, we will make some corrections to the column </span><a id="_idTextAnchor1395"/><span class="koboSpan" id="kobo.451.1">names </span><span class="No-Break"><span class="koboSpan" id="kobo.452.1">for readability:</span></span><pre class="console"><span class="koboSpan" id="kobo.453.1">
summary_df.columns = ['_'.join(col).lower() for col in summary_df.columns]</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.454.1">We can check the final s</span><a id="_idTextAnchor1396"/><span class="koboSpan" id="kobo.455.1">ize of </span><span class="No-Break"><span class="koboSpan" id="kobo.456.1">the DataFrame:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.457.1">
summary_df.shape
&gt;&gt;&gt; (93492, 9)</span></pre>
<p><span class="koboSpan" id="kobo.458.1">We can also check the distribution of the values wit</span><a id="_idTextAnchor1397"/><span class="koboSpan" id="kobo.459.1">h the </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.460.1">describe</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.461.1"> method:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.462.1">
summary_df.describe()</span></pre>
<p><span class="koboSpan" id="kobo.463.1">Here, we are calling a statistical s</span><a id="_idTextAnchor1398"/><span class="koboSpan" id="kobo.464.1">ummary </span><span class="No-Break"><span class="koboSpan" id="kobo.465.1">from </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.466.1">pandas</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.467.1">:</span></span></p>
<div>
<div class="IMG---Figure" id="_idContainer250">
<span class="koboSpan" id="kobo.468.1"><img alt="Figure 10.13: Calculated user CLV " src="image/B19026_10_13.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.469.1">Figure 10.13: Calculated user CLV</span></p>
<ol>
<li value="6"><span class="koboSpan" id="kobo.470.1">Now, let’s filter the ones that have actually</span><a id="_idIndexMarker491"/><span class="koboSpan" id="kobo.471.1"> bought something by looking</span><a id="_idTextAnchor1399"/><span class="koboSpan" id="kobo.472.1"> at the </span><span class="No-Break"><span class="koboSpan" id="kobo.473.1">purchase date:</span></span><pre class="console"><span class="koboSpan" id="kobo.474.1">
summary_df = summary_df.loc[summary_</span></pre><pre class="console"><span class="koboSpan" id="kobo.475.1">
      df['date_purchase_duration'] &gt; 0]</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.476.1">After this, we have widely reduced the number of</span><a id="_idTextAnchor1400"/><span class="koboSpan" id="kobo.477.1"> users in </span><span class="No-Break"><span class="koboSpan" id="kobo.478.1">our data</span><a id="_idTextAnchor1401"/><span class="koboSpan" id="kobo.479.1">set:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.480.1">
summary_df.shape
&gt;&gt;&gt; (66168, 9)</span></pre>
<ol>
<li value="7"><span class="koboSpan" id="kobo.481.1">We can visualize these results by plotting the grouped results using </span><a id="_idTextAnchor1402"/><span class="koboSpan" id="kobo.482.1">the </span><span class="No-Break"><span class="koboSpan" id="kobo.483.1">transaction count:</span></span><pre class="console"><span class="koboSpan" id="kobo.484.1">
import ma</span><a id="_idTextAnchor1403"/><span class="koboSpan" id="kobo.485.1">tplotlib.pyplot as plt</span></pre><pre class="console"><span class="koboSpan" id="kobo.486.1">
ax = summary_df.groupby('totals.transactionrevenue_count').count()['totals.transactionre</span><a id="_idTextAnchor1404"/><span class="koboSpan" id="kobo.487.1">venue_avg'][:20].</span><a id="_idTextAnchor1405"/><span class="koboSpan" id="kobo.488.1">plot(</span></pre><pre class="console"><span class="koboSpan" id="kobo.489.1">
    kind='ba</span><a id="_idTextAnchor1406"/><span class="koboSpan" id="kobo.490.1">r',</span></pre><pre class="console"><span class="koboSpan" id="kobo.491.1">
    color='blue'</span><a id="_idTextAnchor1407"/><span class="koboSpan" id="kobo.492.1">,</span></pre><pre class="console"><span class="koboSpan" id="kobo.493.1">
    figsize=</span><a id="_idTextAnchor1408"/><span class="koboSpan" id="kobo.494.1">(1</span><a id="_idTextAnchor1409"/><span class="koboSpan" id="kobo.495.1">2,7),</span></pre><pre class="console"><span class="koboSpan" id="kobo.496.1">
    grid=True</span></pre><pre class="console"><span class="koboSpan" id="kobo.497.1">
)</span></pre><pre class="console">
<a id="_idTextAnchor1410"/><span class="koboSpan" id="kobo.498.1">ax.set_ylabel(</span><a id="_idTextAnchor1411"/><span class="koboSpan" id="kobo.499.1">'count')</span></pre><pre class="console"><span class="koboSpan" id="kobo.500.1">
plt.show()</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer251">
<span class="koboSpan" id="kobo.501.1"><img alt="Figure 10.14: Transaction revenue count " src="image/B19026_10_14.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.502.1">Figure 10.14: Transaction revenue count</span></p>
<ol>
<li value="8"><span class="koboSpan" id="kobo.503.1">Now, the most common number</span><a id="_idIndexMarker492"/><span class="koboSpan" id="kobo.504.1"> of transactions made is </span><strong class="bold"><span class="koboSpan" id="kobo.505.1">2</span></strong><span class="koboSpan" id="kobo.506.1">, reducing in a parabolic manner. </span><span class="koboSpan" id="kobo.506.2">This gives us enough information to be able to offer customers incentives to keep buying after their </span><span class="No-Break"><span class="koboSpan" id="kobo.507.1">second transaction.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.508.1">Now let’s take a look at the number of days</span><a id="_idTextAnchor1412"/> <span class="No-Break"><span class="koboSpan" id="kobo.509.1">between transactions:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.510.1">
ax = summary_df['date_purc</span><a id="_idTextAnchor1413"/><span class="koboSpan" id="kobo.511.1">hase_frequenc</span><a id="_idTextAnchor1414"/><span class="koboSpan" id="kobo.512.1">y'].hist(
    bins</span><a id="_idTextAnchor1415"/><span class="koboSpan" id="kobo.513.1">=20,
    color='</span><a id="_idTextAnchor1416"/><span class="koboSpan" id="kobo.514.1">blue',
    rwidth=0</span><a id="_idTextAnchor1417"/><span class="koboSpan" id="kobo.515.1">.7</span><a id="_idTextAnchor1418"/><span class="koboSpan" id="kobo.516.1">,
    figsize=(12,7)
)
ax.set_xlabel('avg. </span><span class="koboSpan" id="kobo.516.2">number of da</span><a id="_idTextAnchor1419"/><span class="koboSpan" id="kobo.517.1">ys between purchases')
</span><a id="_idTextAnchor1420"/><span class="koboSpan" id="kobo.518.1">ax.set_ylabel('</span><a id="_idTextAnchor1421"/><span class="koboSpan" id="kobo.519.1">count')
plt.show()</span></pre>
<div>
<div class="IMG---Figure" id="_idContainer252">
<span class="koboSpan" id="kobo.520.1"><img alt="Figure 10.15: Time between purchases " src="image/B19026_10_15.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.521.1">Figure 10.15: Time between purchases</span></p>
<p><span class="koboSpan" id="kobo.522.1">This information shows us that it’s rare for customers to make another purchase after 25 days, so we can use this information to keep our users engaged in case the number of times between transactions is higher than a given threshold. </span><span class="koboSpan" id="kobo.522.2">This allows us to reduce customer churn and </span><span class="No-Break"><span class="koboSpan" id="kobo.523.1">improve loyalty.</span></span></p>
<p><span class="koboSpan" id="kobo.524.1">Now, we have determined how we can calculate</span><a id="_idIndexMarker493"/><span class="koboSpan" id="kobo.525.1"> the CLV, which will allow us to craft better marketing strategies, knowing exactly what we can spend to </span><a id="_idTextAnchor1422"/><span class="koboSpan" id="kobo.526.1">acquire </span><span class="No-Break"><span class="koboSpan" id="kobo.527.1">each customer.</span></span></p>
<h1 id="_idParaDest-103"><a id="_idTextAnchor1423"/><span class="koboSpan" id="kobo.528.1">Predicting customer revenue</span></h1>
<p><span class="koboSpan" id="kobo.529.1">By utilizing the historical transactional data</span><a id="_idIndexMarker494"/><span class="koboSpan" id="kobo.530.1"> from our company, we are attempting to forecast the future revenue that we will get from our clients at a given time. </span><span class="koboSpan" id="kobo.530.2">Planning how to reach your revenue goals is simpler when you can predict your revenue with accuracy, and in a lot of cases, marketing teams are given a revenue target, particularly after a funding round in </span><span class="No-Break"><span class="koboSpan" id="kobo.531.1">startup industries.</span></span></p>
<p><span class="koboSpan" id="kobo.532.1">B2B marketing focuses on the target goals, and here is when historical forecasting, which predicts our revenue using historical data, has consistently been successful. </span><span class="koboSpan" id="kobo.532.2">This is because precise historical revenue and pipeline data provide priceless insights into your previous revenue creation. </span><span class="koboSpan" id="kobo.532.3">You can then forecast what you’ll need in order to meet your income goals using these insights. </span><span class="koboSpan" id="kobo.532.4">Things that will allow us to provide better information to the marketing teams can be summarized into four metrics before you start calculating your </span><span class="No-Break"><span class="koboSpan" id="kobo.533.1">anticipated revenue:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.534.1">How long you take to </span><span class="No-Break"><span class="koboSpan" id="kobo.535.1">generate revenue</span></span></li>
<li><span class="koboSpan" id="kobo.536.1">The average time deals spend in each </span><span class="No-Break"><span class="koboSpan" id="kobo.537.1">pipeline stage</span></span></li>
<li><span class="koboSpan" id="kobo.538.1">The number of </span><span class="No-Break"><span class="koboSpan" id="kobo.539.1">previous deals</span></span></li>
<li><span class="koboSpan" id="kobo.540.1">The revenue generated for the </span><span class="No-Break"><span class="koboSpan" id="kobo.541.1">time period</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.542.1">These metrics form the basis of your predicted revenue in most cases and will allow the creation of better-defined </span><span class="No-Break"><span class="koboSpan" id="kobo.543.1">marketing plans.</span></span></p>
<p><span class="koboSpan" id="kobo.544.1">Questions such as how long it takes for a user to start making money require you to gather these metrics. </span><span class="koboSpan" id="kobo.544.2">Knowing your user’s time to revenue (the length of time it takes a deal to generate a paying customer) is the first step. </span><span class="koboSpan" id="kobo.544.3">This is due to the fact that time to revenue determines the framework for how long it typically takes you to create revenue and earn back the investment made into gaining this customer, from the moment an account is created to the user making a purchase. </span><span class="koboSpan" id="kobo.544.4">If these metrics are omitted, your revenue cycle and your estimates will be out of sync without this parameter, which may cause you to miss goals and allocate money incorrectly. </span><span class="koboSpan" id="kobo.544.5">The fact is that you must be aware of your time </span><span class="No-Break"><span class="koboSpan" id="kobo.545.1">to revenue.</span></span></p>
<p><span class="koboSpan" id="kobo.546.1">Equally, the only way to measure it precisely is to gather data starting from the instant an anonymous user first interacts with you until the moment this account converts to a client. </span><span class="koboSpan" id="kobo.546.2">If you don’t identify first contact, you’re measuring incorrectly and, once more, underestimating how long it actually takes you to make </span><span class="No-Break"><span class="koboSpan" id="kobo.547.1">an income:</span></span></p>
<ol>
<li value="1"><span class="koboSpan" id="kobo.548.1">We will start the analysis by importing</span><a id="_idIndexMarker495"/><span class="koboSpan" id="kobo.549.1"> the packages that we will be using, including the </span><strong class="source-inline"><span class="koboSpan" id="kobo.550.1">LightGBM</span></strong><span class="koboSpan" id="kobo.551.1"> classification. </span><span class="koboSpan" id="kobo.551.2">It’s important to note that we will the transactio</span><a id="_idTextAnchor1424"/><span class="koboSpan" id="kobo.552.1">n NaN values </span><span class="No-Break"><span class="koboSpan" id="kobo.553.1">with zeros:</span></span><pre class="console"><span class="koboSpan" id="kobo.554.1">
from sklearn import model_selection</span><a id="_idTextAnchor1425"/><span class="koboSpan" id="kobo.555.1">, preprocessing, metric</span><a id="_idTextAnchor1426"/><span class="koboSpan" id="kobo.556.1">s</span></pre><pre class="console"><span class="koboSpan" id="kobo.557.1">
import lightgbm as lgb</span></pre><pre class="console"><span class="koboSpan" id="kobo.558.1">
# Impute 0 f</span><a id="_idTextAnchor1427"/><span class="koboSpan" id="kobo.559.1">or missing target values</span></pre><pre class="console"><span class="koboSpan" id="kobo.560.1">
df["totals.transactionRevenue"]</span><a id="_idTextAnchor1428"/><span class="koboSpan" id="kobo.561.1">.fillna(0, inplace=True)</span></pre><pre class="console"><span class="koboSpan" id="kobo.562.1">
y = df["totals.tra</span><a id="_idTextAnchor1429"/><span class="koboSpan" id="kobo.563.1">nsactionRevenue"].values</span></pre><pre class="console"><span class="koboSpan" id="kobo.564.1">
id = df["fullVisitorId"].values</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.565.1">To make categorical data available to the various models, categorical data must be translated into integer representation first through the process of encoding. </span><span class="koboSpan" id="kobo.565.2">Data preparation is a necessary step before modeling in the field of data science – so, how do you handle categorical data in data science? </span><span class="koboSpan" id="kobo.565.3">Some of the methods used are </span><span class="No-Break"><span class="koboSpan" id="kobo.566.1">as follows:</span></span></p>
<ul>
<li><span class="koboSpan" id="kobo.567.1">One-hot encoding using Python’s </span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.568.1">category_encoding</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.569.1"> library</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.570.1">Scikit-learn preprocessing</span></span></li>
<li><strong class="source-inline"><span class="koboSpan" id="kobo.571.1">get_dummies</span></strong> <span class="No-Break"><span class="koboSpan" id="kobo.572.1">in pandas</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.573.1">Binary encoding</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.574.1">Frequency encoding</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.575.1">Label encoding</span></span></li>
<li><span class="No-Break"><span class="koboSpan" id="kobo.576.1">Ordinal encoding</span></span></li>
</ul>
<p><span class="koboSpan" id="kobo.577.1">When data cannot be transported across systems or applications in its existing format, this method is frequently employed to ensure the integrity and usefulness of the data. </span><span class="koboSpan" id="kobo.577.2">Data protection and security do not employ encoding because it is simple </span><span class="No-Break"><span class="koboSpan" id="kobo.578.1">to decode.</span></span></p>
<p><span class="koboSpan" id="kobo.579.1">A very effective method</span><a id="_idIndexMarker496"/><span class="koboSpan" id="kobo.580.1"> for converting the levels of categorical features into numerical values is to use labels with a value between 0 and n classes - 1, where n is the number of different labels. </span><span class="koboSpan" id="kobo.580.2">Here, we are encoding the variables using </span><strong class="source-inline"><span class="koboSpan" id="kobo.581.1">LabelEncoder</span></strong><span class="koboSpan" id="kobo.582.1">. </span><span class="koboSpan" id="kobo.582.2">A label that repeats assigns the same value as it did the </span><span class="No-Break"><span class="koboSpan" id="kobo.583.1">first time.</span></span></p>
<ol>
<li value="2"><span class="koboSpan" id="kobo.584.1">We will list the categorical columns that we want to encode. </span><span class="koboSpan" id="kobo.584.2">Here, the list is hardcoded, but we could have used </span><strong class="source-inline"><span class="koboSpan" id="kobo.585.1">pandas</span></strong><span class="koboSpan" id="kobo.586.1"> data types to det</span><a id="_idTextAnchor1430"/><span class="koboSpan" id="kobo.587.1">ermine the </span><span class="No-Break"><span class="koboSpan" id="kobo.588.1">object column:</span></span><pre class="console"><span class="koboSpan" id="kobo.589.1">
cat_cols = ['channelGrouping','device.browser','device.deviceCategory','device.operatingSystem','geoNetwork.country','trafficSource.campaign','trafficSource.keyword','trafficSource.medium','trafficSource.referralPath','trafficSource.source','trafficSource.isTrueDirect']</span></pre></li>
<li><span class="koboSpan" id="kobo.590.1">Now, we will iterate over them and encode</span><a id="_idTextAnchor1431"/><span class="koboSpan" id="kobo.591.1"> them </span><span class="No-Break"><span class="koboSpan" id="kobo.592.1">using </span></span><span class="No-Break"><strong class="source-inline"><span class="koboSpan" id="kobo.593.1">LabelEnco</span><a id="_idTextAnchor1432"/><span class="koboSpan" id="kobo.594.1">der</span></strong></span><span class="No-Break"><span class="koboSpan" id="kobo.595.1">:</span></span><pre class="console"><span class="koboSpan" id="kobo.596.1">
for col in</span><a id="_idTextAnchor1433"/><span class="koboSpan" id="kobo.597.1"> cat_cols:</span></pre><pre class="console"><span class="koboSpan" id="kobo.598.1">
    print(col)</span></pre><pre class="console"><span class="koboSpan" id="kobo.599.1">
    lbl = pre</span><a id="_idTextAnchor1434"/><span class="koboSpan" id="kobo.600.1">processing.LabelEncoder()</span></pre><pre class="console"><span class="koboSpan" id="kobo.601.1">
    lbl.fit(list(df[co</span><a id="_idTextAnchor1435"/><span class="koboSpan" id="kobo.602.1">l].values.astype('str')))</span></pre><pre class="console"><span class="koboSpan" id="kobo.603.1">
    df[col] = lbl.transform(list(df[col].values.astype('str')))</span></pre></li>
<li><span class="koboSpan" id="kobo.604.1">Now that the categorical columns have been converted, we will continue to convert the numerical columns into floats to meet the requirements </span><span class="No-Break"><span class="koboSpan" id="kobo.605.1">of LightGBM.</span></span></li>
</ol>
<p><span class="koboSpan" id="kobo.606.1">The next are the columns that</span><a id="_idTextAnchor1436"/><span class="koboSpan" id="kobo.607.1"> we will be </span><span class="No-Break"><span class="koboSpan" id="kobo.608.1">working with:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.609.1">
n</span><a id="_idTextAnchor1437"/><span class="koboSpan" id="kobo.610.1">um_cols = ['totals.hits',
      </span><a id="_idTextAnchor1438"/><span class="koboSpan" id="kobo.611.1">      'totals.pageviews',
            'visitNumber',
    </span><a id="_idTextAnchor1439"/><span class="koboSpan" id="kobo.612.1">        'totals.bounces',
            'totals.newVisits']</span></pre>
<ol>
<li value="5"><span class="koboSpan" id="kobo.613.1">As the next step, we use the </span><strong class="source-inline"><span class="koboSpan" id="kobo.614.1">astype</span></strong><span class="koboSpan" id="kobo.615.1"> pandas method</span><a id="_idIndexMarker497"/><span class="koboSpan" id="kobo.616.1"> to cast the</span><a id="_idTextAnchor1440"/><span class="koboSpan" id="kobo.617.1">se data types </span><span class="No-Break"><span class="koboSpan" id="kobo.618.1">into fl</span><a id="_idTextAnchor1441"/><span class="koboSpan" id="kobo.619.1">oats:</span></span><pre class="console"><span class="koboSpan" id="kobo.620.1">
for col i</span><a id="_idTextAnchor1442"/><span class="koboSpan" id="kobo.621.1">n num_cols:</span></pre><pre class="console"><span class="koboSpan" id="kobo.622.1">
    print(col)</span></pre><pre class="console"><span class="koboSpan" id="kobo.623.1">
    df[col] = df[col].astype(float)</span></pre></li>
<li><span class="koboSpan" id="kobo.624.1">Now, we can split the training dataset into development (</span><strong class="source-inline"><span class="koboSpan" id="kobo.625.1">dev</span></strong><span class="koboSpan" id="kobo.626.1">) and </span><a id="_idTextAnchor1443"/><span class="koboSpan" id="kobo.627.1">valid (</span><strong class="source-inline"><span class="koboSpan" id="kobo.628.1">val</span></strong><span class="koboSpan" id="kobo.629.1">) base</span><a id="_idTextAnchor1444"/><span class="koboSpan" id="kobo.630.1">d </span><span class="No-Break"><span class="koboSpan" id="kobo.631.1">on time:</span></span><pre class="console"><span class="koboSpan" id="kobo.632.1">
import datetime</span></pre><pre class="console"><span class="koboSpan" id="kobo.633.1">
dev_df = df</span><a id="_idTextAnchor1445"/><span class="koboSpan" id="kobo.634.1">[df['date']&lt;='2017-05-31']</span></pre><pre class="console"><span class="koboSpan" id="kobo.635.1">
val_df = df[df['date']&gt;'2017-05-31']</span></pre></li>
<li><span class="koboSpan" id="kobo.636.1">Apply the lo</span><a id="_idTextAnchor1446"/><span class="koboSpan" id="kobo.637.1">g to the </span><span class="No-Break"><span class="koboSpan" id="kobo.638.1">revenue variable:</span></span><pre class="console"><span class="koboSpan" id="kobo.639.1">
dev_y = np.log1p(dev_df["totals.tr</span><a id="_idTextAnchor1447"/><span class="koboSpan" id="kobo.640.1">ansactionRevenue"].values)</span></pre><pre class="console"><span class="koboSpan" id="kobo.641.1">
val_y = np.log1p(val_df["totals.transactionRevenue"].values)</span></pre></li>
<li><span class="koboSpan" id="kobo.642.1">Next, we concatenate the categori</span><a id="_idTextAnchor1448"/><span class="koboSpan" id="kobo.643.1">cal and </span><span class="No-Break"><span class="koboSpan" id="kobo.644.1">numerical columns:</span></span><pre class="console"><span class="koboSpan" id="kobo.645.1">
dev_X = de</span><a id="_idTextAnchor1449"/><span class="koboSpan" id="kobo.646.1">v_df[cat_cols + num_cols]</span></pre><pre class="console"><span class="koboSpan" id="kobo.647.1">
val_X = val_df[cat_cols + num_cols]</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.648.1">The final shape of the development DataFrame can be found</span><a id="_idTextAnchor1450"/> <span class="No-Break"><span class="koboSpan" id="kobo.649.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.650.1">
dev_df.shape
&gt;&gt;&gt; (237158, 20)</span></pre>
<p><span class="koboSpan" id="kobo.651.1">The final shape of the validation DataFrame can be found</span><a id="_idTextAnchor1451"/> <span class="No-Break"><span class="koboSpan" id="kobo.652.1">as follows:</span></span></p>
<pre class="console"><span class="koboSpan" id="kobo.653.1">
val_df.shape
&gt;&gt;&gt; (45820, 20)</span></pre>
<p><span class="koboSpan" id="kobo.654.1">In order to predict the CLV of each user, we will use the LightGBM regressor as specified before. </span><span class="koboSpan" id="kobo.654.2">This algorithm is one of the best-performing and it’s a decision </span><span class="No-Break"><span class="koboSpan" id="kobo.655.1">tree algorithm.</span></span></p>
<p><span class="koboSpan" id="kobo.656.1">A decision tree</span><a id="_idIndexMarker498"/><span class="koboSpan" id="kobo.657.1"> is a supervised machine learning tool that can be used to classify or forecast data based on how queries from the past have been answered. </span><span class="koboSpan" id="kobo.657.2">An example of supervised learning is a decision tree model, which is trained and tested on datasets that have the desired category. </span><span class="koboSpan" id="kobo.657.3">The non-parametric approach used for classification and regression applications is the decision tree. </span><span class="koboSpan" id="kobo.657.4">It is organized hierarchically and has a root node, branches, internal nodes, and </span><span class="No-Break"><span class="koboSpan" id="kobo.658.1">leaf nodes.</span></span></p>
<p><span class="koboSpan" id="kobo.659.1">LightGBM is a gradient-boosting algorithm built on decision trees that improves a model’s performance while using less memory. </span><span class="koboSpan" id="kobo.659.2">An open source gradient boosting</span><a id="_idIndexMarker499"/><span class="koboSpan" id="kobo.660.1"> implementation in Python, also called </span><strong class="source-inline"><span class="koboSpan" id="kobo.661.1">LightGBM</span></strong><span class="koboSpan" id="kobo.662.1">, is made to be as effective as existing implementations, if not more so. </span><span class="koboSpan" id="kobo.662.2">The software library, machine learning method, and open source project are all referred to collectively </span><span class="No-Break"><span class="koboSpan" id="kobo.663.1">as LightGBM.</span></span></p>
<p><span class="koboSpan" id="kobo.664.1">The benefits of LightGBM include</span><a id="_idIndexMarker500"/><span class="koboSpan" id="kobo.665.1"> faster training rates and greater effectiveness: LightGBM employs a histogram-based approach, which accelerates the training process by bucketing continuous feature values into discrete bins. </span><span class="koboSpan" id="kobo.665.2">This technique also converts continuous values into discrete bins, which use </span><span class="No-Break"><span class="koboSpan" id="kobo.666.1">less memory.</span></span></p>
<ol>
<li value="9"><span class="koboSpan" id="kobo.667.1">To simplify the training pipeline, we will implement a custom function to run the LightGBM model. </span><span class="koboSpan" id="kobo.667.2">This function has predefined parameters that we can change according to the performance obtained. </span><span class="koboSpan" id="kobo.667.3">These parameters are passed as a dictionary and the documentation can te</span><a id="_idTextAnchor1452"/><span class="koboSpan" id="kobo.668.1">ll you a bit more </span><span class="No-Break"><span class="koboSpan" id="kobo.669.1">about them:</span></span><pre class="console"><span class="koboSpan" id="kobo.670.1">
def run_lgb(tra</span><a id="_idTextAnchor1453"/><span class="koboSpan" id="kobo.671.1">in_X, train_y, </span><a id="_idTextAnchor1454"/><span class="koboSpan" id="kobo.672.1">val_X, val_y):</span></pre><pre class="console"><span class="koboSpan" id="kobo.673.1">
    params = {</span></pre><pre class="console"><span class="koboSpan" id="kobo.674.1">
      </span><a id="_idTextAnchor1455"/><span class="koboSpan" id="kobo.675.1">  "objective" : "regression"</span><a id="_idTextAnchor1456"/><span class="koboSpan" id="kobo.676.1">,</span></pre><pre class="console"><span class="koboSpan" id="kobo.677.1">
        "metric" : "rmse"</span><a id="_idTextAnchor1457"/><span class="koboSpan" id="kobo.678.1">,</span></pre><pre class="console"><span class="koboSpan" id="kobo.679.1">
        "num_leaves" : 50,</span></pre><pre class="console"><span class="koboSpan" id="kobo.680.1">
        "learning_rate" : 0.1,</span></pre><pre class="console"><span class="koboSpan" id="kobo.681.1">
    </span><a id="_idTextAnchor1458"/><span class="koboSpan" id="kobo.682.1">    "bagging_fraction" : 0.7,</span></pre><pre class="console"><span class="koboSpan" id="kobo.683.1">
    </span><a id="_idTextAnchor1459"/><span class="koboSpan" id="kobo.684.1">    "feature_fraction" : 0.5,</span></pre><pre class="console"><span class="koboSpan" id="kobo.685.1">
        "bagging_frequency" </span><a id="_idTextAnchor1460"/><span class="koboSpan" id="kobo.686.1">: 5,</span></pre><pre class="console"><span class="koboSpan" id="kobo.687.1">
        "verbosity" : -1</span></pre><pre class="console"><span class="koboSpan" id="kobo.688.1">
    }</span></pre><pre class="console"><span class="koboSpan" id="kobo.689.1">
    lg_train = lgb.Da</span><a id="_idTextAnchor1461"/><span class="koboSpan" id="kobo.690.1">taset(train_X, label=train_y)</span></pre><pre class="console"><span class="koboSpan" id="kobo.691.1">
    lg_val = lg</span><a id="_idTextAnchor1462"/><span class="koboSpan" id="kobo.692.1">b.Dataset(val_X, label=val_y)</span></pre><pre class="console"><span class="koboSpan" id="kobo.693.1">
    model = lgb.train(params, lg_train , 1000, </span></pre><pre class="console"><span class="koboSpan" id="kobo.694.1">
    valid_sets=[lg_val ], early_stopping_</span><a id="_idTextAnchor1463"/><span class="koboSpan" id="kobo.695.1">rounds=100, </span></pre><pre class="console"><span class="koboSpan" id="kobo.696.1">
    verbose_eval=100)</span></pre><pre class="console"><span class="koboSpan" id="kobo.697.1">
    pred_val_y = model.predict(val_X, </span></pre><pre class="console"><span class="koboSpan" id="kobo.698.1">
    num_it</span><a id="_idTextAnchor1464"/><span class="koboSpan" id="kobo.699.1">eration=model.best_iteration)</span></pre><pre class="console"><span class="koboSpan" id="kobo.700.1">
    return model, pred_val_y</span></pre></li>
</ol>
<p><span class="koboSpan" id="kobo.701.1">Here, the function loads the training</span><a id="_idIndexMarker501"/><span class="koboSpan" id="kobo.702.1"> and development datasets using the </span><strong class="source-inline"><span class="koboSpan" id="kobo.703.1">Dataset</span></strong><span class="koboSpan" id="kobo.704.1"> method and trains the model using the specified parameters during 1,000 steps. </span><span class="koboSpan" id="kobo.704.2">The development dataset is used for validation, as it will give us information about the overall performance of </span><span class="No-Break"><span class="koboSpan" id="kobo.705.1">the model</span><a id="_idTextAnchor1465"/><span class="koboSpan" id="kobo.706.1">.</span></span></p>
<ol>
<li value="10"><span class="koboSpan" id="kobo.707.1">Now, we can train </span><span class="No-Break"><span class="koboSpan" id="kobo.708.1">the model:</span></span><pre class="console"><span class="koboSpan" id="kobo.709.1">
model, pred_val = run_lgb(d</span><a id="_idTextAnchor1466"/><span class="koboSpan" id="kobo.710.1">ev_X, dev_y, val_X, val_y)</span></pre></li>
</ol>
<div>
<div class="IMG---Figure" id="_idContainer253">
<span class="koboSpan" id="kobo.711.1"><img alt="Figure 10.16: RMSE values for the revenue per user " src="image/B19026_10_16.jpg"/></span>
</div>
</div>
<p class="IMG---Caption" lang="en-US" xml:lang="en-US"><span class="koboSpan" id="kobo.712.1">Figure 10.16: RMSE values for the revenue per user</span></p>
<p><span class="koboSpan" id="kobo.713.1">The result shows us that the performance</span><a id="_idIndexMarker502"/><span class="koboSpan" id="kobo.714.1"> of the model can be improved, which would require us to fine-tune the parameters until we reach a level of performance that is with</span><a id="_idTextAnchor1467"/><span class="koboSpan" id="kobo.715.1">in our interval </span><span class="No-Break"><span class="koboSpan" id="kobo.716.1">of confidence.</span></span></p>
<h1 id="_idParaDest-104"><a id="_idTextAnchor1468"/><span class="koboSpan" id="kobo.717.1">Summary</span></h1>
<p><span class="koboSpan" id="kobo.718.1">Web analytics allows us to optimize the performance of the products and services sold online. </span><span class="koboSpan" id="kobo.718.2">The information obtained enables us to improve the way in which we communicate with clients, thanks to a deeper understanding of our customers and their consumption patterns. </span><span class="koboSpan" id="kobo.718.3">In this chapter, we have dived into a basic understanding of this data and how it can be used to determine the CLV of our customers, understand their characteristics, and identify key metrics to establish a successful digital </span><span class="No-Break"><span class="koboSpan" id="kobo.719.1">marketing plan.</span></span></p>
<p><span class="koboSpan" id="kobo.720.1">The next chapter will look into the considerations made by several industry experts on how data, machine learning, and BI can be used in real-life business contexts to </span><span class="No-Break"><span class="koboSpan" id="kobo.721.1">improve operations.</span></span></p>
</div>
</body></html>