<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer046">
			<h1 id="_idParaDest-27"><em class="italic"><a id="_idTextAnchor026"/>Chapter 2</em>: Deploying Azure Machine Learning Workspace Resources</h1>
			<p>In this chapter, you will learn how to deploy an <strong class="bold">Azure Machine Learning</strong> (<strong class="bold">Azure ML</strong>) workspace through the Azure portal and the <strong class="bold">Command-Line Interface</strong> (<strong class="bold">CLI</strong>). You will also gain an understanding of the deployment parameters that you need to select while deploying the workspace. In the end, you will have a fully functional Azure ML workspace, and you will be able to navigate to all of the deployed Azure resources.</p>
			<p>In this chapter, we're going to cover the following main topics:</p>
			<ul>
				<li>Deploying Azure ML through the portal</li>
				<li>Deploying Azure ML via the CLI</li>
				<li>Alternative ways to deploy an Azure ML workspace</li>
				<li>Exploring the deployed Azure resources</li>
			</ul>
			<h1 id="_idParaDest-28"><a id="_idTextAnchor027"/>Technical requirements</h1>
			<p>To provision an Azure ML workspace, you will need an Azure subscription. You can get a free trial by visiting <a href="https://azure.microsoft.com/free/">https://azure.microsoft.com/free/</a>. If you want to use an existing subscription, you will need to request the owner of the subscription to provide you with the following <strong class="bold">Resource Group</strong> items:</p>
			<ul>
				<li><strong class="source-inline">packt-azureml-rg</strong></li>
				<li><strong class="source-inline">packt-azureml-cli-rg</strong></li>
			</ul>
			<p>This book assumes that you have either a <strong class="source-inline">Contributor</strong> role or an <strong class="source-inline">Owner</strong> role on these resource groups. You are going to deploy an Azure ML workspace in both of those resource groups: one through the Azure portal and one through the Azure CLI.</p>
			<p><strong class="bold">Azure ML</strong> requires the following providers to be registered in the Azure subscription that hosts the resource groups you are planning to use:</p>
			<ul>
				<li><strong class="source-inline">Microsoft.MachineLearningServices</strong></li>
				<li><strong class="source-inline">Microsoft.KeyVault</strong></li>
				<li><strong class="source-inline">Microsoft.Storage</strong></li>
				<li><strong class="source-inline">Microsoft.insights</strong></li>
				<li><strong class="source-inline">Microsoft.ContainerRegistry</strong></li>
				<li><strong class="source-inline">Microsoft.Notebooks</strong></li>
			</ul>
			<p>If you are the <strong class="source-inline">Owner</strong> of the subscription, Azure will automatically register the providers for you when you deploy the resources. Otherwise, you will need to request that the subscription owner registers these providers for you by following the instructions at <a href="https://docs.microsoft.com/azure/azure-resource-manager/templates/error-register-resource-provider#solution-3---azure-portal">https://docs.microsoft.com/azure/azure-resource-manager/templates/error-register-resource-provider#solution-3---azure-portal</a>.</p>
			<p>You will require a modern browser that has <strong class="bold">JavaScript</strong> enabled. This is required to access the Azure portal.</p>
			<p>Optionally, you can download and install the Azure CLI from the official Microsoft documentation page at <a href="https://docs.microsoft.com/cli/azure/install-azure-cli">https://docs.microsoft.com/cli/azure/install-azure-cli</a>. In this book, you will learn how to use the online version of this tool that is embedded within the Azure portal.</p>
			<p>You can find all of the commands and code snippets of this chapter on GitHub at <a href="http://bit.ly/dp100-ch02">http://bit.ly/dp100-ch02</a>.</p>
			<h1 id="_idParaDest-29"><a id="_idTextAnchor028"/>Deploying Azure ML through the portal</h1>
			<p>In this <a id="_idIndexMarker122"/>section, you are going to deploy an Azure ML workspace through the Azure portal wizard. First, navigate to the Azure portal at <a href="https://portal.azure.com">https://portal.azure.com</a>.</p>
			<p>There are a couple of ways in which you can initiate the creation of an Azure ML workspace wizard. The following are the three most popular ones:</p>
			<ul>
				<li>From the home page of the Azure portal, you can select <strong class="bold">Create a resource</strong> from either the top of the page underneath the <strong class="bold">Azure services</strong> label or the <strong class="bold">Azure portal menu</strong> in the upper-left corner: </li>
			</ul>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer016" class="IMG---Figure">
					<img src="Images/B16777_02_001.jpg" alt="Figure 2.1 – Creating a resource in the Azure portal&#13;&#10;" width="579" height="354"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.1 – Creating a resource in the Azure portal</p>
			<p>This approach <a id="_idIndexMarker123"/>is the most generic one and will ask you to search for the service you want to create. Search for <strong class="source-inline">machine learning</strong> and select the first option from the <strong class="bold">Marketplace</strong> search results that are provided by Microsoft:</p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer017" class="IMG---Figure">
					<img src="Images/B16777_02_002.jpg" alt=" Figure 2.2 – ML search results in Azure Marketplace&#13;&#10;" width="632" height="692"/>
				</div>
			</div>
			<p class="figure-caption"> Figure 2.2 – ML search results in Azure Marketplace</p>
			<p>You can review the service information. Then, when you are done, click on the <strong class="bold">Create</strong> button to start the wizard.</p>
			<ul>
				<li>Alternatively, you can search for <strong class="source-inline">machine learning</strong> in the top search bar of the Azure portal and select the <strong class="bold">Machine Learning</strong> option that appears under <strong class="bold">Services</strong>: </li>
			</ul>
			<p class="figure-caption">  </p>
			<div>
				<div id="_idContainer018" class="IMG---Figure">
					<img src="Images/B16777_02_003.jpg" alt="Figure 2.3 – The ML service showing in the Azure portal search results&#13;&#10;" width="656" height="170"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.3 – The ML service showing in the Azure portal search results</p>
			<p>This will <a id="_idIndexMarker124"/>navigate you to a list of already deployed ML workspaces that you have access to. If this is a new subscription, it will be empty; you can click on the <strong class="bold">Add</strong> button on the toolbar:</p>
			<div>
				<div id="_idContainer019" class="IMG---Figure">
					<img src="Images/B16777_02_004.jpg" alt="Figure 2.4 – The create buttons available in an empty service list&#13;&#10;" width="1422" height="640"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.4 – The create buttons available in an empty service list</p>
			<ul>
				<li>The final popular approach is to navigate to the resource group where you want to deploy <a id="_idIndexMarker125"/>the Azure ML workspace and select <strong class="bold">Add</strong> from the toolbar:</li>
			</ul>
			<div>
				<div id="_idContainer020" class="IMG---Figure">
					<img src="Images/B16777_02_005.jpg" alt="Figure 2.5 – The Add option within the resource group&#13;&#10;" width="1556" height="638"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.5 – The Add option within the resource group</p>
			<p>Search for <strong class="source-inline">machine learning</strong> and select the first option in the Marketplace search result that is provided by Microsoft. Click on the <strong class="bold">Create</strong> button to start the wizard. This approach will prepopulate the resource group option of the wizard.</p>
			<p>All three of these approaches will lead you to the deployment wizard:</p>
			<div>
				<div id="_idContainer021" class="IMG---Figure">
					<img src="Images/B16777_02_006.jpg" alt="Figure 2.6 – The ML workspace creation wizard&#13;&#10;" width="1151" height="1041"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.6 – The ML workspace creation wizard</p>
			<p>In the next <a id="_idIndexMarker126"/>section, you will learn how to use the wizard to deploy the Azure ML workspace.</p>
			<h2 id="_idParaDest-30"><a id="_idTextAnchor029"/>Using the deployment wizard</h2>
			<p>The <a id="_idIndexMarker127"/>wizard consists<a id="_idIndexMarker128"/> of five steps or tabs:</p>
			<ol>
				<li><strong class="bold">Basics</strong>: This is basic information regarding the workspace you are about to deploy.</li>
				<li><strong class="bold">Networking</strong>: This refers to the advanced networking options you might want to configure.</li>
				<li><strong class="bold">Advanced</strong>: This includes the advanced identity and data security workspace options</li>
				<li><strong class="bold">Tags</strong>: This includes the associate tags within the workspace</li>
				<li><strong class="bold">Review + create</strong>: This is the last step of the wizard; after a short validation process, you can provision the workspace.<p>In the next sections, we'll review all of the options available in the wizard along with the considerations you need to make before selecting them.</p><p class="callout-heading">Important note</p><p class="callout">If you see the warning <strong class="bold">The selected subscription doesn't have permissions to register the resource provider</strong> in the <strong class="bold">Basics</strong> step of the wizard, please make sure you ask the owner of the Azure subscription to register the resource providers mentioned in the <em class="italic">Technical requirements</em> section of this chapter if the providers are missing. Failing to have those providers registered will cause a validation error in the <strong class="bold">Review + create</strong> step of the wizard.</p></li>
			</ol>
			<h3>Basics</h3>
			<p>The wizard starts at the <strong class="bold">Basics</strong> step: </p>
			<ol>
				<li value="1">The first thing you need to specify is the <strong class="bold">Subscription</strong> that is going to be charged by the Azure ML workspace. <p>After selecting the subscription, a list of <strong class="bold">Resource Group</strong> options will populate. You can even create a new <strong class="bold">Resource Group</strong> by selecting the <strong class="bold">Create new</strong> button; this is something that requires, this is something that requires an access role like Contributor, at the subscription level, a <strong class="source-inline">Contributor</strong> access role at the subscription level. If you have started the wizard from the <strong class="bold">Resource Group</strong>, both the <strong class="bold">Subscription</strong> and the <strong class="bold">Resource Group</strong> are already filled in. Otherwise, select the one you created in the <em class="italic">Technical requirements</em> section, called <strong class="source-inline">packt-azureml-rg</strong>.</p></li>
				<li>Type in a <strong class="bold">Workspace name</strong> that you will use to refer to the Azure ML workspace. The name is case-insensitive and should be unique within the resource group. The name can be up to 33 characters long and must only contain <a id="_idIndexMarker129"/>alphanumeric <a id="_idIndexMarker130"/>characters and hyphens. <p>You can use <strong class="source-inline">packt-learning-mlw</strong>, which is a name inspired by the <strong class="bold">Azure Cloud Adoption Framework</strong> (<strong class="bold">Azure CAF</strong>) naming conventions. </p></li>
				<li>You will need to select a <strong class="bold">Region</strong> to deploy the Azure ML workspace. The region is the Azure data center where you are going to deploy all of the resources required by the Azure ML workspace. The list is already filtered to include only the data centers that have the product available. <p>There are three things you need to consider when selecting the Azure region to deploy your resources in. They include compliance and data residency requirements, service availability, and pricing. One example of such a requirement <a id="_idIndexMarker131"/>might be that you need to use some specialized <strong class="bold">virtual machine</strong> size that has a specific <strong class="bold">Graphics Processing Unit</strong> (<strong class="bold">GPU</strong>) such as<a id="_idIndexMarker132"/> the NV-series, which has the Tesla M60 – a virtual machine size that is not available in any Canada-based Azure region. For this book, you should select the region that is closest to you.</p></li>
				<li>Optionally, you can modify the names of the <strong class="bold">Storage account</strong>, <strong class="bold">Key vault</strong>, <strong class="bold">Application insights</strong>, and <strong class="bold">Container registry</strong> that are going to be deployed within the Azure ML workspace. Each of those resources has different naming rules. For example, you cannot use a <strong class="source-inline">hyphen (-)</strong> in the storage account or the container registry names. Moreover, the names of the storage account, key vault, and container registry must be unique. You will learn more about those resource in this chapter's <em class="italic">Exploring the deployed Azure resources</em> section. If another resource exists with the same name, an error message will prompt you to change the name. <em class="italic">Figure 2.7</em> shows how the basics wizard page looks like when it is filled in.</li>
			</ol>
			<div>
				<div id="_idContainer022" class="IMG---Figure">
					<img src="Images/B16777_02_007.jpg" alt="Figure 2.7 – Information selected in the Basics step of the wizard&#13;&#10;" width="1139" height="1143"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.7 – Information selected in the Basics step of the wizard</p>
			<p>With all <a id="_idIndexMarker133"/>of <a id="_idIndexMarker134"/>the basic information filled in, you can now click on the <strong class="bold">Review + create</strong> button and skip all of the intermediate steps. This implies that you automatically accept the default options for the rest of the wizard's steps. However, for the purpose of learning, you should click on the <strong class="bold">Next: Networking</strong> button to navigate to the next wizard page.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">Up until September 2020, the first page of these wizards asked for the <strong class="bold">Edition</strong> of the Azure ML workspace. There used to be a <strong class="source-inline">Basic</strong> edition and an <strong class="source-inline">Enterprise</strong> edition. The <strong class="source-inline">Enterprise</strong> edition was the one that provided the designer, and the Auto ML features you will <a id="_idIndexMarker135"/>see later on in<a id="_idIndexMarker136"/> the book. Since October 2020, all features are available in the <strong class="source-inline">Basic</strong> edition. The original certification had questions related to which feature belongs to what edition – something that you shouldn't encounter in your exam.</p>
			<h3>Networking</h3>
			<p>On this<a id="_idIndexMarker137"/> wizard page, you will need to decide how you are planning to connect to the data plane of the Azure ML workspace. The data plane consists of all data-centric operations within your workspace such as using the Azure ML studio <a id="_idIndexMarker138"/>web interface, triggering an ML pipeline, and making API calls through the <strong class="bold">Software Development Kit</strong> (<strong class="bold">SDK</strong>). There are two options, as follows:</p>
			<ul>
				<li><strong class="bold">Public endpoint (all networks)</strong>: This is the default option that allows you to access the workspace from a publicly accessible endpoint. </li>
				<li><strong class="bold">Private endpoint</strong>: A private endpoint reduces the risk of data exfiltration by reducing the attack surface to the Azure ML workspace. Once you decide to provide a workspace with <strong class="bold">Private endpoint</strong> connectivity, you will need to have a virtual <a id="_idIndexMarker139"/>machine or a <strong class="bold">Virtual Private Network</strong> (<strong class="bold">VPN</strong>) connection in order to access the private endpoint you will expose:</li>
			</ul>
			<div>
				<div id="_idContainer023" class="IMG---Figure">
					<img src="Images/B16777_02_008.jpg" alt="Figure 2.8 – The private endpoint secures access to the Azure ML workspace&#13;&#10;" width="893" height="620"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.8 – The private endpoint secures access to the Azure ML workspace</p>
			<p>For the<a id="_idIndexMarker140"/> purpose of this book, you will select <strong class="bold">Public endpoint (all networks)</strong>:</p>
			<div>
				<div id="_idContainer024" class="IMG---Figure">
					<img src="Images/B16777_02_009.jpg" alt="Figure 2.9 – Networking options in the creation wizard&#13;&#10;" width="1163" height="364"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 2.9 – Networking options in the creation wizard</p>
			<p>On the next<a id="_idIndexMarker141"/> page, you are going to select the advanced options.</p>
			<h3>Advanced</h3>
			<p>On this wizard page, you can configure a few options regarding the security of the workspace and the metadata and metrics data privacy.</p>
			<ol>
				<li value="1">You can configure the <strong class="bold">Managed identity</strong> used by the AzureML workspace to authenticate and access other cloud resources. You can use either a <strong class="bold">System assigned identity</strong> or a <strong class="bold">User assigned identity</strong>. The system assigned ones will be automatically created when you deploy the AzureML resource. Instead, you can create a <strong class="bold">User Assigned Managed Identity</strong> resource within the Azure portal and use that during the deployment of the AzureML workspace. Using the user assigned option allows you to create the identity beforehand, configure access to various systems and data sources and then assign it to the workspace. You can even use the same identity in other services, like an Azure Automation account. You can read more about managed identities in this chapter's <em class="italic">Further reading </em>section. For this book, you will use the default option, which is the <strong class="bold">System assigned identity</strong>.</li>
				<li>You can define how the AzureML workspace will be accessing the data stored in the default storage account. <strong class="bold">Credential-based access</strong> uses the storage account access key to read data. You can think of this approach as having a single password used by everyone who has access to the AzureML workspace to access the data within that storage account. In some organizations, the use of storage account access keys is forbidden for security reasons. In those cases, <strong class="bold">Identity-based access</strong> should be used. When you choose that option, AzureML uses its <strong class="bold">Managed identity</strong> to access the storage account data and write artifacts, like the trained models. Moreover, when the data scientists access datasets stored in the default storage account, their identity is passed through to the storage account to authenticate them and provide them with the data. You will use <strong class="bold">Credential-based access</strong> for the purposes of this book.</li>
				<li>By default, Azure Machine Learning services store metrics and metadata in a Microsoft managed store using encryption keys managed by Microsoft. You can specify your own key to be used to encrypt the metrics and metadata. To do so, you will need to select a key stored within an existing <strong class="bold">Key Vault</strong>. This action will provision a couple of additional Azure resources, including a Cosmos DB, in a new resource group named based on the pattern &lt;your-azure-ml-workspace-resource-name&gt;_&lt;GUID&gt;, for example, packt-learning-mlw_ab07ab07-ab07-ab07-ab07-ab07ab07ab07. You do not have any control over those resources. Their lifecycle management is handled by the Azure Machine Learning workspace, meaning that they will be automatically deleted when you delete the workspace.</li>
				<li>The last option of the wizard's step allows you to limit the amount of telemetry and metric data collected on your workspace. You can do that by selecting the <strong class="bold">High business impact workspace</strong> option.<div id="_idContainer025" class="IMG---Figure"><img src="Images/B16777_02_010.jpg" alt="Figure 2.10 – Advanced options in the creation wizard&#13;&#10;" width="1305" height="1253"/></div><p class="figure-caption">Figure 2.10 – Advanced options in the creation wizard</p><p>For the purposes <a id="_idIndexMarker142"/>of this book, you can leave both options with the default options and continue to the next step.</p><h3>Tags</h3><p>Tags are metadata <a id="_idIndexMarker143"/>that you can attach to any Azure resource, resource group, or subscription to help you locate and manage them. Throughout the Azure portal and the CLI, you can use these tags to filter the resource lists. Moreover, you can attach organizational information to the provisioned resources, for example, the business unit or even an email address that is responsible for the specific resource; this could be something that can give additional context to the IT teams if they need to modify something. Another common scenario is to use these tags to generate reports with usage and billing drill-downs.</p><p>For the purposes of this book, you should add a single metadata tag, that is, one to specify the type of the environment. The following tag can be used:</p><ul><li><strong class="source-inline">Environment</strong>: Typically, you have multiple environments for your code base such as a development environment, a quality assurance testing environment, and a production environment. For the purposes of this book, you should specify the <strong class="source-inline">Development</strong> value.</li></ul></li>
			</ol>
			<p>You can add additional metadata tags if you want. The number can be up to 50, which is the current limit of tags per resource:</p>
			<div>
				<div id="_idContainer026" class="IMG---Figure">
					<img src="Images/B16777_02_011.jpg" alt="Figure 2.11 – The tags step in the creation wizard&#13;&#10;" width="1639" height="525"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 2.11 – The tags step in the creation wizard</p>
			<p>When you <a id="_idIndexMarker144"/>are done, click on <strong class="bold">Next: Review + create</strong> to move to the last wizard step.</p>
			<h3>Review + create</h3>
			<p>This is the <a id="_idIndexMarker145"/>last step of the wizard. If you have forgotten to complete something or made an invalid selection in a previous step, you will get an error message and a red dot will indicate the step where the error is:</p>
			<div>
				<div id="_idContainer027" class="IMG---Figure">
					<img src="Images/B16777_02_012.jpg" alt="Figure 2.12 – An error validation indicating something is wrong in the Basics step&#13;&#10;" width="939" height="276"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.12 – An error validation indicating something is wrong in the Basics step</p>
			<ol>
				<li value="5">If everything is fine, a <strong class="bold">Validation passed</strong> message will appear and the <strong class="bold">Create</strong> button will<a id="_idIndexMarker146"/> be enabled:<div id="_idContainer028" class="IMG---Figure"><img src="Images/B16777_02_013.jpg" alt="Figure 2.13 – Getting ready to provision the Azure ML workspace resources&#13;&#10;" width="849" height="1143"/></div><p class="figure-caption"> </p><p class="figure-caption">Figure 2.13 – Getting ready to provision the Azure ML workspace resources</p><p class="callout-heading">Tip</p><p class="callout">Note the <strong class="bold">Download a template for automation</strong> link that appears at the bottom of the page. This link <a id="_idIndexMarker147"/>will generate an <strong class="bold">Azure Resource Manager</strong> (<strong class="bold">ARM</strong>) template for you that describes all the resources you have configured so far. You can then navigate to the <strong class="bold">Parameters</strong> tab and observe all of the parameters you have configured, including the <strong class="source-inline">keyVaultName</strong>, <strong class="source-inline">storageAccountName</strong>, and <strong class="source-inline">applicationInsightsName</strong> JSON values. This template can be deployed instantly from that<a id="_idIndexMarker148"/> view, or you can download it and use it to provision these resources in a different subscription. For example, imagine that you want to provision the production environment with the same resource structure. You can use this autogenerated ARM template, change the target <strong class="bold">Resource Group</strong>, the corresponding resource names and tag value, and deploy it in the production environment. Please note that the resource names you specify need to be unique, and you might need to experiment until you find a name that is available.</p></li>
				<li>Click on the <strong class="bold">Create</strong> button to provision your Azure ML workspace resources. The resources will start deploying. This process could take a couple of minutes to complete. <p>Finally, you should see a button called <strong class="bold">Go to resource</strong>, which you can use to navigate to the newly provisioned Azure ML workspace:</p></li>
			</ol>
			<div>
				<div id="_idContainer029" class="IMG---Figure">
					<img src="Images/B16777_02_014.jpg" alt=" Figure 2.14 – The Go to resource button indicating the success of the Azure ML workspace deployment&#13;&#10;" width="1425" height="680"/>
				</div>
			</div>
			<p class="figure-caption"> Figure 2.14 – The Go to resource button indicating the success of the Azure ML workspace deployment</p>
			<p>In the next <a id="_idIndexMarker149"/>section, you will learn how to deploy the same Azure ML workspace using the Azure CLI, which is one of the most popular ways to deploy things in Azure.</p>
			<h1 id="_idParaDest-31"><a id="_idTextAnchor030"/>Deploying Azure ML via the CLI</h1>
			<p>In this <a id="_idIndexMarker150"/>section, you<a id="_idIndexMarker151"/> are going to deploy an Azure ML workspace through the Azure CLI. You are going to use the <strong class="source-inline">packt-azureml-cli-rg</strong> resource group to deploy resources; you are going to use the Bash version of the <strong class="bold">Azure Cloud Shell</strong> that is built in the Azure portal – something that will require no installation on your machine. If you want, you can install the Azure CLI locally by following the installation instructions at <a href="https://docs.microsoft.com/cli/azure/install-azure-cli">https://docs.microsoft.com/cli/azure/install-azure-cli</a>, and skip the provision of the Azure Cloud Shell.</p>
			<p class="callout-heading">Important note </p>
			<p class="callout">You are going to use the Azure CLI in the next sections to manage various aspects of the Azure ML workspace. Although the book is going to assume you selected the Azure Cloud Shell, the syntax you will see is applicable for both the Azure Cloud Shell and the Azure CLI <a id="_idIndexMarker152"/>running<a id="_idIndexMarker153"/> within your local machine. </p>
			<h2 id="_idParaDest-32"><a id="_idTextAnchor031"/>Deploying Azure Cloud Shell</h2>
			<p>Azure Cloud<a id="_idIndexMarker154"/> Shell is a browser-based shell that allows you to manage Azure. You can access it either by visiting the dedicated page at <a href="https://shell.azure.com">https://shell.azure.com</a> or from within the Azure portal by clicking on the Cloud Shell icon in the top bar:</p>
			<div>
				<div id="_idContainer030" class="IMG---Figure">
					<img src="Images/B16777_02_015.jpg" alt=" Figure 2.15 – The Cloud Shell icon in the top bar of the Azure portal&#13;&#10;" width="1404" height="89"/>
				</div>
			</div>
			<p class="figure-caption"> Figure 2.15 – The Cloud Shell icon in the top bar of the Azure portal</p>
			<p>Let's begin!</p>
			<ol>
				<li value="1">The first time you invoke the Cloud Shell, you will see the welcome wizard. Select <strong class="source-inline">Bash</strong> to continue:<div id="_idContainer031" class="IMG---Figure"><img src="Images/B16777_02_016.jpg" alt="Figure 2.16 – The Azure Cloud Shell welcome wizard&#13;&#10;" width="1650" height="622"/></div><p class="figure-caption"> </p><p class="figure-caption">Figure 2.16 – The Azure Cloud Shell welcome wizard</p></li>
				<li>Azure Cloud Shell requires a file share to save files. In this next step of the wizard, you can select a subscription; the portal will automatically deploy a storage account for you. Depending on your permissions at the subscription level, the wizard will either create a new resource group or use one where you have a <strong class="source-inline">Contributor</strong> role. <p>If you want to fine-tune the process, you can select the <strong class="bold">Show advanced settings</strong> option and manually create new resource groups or define the name of the storage <a id="_idIndexMarker155"/>account and the file share name that is going to be used by your Cloud Shell:</p><div id="_idContainer032" class="IMG---Figure"><img src="Images/B16777_02_017.jpg" alt="Figure 2.17 – Advanced settings while provisioning Cloud Shell&#13;&#10;" width="1136" height="427"/></div><p class="figure-caption"> </p><p class="figure-caption">Figure 2.17 – Advanced settings while provisioning Cloud Shell</p></li>
				<li>For the purposes of this book, you should allow the wizard to automatically provision a storage account for you by selecting the <strong class="bold">Subscription</strong> you have, then clicking on the <strong class="bold">Create storage</strong> button without configuring the advanced settings:<div id="_idContainer033" class="IMG---Figure"><img src="Images/B16777_02_018.jpg" alt="Figure 2.18 – Creating a storage account wizard page while provisioning Cloud Shell&#13;&#10;" width="865" height="357"/></div></li>
			</ol>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 2.18 – Creating a storage account wizard page while provisioning Cloud Shell</p>
			<p>After a<a id="_idIndexMarker156"/> while, a storage account will be provisioned, and your Cloud Shell Bash prompt should appear:</p>
			<div>
				<div id="_idContainer034" class="IMG---Figure">
					<img src="Images/B16777_02_019.jpg" alt="Figure 2.19 – The Bash prompt in Azure Cloud Shell &#13;&#10;" width="397" height="239"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.19 – The Bash prompt in Azure Cloud Shell </p>
			<p>Now that you<a id="_idIndexMarker157"/> have a Cloud Shell, you can use the Azure CLI to manage your Azure resources; this is something that you will learn how to do in the next section.</p>
			<h2 id="_idParaDest-33"><a id="_idTextAnchor032"/>Using the Azure CLI</h2>
			<p>The Azure CLI<a id="_idIndexMarker158"/> is a management command-line tool that you can invoke by typing in the <strong class="source-inline">az</strong> command. Through this tool, you can provision and manage your Azure resources. The easiest way to learn the Azure CLI is by using the <strong class="source-inline">--help</strong> argument at the end of any command. For example, you can start with <strong class="source-inline">az --help</strong>. This will list all of the available commands, such as the <strong class="source-inline">login</strong> commands, the <strong class="source-inline">find</strong> commands, and the subgroups, including the <strong class="source-inline">storage</strong> one: </p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer035" class="IMG---Figure">
					<img src="Images/B16777_02_020.jpg" alt="Figure 2.20 – The az command's subgroups and commands&#13;&#10;" width="916" height="623"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.20 – The az command's subgroups and commands</p>
			<p>You can keep exploring the various subgroups and commands by appending them to the <strong class="source-inline">az</strong> command. For example, let's explore the <strong class="source-inline">group</strong> subgroup, by typing in <strong class="source-inline">az group --help</strong>. Then, we will investigate the <strong class="source-inline">list</strong> command, where you can discover all of the available options<a id="_idIndexMarker159"/> by typing in <strong class="source-inline">az group list --help</strong>: </p>
			<div>
				<div id="_idContainer036" class="IMG---Figure">
					<img src="Images/B16777_02_021.jpg" alt="Figure 2.21 – The az group list command help page&#13;&#10;" width="936" height="615"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.21 – The az group list command help page</p>
			<p>Another useful feature of Azure CLI is the <strong class="source-inline">az find</strong> command, which searches the Azure documentation for relevant information:</p>
			<div>
				<div id="_idContainer037" class="IMG---Figure">
					<img src="Images/B16777_02_022.jpg" alt="Figure 2.22 – Using az find to discover Azure CLI commands&#13;&#10;" width="686" height="219"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.22 – Using az find to discover Azure CLI commands</p>
			<p>You can list all<a id="_idIndexMarker160"/> of the resource groups you have access to by issuing the <strong class="source-inline">az group list -o table</strong> command, where we have specified that we want to format the output as a table:</p>
			<div>
				<div id="_idContainer038" class="IMG---Figure">
					<img src="Images/B16777_02_023.jpg" alt="Figure 2.23 – Listing all of the resource groups you have access to through the Azure CLI&#13;&#10;" width="385" height="136"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.23 – Listing all of the resource groups you have access to through the Azure CLI</p>
			<p class="callout-heading">Tip</p>
			<p class="callout">If you ever find yourself not understanding why the Azure CLI command you are typing doesn't work as expected, you can use the <strong class="source-inline">--verbose</strong> flag. If you need even more information, then you can combine that with the <strong class="source-inline">--debug</strong> flag.</p>
			<p>In the next section, you will explore the most common actions that you can perform from the <a id="_idIndexMarker161"/>Azure CLI.</p>
			<h3>Authenticating in Azure CLI</h3>
			<p>If you get the<a id="_idIndexMarker162"/> error message <strong class="bold">ValidationError: Please run 'az login' to set up account.</strong>, then you will need to log in using your account. To do so, type in the <strong class="source-inline">az login</strong> command, which will prompt you to open a page and enter a code. This process is referred to as <strong class="bold">interactive device authentication</strong>. You will learn more about this process in section Authenticating from your device in <a href="B16777_07_Final_VK_ePub.xhtml#_idTextAnchor102"><em class="italic">Chapter 7</em></a>, <em class="italic">The AzureML Python SDK</em>. </p>
			<p>After visiting the web page and typing in the code, you will need to log in with the account that has access to the Azure subscription you want to control through the Azure CLI. Doing that will authorize the Azure CLI to act on your behalf. You can always log out from an Azure CLI by typing in <strong class="source-inline">az logout</strong>. </p>
			<h3>Selecting the active Azure subscription</h3>
			<p>If you have <a id="_idIndexMarker163"/>access to multiple Azure subscriptions, you will need to specify which one is the active one. To list your subscriptions, type in <strong class="source-inline">az account list -o table</strong>; you can activate a subscription by typing in <strong class="source-inline">az account set --subscription "Subscription name or ID"</strong> and passing either the name or the ID of the subscription you want to control from the Azure CLI.</p>
			<h3>Creating a resource group from the Azure CLI</h3>
			<p>One of the <a id="_idIndexMarker164"/>most well-documented Azure CLI commands on the internet is the one to create a resource group, which is a virtual folder where you can deploy Azure resources. The following command will create a resource group, called <strong class="source-inline">packt-azureml-cli-rg</strong>, and the record of this new resource group will be kept in the Western Europe Azure data center:</p>
			<p class="source-code">az group create --name packt-azureml-cli-rg --location westeurope</p>
			<p>A shortcut to the <strong class="source-inline">--name</strong> parameter is <strong class="source-inline">-n</strong>. Similarly, <strong class="source-inline">-l</strong> is a shortcut for <strong class="source-inline">--location</strong>. The preceding command can now be written as follows:</p>
			<p class="source-code">az group create -n packt-azureml-cli-rg -l westeurope</p>
			<p>The <strong class="source-inline">-n</strong> and <strong class="source-inline">-l</strong> shortcuts are common across many Azure CLI commands.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">You will need a <strong class="source-inline">Contributor</strong> role at the subscription level to be able to create a resource group. To be more precise, you will need a role that allows you to perform the <strong class="source-inline">Microsoft.Resources/subscriptions/resourceGroups/write</strong> operation, which you will read more about in the <em class="italic">Understanding Role-Based Access Control (RBAC)</em> section that appears later in this chapter.</p>
			<p>In the next section, you will learn how to install an extension within the Azure CLI: the one that <a id="_idIndexMarker165"/>manages Azure ML workspaces.</p>
			<h2 id="_idParaDest-34"><a id="_idTextAnchor033"/>Installing the Azure ML CLI extension</h2>
			<p>To manage <a id="_idIndexMarker166"/>Azure ML workspaces from the Azure CLI, you will need to install the <strong class="bold">azure-cli-ml</strong> extension. Install the extension by typing in <strong class="source-inline">az extension add -n azure-cli-ml</strong>. </p>
			<p>To view the currently installed extensions and their versions, type in <strong class="source-inline">az extension list -o table</strong>:</p>
			<div>
				<div id="_idContainer039" class="IMG---Figure">
					<img src="Images/B16777_02_024.jpg" alt="Figure 2.24 – A list of all of the installed extensions including azure-cli-ml&#13;&#10;" width="1650" height="187"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.24 – A list of all of the installed extensions including azure-cli-ml</p>
			<p>To update the installed extension to the latest version, type in <strong class="source-inline">az extension update -n azure-cli-ml</strong>.</p>
			<p>The extension you just installed has added the <strong class="source-inline">ml</strong> command subgroup to your Azure CLI. You can inspect the subgroups and the commands it contains by using the <strong class="source-inline">az ml --help</strong> command. In the next section, you will use these new commands to deploy an Azure ML workspace.</p>
			<h2 id="_idParaDest-35"><a id="_idTextAnchor034"/>Deploying Azure ML using the az ml command</h2>
			<p>The goal <a id="_idIndexMarker167"/>of this section is to deploy an Azure ML <a id="_idIndexMarker168"/>workspace, named <strong class="source-inline">packt-learning-cli-mlw</strong>, in the resource group named <strong class="source-inline">packt-azureml-cli-rg</strong> and attach the <strong class="source-inline">Environment</strong> tag with the <strong class="source-inline">Development</strong> value. </p>
			<p>To provision a new Azure ML workspace, you will need to use the <strong class="source-inline">az ml workspace create</strong> command. </p>
			<p>The only required option is <strong class="source-inline">--workspace-name</strong> or <strong class="source-inline">-w</strong>, which is the workspace name. This will create a new resource group within your Azure subscription and deploy the new workspace there. This requires you to have at least a <strong class="source-inline">Contributor</strong> role at the subscription level; otherwise, you will get an authorization error.</p>
			<p>In order to specify the target resource group where you want the new workspace to be deployed, you will need to either pass the <strong class="source-inline">--resource-group</strong> option or the <strong class="source-inline">-g</strong> option.</p>
			<p class="callout-heading">Important note</p>
			<p class="callout">There are some common <strong class="source-inline">az ml</strong> parameters: the <strong class="source-inline">-g</strong> and <strong class="source-inline">-w</strong> parameters are common in all Azure ML CLI commands, and you will use them again later in this book.</p>
			<p>To attach tags to the newly created resource, you can use the <strong class="source-inline">--tags</strong> parameter or the <strong class="source-inline">-t</strong> parameter, which uses the <em class="italic">key=value</em> syntax.</p>
			<p>Type in the following command to deploy the requested Azure ML workspace: </p>
			<p class="source-code">az ml workspace create -g packt-azureml-cli-rg -w packt-learning-cli-mlw -t Environment=Development</p>
			<p>The result is displayed in the following screenshot:</p>
			<div>
				<div id="_idContainer040" class="IMG---Figure">
					<img src="Images/B16777_02_025.jpg" alt="Figure 2.25 – Deploying the Azure ML workspace through the CLI extension&#13;&#10;" width="1650" height="262"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.25 – Deploying the Azure ML workspace through the CLI extension</p>
			<p>In this section, you learned how to deploy an Azure ML workspace using the Azure CLI. For this book, you <a id="_idIndexMarker169"/>will only need the one you provisioned<a id="_idIndexMarker170"/> through the user interface, and you will delete the one you just provisioned in the next section.</p>
			<h2 id="_idParaDest-36"><a id="_idTextAnchor035"/>Cleaning up the CLI resource group</h2>
			<p>For the <a id="_idIndexMarker171"/>purposes of this book, you are going to need a single Azure ML workspace. You are going to use the one you deployed through the Azure portal in the <strong class="source-inline">packt-azureml-rg</strong> resource group. If you want, you can delete the newly provisioned Azure ML workspace by issuing the following command:</p>
			<p class="source-code">az ml workspace delete -g packt-azureml-cli-rg -w packt-learning-cli-mlw --all-resources</p>
			<p>This will delete the Azure ML workspace and all of the related resources that were provisioned in the preceding steps.</p>
			<p>So far, you have explored the most common ways to provision the Azure ML workspace, that is, through the portal and the Azure CLI. In the next section, you will learn about a few additional ways, including the ARM way, which is preferred by DevOps engineers.</p>
			<h1 id="_idParaDest-37"><a id="_idTextAnchor036"/>Alternative ways to deploy an Azure ML workspace</h1>
			<p>There are <a id="_idIndexMarker172"/>additional ways in which you can deploy an Azure ML workspace:</p>
			<ul>
				<li>Create an ARM template. This is the Azure-native way of describing resources that you want to deploy in the form of a JSON file. An example of an ARM template for the Azure ML workspace can be found at <a href="https://bit.ly/dp100-azureml-arm">https://bit.ly/dp100-azureml-arm</a>. <p>The command to deploy such a template from the Azure CLI is as follows: </p><p class="source-code"><strong class="bold">az deployment group create --name packt-deployment --resource-group packt-azureml-rg --template-uri https://bit.ly/dp100-azureml-arm --parameters workspaceName=packt-learning-arm-mlw location=westeurope</strong></p><p>You can also find an ARM template if you select the <strong class="bold">Download a template for automation</strong> link that appears on the left-hand side of the <strong class="bold">Create</strong> button in the last step of the Azure portal resource creation wizard.</p></li>
				<li>Through the Azure ML Python SDK, which you will learn about in <a href="B16777_07_Final_VK_ePub.xhtml#_idTextAnchor102"><em class="italic">Chapter 7</em></a>, <em class="italic">The Azure ML Python</em>.</li>
				<li>Through the Azure management REST API as described in <a href="https://docs.microsoft.com/azure/machine-learning/how-to-manage-rest#create-a-workspace-using-rest">https://docs.microsoft.com/azure/machine-learning/how-to-manage-rest#create-a-workspace-using-rest</a>.</li>
			</ul>
			<p>In the next <a id="_idIndexMarker173"/>section, you will explore the Azure resources that have been deployed to the target resource group, and you will learn how to give workspace access to your colleagues.</p>
			<h1 id="_idParaDest-38"><a id="_idTextAnchor037"/>Exploring the deployed Azure resources</h1>
			<p>Open the <a id="_idIndexMarker174"/>Azure portal and search for resource groups. Select the icon to navigate to the list of the resource groups you have access to, as shown in the following screenshot:</p>
			<div>
				<div id="_idContainer041" class="IMG---Figure">
					<img src="Images/B16777_02_026.jpg" alt="Figure 2.26 – Navigating to the list of resource groups&#13;&#10;" width="1650" height="311"/>
				</div>
			</div>
			<p class="figure-caption"> </p>
			<p class="figure-caption">Figure 2.26 – Navigating to the list of resource groups</p>
			<p>Select the <strong class="bold">packt-azureml-rg</strong> option and observe the resources that are deployed within this resource group:</p>
			<ul>
				<li>The ML workspace resource is named <strong class="bold">packt-learning-mlw</strong>. This is the main resource that you deployed. Through this resource, you can manage various aspects of the workspace.</li>
				<li>An Azure key-vault service named <strong class="bold">packtlearningm&lt;random_number&gt;</strong>. This key vault is used to securely store credentials and access keys that you will be using <a id="_idIndexMarker175"/>within the Azure ML workspace.</li>
				<li>A storage account with the name of <strong class="bold">packtlearningm&lt;random_number&gt;</strong>. This storage account was autogenerated during the provisioning process and is used to store files from the workspace, including experimental datasets and models.</li>
				<li>An application insight account named <strong class="bold">packtlearningm&lt;random_number&gt;</strong>. This is the monitoring service for all predictive endpoints that you will publish from within the Azure ML workspace.</li>
			</ul>
			<p>These are the out-of-the-box components that get deployed within the Azure ML workspace:</p>
			<p class="figure-caption"> </p>
			<div>
				<div id="_idContainer042" class="IMG---Figure">
					<img src="Images/B16777_02_027.jpg" alt="Figure 2.27 – The list of resources in the packt-azureml-rg resource group&#13;&#10;" width="1526" height="815"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.27 – The list of resources in the packt-azureml-rg resource group</p>
			<p>There is actually <a id="_idIndexMarker176"/>one more resource that is going to be<a id="_idIndexMarker177"/> provisioned automatically when you run your first experiment: an <strong class="bold">Azure Container Registry</strong> (<strong class="bold">ACR</strong>). This will host various <strong class="bold">Docker</strong> container images, including the ones that are going to be exposing a web server that will make<a id="_idIndexMarker178"/> inferences with the <strong class="bold">Artificial Intelligence</strong> (<strong class="bold">AI</strong>) models you are going to train.</p>
			<p>When <a id="_idIndexMarker179"/>you want to deploy a real-time endpoint for a model, you <a id="_idIndexMarker180"/>can deploy it in an <strong class="bold">Azure Container Instance</strong> (<strong class="bold">ACI</strong>) or <strong class="bold">Azure Kubernetes Service</strong> (<strong class="bold">AKS</strong>) from within the Azure ML studio. You will deploy an ACI for the first time in <a href="B16777_05_Final_VK_ePub.xhtml#_idTextAnchor072"><em class="italic">Chapter 5</em></a>, <em class="italic">Letting Machines Do the Model Training</em>, of this book, and you will notice that an ACI resource will appear within this resource group next to the existing resources.</p>
			<h2 id="_idParaDest-39"><a id="_idTextAnchor038"/>Understanding Role-Based Access Control (RBAC)</h2>
			<p>Azure <a id="_idIndexMarker181"/>provides <a id="_idIndexMarker182"/>RBAC, which allows you to define the operations each role can perform on specific resources. Each role is assigned according to a specific scope, for example, if you are assigned the <strong class="bold">Contributor</strong> role in a resource group, you will be able to provision resources only within that resource group and not at the subscription level. Out of the box, Azure provides three well-known roles:</p>
			<ul>
				<li><strong class="bold">Reader</strong>: This allows you to browse through Azure resources, but you cannot modify or activate anything.</li>
				<li><strong class="bold">Contributor</strong>: This builds on top of the <strong class="bold">Reader</strong> role and allows you to edit resources or create new resources within the scope of the role. This role doesn't allow you to modify the permissions that are attached to the resources. This means you cannot grant another user permission to the resources you might have provisioned.</li>
				<li><strong class="bold">Owner</strong>: This role can do everything that the <strong class="bold">Contributor</strong> role does and can also assign and modify roles within the context that this role applies to.</li>
			</ul>
			<p>Let's examine the roles that are assigned in the resource group where you deployed the Azure ML workspace. Click on the <strong class="bold">Access control (IAM)</strong> tab of the resource group and then select <strong class="bold">Role assignments</strong>. On this page, you will see a list of role assignments to the resource group level. Notice that your account has been assigned, at the very least, the <strong class="bold">Contributor</strong> role in this resource group to provision resources. If you don't see your account in the list, you are most likely an administrator, so take a look under the <strong class="bold">Classic administrators</strong> tab:</p>
			<div>
				<div id="_idContainer043" class="IMG---Figure">
					<img src="Images/B16777_02_028.jpg" alt="Figure 2.28 – Role assignments on the Access control (IAM) page &#13;&#10;of the packt-azureml-rg resource group&#13;&#10;" width="1650" height="787"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.28 – Role assignments on the Access control (IAM) page of the packt-azureml-rg resource group</p>
			<p>When you<a id="_idIndexMarker183"/> provisioned the workspace, a new <a id="_idIndexMarker184"/>system-assigned managed identity was created with the name of the Azure ML workspace you provisioned. This was automatically assigned as a <strong class="bold">Contributor</strong> role for the resource group. This allows the ML workspace to deploy ACI resources within that resource group and access compute targets and data stores. Note that this identity is used by the platform itself and should not be used to assign access to external resources and so on.</p>
			<p>Next, you will learn how this role assignment flows down to the resources.</p>
			<h2 id="_idParaDest-40"><a id="_idTextAnchor039"/>RBAC inheritance</h2>
			<p>Open <a id="_idIndexMarker185"/>the <strong class="bold">packt-learning-mlw</strong> resource <a id="_idIndexMarker186"/>and click on the <strong class="bold">Access control (IAM)</strong> tab. Then, select <strong class="bold">Role assignments</strong>. </p>
			<p>Notice that the roles that existed in the resource group are inherited down to the Azure ML workspace resource:</p>
			<div>
				<div id="_idContainer044" class="IMG---Figure">
					<img src="Images/B16777_02_029.jpg" alt="Figure 2.29 – RBAC inheritance in packt-learning-mlw from the resource group&#13;&#10;" width="1650" height="795"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.29 – RBAC inheritance in packt-learning-mlw from the resource group</p>
			<p>The role <a id="_idIndexMarker187"/>assignments inherit from the subscription <a id="_idIndexMarker188"/>to the resource groups and from there to the resources. On top of the subscriptions, there is another grouping<a id="_idIndexMarker189"/> layer, called <strong class="bold">Management Groups</strong>, which allows you to build hierarchies that contain other management groups and or subscriptions. An example of the overall RBAC inheritance model is depicted in the following schema:</p>
			<div>
				<div id="_idContainer045" class="IMG---Figure">
					<img src="Images/B16777_02_030.jpg" alt="Figure 2.30 – The RBAC inheritance model&#13;&#10;" width="660" height="527"/>
				</div>
			</div>
			<p class="figure-caption">Figure 2.30 – The RBAC inheritance model</p>
			<p>Now that you know how to assign out-of-the-box roles and have understood how inheritance <a id="_idIndexMarker190"/>works, in the next section, you will learn how to create custom roles for your <a id="_idIndexMarker191"/>Azure ML workspace.</p>
			<h2 id="_idParaDest-41"><a id="_idTextAnchor040"/>Creating custom roles</h2>
			<p>Azure allows <a id="_idIndexMarker192"/>you to create custom RBAC roles where you can fine-tune what operations are allowed and what actions are not allowed; this is similar to an allow list and a block list. The portal provides a graphical experience that allows you to create custom roles at the resource group level or higher. The result of this experience is a JSON file, such as the following example:</p>
			<p class="source-code">{</p>
			<p class="source-code">    "Name": "ACI model deployer role",</p>
			<p class="source-code">    "IsCustom": true,</p>
			<p class="source-code">    "Description": "Can deploy registered model on ACI resources",</p>
			<p class="source-code">    "Actions": [</p>
			<p class="source-code">"Microsoft.MachineLearningServices/workspaces/services/aci/write"</p>
			<p class="source-code">    ],</p>
			<p class="source-code">    "NotActions": [ ],</p>
			<p class="source-code">    "AssignableScopes":["/subscriptions/&lt;subscription_id&gt;"]</p>
			<p class="source-code">}</p>
			<p>This is a very simple custom role, named <strong class="source-inline">ACI model deployer role</strong>, which provides write access to the ACI service of the workspaces – an operation that is encoded in the literal <strong class="source-inline">Microsoft.MachineLearningServices/workspaces/services/aci/write</strong>. </p>
			<p>A more complex example of a custom role is as follows:</p>
			<p class="source-code">{</p>
			<p class="source-code">    "Name": "Limited Data Scientist",</p>
			<p class="source-code">    "IsCustom": true,</p>
			<p class="source-code">    "Description": "Limited data scientist role",</p>
			<p class="source-code">    "Actions": ["*"],</p>
			<p class="source-code">    "NotActions": [</p>
			<p class="source-code">"Microsoft.MachineLearningServices/workspaces/computes/delete",</p>
			<p class="source-code">"Microsoft.Authorization/*/write"</p>
			<p class="source-code">    ],</p>
			<p class="source-code">    "AssignableScopes": [        </p>
			<p class="source-code">"/subscriptions/&lt;subscription_id&gt;/resourceGroups/&lt;resource_group_name&gt;/providers/Microsoft.MachineLearningServices/workspaces/&lt;workspace_name&gt;"</p>
			<p class="source-code">    ]</p>
			<p class="source-code">}</p>
			<p>Notice that <a id="_idIndexMarker193"/>in contrast to the previous role, which was explicitly allowing a single action, this role has a wildcard (<strong class="source-inline">*</strong>) in the allowed actions, meaning that it can do all available actions. To limit that effect, we use the <strong class="source-inline">NotActions</strong> sections, which indicate which operations are explicitly denied. In this example, we are explicitly disallowing the ability to delete compute resources (<strong class="source-inline">Microsoft.MachineLearningServices/workspaces/computes/delete</strong>) and cannot update any authorization aspect of this workspace (<strong class="source-inline">Microsoft.Authorization/*/write</strong>). Note that the wildcard can be used to match partial actions like in the <strong class="source-inline">Microsoft.Authorization</strong> action, where the wildcard matches action groups such as <strong class="source-inline">lock</strong>, <strong class="source-inline">roleAssignments</strong>, and <strong class="source-inline">roleDefinitions</strong>. In our case, we want the user who will have this role to not be able to add new users to the workspace, so we want to disallow the <strong class="source-inline">Microsoft.Authorization/roleAssignments/write</strong> action, which is covered by the wildcard expression we used.</p>
			<p>Finally, <strong class="source-inline">AssignableScopes</strong> allows you to specify the scope of this role. This is a mandatory field. In the first example, you are limiting the scope of this role to the Azure subscription with an ID of <strong class="source-inline">&lt;subscription_id&gt;</strong>. In this case, you can assign this custom role to any resource group or resource that belongs to the subscription with ID <strong class="source-inline">&lt;subscription_id&gt;</strong>. In the second example, you are limiting the scope of this custom role to the Azure ML workspace, named <strong class="source-inline">&lt;workspace_name&gt;</strong>, that is deployed in the resource group named <strong class="source-inline">&lt;resource_group_name&gt;</strong>, which belongs to the <strong class="source-inline">&lt;subscription_id&gt;</strong> subscription. This means you cannot assign this custom role anywhere else as it has a very targeted assignable scope.</p>
			<p>If you want<a id="_idIndexMarker194"/> to deploy a custom role in Azure through the Azure CLI, you can use the following command:</p>
			<p class="source-code">az role definition create --role-definition custom_role.json</p>
			<p>Here, <strong class="source-inline">custom_role.json</strong> is a file containing the JSON role definition of the custom role that you want to deploy in Azure.</p>
			<p>Once the role is deployed to Azure, you can assign that specific role to a user.</p>
			<h2 id="_idParaDest-42"><a id="_idTextAnchor041"/>Assigning roles in the Azure ML workspace</h2>
			<p>Assigning <a id="_idIndexMarker195"/>a role to a user is a privileged operation that means you are modifying the permissions of a resource. To do so, you will need to have the <strong class="source-inline">Owner</strong> permission of the resource that you want to modify. To be more accurate, you will need a role that allows you to use the <strong class="source-inline">Microsoft.Authorization/roleAssignments/write</strong> operation – something that the built-in <strong class="source-inline">Owner</strong> role has.</p>
			<p>If you do have the <strong class="source-inline">Owner</strong> permission, you can assign the <strong class="bold">ACI model deployer role</strong> that you created in the previous section to a user. You can do so in the following three ways:</p>
			<ul>
				<li>In the Azure portal, you can visit the Azure ML workspace you want and assign the role to the user through the <strong class="bold">Access control (IAM)</strong> tab that you saw in the <em class="italic">Understanding Role-Based Access Control (RBAC)</em> section.</li>
				<li>Through the Azure CLI by issuing the following command:<p class="source-code"><strong class="bold">az role assignment create –assignee "user id" </strong><strong class="bold">--role "ACI model deployer role" --scope "/subscriptions/&lt;subscription_id&gt;/resourceGroups/packt-azureml-rg/providers/Microsoft.MachineLearningServices/workspaces/packt-learning-mlw"</strong></p><p>Here, you assign the custom role to a user with an ID of <strong class="source-inline">user id</strong>. Then, you apply this assignment at the level of the Azure ML workspace. To get the user ID of the user with the email <strong class="source-inline">username@organization.org</strong>, you can use the following <a id="_idIndexMarker196"/>Azure CLI command:</p><p class="source-code"><strong class="bold">az ad user list --query "[?mail=='username@organization.org'].objectId" --output tsv</strong></p></li>
				<li>Through the Azure ML CLI extension by using the following command:<p class="source-code"><strong class="bold">az ml workspace share -w packt-learning-mlw -g packt-</strong><strong class="bold">azureml-rg --role "ACI model deployer role" --user username@organization.org</strong></p></li>
			</ul>
			<p>With these steps, you can share the workspace with your colleagues by creating custom roles that fine-tune the allowed permissions.</p>
			<h1 id="_idParaDest-43"><a id="_idTextAnchor042"/>Summary</h1>
			<p>In this chapter, you learned about the prerequisites for deploying Azure ML. You can work with either a trial subscription or you can request a resource group in your company's subscription, where you, at the very least, have contributor rights to the resource group. You also discovered, in depth, the two most common ways of deploying the Azure ML workspace in a development environment, and you also gained an understanding of the parameters that you need to specify. You also learned about the alternative ways you can deploy the workspace, including ARM templates, which are the more DevOps-friendly way of deploying in production environments. In the final section, you looked at the resources that are part of Azure ML workspace deployment, and you learned how RBAC works in Azure. Additionally, you learned how to use built-in or custom roles to give access to the Azure ML workspace you deployed.</p>
			<p>In the next chapter, you will learn about the <strong class="bold">Azure ML Studio</strong> experience, which is a web environment that enables you to manage the end-to-end ML life cycle. </p>
			<h1 id="_idParaDest-44"><a id="_idTextAnchor043"/>Questions</h1>
			<p>In each chapter, you should find a couple of questions that will allow you to perform a knowledge check on the topics discussed in this chapter:</p>
			<ol>
				<li value="1">Which of the following are applicable ways of deploying the Azure ML workspace?<p>a. Azure CLI through the azure-cli-ml extension</p><p>b. The Azure portal</p><p>c. The deployment of an ARM template</p><p>d. Azure ML Python SDK</p></li>
				<li>You are creating a custom role and you want to deny the ability to delete a workspace. Where do you need to add the <strong class="bold">Microsoft.MachineLearningServices/workspaces/delete</strong> action?<p>a. To the <strong class="source-inline">Actions</strong> section of the JSON definition</p><p>b. To the <strong class="source-inline">NotActions</strong> section of the JSON definition</p><p>c. To the <strong class="source-inline">AssignableScopes</strong> section of the JSON definition</p></li>
				<li>What do you have to install in the Azure CLI before you can deploy an Azure ML workspace?</li>
			</ol>
			<h1 id="_idParaDest-45"><a id="_idTextAnchor044"/>Further reading</h1>
			<p>This section offers a list of useful web resources that will help you to augment your knowledge and understanding of Azure:</p>
			<ul>
				<li>If this is the first time you are navigating to the Azure portal, you might want to read an overview of it at <a href="https://docs.microsoft.com/azure/azure-portal/azure-portal-overview">https://docs.microsoft.com/azure/azure-portal/azure-portal-overview</a>. If you want to learn more about the features of Cloud Shell, you can visit <a href="https://docs.microsoft.com/azure/cloud-shell/overview">https://docs.microsoft.com/azure/cloud-shell/overview</a>.</li>
				<li>You can learn more about selecting the proper region for your resources at <a href="https://azure.microsoft.com/global-infrastructure/geographies/#choose-your-region">https://azure.microsoft.com/global-infrastructure/geographies/#choose-your-region</a>.</li>
				<li>If you are interested in learning how to create and deploy ARM templates by using the Azure portal, you can read the documentation at <a href="https://docs.microsoft.com/azure/azure-resource-manager/templates/quickstart-create-templates-use-the-portal">https://docs.microsoft.com/azure/azure-resource-manager/templates/quickstart-create-templates-use-the-portal</a>.</li>
				<li>For a complete list of data centers that have an Azure ML service available, please visit <a href="https://azure.microsoft.com/global-infrastructure/services/?regions=all&amp;products=machine-learning-service">https://azure.microsoft.com/global-infrastructure/services/?regions=all&amp;products=machine-learning-service</a>.</li>
				<li>You can learn more about the Azure resource name rules at <a href="https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules#microsoftmachinelearningservices">https://docs.microsoft.com/azure/azure-resource-manager/management/resource-name-rules#microsoftmachinelearningservices</a>.</li>
				<li>You can read more about the best practices for naming at <a href="https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging">https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging</a>.</li>
				<li>You can also read more about how to use resource tags at <a href="https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources">https://docs.microsoft.com/azure/azure-resource-manager/management/tag-resources</a>. The Microsoft Cloud Adoption Framework has a list of best practices related to metadata tags, which you can read at <a href="https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging#metadata-tags">https://docs.microsoft.com/azure/cloud-adoption-framework/ready/azure-best-practices/naming-and-tagging#metadata-tags</a>. </li>
				<li>For more information about the Azure ML private link feature, please refer to <a href="https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link">https://docs.microsoft.com/azure/machine-learning/how-to-configure-private-link</a>.</li>
				<li>You can learn more about this system-managed identity concept that is infused in the Azure ML workspace at <a href="https://docs.microsoft.com/azure/machine-learning/concept-enterprise-security#securing-compute-targets-and-data">https://docs.microsoft.com/azure/machine-learning/concept-enterprise-security#securing-compute-targets-and-data</a>.</li>
				<li>You can learn more about the default Azure roles (such as <strong class="source-inline">Owner</strong>, <strong class="source-inline">Contributor</strong>, and <strong class="source-inline">Reader</strong>) and how to create custom roles for the Azure ML workspace at <a href="https://docs.microsoft.com/azure/machine-learning/how-to-assign-roles">https://docs.microsoft.com/azure/machine-learning/how-to-assign-roles</a>.</li>
				<li>Learn more about Managed Identities: <a href="https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview">https://docs.microsoft.com/azure/active-directory/managed-identities-azure-resources/overview</a> </li>
				<li>AzureML identity based data access: <a href="https://docs.microsoft.com/azure/machine-learning/how-to-identity-based-data-access">https://docs.microsoft.com/azure/machine-learning/how-to-identity-based-data-access</a></li>
			</ul>
		</div>
	</div></body></html>