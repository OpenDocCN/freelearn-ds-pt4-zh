<html><head></head><body>
  <div id="_idContainer060">
   <h1 class="chapter-number" id="_idParaDest-101">
    <a id="_idTextAnchor126">
    </a>
    <span class="koboSpan" id="kobo.1.1">
     5
    </span>
   </h1>
   <h1 id="_idParaDest-102">
    <a id="_idTextAnchor127">
    </a>
    <span class="koboSpan" id="kobo.2.1">
     Mastering Data Governance in the Lakehouse with Unity Catalog
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.3.1">
     In this chapter, we’ll dive into the implementation of effective data governance for the lakehouse using Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.3.2">
     We’ll cover enabling Unity Catalog on an existing Databricks workspace, implementing data cataloging for data discovery, enforcing fine-grained data access at the table, row and column levels, as well as tracking data lineage.
    </span>
    <span class="koboSpan" id="kobo.3.3">
     By the end of the chapter, you’ll be armed with industry best practices around data governance and will have gained real-world insights for enhancing data security
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.4.1">
      and compliance.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.5.1">
     In this chapter, we’re going to cover the following
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.6.1">
      main topics:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.7.1">
      Understanding data governance in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.8.1">
       the
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.9.1">
       l
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.10.1">
       akehouse
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.11.1">
      Enabling Unity Catalog on an existing
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.12.1">
       Databricks workspace
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.13.1">
      Identity federation in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.14.1">
       Unity Catalog
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.15.1">
      Data discovery
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.16.1">
       and cataloging
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.17.1">
      Hands-on lab – data masking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.18.1">
       healthcare datasets
      </span>
     </span>
    </li>
   </ul>
   <h1 id="_idParaDest-103">
    <a id="_idTextAnchor128">
    </a>
    <span class="koboSpan" id="kobo.19.1">
     Technical requirements
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.20.1">
     To follow along in this chapter, you’ll need Databricks workspace permissions to create and start an all-purpose cluster so that you can execute the chapter’s accompanying notebooks.
    </span>
    <span class="koboSpan" id="kobo.20.2">
     It’s also recommended that your Databricks user be elevated to an account admin and a metastore admin so that you can deploy a new Unity Catalog metastore and attach it to your existing Databricks workspace.
    </span>
    <span class="koboSpan" id="kobo.20.3">
     All code samples can be downloaded from this chapter’s GitHub repository located at
    </span>
    <a href="https://github.com/PacktPublishing/Building-Modern-Data-Applications-Using-Databricks-Lakehouse/tree/main/chapter05">
     <span class="koboSpan" id="kobo.21.1">
      https://github.com/PacktPublishing/Building-Modern-Data-Applications-Using-Databricks-Lakehouse/tree/main/chapter05
     </span>
    </a>
    <span class="koboSpan" id="kobo.22.1">
     .
    </span>
    <span class="koboSpan" id="kobo.22.2">
     This chapter will create and run several new notebooks, estimated to consume around 5–10
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.23.1">
      Databricks
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.24.1">
       units
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.25.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.26.1">
       DBUs
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.27.1">
      ).
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-104">
    <a id="_idTextAnchor129">
    </a>
    <span class="koboSpan" id="kobo.28.1">
     Understanding data governance in a lakehouse
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.29.1">
     It’s quite common for a
    </span>
    <a id="_idIndexMarker239">
    </a>
    <span class="koboSpan" id="kobo.30.1">
     lakehouse implementation to leverage multiple processing engines for different use cases.
    </span>
    <span class="koboSpan" id="kobo.30.2">
     However, each processing engine comes with its own data security implementation and, often, these different data security solutions don’t integrate with one another.
    </span>
    <span class="koboSpan" id="kobo.30.3">
     Where most lakehouses fall short is that due to these multiple security layers, implementing consistent, global data security policies is nearly impossible.
    </span>
    <span class="koboSpan" id="kobo.30.4">
     Ensuring that the data in your lakehouse is completely and consistently secured and private and that access is only granted to the correct set of users is of the utmost importance when building a data lakehouse.
    </span>
    <span class="koboSpan" id="kobo.30.5">
     Therefore, having a simple data governance solution that covers all the data in your organization’s lakehouse is critical for your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.31.1">
      organization’s success.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-105">
    <a id="_idTextAnchor130">
    </a>
    <span class="koboSpan" id="kobo.32.1">
     Introducing the Databricks Unity Catalog
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.33.1">
     Unity Catalog is a
    </span>
    <a id="_idIndexMarker240">
    </a>
    <span class="koboSpan" id="kobo.34.1">
     centralized data
    </span>
    <a id="_idIndexMarker241">
    </a>
    <span class="koboSpan" id="kobo.35.1">
     governance solution that simplifies securing the data in your lakehouse by organizing workspace object access policies into a single administrative “pane of glass.”
    </span>
    <span class="koboSpan" id="kobo.35.2">
     In addition to access policies, Unity Catalog was designed with strong auditing in mind, allowing administrators to capture all user access patterns to workspace objects so that administrators can observe access patterns, workspace usage, and billing patterns across all Databricks workspaces.
    </span>
    <span class="koboSpan" id="kobo.35.3">
     Furthermore, Unity Catalog was designed to allow data professionals to discover datasets across your organization, track data lineage, view entity relationship diagrams, share curated datasets, and monitor the health of systems.
    </span>
    <span class="koboSpan" id="kobo.35.4">
     One of the major strong suites of Unity Catalog is that once your organization’s data is in Unity Catalog, it’s secured by default – no process, whether it’s internal within the Databricks workspace or an external process that interacts with data from outside of the Databricks Data Intelligence Platform, has access to the data unless access has been explicitly granted by a data administrator.
    </span>
    <span class="koboSpan" id="kobo.35.5">
     Unity Catalog was designed to span across the perimeter of your lakehouse from workspace to workspace and beyond the Databricks workspace, sitting on top of your organization’s data so that a single governance model can be simply and consistently applied to all parties accessing your organization’s data in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.36.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.37.1">
      l
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.38.1">
      akehouse.
     </span>
    </span>
   </p>
   <p class="IMG---Figure">
    <span class="koboSpan" id="kobo.39.1">
     <img alt="Figure 5.1 – Unity Catalog provides a single, unified governance layer on top of your organization’s cloud data" src="image/B22011_05_1.png"/>
    </span>
   </p>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.40.1">
     Figure 5.1 – Unity Catalog provides a single, unified governance layer on top of your organization’s cloud data
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.41.1">
     However, having a global data and workspace object security layer wasn’t always as seamless as it is in
    </span>
    <a id="_idIndexMarker242">
    </a>
    <span class="koboSpan" id="kobo.42.1">
     Unity Catalog today.
    </span>
    <span class="koboSpan" id="kobo.42.2">
     Let’s
    </span>
    <a id="_idIndexMarker243">
    </a>
    <span class="koboSpan" id="kobo.43.1">
     travel back in time to the lessons learned from the previous security model in Databricks and how Unity Catalog came to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.44.1">
      fruition today.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-106">
    <a id="_idTextAnchor131">
    </a>
    <span class="koboSpan" id="kobo.45.1">
     A problem worth solving
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.46.1">
     Previously, data access
    </span>
    <a id="_idIndexMarker244">
    </a>
    <span class="koboSpan" id="kobo.47.1">
     control policies were defined per workspace using a mechanism known as table
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.48.1">
      access control lists
     </span>
    </strong>
    <span class="koboSpan" id="kobo.49.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.50.1">
      ACLs
     </span>
    </strong>
    <span class="koboSpan" id="kobo.51.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.51.2">
     When
    </span>
    <a id="_idIndexMarker245">
    </a>
    <span class="koboSpan" id="kobo.52.1">
     these were enforced properly, table ACLs provided a powerful data governance solution.
    </span>
    <span class="koboSpan" id="kobo.52.2">
     Administrators could define data access policies for different users and groups within a workspace and those access policies could be enforced by the Databricks cluster when executing Spark code that accessed the underlying
    </span>
    <a id="_idIndexMarker246">
    </a>
    <span class="koboSpan" id="kobo.53.1">
     datasets registered in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.54.1">
      Hive
     </span>
    </strong>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.55.1">
       Metastore
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.56.1">
      (
     </span>
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.57.1">
       HMS
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.58.1">
      ).
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.59.1">
     However, four major problems quickly arose from the table ACL security model.
    </span>
    <span class="koboSpan" id="kobo.59.2">
     The first problem was that data access policies defined using the table ACL security model needed to be repeated for each unique Databricks workspace.
    </span>
    <span class="koboSpan" id="kobo.59.3">
     Most organizations prefer to have separate workspaces for each logical work environment – for example, a single workspace for development, another workspace for acceptance testing, and finally, a workspace dedicated to running production workloads.
    </span>
    <span class="koboSpan" id="kobo.59.4">
     Aside from the repetition of the same shared data access policies, if a data access policy happened to change in one workspace, it often meant that the data access policies across
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.60.1">
      all
     </span>
    </em>
    <span class="koboSpan" id="kobo.61.1">
     workspaces needed to be changed as well.
    </span>
    <span class="koboSpan" id="kobo.61.2">
     This led to unnecessary maintenance overhead, as there was not a single location where these data access patterns could be easily defined within the Databricks Data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.62.1">
      Intelligence Platform.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.63.1">
     Secondly, table ACLs were only enforced on the underlying data when interactive notebooks or automated jobs were executed on a table ACL-enabled cluster.
    </span>
    <span class="koboSpan" id="kobo.63.2">
     A cluster without the table ACL security model enabled could directly access the underlying dataset, bypassing the security model entirely!
    </span>
    <span class="koboSpan" id="kobo.63.3">
     While cluster policies (covered in
    </span>
    <a href="B22011_01.xhtml#_idTextAnchor014">
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.64.1">
        Chapter 1
       </span>
      </em>
     </span>
    </a>
    <span class="koboSpan" id="kobo.65.1">
     ) could be used to mitigate this issue and prevent any potential nefarious access to privileged datasets, cluster policies are complex to write.
    </span>
    <span class="koboSpan" id="kobo.65.2">
     They require knowledge of the cluster policy schema as well as experience expressing configuration as JSON, making it difficult to scale across an organization.
    </span>
    <span class="koboSpan" id="kobo.65.3">
     More often than not, it was quite common for a user to complain to their organization’s leaders that they needed administrative workspace access to spin up a cluster of their own liking and complete their day-to-day
    </span>
    <a id="_idIndexMarker247">
    </a>
    <span class="koboSpan" id="kobo.66.1">
     activities.
    </span>
    <span class="koboSpan" id="kobo.66.2">
     Once the user was granted administrator workspace access, they too could grant administrator access to other users, and, like a snowball effect, there would be an unreasonable number of administrators for a workspace.
    </span>
    <span class="koboSpan" id="kobo.66.3">
     This type of bad practice can easily lead to a data leak by side-stepping the table ACL security model using a cluster without table
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.67.1">
      ACLs enabled.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.68.1">
     Furthermore, due to the isolation issues of
    </span>
    <a id="_idIndexMarker248">
    </a>
    <span class="koboSpan" id="kobo.69.1">
     running
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.70.1">
      Java Virtual Machine
     </span>
    </strong>
    <span class="koboSpan" id="kobo.71.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.72.1">
      JVM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.73.1">
     ) languages on a shared computational resource, table ACL-enabled clusters limited end users to only running workloads using either the SQL or Python programming languages.
    </span>
    <span class="koboSpan" id="kobo.73.2">
     Users wanting to execute workloads using the Scala, Java, or R programming languages would need to be granted an exception to use a non-table ACL-enabled cluster, opening a huge hole in the organization’s data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.74.1">
      governance solution.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.75.1">
     The fourth major problem that arose had to do with the ability of the HMS to scale.
    </span>
    <span class="koboSpan" id="kobo.75.2">
     The Databricks Data Intelligence Platform leveraged the HMS to register datasets across a workspace, which allowed users to create new datasets from scratch, organize them in schemas, and even share access to users and groups across an organization.
    </span>
    <span class="koboSpan" id="kobo.75.3">
     However, as a workspace onboarded thousands of users, those users would need to execute ad hoc queries concurrently, while also executing hundreds or even thousands of scheduled jobs.
    </span>
    <span class="koboSpan" id="kobo.75.4">
     Eventually, the HMS struggled to keep up with the level of concurrency needed for the most
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.76.1">
      demanding workspaces.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.77.1">
     It was clear that there
    </span>
    <a id="_idIndexMarker249">
    </a>
    <span class="koboSpan" id="kobo.78.1">
     needed to be a huge change and so Databricks set out to completely redesign a data governance solution
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.79.1">
      from scratch.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-107">
    <a id="_idTextAnchor132">
    </a>
    <span class="koboSpan" id="kobo.80.1">
     An overview of the Unity Catalog architecture
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.81.1">
     One of the primary
    </span>
    <a id="_idIndexMarker250">
    </a>
    <span class="koboSpan" id="kobo.82.1">
     pain points
    </span>
    <a id="_idIndexMarker251">
    </a>
    <span class="koboSpan" id="kobo.83.1">
     that Unity Catalog aimed to solve was to implement a complete end-to-end data governance solution
    </span>
    <a id="_idTextAnchor133">
    </a>
    <span class="koboSpan" id="kobo.84.1">
     that spans all of an organization’s workspaces, removing the redundancy of having to redefine data access policies for each Databricks workspace.
    </span>
    <span class="koboSpan" id="kobo.84.2">
     Instead, with Unity Catalog, data administrators can define data access controls
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.85.1">
      once
     </span>
    </em>
    <span class="koboSpan" id="kobo.86.1">
     in a centralized location and have the peace of mind that they will be consistently applied across an organization no matter what computational resource or processing engine is used to interact with datasets in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.87.1">
      Unity Catalog.
     </span>
    </span>
   </p>
   <p class="IMG---Figure">
    <span class="koboSpan" id="kobo.88.1">
     <img alt="Figure 5.2 – Unity Catalog centralizes data access policies that are then consistently applied across multiple Databricks workspaces" src="image/B22011_05_2.png"/>
    </span>
   </p>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.89.1">
     Figure 5.2 – Unity Catalog centralizes data access policies that are then consistently applied across multiple Databricks workspaces
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.90.1">
     In addition to centralized data governance, Unity Catalog has several other key motivating factors
    </span>
    <a id="_idIndexMarker252">
    </a>
    <span class="koboSpan" id="kobo.91.1">
     that make
    </span>
    <a id="_idIndexMarker253">
    </a>
    <span class="koboSpan" id="kobo.92.1">
     it an ideal data governance solution for the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.93.1">
      modern-day
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.94.1">
      l
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.95.1">
      akehouse:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.96.1">
       Secure by default
      </span>
     </strong>
     <span class="koboSpan" id="kobo.97.1">
      : Users will not have access to read data from any form of compute without using a Unity Catalog-enabled cluster (Unity Catalog clusters are covered in the following section) and having been granted specific access to use and select data from a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.98.1">
       particular dataset.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.99.1">
       Comfortable administrator interfaces
      </span>
     </strong>
     <span class="koboSpan" id="kobo.100.1">
      : Data access policies in Unity Catalog are tightly integrated with
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.101.1">
       American National Standards Institute
      </span>
     </strong>
     <span class="koboSpan" id="kobo.102.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.103.1">
       ANSI
      </span>
     </strong>
     <span class="koboSpan" id="kobo.104.1">
      ) SQL, allowing
     </span>
     <a id="_idIndexMarker254">
     </a>
     <span class="koboSpan" id="kobo.105.1">
      administrators to express data access permissions on familiar database objects such as catalogs, databases, tables, functions, and views.
     </span>
     <span class="koboSpan" id="kobo.105.2">
      Data access permissions can also be set using the administrator UI from the Databricks web app, or automated deployment tools such
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.106.1">
       as Terraform.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.107.1">
       Data discovery
      </span>
     </strong>
     <span class="koboSpan" id="kobo.108.1">
      : Unity Catalog makes it easy for data stewards to tag datasets with descriptive metadata, allowing users across your organization to search and discover datasets available
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.109.1">
       to them.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.110.1">
       Strong auditing
      </span>
     </strong>
     <span class="koboSpan" id="kobo.111.1">
      : Unity Catalog automatically captures user-level access patterns and data operations, allowing administrators to view and audit user behavior as they interact with the data in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.112.1">
       your
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.113.1">
       l
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.114.1">
       akehouse.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.115.1">
       Data lineage tracking
      </span>
     </strong>
     <span class="koboSpan" id="kobo.116.1">
      : Tracing how tables and columns are generated from upstream sources is important in ensuring that downstream datasets are formed using trusted sources.
     </span>
     <span class="koboSpan" id="kobo.116.2">
      Unity Catalog makes tracking data and workspace assets simple through its strong data lineage APIs and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.117.1">
       system tables.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.118.1">
       Observability
      </span>
     </strong>
     <span class="koboSpan" id="kobo.119.1">
      : Because Unity Catalog spans multiple Databricks workspaces, it can aggregate system metrics and auditing events into a centralized set of read-only tables for monitoring and system observability called system tables (covered in greater detail in the
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.120.1">
       Observability with system
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.121.1">
        tables
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.122.1">
       section).
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.123.1">
     To implement a security model where the data is secured by default and there is no ability to access the data externally without going through Unity Catalog, Databricks needed to design
    </span>
    <a id="_idIndexMarker255">
    </a>
    <span class="koboSpan" id="kobo.124.1">
     different
    </span>
    <a id="_idIndexMarker256">
    </a>
    <span class="koboSpan" id="kobo.125.1">
     clusters based on the user’s persona.
    </span>
    <span class="koboSpan" id="kobo.125.2">
     Let’s look at the different cluster types available to users in a Unity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.126.1">
      Catalog-enabled workspace.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-108">
    <a id="_idTextAnchor134">
    </a>
    <span class="koboSpan" id="kobo.127.1">
     Unity Catalog-enabled cluster types
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.128.1">
     There are three major
    </span>
    <a id="_idIndexMarker257">
    </a>
    <span class="koboSpan" id="kobo.129.1">
     types of
    </span>
    <a id="_idIndexMarker258">
    </a>
    <span class="koboSpan" id="kobo.130.1">
     clusters for a workspace with Unity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.131.1">
      Catalog enabled:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.132.1">
       Single-user cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.133.1">
      : Only a single user or service principal will have permission to execute notebook cells or workflows on this type of cluster.
     </span>
     <span class="koboSpan" id="kobo.133.2">
      Workloads containing a mixture of Scala, Java, R, Python, and SQL languages can be executed on this type of cluster
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.134.1">
       only
      </span>
     </em>
     <span class="koboSpan" id="kobo.135.1">
      .
     </span>
     <span class="koboSpan" id="kobo.135.2">
      Datasets registered in Unity Catalog can be queried from this type
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.136.1">
       of cluster.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.137.1">
       Shared cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.138.1">
      : Multiple users or service principals can have permission to execute notebook cells or workflows on this type of cluster.
     </span>
     <span class="koboSpan" id="kobo.138.2">
      This type of cluster is restricted to only Python, SQL, and Scala workloads.
     </span>
     <span class="koboSpan" id="kobo.138.3">
      Datasets registered in Unity Catalog can be queried from this type
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.139.1">
       of cluster.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.140.1">
       Standalone cluster
      </span>
     </strong>
     <span class="koboSpan" id="kobo.141.1">
      : A single user or multiple users can attach a notebook and execute notebook cells to this type of cluster.
     </span>
     <span class="koboSpan" id="kobo.141.2">
      However, datasets registered within the Unity Catalog
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.142.1">
       cannot
      </span>
     </em>
     <span class="koboSpan" id="kobo.143.1">
      be queried by this type of cluster and will result in a runtime exception if a user attempts to query a dataset registered in Unity Catalog.
     </span>
     <span class="koboSpan" id="kobo.143.2">
      This type of cluster can be used for reading datasets registered in the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.144.1">
       legacy HMS.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.145.1">
     Now that we’ve outlined the different types of computational resources you can use to interact with the data
    </span>
    <a id="_idIndexMarker259">
    </a>
    <span class="koboSpan" id="kobo.146.1">
     in Unity Catalog, let’s
    </span>
    <a id="_idIndexMarker260">
    </a>
    <span class="koboSpan" id="kobo.147.1">
     now turn our attention to how the data and other assets are organized within the Unity Catalog, mainly understanding the Unity Catalog
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.148.1">
      object model.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-109">
    <a id="_idTextAnchor135">
    </a>
    <span class="koboSpan" id="kobo.149.1">
     Unity Catalog object model
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.150.1">
     It’s important to
    </span>
    <a id="_idIndexMarker261">
    </a>
    <span class="koboSpan" id="kobo.151.1">
     understand the object
    </span>
    <a id="_idIndexMarker262">
    </a>
    <span class="koboSpan" id="kobo.152.1">
     model within Unity Catalog as it will help users understand the types of objects that can be secured and governed by Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.152.2">
     Furthermore, it will also help metastore administrators architect data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.153.1">
      access policies.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.154.1">
     One of the major changes that Unity Catalog introduced is the concept of a three-level namespace.
    </span>
    <span class="koboSpan" id="kobo.154.2">
     Traditionally, in the HMS, users interacting with the data could reference datasets using a combination of a schema (or database) and a table name.
    </span>
    <span class="koboSpan" id="kobo.154.3">
     However, Unity Catalog adds a third logical container, called the catalog, which can hold one or more schemas.
    </span>
    <span class="koboSpan" id="kobo.154.4">
     To reference a fully qualified dataset in Unity Catalog, data practitioners will need to provide the name of the catalog, schema,
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.155.1">
      and table.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer050">
     <span class="koboSpan" id="kobo.156.1">
      <img alt="Figure 5.3 – Unity Catalog consists of many different securable objects beyond just a dataset" src="image/B22011_05_3.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.157.1">
     Figure 5.3 – Unity Catalog consists of many different securable objects beyond just a dataset
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.158.1">
     Let’s dive more into the
    </span>
    <a id="_idIndexMarker263">
    </a>
    <span class="koboSpan" id="kobo.159.1">
     Unity Catalog
    </span>
    <a id="_idIndexMarker264">
    </a>
    <span class="koboSpan" id="kobo.160.1">
     object model starting with the objects related to organizing
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.161.1">
      physical datasets:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.162.1">
       Metastore
      </span>
     </strong>
     <span class="koboSpan" id="kobo.163.1">
      : The “physical” implementation of Unity Catalog.
     </span>
     <span class="koboSpan" id="kobo.163.2">
      A particular cloud region can at most contain a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.164.1">
       single metastore.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.165.1">
       Catalog
      </span>
     </strong>
     <span class="koboSpan" id="kobo.166.1">
      : The top-level container for datasets in Unity Catalog.
     </span>
     <span class="koboSpan" id="kobo.166.2">
      A catalog can contain a collection of one or more
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.167.1">
       schema objects.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.168.1">
       Schema
      </span>
     </strong>
     <span class="koboSpan" id="kobo.169.1">
      : Serves as the second tier in Unity Catalog.
     </span>
     <span class="koboSpan" id="kobo.169.2">
      A schema can contain a collection of one or more tables, views, functions, models,
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.170.1">
       and volumes.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.171.1">
       Table
      </span>
     </strong>
     <span class="koboSpan" id="kobo.172.1">
      : The representation of a dataset containing a defined schema and organized into rows
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.173.1">
       and columns.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.174.1">
       View
      </span>
     </strong>
     <span class="koboSpan" id="kobo.175.1">
      : A calculated dataset that can be the result of joining together tables, filtering columns, or applying complex business logic.
     </span>
     <span class="koboSpan" id="kobo.175.2">
      Furthermore, views are read-only and cannot have data written to them
     </span>
     <a id="_idIndexMarker265">
     </a>
     <span class="koboSpan" id="kobo.176.1">
      or data updated using
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.177.1">
       data manipulation language
      </span>
     </strong>
     <span class="koboSpan" id="kobo.178.1">
      (
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.179.1">
        DML
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.180.1">
       ) statements.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.181.1">
       Model
      </span>
     </strong>
     <span class="koboSpan" id="kobo.182.1">
      : A machine learning model that has been registered to the tracking server
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.183.1">
       using MLflow.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.184.1">
       Function
      </span>
     </strong>
     <span class="koboSpan" id="kobo.185.1">
      : A custom, user-defined function that often contains complex business logic that typically cannot be implemented using the built-in Spark
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.186.1">
       functions alone.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.187.1">
       Volume
      </span>
     </strong>
     <span class="koboSpan" id="kobo.188.1">
      : A data storage location designed for storing structured, semi-structured, or unstructured data (we will cover volumes in greater detail in the following chapter,
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.189.1">
       Mastering Data Locations in
      </span>
     </em>
     <span class="No-Break">
      <em class="italic">
       <span class="koboSpan" id="kobo.190.1">
        Unity Catalog
       </span>
      </em>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.191.1">
       ).
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.192.1">
     Next, let’s turn our attention to the objects within Unity Catalog that are used to interact with data
    </span>
    <a id="_idIndexMarker266">
    </a>
    <span class="koboSpan" id="kobo.193.1">
     outside of the Databricks Data
    </span>
    <a id="_idIndexMarker267">
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.194.1">
      Intelligence Platform:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.195.1">
       Connection
      </span>
     </strong>
     <span class="koboSpan" id="kobo.196.1">
      : Represents a read-only connection containing the credentials to access data in a foreign
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.197.1">
       relational database management system
      </span>
     </strong>
     <span class="koboSpan" id="kobo.198.1">
      (
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.199.1">
       RDBMS
      </span>
     </strong>
     <span class="koboSpan" id="kobo.200.1">
      ) or
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.201.1">
       data
      </span>
     </span>
     <span class="No-Break">
      <a id="_idIndexMarker268">
      </a>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.202.1">
       warehouse
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.203.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.204.1">
       Storage credential
      </span>
     </strong>
     <span class="koboSpan" id="kobo.205.1">
      : Represents the authentication credential for accessing a cloud
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.206.1">
       storage location
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.207.1">
       .
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.208.1">
       External location
      </span>
     </strong>
     <span class="koboSpan" id="kobo.209.1">
      : Represents a cloud storage location outside of the Databricks-managed root
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.210.1">
       storage location
      </span>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.211.1">
       .
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.212.1">
     Lastly, let’s look at the elements of the Unity Catalog object model for sharing and receiving datasets using the Delta
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.213.1">
      Sharing protocol:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.214.1">
       Provider
      </span>
     </strong>
     <span class="koboSpan" id="kobo.215.1">
      : Represents a data provider.
     </span>
     <span class="koboSpan" id="kobo.215.2">
      This entity creates a collection of one or more curated datasets into a logical grouping, called a
     </span>
     <em class="italic">
      <span class="koboSpan" id="kobo.216.1">
       share
      </span>
     </em>
     <span class="koboSpan" id="kobo.217.1">
      .
     </span>
     <span class="koboSpan" id="kobo.217.2">
      The data provider can revoke access to a shared dataset at
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.218.1">
       any moment.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.219.1">
       Share
      </span>
     </strong>
     <span class="koboSpan" id="kobo.220.1">
      : A logical grouping of one or more shared datasets that can be shared with a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.221.1">
       data recipient.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.222.1">
       Recipient
      </span>
     </strong>
     <span class="koboSpan" id="kobo.223.1">
      : Represents a data recipient.
     </span>
     <span class="koboSpan" id="kobo.223.2">
      This entity receives access to a data share and can query the datasets within
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.224.1">
       their workspace.
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.225.1">
     Now that we’ve outlined the major building blocks of Unity Catalog, let’s look at how we can enable Unity
    </span>
    <a id="_idIndexMarker269">
    </a>
    <span class="koboSpan" id="kobo.226.1">
     Catalog on an existing
    </span>
    <a id="_idIndexMarker270">
    </a>
    <span class="koboSpan" id="kobo.227.1">
     Databricks workspace so that administrators can begin taking full advantage of the strong data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.228.1">
      governance solution.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-110">
    <a id="_idTextAnchor136">
    </a>
    <span class="koboSpan" id="kobo.229.1">
     Enabling Unity Catalog on an existing Databricks workspace
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.230.1">
     Beginning in early
    </span>
    <a id="_idIndexMarker271">
    </a>
    <span class="koboSpan" id="kobo.231.1">
     November 2023, all new Databricks
    </span>
    <a id="_idIndexMarker272">
    </a>
    <span class="koboSpan" id="kobo.232.1">
     workspaces created on
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.233.1">
      Amazon Web Services
     </span>
    </strong>
    <span class="koboSpan" id="kobo.234.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.235.1">
      AWS
     </span>
    </strong>
    <span class="koboSpan" id="kobo.236.1">
     ) or
    </span>
    <a id="_idIndexMarker273">
    </a>
    <span class="koboSpan" id="kobo.237.1">
     Azure are enabled with Unity Catalog by default, so there is no extra configuration needed if your workspace was created after this date on these two cloud providers.
    </span>
    <span class="koboSpan" id="kobo.237.2">
     Similarly, at the time of the creation of a new Databricks workspace, a single regional Unity Catalog metastore will be provisioned for your workspace to use.
    </span>
    <span class="koboSpan" id="kobo.237.3">
     Within the regional metastore is a default catalog having the same name as the workspace and is bound to that workspace only (we’ll cover catalog binding in the following section).
    </span>
    <span class="koboSpan" id="kobo.237.4">
     Furthermore, all users of a newly created workspace will have read and write access to a schema called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.238.1">
      default
     </span>
    </strong>
    <span class="koboSpan" id="kobo.239.1">
     within this
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.240.1">
      workspace catalog.
     </span>
    </span>
   </p>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.241.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.242.1">
     Workspace administrators cannot disable Unity Catalog on a workspace once a Databricks workspace has been enabled for Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.242.2">
     However, datasets can always be migrated back to the HMS implementation, but the workspace will always be enabled with a Unity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.243.1">
      Catalog metastore.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.244.1">
     The first step in upgrading an existing Databricks workspace with Unity Catalog is to deploy a new metastore.
    </span>
    <span class="koboSpan" id="kobo.244.2">
     A metastore is the “physical” implementation of a Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.244.3">
     Administrators will need to deploy a single metastore per cloud region for an organization.
    </span>
    <span class="koboSpan" id="kobo.244.4">
     A metastore can be deployed through a variety of methods, but for simplicity’s sake, we’ll cover deploying a new metastore using the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.245.1">
      Databricks UI:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.246.1">
      First, ensure that you are logged in to the account console located
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.247.1">
       at
      </span>
     </span>
     <a href="https://accounts.cloud.databricks.com">
      <span class="No-Break">
       <span class="koboSpan" id="kobo.248.1">
        https://accounts.cloud.databricks.com
       </span>
      </span>
     </a>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.249.1">
       .
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.250.1">
      From the account console, click on the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.251.1">
       Catalog
      </span>
     </strong>
     <span class="koboSpan" id="kobo.252.1">
      menu item in the sidebar and click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.253.1">
       Create metastore
      </span>
     </strong>
     <span class="koboSpan" id="kobo.254.1">
      button to begin deploying a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.255.1">
       new metastore.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.256.1">
      Enter a meaningful name for your metastore, choose the appropriate region, and, optionally, select a default storage path where managed datasets should be
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.257.1">
       stored in.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.258.1">
      Finally, click the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.259.1">
       Create
      </span>
     </strong>
     <span class="koboSpan" id="kobo.260.1">
      button.
     </span>
     <span class="koboSpan" id="kobo.260.2">
      After a few minutes, your new metastore will be provisioned in the cloud region of
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.261.1">
       your choosing.
      </span>
     </span>
    </li>
   </ol>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.262.1">
     Note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.263.1">
     In Databricks, global configurations such as catalog binding, network configurations, or user provisioning
    </span>
    <a id="_idIndexMarker274">
    </a>
    <span class="koboSpan" id="kobo.264.1">
     are
    </span>
    <a id="_idIndexMarker275">
    </a>
    <span class="koboSpan" id="kobo.265.1">
     centralized in a single administrative console, sometimes shortened to the “
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.266.1">
      account console.”
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.267.1">
     Now that the metastore has been deployed, the only thing left is to choose which Databricks workspaces you’d like to link the metastore to, enabling
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.268.1">
      Unity Catalog:
     </span>
    </span>
   </p>
   <ol>
    <li>
     <span class="koboSpan" id="kobo.269.1">
      From the account console, again choose the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.270.1">
       Catalog
      </span>
     </strong>
     <span class="koboSpan" id="kobo.271.1">
      menu item from
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.272.1">
       the sidebar.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.273.1">
      Next, click the name of the newly created metastore, followed by the
     </span>
     <strong class="bold">
      <span class="koboSpan" id="kobo.274.1">
       Assign to
      </span>
     </strong>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.275.1">
        workspaces
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.276.1">
       button.
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.277.1">
      Lastly, click the workspace you would like to enable Unity Catalog on and confirm your selection by clicking the
     </span>
     <span class="No-Break">
      <strong class="bold">
       <span class="koboSpan" id="kobo.278.1">
        Assign
       </span>
      </strong>
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.279.1">
       button.
      </span>
     </span>
    </li>
   </ol>
   <p>
    <span class="koboSpan" id="kobo.280.1">
     Congratulations!
    </span>
    <span class="koboSpan" id="kobo.280.2">
     You’ve now enabled Unity Catalog for your existing Databricks workspace, and you can begin to enjoy the peace of mind that your lakehouse data will be governed by a
    </span>
    <a id="_idIndexMarker276">
    </a>
    <span class="koboSpan" id="kobo.281.1">
     complete
    </span>
    <a id="_idIndexMarker277">
    </a>
    <span class="koboSpan" id="kobo.282.1">
     data security solution.
    </span>
    <span class="koboSpan" id="kobo.282.2">
     Equally as important, once you have attached a Unity Catalog metastore to a Databricks workspace, you have now enabled your workspace for
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.283.1">
      identity federation.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-111">
    <a id="_idTextAnchor137">
    </a>
    <span class="koboSpan" id="kobo.284.1">
     Identity federation in Unity Catalog
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.285.1">
     Whether you’ve
    </span>
    <a id="_idIndexMarker278">
    </a>
    <span class="koboSpan" id="kobo.286.1">
     deployed a brand new Databricks workspace or
    </span>
    <a id="_idIndexMarker279">
    </a>
    <span class="koboSpan" id="kobo.287.1">
     you’ve manually upgraded an existing workspace to use Unity Catalog, the natural next step is to set up new users so that they log in to the Databricks workspace and take advantage of the benefits of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.288.1">
      Unity Catalog.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.289.1">
     Previously, user management in Databricks was managed within each workspace.
    </span>
    <span class="koboSpan" id="kobo.289.2">
     Unity Catalog consolidates user management into a single centralized governance pane – the account console.
    </span>
    <span class="koboSpan" id="kobo.289.3">
     Rather than manage the workspace identities at a workspace level, which can get repetitive if the same users have access to more than one workspace in a Databricks account, identity management is managed at the account level.
    </span>
    <span class="koboSpan" id="kobo.289.4">
     This allows administrators to define users and their privileges once, and easily manage identity roles and permissions at a
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.290.1">
      global level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.291.1">
     Prior to Unity Catalog, workspace administrators would need to sync organizational identities from the identity provider, such as Okta, Ping, or
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.292.1">
      Azure Active Directory
     </span>
    </strong>
    <span class="koboSpan" id="kobo.293.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.294.1">
      AAD
     </span>
    </strong>
    <span class="koboSpan" id="kobo.295.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.295.2">
     With
    </span>
    <a id="_idIndexMarker280">
    </a>
    <span class="koboSpan" id="kobo.296.1">
     Unity Catalog, the identities are synced across at the account level once using the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.297.1">
      System for Cross-domain Identity Management
     </span>
    </strong>
    <span class="koboSpan" id="kobo.298.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.299.1">
      SCIM
     </span>
    </strong>
    <span class="koboSpan" id="kobo.300.1">
     ).
    </span>
    <span class="koboSpan" id="kobo.300.2">
     Unity
    </span>
    <a id="_idIndexMarker281">
    </a>
    <span class="koboSpan" id="kobo.301.1">
     Catalog will then take care of syncing across the identities to the appropriate workspace in a process known
    </span>
    <a id="_idIndexMarker282">
    </a>
    <span class="koboSpan" id="kobo.302.1">
     as
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.303.1">
      identity federation
     </span>
    </strong>
    <span class="koboSpan" id="kobo.304.1">
     .
    </span>
    <span class="koboSpan" id="kobo.304.2">
     This allows an organization to continue to manage the identities within their organization’s identity provider while ensuring that changes are automatically propagated to the individual
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.305.1">
      Databricks workspaces.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer051">
     <span class="koboSpan" id="kobo.306.1">
      <img alt="Figure 5.4 – Identities are managed at the account console and will automatically get federated across multiple Databricks workspaces" src="image/B22011_05_4.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.307.1">
     Figure 5.4 – Identities are managed at the account console and will automatically get federated across multiple Databricks workspaces
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.308.1">
     In fact, the word
    </span>
    <em class="italic">
     <span class="koboSpan" id="kobo.309.1">
      administrator
     </span>
    </em>
    <span class="koboSpan" id="kobo.310.1">
     is quite an overloaded term in the context of the Databricks Data Intelligence Platform.
    </span>
    <span class="koboSpan" id="kobo.310.2">
     Let’s take a look at the different administrative
    </span>
    <a id="_idTextAnchor138">
    </a>
    <span class="koboSpan" id="kobo.311.1">
     roles and the level of
    </span>
    <a id="_idIndexMarker283">
    </a>
    <span class="koboSpan" id="kobo.312.1">
     entitlement
    </span>
    <a id="_idIndexMarker284">
    </a>
    <span class="koboSpan" id="kobo.313.1">
     each persona has in a Unity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.314.1">
      Catalog-enabled workspace:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.315.1">
       Account owner
      </span>
     </strong>
     <span class="koboSpan" id="kobo.316.1">
      : The individual who originally opened the Databricks account.
     </span>
     <span class="koboSpan" id="kobo.316.2">
      By default, this user will have access to the account console and will be added as both an account admin as well as a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.317.1">
       workspace admin.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.318.1">
       Account admin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.319.1">
      : A power user who has the privileges to access the account console and make account-level changes, such as deploying a new Unity Catalog metastore, making network configuration changes, or adding users, groups, and service principals to workspaces.
     </span>
     <span class="koboSpan" id="kobo.319.2">
      This user has the power to grant additional account admins and
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.320.1">
       metastore admins.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.321.1">
       Metastore admin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.322.1">
      : An administrative user who has privileges to make metastore-level changes, such as changing catalog ownership, granting access to users to create or delete new catalogs, or configuring new datasets shared through the Delta Sharing protocol, to name a few.
     </span>
     <span class="koboSpan" id="kobo.322.2">
      This user does not have access to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.323.1">
       account console.
      </span>
     </span>
    </li>
    <li>
     <strong class="bold">
      <span class="koboSpan" id="kobo.324.1">
       Workspace admin
      </span>
     </strong>
     <span class="koboSpan" id="kobo.325.1">
      : An administrative user who has privileges to make workspace-level configuration changes, including creating cluster policies and instance pools, creating new clusters and DBSQL warehouses, or configuring workspace
     </span>
     <a id="_idIndexMarker285">
     </a>
     <span class="koboSpan" id="kobo.326.1">
      appearance
     </span>
     <a id="_idIndexMarker286">
     </a>
     <span class="koboSpan" id="kobo.327.1">
      settings, to name a few.
     </span>
     <span class="koboSpan" id="kobo.327.2">
      This user does not have access to the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.328.1">
       account console.
      </span>
     </span>
    </li>
   </ul>
   <div>
    <div class="IMG---Figure" id="_idContainer052">
     <span class="koboSpan" id="kobo.329.1">
      <img alt="Figure 5.5 – Administrator-level privileges in the ﻿Databricks Data Intelligence Platform" src="image/B22011_05_5.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.330.1">
     Figure 5.5 – Administrator-level privileges in the Databricks Data Intelligence Platform
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.331.1">
     To begin provisioning
    </span>
    <a id="_idIndexMarker287">
    </a>
    <span class="koboSpan" id="kobo.332.1">
     new
    </span>
    <a id="_idIndexMarker288">
    </a>
    <span class="koboSpan" id="kobo.333.1">
     workspace users, you will need to log in to the account console, located at
    </span>
    <a href="https://accounts.cloud.databricks.com/login">
     <span class="koboSpan" id="kobo.334.1">
      https://accounts.cloud.databricks.com/login
     </span>
    </a>
    <span class="koboSpan" id="kobo.335.1">
     .
    </span>
    <span class="koboSpan" id="kobo.335.2">
     However, only account owners, the individual who originally opened the Databricks organization, or account admins will have access to the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.336.1">
      admin console.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.337.1">
     The first step to begin onboarding new workspace users is to enable
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.338.1">
      single sign-on
     </span>
    </strong>
    <span class="koboSpan" id="kobo.339.1">
     (
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.340.1">
      SSO
     </span>
    </strong>
    <span class="koboSpan" id="kobo.341.1">
     ) in
    </span>
    <a id="_idIndexMarker289">
    </a>
    <span class="koboSpan" id="kobo.342.1">
     the account console.
    </span>
    <span class="koboSpan" id="kobo.342.2">
     This can be done by navigating to the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.343.1">
      Settings
     </span>
    </strong>
    <span class="koboSpan" id="kobo.344.1">
     menu of the account console and providing the details of your organization’s identity provider.
    </span>
    <span class="koboSpan" id="kobo.344.2">
     Once you’ve entered the configuration details, click on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.345.1">
      Test SSO
     </span>
    </strong>
    <span class="koboSpan" id="kobo.346.1">
     button to verify connectivity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.347.1">
      is successful.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer053">
     <span class="koboSpan" id="kobo.348.1">
      <img alt="Figure 5.6 – SSO is required for identity federation to sync with your identity provider" src="image/B22011_05_6.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.349.1">
     Figure 5.6 – SSO is required for identity federation to sync with your identity provider
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.350.1">
     After the identity
    </span>
    <a id="_idIndexMarker290">
    </a>
    <span class="koboSpan" id="kobo.351.1">
     provider
    </span>
    <a id="_idIndexMarker291">
    </a>
    <span class="koboSpan" id="kobo.352.1">
     integration has been verified successfully, the next step is to assign users and groups to the appropriate Databricks workspace.
    </span>
    <span class="koboSpan" id="kobo.352.2">
     If you have a single Databricks workspace, then this is a trivial exercise.
    </span>
    <span class="koboSpan" id="kobo.352.3">
     However, if there is more than one Databricks workspace, then it will be up to your organization to determine who has access to a particular workspace.
    </span>
    <span class="koboSpan" id="kobo.352.4">
     You can assign individual users and groups to a Databricks workspace by navigating to the account console, then clicking on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.353.1">
      User Management
     </span>
    </strong>
    <span class="koboSpan" id="kobo.354.1">
     tab from the menu item, and assigning users to the appropriate workspace either at the user level or at the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.355.1">
      group level.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.356.1">
     Let’s look at how you
    </span>
    <a id="_idIndexMarker292">
    </a>
    <span class="koboSpan" id="kobo.357.1">
     can
    </span>
    <a id="_idIndexMarker293">
    </a>
    <span class="koboSpan" id="kobo.358.1">
     promote secure data exploration across
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.359.1">
      your organization.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-112">
    <a id="_idTextAnchor139">
    </a>
    <span class="koboSpan" id="kobo.360.1">
     Data discovery and cataloging
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.361.1">
     Data tags are
    </span>
    <a id="_idIndexMarker294">
    </a>
    <span class="koboSpan" id="kobo.362.1">
     useful data cataloging constructs that permit data stewards to link descriptive metadata with datasets and other securable objects, such as catalogs, volumes, or machine learning models, within Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.362.2">
     By attaching descriptive tags to datasets and other securable objects, users across your organization can search and discover data assets that may be helpful in their day-to-day activities.
    </span>
    <span class="koboSpan" id="kobo.362.3">
     This helps to promote collaboration across teams, saving time and resources by not having to recreate similar data assets to reach the completion of a particular activity.
    </span>
    <span class="koboSpan" id="kobo.362.4">
     Unity Catalog supports tags on the following data objects: catalogs, databases, tables, volumes, views, and machine
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.363.1">
      learning models.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.364.1">
     Let’s look at an example of how we can apply descriptive tags to our existing taxi trip datasets that will make it easier for users across our organization to search, discover, and use our published datasets in Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.364.2">
     Tags can be easily added to a table in Unity Catalog from a variety of methods.
    </span>
    <span class="koboSpan" id="kobo.364.3">
     The easiest method is directly from the UI using Catalog Explorer in the Databricks Data Intelligence platform.
    </span>
    <span class="koboSpan" id="kobo.364.4">
     Starting from Catalog Explorer, search for the catalog created in a previous chapter’s hands-on exercise that stored data from our DLT pipeline into our
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.365.1">
      yellow_taxi_raw
     </span>
    </strong>
    <span class="koboSpan" id="kobo.366.1">
     dataset.
    </span>
    <span class="koboSpan" id="kobo.366.2">
     Next, expand the schema and select the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.367.1">
      yellow_taxi_raw
     </span>
    </strong>
    <span class="koboSpan" id="kobo.368.1">
     dataset to bring up the dataset details.
    </span>
    <span class="koboSpan" id="kobo.368.2">
     Finally, click on the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.369.1">
      Add tags
     </span>
    </strong>
    <span class="koboSpan" id="kobo.370.1">
     button to begin adding
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.371.1">
      tag data.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer054">
     <span class="koboSpan" id="kobo.372.1">
      <img alt="Figure 5.7 – Tags can be added to datasets directly from Catalog Explorer" src="image/B22011_05_7.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.373.1">
     Figure 5.7 – Tags can be added to datasets directly from Catalog Explorer
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.374.1">
     Tags are added as key-value
    </span>
    <a id="_idIndexMarker295">
    </a>
    <span class="koboSpan" id="kobo.375.1">
     pairs, with the key serving as a unique identifier, such as a category, and the value containing the contents that you’d like to assign to the securable object.
    </span>
    <span class="koboSpan" id="kobo.375.2">
     In this case, we’d like to add a few tags to mark the data sensitivity of our dataset as well as a tag for the dataset owner.
    </span>
    <span class="koboSpan" id="kobo.375.3">
     Add a few tags of your own choosing and click the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.376.1">
      Save tags
     </span>
    </strong>
    <span class="koboSpan" id="kobo.377.1">
     button to persist your changes to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.378.1">
      the dataset.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer055">
     <span class="koboSpan" id="kobo.379.1">
      <img alt="Figure 5.8 – Tags are key-value pairs that help distinguish the dataset from others in Unity Catalog" src="image/B22011_05_8.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.380.1">
     Figure 5.8 – Tags are key-value pairs that help distinguish the dataset from others in Unity Catalog
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.381.1">
     Similarly, tag data can be added, changed, or removed using SQL syntax as well.
    </span>
    <span class="koboSpan" id="kobo.381.2">
     In the next example, create a new notebook within your workspace home directory in Databricks, and in the first cell of the notebook, add the following SQL statement.
    </span>
    <span class="koboSpan" id="kobo.381.3">
     In this example, we’ll update the dataset description tag of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.382.1">
      our dataset:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.383.1">
ALTER TABLE yellow_taxi_raw
SET TAGS ('description'='Unprocessed taxi trip data')</span></pre>
   <p>
    <span class="koboSpan" id="kobo.384.1">
     Lastly, tags support
    </span>
    <a id="_idIndexMarker296">
    </a>
    <span class="koboSpan" id="kobo.385.1">
     finer granularity and can be added down to the column level for datasets in Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.385.2">
     This is useful in scenarios when you might want to distinguish the data sensitivity of a column so that you can dynamically apply a data mask for a view in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.386.1">
      Unity Catalog.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer056">
     <span class="koboSpan" id="kobo.387.1">
      <img alt="Figure 5.9 – Tags can be added at the column level for datasets in Unity Catalog" src="image/B22011_05_9.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.388.1">
     Figure 5.9 – Tags can be added at the column level for datasets in Unity Catalog
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.389.1">
     Conversely, users can search for views, tables, or columns that have tags applied by using the following syntax in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.390.1">
      Search
     </span>
    </strong>
    <span class="koboSpan" id="kobo.391.1">
     text field of Catalog
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.392.1">
      Explorer:
     </span>
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.393.1">
       tag:&lt;case_sensitive_name_of_tag&gt;
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.394.1">
      .
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.395.1">
     As you can see, tags are extremely useful in helping promote the discoverability of datasets across your organization and help users distinguish datasets in Unity Catalog from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.396.1">
      one another.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.397.1">
     In addition to discovering datasets across your organization, it’s also imperative to know how a dataset is formed and whether upstream sources are trusted.
    </span>
    <span class="koboSpan" id="kobo.397.2">
     Data lineage is one such method for users
    </span>
    <a id="_idIndexMarker297">
    </a>
    <span class="koboSpan" id="kobo.398.1">
     to know exactly how the datasets they discover in Unity Catalog are formed and where the different columns
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.399.1">
      originate from.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-113">
    <a id="_idTextAnchor140">
    </a>
    <span class="koboSpan" id="kobo.400.1">
     Tracking dataset relationships using lineage
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.401.1">
     As data is
    </span>
    <a id="_idIndexMarker298">
    </a>
    <span class="koboSpan" id="kobo.402.1">
     transformed in
    </span>
    <a id="_idIndexMarker299">
    </a>
    <span class="koboSpan" id="kobo.403.1">
     your lakehouse by
    </span>
    <a id="_idIndexMarker300">
    </a>
    <span class="koboSpan" id="kobo.404.1">
     data pipelines, the contents of your organization’s datasets can go through a series of evolutions by a variety of processes.
    </span>
    <span class="koboSpan" id="kobo.404.2">
     This can include processes such as data cleansing, data type casting, column transformation, or data enrichment, to name a few.
    </span>
    <span class="koboSpan" id="kobo.404.3">
     As you can imagine, the data can deviate quite far from when it was originally ingested from its originating source.
    </span>
    <span class="koboSpan" id="kobo.404.4">
     It’s important for downstream consumers of the data in your lakehouse to be able to verify the validity of your datasets.
    </span>
    <span class="koboSpan" id="kobo.404.5">
     Data lineage is one mechanism for such validation by allowing users to trace the origin of tables and columns so that you can ensure that you are using data from
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.405.1">
      trusted sources.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer057">
     <span class="koboSpan" id="kobo.406.1">
      <img alt="Figure 5.10 – A lakehouse table may be the result of a combination of multiple upstream tables" src="image/B22011_05_10.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.407.1">
     Figure 5.10 – A lakehouse table may be the result of a combination of multiple upstream tables
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.408.1">
     Data lineage can
    </span>
    <a id="_idIndexMarker301">
    </a>
    <span class="koboSpan" id="kobo.409.1">
     be viewed
    </span>
    <a id="_idIndexMarker302">
    </a>
    <span class="koboSpan" id="kobo.410.1">
     from
    </span>
    <a id="_idIndexMarker303">
    </a>
    <span class="koboSpan" id="kobo.411.1">
     a variety of mechanisms in the Databricks Data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.412.1">
      Intelligence Platform:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <span class="koboSpan" id="kobo.413.1">
      Directly from Catalog Explorer by viewing the
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.414.1">
       lineage graph
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.415.1">
      Retrieved using the Lineage Tracking
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.416.1">
       REST API
      </span>
     </span>
    </li>
    <li>
     <span class="koboSpan" id="kobo.417.1">
      Querying the Lineage Tracking system tables in
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.418.1">
       Unity Catalog
      </span>
     </span>
    </li>
   </ul>
   <p>
    <span class="koboSpan" id="kobo.419.1">
     Let’s look at how we might be able to trace the origin of a few columns in our downstream table to the upstream sources in Databricks.
    </span>
    <span class="koboSpan" id="kobo.419.2">
     If you haven’t already done so, you can clone this chapter’s sample notebooks from the GitHub repository located at
    </span>
    <a href="https://github.com/PacktPublishing/Building-Modern-Data-Applications-Using-Databricks-Lakehouse/tree/main/chapter05">
     <span class="koboSpan" id="kobo.420.1">
      https://github.com/PacktPublishing/Building-Modern-Data-Applications-Using-Databricks-Lakehouse/tree/main/chapter05
     </span>
    </a>
    <span class="koboSpan" id="kobo.421.1">
     .
    </span>
    <span class="koboSpan" id="kobo.421.2">
     Begin by importing the sample notebook titled
    </span>
    <a id="_idTextAnchor141">
    </a>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.422.1">
      Data Lineage Demo.sql
     </span>
    </strong>
    <span class="koboSpan" id="kobo.423.1">
     into your Databricks workspace.
    </span>
    <span class="koboSpan" id="kobo.423.2">
     Attach the notebook to a running all-purpose cluster and execute all of the notebook cells.
    </span>
    <span class="koboSpan" id="kobo.423.3">
     The notebook will generate two tables – a parent table and a child table whose columns are constructed from the upstream
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.424.1">
      parent table.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.425.1">
     Once the notebook has been executed and the tables have been saved to Unity Catalog, navigate to Catalog Explorer by clicking the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.426.1">
      Catalog
     </span>
    </strong>
    <span class="koboSpan" id="kobo.427.1">
     menu item from the left-hand navigation menu.
    </span>
    <span class="koboSpan" id="kobo.427.2">
     From Catalog Explorer, search for the child table by entering the table name in the
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.428.1">
      Search
     </span>
    </strong>
    <span class="koboSpan" id="kobo.429.1">
     text field.
    </span>
    <span class="koboSpan" id="kobo.429.2">
     Click on the child table to reveal the table details.
    </span>
    <span class="koboSpan" id="kobo.429.3">
     Finally, click on the blue button titled
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.430.1">
      See lineage graph
     </span>
    </strong>
    <span class="koboSpan" id="kobo.431.1">
     to generate a lineage diagram.
    </span>
    <span class="koboSpan" id="kobo.431.2">
     You’ll notice that the diagram clearly depicts the relationship between the two data assets – the parent table and the child table.
    </span>
    <span class="koboSpan" id="kobo.431.3">
     Next, click on the column titled
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.432.1">
      car_description
     </span>
    </strong>
    <span class="koboSpan" id="kobo.433.1">
     in the child table.
    </span>
    <span class="koboSpan" id="kobo.433.2">
     You’ll notice that the lineage diagram is updated, clearly illustrating which columns from the parent table are used to construct this column in the downstream
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.434.1">
      child table.
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer058">
     <span class="koboSpan" id="kobo.435.1">
      <img alt="Figure 5.11 – The table lineage graph can be viewed directly from Catalog Explorer" src="image/B22011_05_11.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.436.1">
     Figure 5.11 – The table lineage graph can be viewed directly from Catalog Explorer
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.437.1">
     In fact, thanks to the unification nature of Unity Catalog, data lineage can be used to trace data relationships across multiple workspaces.
    </span>
    <span class="koboSpan" id="kobo.437.2">
     Furthermore, data lineage will capture relationship
    </span>
    <a id="_idIndexMarker304">
    </a>
    <span class="koboSpan" id="kobo.438.1">
     information
    </span>
    <a id="_idIndexMarker305">
    </a>
    <span class="koboSpan" id="kobo.439.1">
     in
    </span>
    <a id="_idIndexMarker306">
    </a>
    <span class="koboSpan" id="kobo.440.1">
     near-real time, so that users can always have an up-to-date view of dataset relationships no matter the Databricks workspace they
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.441.1">
      are using.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-114">
    <a id="_idTextAnchor142">
    </a>
    <span class="koboSpan" id="kobo.442.1">
     Observability with system tables
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.443.1">
     Strong auditing and
    </span>
    <a id="_idIndexMarker307">
    </a>
    <span class="koboSpan" id="kobo.444.1">
     system
    </span>
    <a id="_idIndexMarker308">
    </a>
    <span class="koboSpan" id="kobo.445.1">
     observability is another core strength of Unity Catalog and is implemented in Databricks using system tables.
    </span>
    <span class="koboSpan" id="kobo.445.2">
     System tables are a set of read-only tables in a Databricks workspace that capture the operational data about activities within your Databricks workspaces.
    </span>
    <span class="koboSpan" id="kobo.445.3">
     Furthermore, systems tables record data across all workspaces within a Databricks account, serving as a single source of truth to retrieve operational data pertaining to your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.446.1">
      Databricks workspaces.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.447.1">
     System tables record
    </span>
    <a id="_idIndexMarker309">
    </a>
    <span class="koboSpan" id="kobo.448.1">
     observability information about the following aspects of your Databricks workspaces (the latest list of available system tables can be found
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.449.1">
      at
     </span>
    </span>
    <a href="https://docs.databricks.com/en/admin/system-tables/index.html#which-system-tables-are-available">
     <span class="No-Break">
      <span class="koboSpan" id="kobo.450.1">
       https://docs.databricks.com/en/admin/system-tables/index.html#which-system-tables-are-available
      </span>
     </span>
    </a>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.451.1">
      ):
     </span>
    </span>
   </p>
   <table class="No-Table-Style _idGenTablePara-1" id="table001-4">
    <colgroup>
     <col/>
     <col/>
     <col/>
    </colgroup>
    <tbody>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.452.1">
           Category
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.453.1">
           Service
          </span>
         </strong>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.454.1">
           Description
          </span>
         </strong>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style" rowspan="2">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.455.1">
          System billing
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.456.1">
          Billable usage
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.457.1">
         Captures billing information about utilized computational resources such as warehouses
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.458.1">
          and clusters
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.459.1">
          Pricing
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.460.1">
         Captures
        </span>
        <a id="_idIndexMarker310">
        </a>
        <span class="koboSpan" id="kobo.461.1">
         historical changes to system service pricing (or
        </span>
        <strong class="bold">
         <span class="koboSpan" id="kobo.462.1">
          stock-keeping
         </span>
        </strong>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.463.1">
           unit
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.464.1">
          (
         </span>
        </span>
        <span class="No-Break">
         <strong class="bold">
          <span class="koboSpan" id="kobo.465.1">
           SKU
          </span>
         </strong>
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.466.1">
          ))
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style" rowspan="3">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.467.1">
          System access
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.468.1">
          System audit
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.469.1">
         Contains event data from workspace services including jobs, workflows, clusters, notebooks, repos, secrets,
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.470.1">
          and more
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.471.1">
          Table lineage
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.472.1">
         Captures data about reads/writes to and from a table in
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.473.1">
          Unity Catalog
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.474.1">
         Column
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.475.1">
          lineage information
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.476.1">
         Captures data about reads/writes to and from a column within a Unity
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.477.1">
          Catalog table
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style" rowspan="3">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.478.1">
          Compute
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.479.1">
          Clusters
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.480.1">
         Captures information about clusters – for example, configuration changes
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.481.1">
          over time
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.482.1">
         Node
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.483.1">
          type information
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.484.1">
         Includes hardware information about cluster
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.485.1">
          node types
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.486.1">
         SQL
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.487.1">
          warehouse events
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.488.1">
         Captures changes made to SQL warehousing such as
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.489.1">
          scaling events
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.490.1">
          System storage
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.491.1">
          Predictive optimizations
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.492.1">
         Captures predicative I/O optimizations as they occur during
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.493.1">
          data processing
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style" rowspan="2">
       <p>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.494.1">
          Marketplace
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.495.1">
         Marketplace
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.496.1">
          funnel events
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.497.1">
         Captures marketplace analytical information such as number of impressions and funnel data about
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.498.1">
          dataset listing
         </span>
        </span>
       </p>
      </td>
     </tr>
     <tr class="No-Table-Style">
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.499.1">
         Marketplace
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.500.1">
          listing events
         </span>
        </span>
       </p>
      </td>
      <td class="No-Table-Style">
       <p>
        <span class="koboSpan" id="kobo.501.1">
         Records marketplace consumer information about
        </span>
        <span class="No-Break">
         <span class="koboSpan" id="kobo.502.1">
          dataset listings
         </span>
        </span>
       </p>
      </td>
     </tr>
    </tbody>
   </table>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.503.1">
     Table 5.1 – System tables will record operational information across various parts of the Databricks Data Intelligence Platform
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.504.1">
     Like all tables in Unity Catalog, there is no access to the system tables by default.
    </span>
    <span class="koboSpan" id="kobo.504.2">
     Instead, a
    </span>
    <a id="_idIndexMarker311">
    </a>
    <span class="koboSpan" id="kobo.505.1">
     metastore
    </span>
    <a id="_idIndexMarker312">
    </a>
    <span class="koboSpan" id="kobo.506.1">
     administrator will need to grant read access (
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.507.1">
      SELECT
     </span>
    </strong>
    <span class="koboSpan" id="kobo.508.1">
     permissions) to these tables to the appropriate users and groups.
    </span>
    <span class="koboSpan" id="kobo.508.2">
     For example, to grant permissions for department leaders to track their warehouse scaling events throughout the workday, a metastore admin would need to explicitly grant permissions for the group,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.509.1">
      dept_leads
     </span>
    </strong>
    <span class="koboSpan" id="kobo.510.1">
     , to query the SQL warehouse
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.511.1">
      system table:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.512.1">
GRANT SELECT ON system.compute.warehouse_events TO dept_leads</span></pre>
   <p>
    <span class="koboSpan" id="kobo.513.1">
     As you can imagine, very active Databricks workspaces will record many events throughout the day, and over time, these tables can grow to be quite large.
    </span>
    <span class="koboSpan" id="kobo.513.2">
     To prevent observability information from accumulating to the point of creating a large cloud storage bill, instead, the system information will only be retained for a maximum of one year within your
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.514.1">
      Databricks account.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.515.1">
     For use cases where the auditing information is required to be retained in the order of many years, you will need to set up a secondary process to copy the system information into a long-term archival system, for example.
    </span>
    <span class="koboSpan" id="kobo.515.2">
     Tracking changes to datasets is critical to ensuring strong
    </span>
    <a id="_idIndexMarker313">
    </a>
    <span class="koboSpan" id="kobo.516.1">
     observability in your
    </span>
    <a id="_idIndexMarker314">
    </a>
    <span class="koboSpan" id="kobo.517.1">
     lakehouse.
    </span>
    <span class="koboSpan" id="kobo.517.2">
     Another strong suite of Unity Catalog is that observability extends beyond just datasets and covers all objects that can be secured under Unity
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.518.1">
      Catalog governance.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-115">
    <a id="_idTextAnchor143">
    </a>
    <span class="koboSpan" id="kobo.519.1">
     Tracing the lineage of other assets
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.520.1">
     As previously
    </span>
    <a id="_idIndexMarker315">
    </a>
    <span class="koboSpan" id="kobo.521.1">
     mentioned, Unity
    </span>
    <a id="_idIndexMarker316">
    </a>
    <span class="koboSpan" id="kobo.522.1">
     Catalog implements a single governance solution over your organization’s data assets, which extends beyond just tables.
    </span>
    <span class="koboSpan" id="kobo.522.2">
     With Unity Catalog, you can trace the lineage of other data assets such as workflows, notebooks, and machine learning models, to name
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.523.1">
      a few.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.524.1">
     Let’s turn our attention to how Unity Catalog can dynamically generate different result sets to queries by evaluating the user and group permissions of a given
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.525.1">
      Databricks user.
     </span>
    </span>
   </p>
   <h2 id="_idParaDest-116">
    <a id="_idTextAnchor144">
    </a>
    <span class="koboSpan" id="kobo.526.1">
     Fine-grained data access
    </span>
   </h2>
   <p>
    <span class="koboSpan" id="kobo.527.1">
     Dynamic views are a
    </span>
    <a id="_idIndexMarker317">
    </a>
    <span class="koboSpan" id="kobo.528.1">
     special type of
    </span>
    <a id="_idIndexMarker318">
    </a>
    <span class="koboSpan" id="kobo.529.1">
     view within the Databricks Data Intelligence Platform that provides data administrators with the ability to control fine-grained access to data within a dataset.
    </span>
    <span class="koboSpan" id="kobo.529.2">
     For example, administrators can specify which rows and columns a particular individual may have access to depending upon their group membership.
    </span>
    <span class="koboSpan" id="kobo.529.3">
     The Databricks Data Intelligence Platform introduces several built-in functions for dynamically evaluating group membership when a particular user queries the contents of
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.530.1">
      a view:
     </span>
    </span>
   </p>
   <ul>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.531.1">
       current_user()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.532.1">
      returns the email address of the user querying
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.533.1">
       the view
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.534.1">
       is_member()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.535.1">
      returns a Boolean (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.536.1">
       True
      </span>
     </strong>
     <span class="koboSpan" id="kobo.537.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.538.1">
       False
      </span>
     </strong>
     <span class="koboSpan" id="kobo.539.1">
      ) of whether the user querying a view is a member of a Databricks
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.540.1">
       workspace-level group
      </span>
     </span>
    </li>
    <li>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.541.1">
       is_account_group_member()
      </span>
     </strong>
     <span class="koboSpan" id="kobo.542.1">
      returns a Boolean (
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.543.1">
       True
      </span>
     </strong>
     <span class="koboSpan" id="kobo.544.1">
      or
     </span>
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.545.1">
       False
      </span>
     </strong>
     <span class="koboSpan" id="kobo.546.1">
      ) of whether the user querying a view is a member of a Databricks account-level group (as opposed to a
     </span>
     <span class="No-Break">
      <span class="koboSpan" id="kobo.547.1">
       workspace-level group)
      </span>
     </span>
    </li>
   </ul>
   <p class="callout-heading">
    <span class="koboSpan" id="kobo.548.1">
     Important note
    </span>
   </p>
   <p class="callout">
    <span class="koboSpan" id="kobo.549.1">
     For dynamic views created against tables and views in Unity Catalog, it’s recommended to use the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.550.1">
      is_account_group_member()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.551.1">
     function to evaluate a user’s membership to a group as it will evaluate group membership at the Databricks account level.
    </span>
    <span class="koboSpan" id="kobo.551.2">
     On the other hand, the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.552.1">
      is_member()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.553.1">
     function will evaluate a user’s membership to a group that is local to a particular workspace and may provide false or
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.554.1">
      unintended results.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.555.1">
     Furthermore, dynamic views also enable data administrators to obfuscate specific column values so that sensitive data is not exfiltrated by accident.
    </span>
    <span class="koboSpan" id="kobo.555.2">
     Using built-in Spark SQL functions
    </span>
    <a id="_idIndexMarker319">
    </a>
    <span class="koboSpan" id="kobo.556.1">
     such as
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.557.1">
      concat()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.558.1">
     ,
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.559.1">
      regexp_extract()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.560.1">
     ,
    </span>
    <a id="_idTextAnchor145">
    </a>
    <span class="koboSpan" id="kobo.561.1">
     or even
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.562.1">
      lit()
     </span>
    </strong>
    <span class="koboSpan" id="kobo.563.1">
     is a simple yet powerful tool for protecting the contents of the most sensitive datasets on the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.564.1">
      Databricks platform.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.565.1">
     In the next section, we’ll look at how we can leverage dynamic views to permit members of a data science team to
    </span>
    <a id="_idIndexMarker320">
    </a>
    <span class="koboSpan" id="kobo.566.1">
     perform ad hoc data wrangling of a sensitive dataset while simultaneously protecting the contents of columns
    </span>
    <a id="_idIndexMarker321">
    </a>
    <span class="koboSpan" id="kobo.567.1">
     with
    </span>
    <strong class="bold">
     <span class="koboSpan" id="kobo.568.1">
      personally identifiable information
     </span>
    </strong>
    <span class="koboSpan" id="kobo.569.1">
     (
    </span>
    <span class="No-Break">
     <strong class="bold">
      <span class="koboSpan" id="kobo.570.1">
       PII
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.571.1">
      ) data.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-117">
    <a id="_idTextAnchor146">
    </a>
    <span class="koboSpan" id="kobo.572.1">
     Hands-on example – data masking healthcare datasets
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.573.1">
     In this example, we’ll be
    </span>
    <a id="_idIndexMarker322">
    </a>
    <span class="koboSpan" id="kobo.574.1">
     creating a dynamic view to restrict data access to certain rows and columns within a dataset.
    </span>
    <span class="koboSpan" id="kobo.574.2">
     We’ll be using the COVID sample dataset located within the Databricks datasets at
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.575.1">
      /databricks-datasets/COVID/covid-19-data/us-counties.csv
     </span>
    </strong>
    <span class="koboSpan" id="kobo.576.1">
     .
    </span>
    <span class="koboSpan" id="kobo.576.2">
     The dataset contains COVID-19 infection data for US counties during the 2020 global pandemic.
    </span>
    <span class="koboSpan" id="kobo.576.3">
     Since this dataset can contain sensitive data, we’ll apply a simple data mask to prevent the exposure of sensitive data to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.577.1">
      non-privileged users.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.578.1">
     Let’s start by defining a few global variables, as well as the catalog and schema that will hold our
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.579.1">
      dynamic views:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.580.1">
CATALOG_NAME = "building_modern_dapps"
SCHEMA_NAME = "dynamic_views_demo"
PERSISTENT_TABLE_NAME = "covid_us_counties"
COVID_DATASET_PATH = "/databricks-datasets/COVID/covid-19-data/us-counties.csv"
spark.sql(f"CREATE CATALOG IF NOT EXISTS {CATALOG_NAME}")
spark.sql(f"USE CATALOG {CATALOG_NAME}")
spark.sql(f"CREATE SCHEMA IF NOT EXISTS {SCHEMA_NAME}")
spark.sql(f"USE SCHEMA {SCHEMA_NAME}")</span></pre>
   <p>
    <span class="koboSpan" id="kobo.581.1">
     Next, we’ll need to define a persistent table object in Unity Catalog that we will use to create views.
    </span>
    <span class="koboSpan" id="kobo.581.2">
     Let’s start by creating a new table using the sample US Counties
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.582.1">
      COVID dataset:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.583.1">
covid_df = (spark.read
            .option("header", True)
            .option("inferSchema", True)
            .csv(COVID_DATASET_PATH))
(covid_df.write
    .mode("overwrite")
    .saveAsTable(f"{CATALOG_NAME}.{SCHEMA_NAME}.{PERSISTENT_TABLE_NAME}"));</span></pre>
   <p>
    <span class="koboSpan" id="kobo.584.1">
     Next, let’s query the newly created table in Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.584.2">
     Note that all columns and rows are returned since we didn’t specify any qualifying criteria that would filter
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.585.1">
      the data:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.586.1">
spark.table(f"{CATALOG_NAME}.{SCHEMA_NAME}.{PERSISTENT_TABLE_NAME}").display()</span></pre>
   <p>
    <span class="koboSpan" id="kobo.587.1">
     Let’s create a view that will dynamically evaluate the querying user’s group membership in Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.587.2">
     In this case, we want to restrict access to certain columns if the user is not a member of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.588.1">
      admins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.589.1">
     group.
    </span>
    <span class="koboSpan" id="kobo.589.2">
     Based upon the group membership, we can give access to a user or we could limit access to
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.590.1">
      the data.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.591.1">
     Let’s also leverage a
    </span>
    <a id="_idIndexMarker323">
    </a>
    <span class="koboSpan" id="kobo.592.1">
     built-in Spark SQL function to apply a simple yet powerful data mask to sensitive data columns, allowing only privileged members of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.593.1">
      admins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.594.1">
     group access to view
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.595.1">
      the text:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.596.1">
RESTRICTED_VIEW_NAME = "covid_us_counties_restricted_vw"
spark.sql(f"""
CREATE OR REPLACE VIEW {RESTRICTED_VIEW_NAME} AS
SELECT
    date,
    county,
    state,
    CASE WHEN is_account_group_member('admins')
        THEN fips
        ELSE concat('***', substring(fips, length(fips)-1,
                                     length(fips)))
    END AS fips_id,
    cases,
    CASE WHEN is_account_group_member('admins')
        THEN deaths
        ELSE 'UNKNOWN'
    END AS mortality_cases
FROM {CATALOG_NAME}.{SCHEMA_NAME}.{PERSISTENT_TABLE_NAME}
""")</span></pre>
   <p>
    <span class="koboSpan" id="kobo.597.1">
     In the previous view definition, we’ve limited data access to a particular set of columns within the US Counties COVID dataset.
    </span>
    <span class="koboSpan" id="kobo.597.2">
     Using dynamic views, we can also limit access to a particular set of rows using a query predicate.
    </span>
    <span class="koboSpan" id="kobo.597.3">
     In the final view definition, we’ll limit which US states a particular
    </span>
    <a id="_idIndexMarker324">
    </a>
    <span class="koboSpan" id="kobo.598.1">
     user can view based on a user’s membership to the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.599.1">
       admins
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.600.1">
      group:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.601.1">
COL_AND_ROW_RESTRICTED_VIEW_NAME = "covid_us_counties_final_vw"
spark.sql(f"""
CREATE OR REPLACE VIEW {COL_AND_ROW_RESTRICTED_VIEW_NAME} AS
SELECT
    date,
    county,
    state,
    CASE WHEN is_account_group_member('admins')
        THEN fips
        ELSE concat('***', substring(fips, length(fips)-1,
                                     length(fips)))
    END AS fips_id,
    cases,
    CASE WHEN is_account_group_member('admins')
        THEN deaths
        ELSE 'UNKNOWN'
    END AS mortality_cases
FROM {CATALOG_NAME}.{SCHEMA_NAME}.{PERSISTENT_TABLE_NAME}
WHERE
    CASE WHEN is_account_group_member('admins')
        THEN 1=1
        ELSE state IN ('Alabamba', 'Colorado', 'California',
                       'Delaware', 'New York', 'Texas', 'Florida')
    END
""")</span></pre>
   <p>
    <span class="koboSpan" id="kobo.602.1">
     Now, members of other groups can perform ad hoc data exploration and other data experimentation.
    </span>
    <span class="koboSpan" id="kobo.602.2">
     However, we won’t inadvertently expose any sensitive healthcare data.
    </span>
    <span class="koboSpan" id="kobo.602.3">
     For example, let’s imagine that there is another group called
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.603.1">
      data-science
     </span>
    </strong>
    <span class="koboSpan" id="kobo.604.1">
     .
    </span>
    <span class="koboSpan" id="kobo.604.2">
     This group can query the dynamic view, but the results will be different from if a member of the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.605.1">
      admins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.606.1">
     group queried the view.
    </span>
    <span class="koboSpan" id="kobo.606.2">
     For example, the following aggregation will
    </span>
    <a id="_idIndexMarker325">
    </a>
    <span class="koboSpan" id="kobo.607.1">
     return different result sets depending on whether a user is in the
    </span>
    <strong class="source-inline">
     <span class="koboSpan" id="kobo.608.1">
      admins
     </span>
    </strong>
    <span class="koboSpan" id="kobo.609.1">
     group or the
    </span>
    <span class="No-Break">
     <strong class="source-inline">
      <span class="koboSpan" id="kobo.610.1">
       data-science
      </span>
     </strong>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.611.1">
      group:
     </span>
    </span>
   </p>
   <pre class="source-code"><span class="koboSpan" id="kobo.612.1">
(spark.table(COL_AND_ROW_RESTRICTED_VIEW_NAME)
    .groupBy("state", "county")
    .agg({"cases": "count"})
    .orderBy("state", "county")
).withColumnRenamed("count(cases)", "total_covid_cases").display()</span></pre>
   <p>
    <span class="koboSpan" id="kobo.613.1">
     We get the
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.614.1">
      following results:
     </span>
    </span>
   </p>
   <div>
    <div class="IMG---Figure" id="_idContainer059">
     <span class="koboSpan" id="kobo.615.1">
      <img alt="Figure 5.12 – Dynamic views can generate customized results based on group membership" src="image/B22011_05_12.jpg"/>
     </span>
    </div>
   </div>
   <p class="IMG---Caption" lang="en-US" xml:lang="en-US">
    <span class="koboSpan" id="kobo.616.1">
     Figure 5.12 – Dynamic views can generate customized results based on group membership
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.617.1">
     By now, you should be able to realize the power of dynamic views within the Databricks Data Intelligence Platform.
    </span>
    <span class="koboSpan" id="kobo.617.2">
     With
    </span>
    <a id="_idIndexMarker326">
    </a>
    <span class="koboSpan" id="kobo.618.1">
     just a few built-in functions, we can implement strong data governance across various users and groups interacting with your organization’s data in
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.619.1">
      the
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.620.1">
      l
     </span>
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.621.1">
      akehouse.
     </span>
    </span>
   </p>
   <h1 id="_idParaDest-118">
    <a id="_idTextAnchor147">
    </a>
    <span class="koboSpan" id="kobo.622.1">
     Summary
    </span>
   </h1>
   <p>
    <span class="koboSpan" id="kobo.623.1">
     In this chapter, we covered the challenges specific to lakehouse data governance and how Unity Catalog solves these challenges.
    </span>
    <span class="koboSpan" id="kobo.623.2">
     We also covered how to enable Unity Catalog within an existing Databricks workspace and how metastore admins can establish connections with external data sources.
    </span>
    <span class="koboSpan" id="kobo.623.3">
     Lastly, we covered techniques for discovering and cataloging data assets within the lakehouse and how annotating data assets with metadata tags can create a searchable and well-organized
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.624.1">
      data catalog.
     </span>
    </span>
   </p>
   <p>
    <span class="koboSpan" id="kobo.625.1">
     In the next chapter, we’ll explore how to effectively manage input and output data locations using Unity Catalog.
    </span>
    <span class="koboSpan" id="kobo.625.2">
     You’ll learn how to govern data access across various roles and departments within an organization, ensuring security and auditability within the Databricks Data
    </span>
    <span class="No-Break">
     <span class="koboSpan" id="kobo.626.1">
      Intelligence Platform.
     </span>
    </span>
   </p>
  </div>
 </body></html>