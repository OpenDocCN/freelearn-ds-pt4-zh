<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops" lang="en-US" xml:lang="en-US">
<head>
  <meta charset="utf-8"/>
  <meta name="generator" content="pandoc"/>
  <title>ch017.xhtml</title>
  <style>
  </style>
  <link rel="stylesheet" type="text/css" href="../styles/stylesheet1.css"/>
</head>
<body epub:type="bodymatter">
<section id="functions" class="level2 chapterHead">
<h1 class="chapterHead"><span class="titlemark"><span class="cmss-10x-x-109">9</span></span><br/>
<span id="x1-14600011"></span><span class="cmss-10x-x-109">Functions</span></h1>
<blockquote class="packt_quote">
<p><span class="cmss-10x-x-109">”Mathematicians are like Frenchmen: whatever you say to them they translate into their own language and forthwith it is something entirely different.”</span></p>
<div class="flushright">
<p><span class="cmss-10x-x-109">— Johann Wolfgang von Goethe</span></p>
</div>
</blockquote>
<p><span class="cmss-10x-x-109">It’s time we tackle the next big subject of machine-learning-math: functions and calculus. What do we have to do with functions?</span></p>
<p><span class="cmss-10x-x-109">As we’ve seen before, a predictive model is nothing but a multivariate parametric function. Linear regression? </span><span class="cmmi-10x-x-109">A</span><span class="cmbx-10x-x-109">x</span><span class="cmss-10x-x-109">. Logistic regression? </span><span class="cmmi-10x-x-109">σ</span>(<span class="cmmi-10x-x-109">A</span><span class="cmbx-10x-x-109">x</span>)<span class="cmss-10x-x-109">. Neural networks? A sequence of </span><span class="cmmi-10x-x-109">σ</span>(<span class="cmmi-10x-x-109">A</span><span class="cmbx-10x-x-109">x</span>)<span class="cmss-10x-x-109">-s, and a multitude of other layers.</span></p>
<p><span class="cmss-10x-x-109">But it’s not just the description of models, it’s fitting them to the data. Say, for a simple linear regression model, “training” is minimizing the mean squared error; that is, finding</span></p>
<div class="math-display">
<img src="../media/file851.png" class="math-display" alt=" n 1-∑ 2 argmina,b∈ℝn (axi + b − yi), i=1 "/>
</div>
<p><span class="cmss-10x-x-109">where </span><span class="cmmi-10x-x-109">x</span><sub><span class="cmmi-8">i</span></sub> <span class="cmss-10x-x-109">is the training data, and </span><span class="cmmi-10x-x-109">y</span><sub><span class="cmmi-8">i</span></sub> <span class="cmss-10x-x-109">is the ground truth. This is done via </span><span class="cmssi-10x-x-109">differentiation</span><span class="cmss-10x-x-109">, one of humanity’s most essential inventions. (Whether we can call mathematical discoveries </span><span class="cmssi-10x-x-109">inventions </span><span class="cmss-10x-x-109">is a matter of constant debate.)</span></p>
<p><span class="cmss-10x-x-109">For a function </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>)<span class="cmss-10x-x-109">, its derivative at </span><span class="cmmi-10x-x-109">x</span><sub><span class="cmr-8">0</span></sub> <span class="cmss-10x-x-109">is defined by</span></p>
<div class="math-display">
<img src="../media/file852.png" class="math-display" alt="f ′(x0) = lim f-(x)−-f(x0), x→x0 x − x0 "/>
</div>
<p><span class="cmss-10x-x-109">describing the rate of change in terms of </span><span class="cmmi-10x-x-109">x </span><span class="cmss-10x-x-109">. There’s a lot to unravel: what is that strange</span> lim<sub><span class="cmmi-8">x</span><span class="cmsy-8">→</span><span class="cmmi-8">x</span><sub><span class="cmr-6">0</span></sub></sub> <span class="cmss-10x-x-109">symbol? What do the ratio</span> <img src="../media/file853.png" class="frac" data-align="middle" alt="f(x)−f(x0)- x−x0"/> <span class="cmss-10x-x-109">represent? We’ll get to all of it in due time. The gist is, differentiation is the driving force of gradient descent, the number one algorithm for training neural networks.</span></p>
<p><span class="cmss-10x-x-109">But it does not end here either. Differentiation has an equally important counterpart: </span><span class="cmssi-10x-x-109">integration</span><span class="cmss-10x-x-109">. The formula</span></p>
<div class="math-dislay">
<img src="../media/file854.png" width="150" class="math-display" alt="∫ b f(x)dx a "/>
</div>
<p><span class="cmss-10x-x-109">is called the </span><span class="cmssi-10x-x-109">integral </span><span class="cmss-10x-x-109">of </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>)<span class="cmss-10x-x-109">, describing the signed area under its graph. Integration is not as prevalent in practice, but it’s an essential tool for theory. For instance, half of probability theory is built around it. Say, the famous expected value is defined in terms of an integral; as are several notable probability distributions.</span></p>
<p><span class="cmss-10x-x-109">In the next couple of chapters, we’ll dive deep into </span><span class="cmssi-10x-x-109">calculus</span><span class="cmss-10x-x-109">, the theory of univariate functions. Why? Because even though machine learning is multivariate, the ideas we develop here will serve as the foundations for all the math to come. Let’s get to work!</span></p>
<section id="functions-in-theory" class="level3 sectionHead">
<h2 class="sectionHead" id="sigil_toc_id_125"><span class="titlemark"><span class="cmss-10x-x-109">9.1 </span></span> <span id="x1-14700011.1"></span><span class="cmss-10x-x-109">Functions in theory</span></h2>
<p><span class="cmss-10x-x-109">Everyone has an</span> <span id="dx1-147001"></span><span class="cmss-10x-x-109">intuitive understanding of what functions are. At one point or another, all of us have encountered this concept. For most of us, a function is a curve drawn with a continuous line onto a representation of the Cartesian coordinate system.</span></p>
<div class="minipage">
<p><img src="../media/file855.png" width="356" alt="PIC"/> <span id="x1-147002r1"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.1: Definitely looks like a function</span> </span>
</div>
<p><span class="cmss-10x-x-109">However, in mathematics, intuitions can often lead us to false conclusions. Often, there is a difference between </span><span class="cmssi-10x-x-109">what something is </span><span class="cmss-10x-x-109">and </span><span class="cmssi-10x-x-109">how you think about it </span><span class="cmss-10x-x-109">– what your mental models are. To give an example from a real-life scenario in machine learning, consider the following piece of code:</span></p>
<div id="tcolobox-201" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>import numpy as np 
 
 
def cross_entropy_loss(X, y): 
    #x0022;"/span&gt; 
    Args: 
        X: numpy.ndarray of shape (n_batch, n_dim). 
            Contains the predictions in form of a probability distribution. 
        y: numpy.ndarray of shape (n_batch, 1). 
            Contains class labels for each data point in X. 
 
    Returns: 
        loss: numpy.float. 
            Cross entropy loss of the predictions. 
    #x0022;"/span&gt; 
 
    exp_x = np.exp(X) 
    probs = exp_x / np.sum(exp_x, axis=1, keepdims=True) 
    log_probs = - np.log([probs[i, y[i]] for i in range(len(probs))]) 
    loss = np.mean(log_probs) 
 
    return loss</code></pre>
</div>
</div>
<p><span class="cmss-10x-x-109">Suppose that you</span> <span id="dx1-147025"></span><span class="cmss-10x-x-109">wrote this function, and it is in your codebase somewhere. Depending on our needs, we might think of it as </span><span class="cmssi-10x-x-109">cross-entropy loss</span><span class="cmss-10x-x-109">, but in reality, this is a 579-character-long string in the Python language, eventually processed by an interpreter. However, when working with it, we often use a mental model that compacts this information into easily usable chunks, like the three words </span><span class="cmssi-10x-x-109">cross-entropy loss</span><span class="cmss-10x-x-109">. When we reason about high-level processes like training a neural network, abstractions such as this allow us to move further and step bigger.</span></p>
<p><span class="cmss-10x-x-109">But sometimes, things don’t go our way. When this function throws an error and crashes the computations, </span><span class="cmssi-10x-x-109">cross-entropy loss </span><span class="cmss-10x-x-109">will not cut it. Then, it is time to unravel the definition and put everything under a magnifying glass. What could have hindered your thinking before is now essential.</span></p>
<p><span class="cmss-10x-x-109">These principles are also true for theory, not just for practice. Mathematics is a balancing act between logical precision and a clear understanding, two often contradicting objectives.</span></p>
<p><span class="cmss-10x-x-109">Let’s go back to our starting point: functions in a mathematical sense. One possible mental model, as mentioned, is </span><span class="cmssi-10x-x-109">a curve drawn with a continuous line</span><span class="cmss-10x-x-109">. It allows us to reason about functions visually and intuitively answer some questions. However, this particular mental model can go very wrong.</span></p>
<p><span class="cmss-10x-x-109">To give an example, does </span><span class="cmssi-10x-x-109">Figure 9.2 </span><span class="cmss-10x-x-109">depict a function?</span></p>
<div class="minipage">
<p><img src="../media/file856.png" width="399" alt="PIC"/> <span id="x1-147026r2"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.2: Is this a function?</span> </span>
</div>
<p><span class="cmss-10x-x-109">Even though this</span> <span id="dx1-147027"></span><span class="cmss-10x-x-109">curve is drawn with a continuous line, this is </span><span class="cmssi-10x-x-109">not </span><span class="cmss-10x-x-109">a function, as there are values with multiple images, which cannot happen. To avoid confusion later, we have to build the foundations of our discussion if we were to talk about mathematical objects. In this chapter, our goal is to establish a basic dictionary to properly understand the objects we are working with in machine learning.</span></p>
<section id="the-mathematical-definition-of-a-function" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_126"><span class="titlemark"><span class="cmss-10x-x-109">9.1.1 </span></span> <span id="x1-14800011.1.1"></span><span class="cmss-10x-x-109">The mathematical definition of a function</span></h3>
<p><span class="cmss-10x-x-109">Let’s dive</span><span id="dx1-148001"></span> <span class="cmss-10x-x-109">straight into the deep water and see the exact </span><span class="cmssi-10x-x-109">mathematical definition </span><span class="cmss-10x-x-109">of functions! (Don’t worry if you don’t understand it for the first read. I’ll explain everything in detail. This is the usual experience when encountering a definition for the first time.)</span></p>
<div class="newtheorem">
<p><span class="head"> <span id="x1-148002r35"></span> <span class="cmbx-10x-x-109">Definition 35.</span> </span><span class="cmbx-10x-x-109">(Functions)</span></p>
<p>Let <span class="cmmi-10x-x-109">X </span>and <span class="cmmi-10x-x-109">Y </span>be two sets. The subset <span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">⊆</span><span class="cmmi-10x-x-109">X </span><span class="cmsy-10x-x-109">×</span><span class="cmmi-10x-x-109">Y </span>is a <span class="cmti-10x-x-109">function </span>if for every <span class="cmmi-10x-x-109">x </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">X</span>, there is at most one <span class="cmmi-10x-x-109">y </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">Y </span>such that (<span class="cmmi-10x-x-109">x,y</span>) <span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">f</span>.</p>
</div>
<p><span class="cmss-10x-x-109">(The set </span><span class="cmmi-10x-x-109">X </span><span class="cmsy-10x-x-109">×</span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">denotes the </span><span class="cmssi-10x-x-109">Cartesian product </span><span class="cmss-10x-x-109">of </span><span class="cmmi-10x-x-109">X </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">. If you are not familiar</span> <span id="dx1-148003"></span><span class="cmss-10x-x-109">with the concept, check out </span><span class="cmssi-10x-x-109">Appendix C</span><span class="cmss-10x-x-109">.)</span></p>
<p><span class="cmss-10x-x-109">For simplicity, we introduce the notation</span></p>
<img src="../media/file857.png" width="150" class="math-display" alt="f : X → Y, "/>

<p><span class="cmss-10x-x-109">which is short for </span><span class="cmmi-10x-x-109">f </span><span class="cmssi-10x-x-109">is a function from </span><span class="cmmi-10x-x-109">X </span><span class="cmssi-10x-x-109">to </span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">.</span></p>
<p><span class="cmss-10x-x-109">Note that </span><span class="cmmi-10x-x-109">X </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">can be any set. In the examples we encounter, these are usually the set of real numbers or vectors, but there is no such restriction.</span></p>
<p><span class="cmss-10x-x-109">To visualize the</span> <span id="dx1-148004"></span><span class="cmss-10x-x-109">definition, we can draw two sets and arrows pointing from elements of </span><span class="cmmi-10x-x-109">X </span><span class="cmss-10x-x-109">to elements of </span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">. Each element </span>(<span class="cmmi-10x-x-109">x,y</span>) <span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">represents an arrow, pointing from </span><span class="cmmi-10x-x-109">x </span><span class="cmss-10x-x-109">to </span><span class="cmmi-10x-x-109">y</span><span class="cmss-10x-x-109">.</span></p>
<div class="minipage">
<p><img src="../media/file858.png" width="399" alt="PIC"/> <span id="x1-148005r3"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.3: A function, as arrows between two sets</span> </span>
</div>
<p><span class="cmss-10x-x-109">The only criteria is that there can be at most one arrow starting from any </span><span class="cmmi-10x-x-109">x </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">X</span><span class="cmss-10x-x-109">. This is why </span><span class="cmssi-10x-x-109">Figure 9.2 </span><span class="cmss-10x-x-109">is </span><span class="cmssi-10x-x-109">not </span><span class="cmss-10x-x-109">a function.</span></p>
<p><span class="cmss-10x-x-109">Defining a function as a subset is mathematically precise but very low level. To be more useful, we can introduce an abstraction by defining functions with </span><span class="cmssi-10x-x-109">formulas</span><span class="cmss-10x-x-109">, such as</span></p>
<div class="math-display">
<img src="../media/file859.png" class="math-display" alt="f : ℝ → ℝ, x ↦→ x2, "/>
</div>
<p><span class="cmss-10x-x-109">or simply </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">2</span></sup> <span class="cmss-10x-x-109">in short. This is how most of us think about functions when working with them.</span></p>
<p><span class="cmss-10x-x-109">Now that we are familiar with the definition, we should get to know some of the most basic structural properties of functions.</span></p>
</section>
<section id="domain-and-image" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_127"><span class="titlemark"><span class="cmss-10x-x-109">9.1.2 </span></span> <span id="x1-14900011.1.2"></span><span class="cmss-10x-x-109">Domain and image</span></h3>
<p><span class="cmss-10x-x-109">We saw that, in essence, functions</span> <span id="dx1-149001"></span><span class="cmss-10x-x-109">are arrows between sets. At this point, we don’t know anything useful about them. When is a function invertible? How can we find their minima and maxima? Why should we even care? Probably you have a bunch of questions here. Slowly but surely, we will cover all of these.</span></p>
<p><span class="cmss-10x-x-109">The first steps in our journey are concerned with the </span><span class="cmssi-10x-x-109">sets </span><span class="cmss-10x-x-109">from which arrows start and point. There are two important sets in a function’s life: its </span><span class="cmssi-10x-x-109">domain </span><span class="cmss-10x-x-109">and </span><span class="cmssi-10x-x-109">image</span><span class="cmss-10x-x-109">.</span></p>
<div class="newtheorem">
<p><span class="head"> <span id="x1-149002r36"></span> <span class="cmbx-10x-x-109">Definition 36.</span> </span><span class="cmbx-10x-x-109">(Domain and image of functions)</span></p>
<p>Let <span class="cmmi-10x-x-109">f </span>: <span class="cmmi-10x-x-109">X </span><span class="cmsy-10x-x-109">→</span><span class="cmmi-10x-x-109">Y </span>be a function. The sets</p>
<div class="math-display">
<img src="../media/file860.png" class="math-display" alt="domf := {x ∈ X : there is an y ∈ Y such that f(x) = y} ⊆ X "/>
</div>
<p>and</p>
<div class="math-display">
<img src="../media/file861.png" class="math-display" alt="im f := {y ∈ Y : there is an x ∈ X such that f(x) = y} ⊆ Y "/>
</div>
<p>are respectively called the <span class="cmti-10x-x-109">domain </span>and <span class="cmti-10x-x-109">image </span>of <span class="cmmi-10x-x-109">f</span>.</p>
</div>
<p><span class="cmss-10x-x-109">In other words, the</span> <span id="dx1-149003"></span><span class="cmss-10x-x-109">domain is the subset of </span><span class="cmmi-10x-x-109">X </span><span class="cmss-10x-x-109">where arrows start; the image is the subset of </span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">where arrows point.</span></p>
<div class="minipage">
<p><img src="../media/file862.png" width="427" alt="PIC"/> <span id="x1-149004r4"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.4: The domain and image of a function</span> </span>
</div>
<p><span class="cmss-10x-x-109">Why is this important? For one, these are directly related to the </span><span class="cmssi-10x-x-109">invertibility </span><span class="cmss-10x-x-109">of a function. If you consider the ”points and arrows” mental representation, inverting a function is as simple as flipping the direction of the arrows. When can we do it? In some cases, doing this might not even result in a function, as </span><span class="cmssi-10x-x-109">Figure 9.5 </span><span class="cmss-10x-x-109">shows.</span></p>
<div class="minipage">
<p><img src="../media/file863.png" width="427" alt="PIC"/> <span id="x1-149005r5"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.5: This function is not invertible, as reversing the arrows doesn’t give a well-defined function</span> </span>
</div>
<p><span class="cmss-10x-x-109">To put the study of functions on top of solid theoretical foundations, we introduce the concept of </span><span class="cmssi-10x-x-109">injective</span><span class="cmss-10x-x-109">, </span><span class="cmssi-10x-x-109">surjective </span><span class="cmss-10x-x-109">and </span><span class="cmssi-10x-x-109">bijective </span><span class="cmss-10x-x-109">functions.</span></p>
<div class="newtheorem">
<p><span class="head"> <span id="x1-149006r37"></span> <span class="cmbx-10x-x-109">Definition 37.</span> </span><span class="cmbx-10x-x-109">(Surjective, injective, and bijective functions)</span></p>
<p>Let <span class="cmmi-10x-x-109">f </span>: <span class="cmmi-10x-x-109">X </span><span class="cmsy-10x-x-109">→</span><span class="cmmi-10x-x-109">Y </span>be an arbitrary function.</p>
<p><span class="cmti-10x-x-109">(a) </span><span class="cmmi-10x-x-109">f </span>is <span class="cmti-10x-x-109">injective </span>if for every <span class="cmmi-10x-x-109">y </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">Y </span>there is at most one <span class="cmmi-10x-x-109">x </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">X </span>such that <span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">y</span>. (We often say that an injective <span class="cmmi-10x-x-109">f </span>is a <span class="cmti-10x-x-109">one-to-one </span>function.)</p>
<p><span class="cmti-10x-x-109">(b) </span><span class="cmmi-10x-x-109">f </span>is <span class="cmti-10x-x-109">surjective </span>if for every <span class="cmmi-10x-x-109">y </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">Y </span>there is an <span class="cmmi-10x-x-109">x </span><span class="cmsy-10x-x-109">∈</span><span class="cmmi-10x-x-109">X </span>such that <span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">y</span>. (We often say that a surjective <span class="cmmi-10x-x-109">f </span>maps <span class="cmmi-10x-x-109">X </span><span class="cmti-10x-x-109">onto </span><span class="cmmi-10x-x-109">Y </span>.)</p>
<p><span class="cmti-10x-x-109">(c) </span><span class="cmmi-10x-x-109">f </span>is <span class="cmti-10x-x-109">bijective </span>if it is injective and surjective.</p>
</div>
<p><span class="cmss-10x-x-109">In</span> <span id="dx1-149007"></span><span class="cmss-10x-x-109">terms of arrows, injectivity means that every element of the image has at most one arrow pointing to it, while surjectivity is that every element indeed has at least one arrow. When both are satisfied, we have a bijective function, one that can be inverted properly. When the inverse </span><span class="cmmi-10x-x-109">f</span><sup><span class="cmsy-8">−</span><span class="cmr-8">1</span></sup> <span class="cmss-10x-x-109">exists, it is unique. Both </span><span class="cmmi-10x-x-109">f</span><sup><span class="cmsy-8">−</span><span class="cmr-8">1</span></sup> <span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">f</span><sup><span class="cmsy-8">−</span><span class="cmr-8">1</span></sup> <span class="cmss-10x-x-109">equal to the identity function in their respective domains.</span></p>
<p><span class="cmss-10x-x-109">Let’s see some concrete examples! For instance,</span></p>
<div class="math-display">
<img src="../media/file864.png" class="math-display" alt="f : ℝ → ℝ, f(x) = x2 "/>
</div>
<p><span class="cmss-10x-x-109">is not</span> <span id="dx1-149008"></span><span class="cmss-10x-x-109">injective nor surjective. (Ponder on this a bit if you don’t understand it right away. It helps if you draw a figure.)</span></p>
<div class="minipage">
<p><img src="../media/file865.png" width="427" alt="PIC"/> <span id="x1-149009r6"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.6: Injective, surjective, and bijective functions</span> </span>
</div>
<p><span class="cmss-10x-x-109">On the contrary,</span></p>
<div class="math-display">
<img src="../media/file866.png" class="math-display" alt=" 3 g : ℝ → ℝ, g(x) = x "/>
</div>
<p><span class="cmss-10x-x-109">is both, so it is bijective and invertible with inverse </span><span class="cmmi-10x-x-109">g</span><sup><span class="cmsy-8">−</span><span class="cmr-8">1</span></sup>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">1</span><span class="cmmi-8">∕</span><span class="cmr-8">3</span></sup><span class="cmss-10x-x-109">.</span></p>
<p><span class="cmss-10x-x-109">Invertible functions behave nicely, and from a certain perspective, they are much better to work with.</span></p>
</section>
<section id="operations-with-functions" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_128"><span class="titlemark"><span class="cmss-10x-x-109">9.1.3 </span></span> <span id="x1-15000011.1.3"></span><span class="cmss-10x-x-109">Operations with functions</span></h3>
<p><span class="cmss-10x-x-109">Functions, just like numbers, have operations defined on them. Two numbers can be multiplied and added together, but can you do the same with</span><span id="dx1-150001"></span> <span class="cmss-10x-x-109">functions? Without any difficulty, they can be added together and multiplied with a scalar as</span></p>
<div class="math-display">
<img src="../media/file867.png" class="math-display" alt="(f + g)(x) := f(x)+ g(x ), (cf)(x) := cf(x), "/>
</div>
<p><span class="cmss-10x-x-109">where </span><span class="cmmi-10x-x-109">c </span><span class="cmss-10x-x-109">is some scalar.</span></p>
<div class="minipage">
<p><img src="../media/file868.png" width="427" alt="PIC"/> <span id="x1-150002r7"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.7: Composing functions</span> </span>
</div>
<p><span class="cmss-10x-x-109">Another essential operation is </span><span class="cmssi-10x-x-109">composition</span><span class="cmss-10x-x-109">. Let’s consider the famous logistic regression for a minute! The estimator itself is defined by</span></p>
<div class="math-display">
<img src="../media/file869.png" class="math-display" alt="f(x) = σ(ax + b), "/>
</div>
<p><span class="cmss-10x-x-109">where</span></p>
<div class="math-display">
<img src="../media/file870.png" class="math-display" alt="σ(x) = ---1--- 1 + e−x "/>
</div>
<p><span class="cmss-10x-x-109">is the sigmoid function. The estimator </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) <span class="cmss-10x-x-109">is the </span><span class="cmssi-10x-x-109">composition </span><span class="cmss-10x-x-109">of two functions: </span><span class="cmmi-10x-x-109">l</span>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">ax </span>+ <span class="cmmi-10x-x-109">b </span><span class="cmss-10x-x-109">and the sigmoid function, so</span></p>
<div class="math-display">
<img src="../media/file871.png" class="math-display" alt="f(x) = σ(l(x)). "/>
</div>
<p><span class="cmss-10x-x-109">As </span><span class="cmmi-10x-x-109">σ </span><span class="cmss-10x-x-109">maps </span><span class="msbm-10x-x-109">ℝ </span><span class="cmss-10x-x-109">onto</span> [0<span class="cmmi-10x-x-109">,</span>1]<span class="cmss-10x-x-109">, we can think about </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) <span class="cmss-10x-x-109">as the probability that </span><span class="cmmi-10x-x-109">x </span><span class="cmss-10x-x-109">belongs to the positive class.</span></p>
<p><span class="cmssi-10x-x-109">Figure 9.7 </span><span class="cmss-10x-x-109">shows the points-and-arrows illustration of function composition.</span></p>
<p><span class="cmss-10x-x-109">To give one</span> <span id="dx1-150003"></span><span class="cmss-10x-x-109">more example, a neural network with several hidden layers is just the composition of a bunch of functions. The output of each layer is fed into the next one, which is exactly how composition is defined.</span></p>
<p><span class="cmss-10x-x-109">In general, if </span><span class="cmmi-10x-x-109">f </span>: <span class="cmmi-10x-x-109">Y </span><span class="cmsy-10x-x-109">→</span><span class="cmmi-10x-x-109">Z </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">g </span>: <span class="cmmi-10x-x-109">X </span><span class="cmsy-10x-x-109">→</span><span class="cmmi-10x-x-109">Y </span><span class="cmss-10x-x-109">are two functions, then their composition is formally defined by</span></p>
<div class="math-display">
<img src="../media/file872.png" class="math-display" alt="f ∘ g : X → Z, x ↦→ f (g(x )). "/>
</div>
<p><span class="cmss-10x-x-109">Note that in </span>(<span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">g</span>)(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">g</span>(<span class="cmmi-10x-x-109">x</span>))<span class="cmss-10x-x-109">, the function </span><span class="cmmi-10x-x-109">g </span><span class="cmss-10x-x-109">is applied first. The order of application is often a point of confusion, so keep this in mind.</span></p>
<div class="newtheorem">
<p><span class="head"> <span id="x1-150004r8"></span> <span class="cmbx-10x-x-109">Remark 8.</span> </span><span class="cmbx-10x-x-109">(Function addition as composition)</span></p>
<p>Given the functions</p>
<div class="math-display">
<img src="../media/file873.png" class="math-display" alt="f : X → ℝ, g : X → ℝ, "/>
</div>
<p>we can define their sum by</p>
<div class="math-display">
<img src="../media/file874.png" class="math-display" alt="(f + g)(x) := f(x)+ g(x ). "/>
</div>
<p>Believe it or not, this is yet another form of function composition. Why? Define the function add by</p>
<div class="math-display">
<img src="../media/file875.png" class="math-display" alt="add : X × X → ℝ, add(x1,x2) = x1 + x2. "/>
</div>
<p>Now we can write addition as</p>
<div class="math-display">
<img src="../media/file876.png" class="math-display" alt="(f + g )(x) = add(f(x),g(x)). "/>
</div>
</div>
<p><span class="cmss-10x-x-109">Composition is an </span><span class="cmssi-10x-x-109">extremely </span><span class="cmss-10x-x-109">powerful tool. In fact, so powerful that given a small</span> <span id="dx1-150005"></span><span class="cmss-10x-x-109">set of cleverly defined building blocks, “almost every function” can be obtained as the composition of these blocks. (I put “almost every function” in quotes because if we want to stay mathematically precise here, long detours are needed. To keep ourselves focused, let’s allow ourselves to be a little hand-wavy here.)</span></p>
</section>
<section id="mental-models-of-functions" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_129"><span class="titlemark"><span class="cmss-10x-x-109">9.1.4 </span></span> <span id="x1-15100011.1.4"></span><span class="cmss-10x-x-109">Mental models of functions</span></h3>
<p><span class="cmss-10x-x-109">So far, we have</span> <span id="dx1-151001"></span><span class="cmss-10x-x-109">seen that functions are defined as arrows drawn between elements of two sets. This, although being mathematically rigorous, does not give us useful mental models to reason about them. As you’ll surely see by the end of our journey, in mathematics, the key is often to find the right way to look at things.</span></p>
<p><span class="cmss-10x-x-109">Regarding functions, one of the most common and useful mental models is their </span><span class="cmssi-10x-x-109">graph</span><span class="cmss-10x-x-109">.</span></p>
<p><span class="cmss-10x-x-109">If </span><span class="cmmi-10x-x-109">f </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→</span><span class="msbm-10x-x-109">ℝ </span><span class="cmss-10x-x-109">is a function mapping a real number to a real number, we can </span><span class="cmssi-10x-x-109">visualize </span><span class="cmss-10x-x-109">it using its graph, defined by</span></p>
<div class="math-display">
<img src="../media/file877.png" class="math-display" alt="graph(f) := {(x,f(x)) : x ∈ ℝ }. "/>
</div>
<p><span class="cmss-10x-x-109">This set of points</span> <span id="dx1-151002"></span><span class="cmss-10x-x-109">can be drawn in the two-dimensional plane. For instance, in the case of the famous </span><span class="cmssi-10x-x-109">rectified linear unit </span><span class="cmss-10x-x-109">(ReLU)</span></p>
<div class="math-display">
<img src="../media/file878.png" class="math-display" alt=" ( |{ ReLU (x ) = 0 if x &lt;0 |( x if 0 ≤ x, "/>
</div>
<p><span class="cmss-10x-x-109">the graph looks like this.</span></p>
<div id="tcolobox-202" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>import numpy as np 
import matplotlib.pyplot as plt 
 
x = np.linspace(-10, 10, 400) 
relu = np.maximum(0, x) 
 
with plt.style.context("/span&gt;seaborn-v0_8-white: 
    plt.figure() 
    plt.plot(x, relu, label="/span&gt;ReLU(x) color="/span&gt;blue 
    plt.axhline(0, color=’black’, linewidth=0.8, linestyle="-" 
    plt.title("/span&gt;ReLU fontsize=14) 
    plt.xlabel("/span&gt;x fontsize=12) 
    plt.ylabel("/span&gt;ReLU(x) fontsize=12) 
    plt.grid(alpha=0.3) 
    plt.show()</code></pre>
</div>
</div>
<div class="minipage">
<p><img src="../media/file879.png" width="499" alt="PIC"/> <span id="x1-151018r8"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.8: Graph of the ReLU function</span> </span>
</div>
<p><span class="cmss-10x-x-109">Although identifying functions with their graphs can be useful, it is not generalizable</span> <span id="dx1-151019"></span><span class="cmss-10x-x-109">for more complex mappings. Visualizing it is challenging if the function’s domain and image are not the set of real numbers.</span></p>
<div class="minipage">
<p><img src="../media/file880.png" width="442" alt="PIC"/> <span id="x1-151020r9"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.9: Functions as a transformation of the space. Here, the vectors of the space are rotated around the origin</span> </span>
</div>
<p><span class="cmss-10x-x-109">When dealing with neural networks, probably the best way to think about functions (that is, layers in this context) is as </span><span class="cmssi-10x-x-109">transformations of the underlying feature space</span><span class="cmss-10x-x-109">. A simple example is a rotation in the two-dimensional Euclidean plane, as </span><span class="cmssi-10x-x-109">Figure 9.9 </span><span class="cmss-10x-x-109">shows.</span></p>
<div class="minipage">
<p><img src="../media/file881.png" width="456" alt="PIC"/> <span id="x1-151021r10"></span></p>
<span class="id"><span class="cmss-10x-x-109">Figure 9.10: Examplar applications of image transformations available in Albumenations</span> </span>
</div>
<p><span class="cmss-10x-x-109">Image transformations provide a set of more complex examples. You rarely think about image</span> <span id="dx1-151022"></span><span class="cmss-10x-x-109">blur as a transformation between spaces, but this is the case. After all, an image is just a huge vector in some vector space.</span></p>
<p><span class="cmss-10x-x-109">Image operations as transformations, as done by the Albumentations (</span> <a href="https://albumentations.ai/" class="url"><span class="cmtt-10x-x-109">https://albumentations.ai/</span></a><span class="cmss-10x-x-109">) library. Source of the image: Albumentations: Fast and Flexible Image Augmentations by Alexander Buslaev, Vladimir I. Iglovikov, Eugene Khvedchenya, Alex Parinov, Mikhail Druzhinin and Alexandr A. Kalinin (</span> <a href="https://www.mdpi.com/2078-2489/11/2/125" class="url"><span class="cmtt-10x-x-109">https://www.mdpi.com/2078-2489/11/2/125</span></a><span class="cmss-10x-x-109">).</span></p>
<p><span class="cmss-10x-x-109">In essence, a neural network is simply a stack of transformations, each taking its input</span> <span id="dx1-151023"></span><span class="cmss-10x-x-109">from the output of the previous one. As you’ll see, what makes them special is that the transformations are not hand-engineered but </span><span class="cmssi-10x-x-109">learned </span><span class="cmss-10x-x-109">from the data.</span></p>
</section>
</section>
<section id="functions-in-practice" class="level3 sectionHead">
<h2 class="sectionHead" id="sigil_toc_id_130"><span class="titlemark"><span class="cmss-10x-x-109">9.2 </span></span> <span id="x1-15200011.2"></span><span class="cmss-10x-x-109">Functions in practice</span></h2>
<p><span class="cmss-10x-x-109">In our study of</span> <span id="dx1-152001"></span><span class="cmss-10x-x-109">functions, we started from arrows between sets and ended up with mental models such as formulas and graphs. For pure mathematical purposes, these models are perfectly enough to conduct thorough investigations. However, once we leave the realm of theory and start putting things into practice, we must think about how functions are represented in programming languages.</span></p>
<p><span class="cmss-10x-x-109">In Python, functions are defined using a straightforward syntax. For instance, this is how the</span> square(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">2</span></sup> <span class="cmss-10x-x-109">function can be implemented.</span></p>
<div id="tcolobox-203" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>def square(x): 
    return x**2</code></pre>
</div>
</div>
<p><span class="cmss-10x-x-109">The result is an object of type </span><span class="cmtt-10x-x-109">function</span><span class="cmss-10x-x-109">. (In Python, everything is an object.)</span></p>
<div id="tcolobox-204" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>type(square)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>function</code></pre>
<p><span class="cmss-10x-x-109">Functions are called using the </span><span class="cmtt-10x-x-109">() </span><span class="cmss-10x-x-109">operator.</span></p>
<div id="tcolobox-205" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>square(12)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>144</code></pre>
<p><span class="cmss-10x-x-109">Python is well-known for its simplicity, and functions are no exception. However, this doesn’t mean that they are limited in features – quite the contrary: you can achieve a lot with the clever use of functions.</span></p>
<section id="operations-on-functions" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_131"><span class="titlemark"><span class="cmss-10x-x-109">9.2.1 </span></span> <span id="x1-15300011.2.1"></span><span class="cmss-10x-x-109">Operations on functions</span></h3>
<p><span class="cmss-10x-x-109">There are three operations that we want to do on functions: composition, addition, multiplication. The</span> <span id="dx1-153001"></span><span class="cmss-10x-x-109">easiest way is to call the functions themselves and fall back to the operations defined for the number types. To see an example, let’s implement the</span> cube(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">3</span></sup> <span class="cmss-10x-x-109">function and add/multiply/compose it with </span><span class="cmtt-10x-x-109">square</span><span class="cmss-10x-x-109">.</span></p>
<div id="tcolobox-206" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>def cube(x): 
    return x**3 
x = 2 
 
square(x) + cube(x)    # addition</code></pre>
</div>
</div>
<pre class="lstlisting"><code> 12</code></pre>
<div id="tcolobox-207" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>square(x)*cube(x)      # multiplication</code></pre>
</div>
</div>
<pre class="lstlisting"><code>32</code></pre>
<div id="tcolobox-208" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>square(cube(x))        # composition</code></pre>
</div>
</div>
<pre class="lstlisting"><code>64</code></pre>
<p><span class="cmss-10x-x-109">However, there is a major problem. If you take another look at the function operations, you can notice that they </span><span class="cmssi-10x-x-109">take </span><span class="cmss-10x-x-109">functions and </span><span class="cmssi-10x-x-109">return </span><span class="cmss-10x-x-109">functions. For instance, the composition is defined by</span></p>
<div class="math-display">
<img src="../media/file882.png" class="math-display" alt="compose : f,g ↦→ (x ↦→ f(g(x))) , ◟-----◝◜----◞ the composed function "/>
</div>
<p><span class="cmss-10x-x-109">with a function as a result. We did no such thing by simply passing the return value to the outer function. There is no </span><span class="cmtt-10x-x-109">function </span><span class="cmss-10x-x-109">object to represent the composition.</span></p>
<p><span class="cmss-10x-x-109">In Python, functions are first-class objects, meaning that we can pass them to other functions and return them from functions. (This is an absolutely fantastic feature, but if this is the first time you’ve encountered this, it might take some time to get used to.)</span></p>
<p><span class="cmss-10x-x-109">Thus, we can implement the</span> compose <span class="cmss-10x-x-109">function above by using the first-class function feature.</span></p>
<div id="tcolobox-209" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>def compose(f, g): 
 
    def composition(*args, **kwargs): 
        return f(g(*args, **kwargs)) 
 
    return composition 
square_cube_composition = compose(square, cube) 
 
square_cube_composition(2)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>64</code></pre>
<p><span class="cmss-10x-x-109">Addition and multiplication can be done just like this. (They are even</span><span id="dx1-153022"></span> <span class="cmss-10x-x-109">assigned as an exercise problem </span><span class="cmssi-10x-x-109">Section </span><a href="ch017.xhtml#problems8"><span class="cmssi-10x-x-109">9.4</span></a><span class="cmss-10x-x-109">.)</span></p>
</section>
<section id="functions-as-callable-objects" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_132"><span class="titlemark"><span class="cmss-10x-x-109">9.2.2 </span></span> <span id="x1-15400011.2.2"></span><span class="cmss-10x-x-109">Functions as callable objects</span></h3>
<p><span class="cmss-10x-x-109">The standard</span> <span id="dx1-154001"></span><span class="cmss-10x-x-109">way of doing function definitions is not a good fit for an application that is essential for us: parametrized functions. Think about the case of linear functions of the form </span><span class="cmmi-10x-x-109">ax </span>+ <span class="cmmi-10x-x-109">b</span><span class="cmss-10x-x-109">, where </span><span class="cmmi-10x-x-109">a </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">b </span><span class="cmss-10x-x-109">are parameters. On the first try, we can do something like this.</span></p>
<pre class="lstinputlisting"><code>def linear(x, a, b):
    return a*x + b</code></pre>
<p><span class="cmss-10x-x-109">Passing the parameters as arguments seems to work, but there are serious underlying issues. For instance, functions can have a lot of parameters. Even if we compact parameters into multidimensional arrays, we might need to deal with dozens of such arrays. Passing them around manually is error-prone, and we usually have to work with multiple functions. For example, neural networks are composed of several layers. Each layer is a parameterized function, and their composition yields a predictive model.</span></p>
<p><span class="cmss-10x-x-109">We can solve this issue by applying the classical object-oriented principle of </span><span class="cmssi-10x-x-109">encapsulation</span><span class="cmss-10x-x-109">, implementing functions as callable objects. In Python, we can do this by implementing the magic </span><span class="cmtt-10x-x-109">__call__ </span><span class="cmss-10x-x-109">method for the class.</span></p>
<div id="tcolobox-210" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>class Linear: 
    def __init__(self, a, b): 
        self.a = a 
        self.b = b 
 
    def __call__(self, x): 
        return self.a*x + self.b 
f = Linear(2, -1) # this represents the function f(x) = 2*x - 1 
f(2.1)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>3.2</code></pre>
<p><span class="cmss-10x-x-109">This way, we can store, access, and</span> <span id="dx1-154014"></span><span class="cmss-10x-x-109">modify the parameters using attributes.</span></p>
<pre class="lstinputlisting"><code>f.a, f.b</code></pre>
<pre class="lstlisting"><code>(2, -1)</code></pre>
<p><span class="cmss-10x-x-109">Since there can be a lot of parameters, we should implement a method that collects them together in a dictionary.</span></p>
<div id="tcolobox-211" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>class Linear: 
    def __init__(self, a, b): 
        self.a = a 
        self.b = b 
 
    def __call__(self, x): 
        return self.a*x + self.b 
 
    def parameters(self): 
        return {"/span&gt;a self.a, /span&gt;b self.b}</code></pre>
</div>
</div>
<div id="tcolobox-212" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>f = Linear(2, -1) 
f.parameters()</code></pre>
</div>
</div>
<pre class="lstlisting"><code>{’a’: 2, ’b’: -1}</code></pre>
<p><span class="cmss-10x-x-109">Interactivity is one of the most useful features of Python. In practice, we frequently find ourselves working in the REPL, inspecting objects and calling functions by hand. We often add a concise string representation for our classes for these situations.</span></p>
<p><span class="cmss-10x-x-109">By default, printing a </span><span class="cmtt-10x-x-109">Linear </span><span class="cmss-10x-x-109">instance results in a cryptic message.</span></p>
<div id="tcolobox-213" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>f</code></pre>
</div>
</div>
<pre class="lstlisting"><code>/span&gt;__main__.Linear at 0x7c9fbef31190/span&gt;</code></pre>
<p><span class="cmss-10x-x-109">This is not very useful. Besides the class name and its location in the memory, we haven’t received any information. We can change this by implementing the </span><span class="cmtt-10x-x-109">__repr__ </span><span class="cmss-10x-x-109">method responsible for returning</span><span id="dx1-154032"></span> <span class="cmss-10x-x-109">the string representation for our object.</span></p>
<div id="tcolobox-214" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>class Linear: 
    def __init__(self, a, b): 
        self.a = a 
        self.b = b 
 
    def __call__(self, x): 
        return self.a*x + self.b 
 
    def __repr__(self): 
        return f/span&gt;Linear(a={self.a}, b={self.b})/span&gt; 
 
    def parameters(self): 
        return {"/span&gt;a self.a, /span&gt;b self.b} 
f = Linear(2, -1) 
f</code></pre>
</div>
</div>
<pre class="lstlisting"><code>Linear(a=2, b=-1)</code></pre>
<p><span class="cmss-10x-x-109">This looks much better! Adding a pretty string representation seems like a small thing, but this can go a long way when doing machine learning engineering in the trenches.</span></p>
</section>
<section id="function-base-class" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_133"><span class="titlemark"><span class="cmss-10x-x-109">9.2.3 </span></span> <span id="x1-15500011.2.3"></span><span class="cmss-10x-x-109">Function base class</span></h3>
<p><span class="cmss-10x-x-109">The </span><span class="cmtt-10x-x-109">Linear </span><span class="cmss-10x-x-109">class that we have just seen is only the tip of the</span><span id="dx1-155001"></span> <span class="cmss-10x-x-109">iceberg. There are hundreds of function families that are used in machine learning. We’ll implement many of them eventually, and to keep the interfaces consistent, we are going to add a base class from which all others will be inherited.</span></p>
<div id="tcolobox-215" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>class Function: 
    def __init__(self): 
        pass 
 
    def __call__(self, *args, **kwargs): 
        pass 
 
    def parameters(self): 
        return dict()</code></pre>
</div>
</div>
<p><span class="cmss-10x-x-109">With this, we can</span> <span id="dx1-155011"></span><span class="cmss-10x-x-109">implement functions and function families in the following way.</span></p>
<div id="tcolobox-216" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>import numpy as np 
 
 
class Sigmoid(Function):            # the parent class is explicitly declared 
    def __call__(self, x): 
        return 1/(1 + np.exp(-x)) 
 
sigmoid = Sigmoid() 
sigmoid(2)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>np.float64(0.8807970779778823)</code></pre>
<p><span class="cmss-10x-x-109">Even though we haven’t implemented the </span><span class="cmtt-10x-x-109">parameters </span><span class="cmss-10x-x-109">method for</span><span id="dx1-155022"></span> <span class="cmss-10x-x-109">the </span><span class="cmtt-10x-x-109">Sigmoid </span><span class="cmss-10x-x-109">class, it is inherited from the base class.</span></p>
<div id="tcolobox-217" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>sigmoid.parameters()</code></pre>
</div>
</div>
<pre class="lstlisting"><code>{}</code></pre>
<p><span class="cmss-10x-x-109">For now, let’s keep the base class as simple as possible. During the course of this book, we’ll progressively enhance the </span><span class="cmtt-10x-x-109">Function </span><span class="cmss-10x-x-109">base class to cover all the methods a neural network and its layers need. (For instance, gradients.)</span></p>
</section>
<section id="composition-in-the-objectoriented-way" class="level4 subsectionHead">
<h3 class="subsectionHead" id="sigil_toc_id_134"><span class="titlemark"><span class="cmss-10x-x-109">9.2.4 </span></span> <span id="x1-15600011.2.4"></span><span class="cmss-10x-x-109">Composition in the object-oriented way</span></h3>
<p><span class="cmss-10x-x-109">Recall how we did function composition (in </span><span class="cmssi-10x-x-109">Section </span><a href="ch017.xhtml#operations-on-functions"><span class="cmssi-10x-x-109">9.2.1</span></a><span class="cmss-10x-x-109">) when working</span> <span id="dx1-156001"></span><span class="cmss-10x-x-109">with plain Python functions? Syntactically, that can work with our </span><span class="cmtt-10x-x-109">Function </span><span class="cmss-10x-x-109">class as well, although there is a huge issue: the return value is not a </span><span class="cmtt-10x-x-109">Function </span><span class="cmss-10x-x-109">type.</span></p>
<pre class="lstinputlisting"><code>composed = compose(Linear(2, -1), Sigmoid())
composed(2)</code></pre>
<pre class="lstlisting"><code>np.float64(0.7615941559557646)</code></pre>
<div id="tcolobox-218" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>isinstance(composed, Function)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>False</code></pre>
<p><span class="cmss-10x-x-109">This kind of</span> <span id="dx1-156007"></span><span class="cmss-10x-x-109">composition doesn’t inherit the interface we need.</span></p>
<div id="tcolobox-219" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>composed.parameters()</code></pre>
</div>
</div>
<pre class="lstlisting"><code>--------------------------------------------------------------------------- 
AttributeError                          Traceback (most recent call last) 
Cell In[33], line 1 
----&gt;/span&gt; 1 composed.parameters() 
 
AttributeError: ’function’ object has no attribute ’parameters’</code></pre>
<p><span class="cmss-10x-x-109">To fix the issue, we implement function composition as a child of the </span><span class="cmtt-10x-x-109">Function </span><span class="cmss-10x-x-109">base class. Recall that composition is a </span><span class="cmssi-10x-x-109">function</span><span class="cmss-10x-x-109">, taking two functions as input and returning one:</span></p>
<div class="math-display">
<img src="../media/file889.png" class="math-display" alt="compose : f, g ↦→ (◟x-↦→-f◝(g◜-(x-)))◞ . the composed function "/>
</div>
<p><span class="cmss-10x-x-109">Keeping this in mind, this is how we can do composition.</span></p>
<div id="tcolobox-220" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>class Composition(Function): 
    def __init__(self, *functions): 
        self.functions = functions 
 
    def __call__(self, x): 
 
        for f in reversed(self.functions): 
            x = f(x) 
 
        return x</code></pre>
</div>
</div>
<p><span class="cmss-10x-x-109">(Note that due to how composition is defined, we iterate through the list of functions in the reverse order. That’s because </span>(<span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">g</span>)(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">g</span>(<span class="cmmi-10x-x-109">x</span>))<span class="cmss-10x-x-109">, we apply </span><span class="cmmi-10x-x-109">g </span><span class="cmss-10x-x-109">first.)</span></p>
<div id="tcolobox-221" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>composed = Composition(Linear(2, -1), Sigmoid()) 
composed(2)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>np.float64(0.7615941559557646)</code></pre>
<p><span class="cmss-10x-x-109">This way, we</span> <span id="dx1-156028"></span><span class="cmss-10x-x-109">get to keep the </span><span class="cmtt-10x-x-109">Function </span><span class="cmss-10x-x-109">interface.</span></p>
<div id="tcolobox-222" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>composed.parameters()</code></pre>
</div>
</div>
<pre class="lstlisting"><code>{}</code></pre>
<div id="tcolobox-223" class="tcolorbox">
<div class="tcolorbox-title">

</div>
<div class="tcolorbox-contnt">
<pre class="lstinputlisting"><code>isinstance(composed, Function)</code></pre>
</div>
</div>
<pre class="lstlisting"><code>True</code></pre>
</section>
</section>
<section id="summary8" class="level3 sectionHead">
<h2 class="sectionHead" id="sigil_toc_id_135"><span class="titlemark"><span class="cmss-10x-x-109">9.3 </span></span> <span id="x1-15700011.3"></span><span class="cmss-10x-x-109">Summary</span></h2>
<p><span class="cmss-10x-x-109">Now that we’ve learned what functions really are, I bet your world is a bit shaken. Functions as graphs drawn with continuous lines, sure. Maybe even expressions like </span><span class="cmmi-10x-x-109">f</span>(<span class="cmmi-10x-x-109">x</span>) = <span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">2</span></sup> + 1<span class="cmss-10x-x-109">. But functions as dots and arrows?</span></p>
<p><span class="cmss-10x-x-109">Surprisingly, the dot-and-arrow representation is the closest to the true definition. Graphs and expressions come after that. This is what we’ve learned in this chapter, and by now, I feel like a magician. I’ve shown you mathematical objects and revealed that, deep inside, they are not what you think. We did this with vectors, matrices, and now, with functions.</span></p>
<p><span class="cmss-10x-x-109">Along with the </span><span class="cmssi-10x-x-109">“what’s behind the curtain?” </span><span class="cmss-10x-x-109">tricks, putting theory into practice also became an established pattern for us. So, we’ve used object-oriented Python to get a taste of what a function is like.</span></p>
<p><span class="cmss-10x-x-109">Next, we’ll turn our lenses to an even higher level of magnification. For us, the most important functions map numbers to numbers. But what’s a number? Even in programming languages, we have several different number types, like </span><span class="cmtt-10x-x-109">int</span><span class="cmss-10x-x-109">-s, </span><span class="cmtt-10x-x-109">float</span><span class="cmss-10x-x-109">-s, </span><span class="cmtt-10x-x-109">double</span><span class="cmss-10x-x-109">-s, and so on. These are deeply rooted in math, and familiarity with the structure of numbers is a must for every developer and engineer.</span></p>
<p><span class="cmss-10x-x-109">See you in the next chapter!</span></p>
</section>
<section id="problems8" class="level3 sectionHead">
<h2 class="sectionHead" id="sigil_toc_id_136"><span class="titlemark"><span class="cmss-10x-x-109">9.4 </span></span> <span id="x1-15800011.4"></span><span class="cmss-10x-x-109">Problems</span></h2>
<p><span class="cmssbx-10x-x-109">Problem 1. </span><span class="cmss-10x-x-109">Which of these functions are injective, surjective, or bijective? Find the inverse of bijective functions.</span></p>
<p><span class="cmssi-10x-x-109">(a) </span><span class="cmmi-10x-x-109">f </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→ </span>(0<span class="cmmi-10x-x-109">,</span><span class="cmsy-10x-x-109">∞</span>)<span class="cmss-10x-x-109">, </span><span class="cmmi-10x-x-109">x</span>→<span class="cmmi-10x-x-109">e</span><sup><span class="cmmi-8">x</span></sup> <span class="cmssi-10x-x-109">(b) </span><span class="cmmi-10x-x-109">g </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→ </span>[0<span class="cmmi-10x-x-109">,</span><span class="cmsy-10x-x-109">∞</span>)<span class="cmss-10x-x-109">, </span><span class="cmmi-10x-x-109">x</span>→<span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">2</span></sup> <span class="cmssi-10x-x-109">(c) </span><span class="cmmi-10x-x-109">h </span>: [0<span class="cmmi-10x-x-109">,</span><span class="cmsy-10x-x-109">∞</span>) <span class="cmsy-10x-x-109">→ </span>[0<span class="cmmi-10x-x-109">,</span><span class="cmsy-10x-x-109">∞</span>)<span class="cmss-10x-x-109">, </span><span class="cmmi-10x-x-109">x</span>→<span class="cmmi-10x-x-109">x</span><sup><span class="cmr-8">2</span></sup> <span class="cmssi-10x-x-109">(d)</span> sin : <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→ </span>[0<span class="cmmi-10x-x-109">,</span>1]<span class="cmss-10x-x-109">, </span><span class="cmmi-10x-x-109">x</span>→sin(<span class="cmmi-10x-x-109">x</span>) <span class="cmssi-10x-x-109">(e)</span> tan : <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→</span><span class="msbm-10x-x-109">ℝ</span><span class="cmss-10x-x-109">, </span><span class="cmmi-10x-x-109">x</span>→tan(<span class="cmmi-10x-x-109">x</span>)<span class="cmss-10x-x-109">,</span></p>
<p><span class="cmssbx-10x-x-109">Problem 2. </span><span class="cmss-10x-x-109">Find a function </span><span class="cmmi-10x-x-109">f </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→</span><span class="msbm-10x-x-109">ℝ </span><span class="cmss-10x-x-109">such that </span>(<span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">f</span>)(<span class="cmmi-10x-x-109">x</span>) = <span class="cmsy-10x-x-109">−</span><span class="cmmi-10x-x-109">x</span><span class="cmss-10x-x-109">.</span></p>
<p><span class="cmssbx-10x-x-109">Problem 3. </span><span class="cmss-10x-x-109">Can any real function </span><span class="cmmi-10x-x-109">g </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→</span><span class="msbm-10x-x-109">ℝ </span><span class="cmss-10x-x-109">be obtained as </span><span class="cmmi-10x-x-109">g </span>= <span class="cmmi-10x-x-109">f </span><span class="cmsy-10x-x-109">∘</span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">for some </span><span class="cmmi-10x-x-109">f </span>: <span class="msbm-10x-x-109">ℝ </span><span class="cmsy-10x-x-109">→</span><span class="msbm-10x-x-109">ℝ</span><span class="cmss-10x-x-109">?</span></p>
<p><span class="cmssbx-10x-x-109">Problem 4. </span><span class="cmss-10x-x-109">Following the example of the composition </span><span class="cmssi-10x-x-109">Section </span><a href="ch017.xhtml#operations-on-functions"><span class="cmssi-10x-x-109">9.2.1</span></a><span class="cmss-10x-x-109">, implement</span></p>
<ul>
<li><span class="cmss-10x-x-109">the </span><span class="cmtt-10x-x-109">add </span><span class="cmss-10x-x-109">function, taking </span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">g</span><span class="cmss-10x-x-109">, returning </span><span class="cmmi-10x-x-109">f </span>+ <span class="cmmi-10x-x-109">g</span><span class="cmss-10x-x-109">,</span></li>
<li><span class="cmss-10x-x-109">the </span><span class="cmtt-10x-x-109">mul </span><span class="cmss-10x-x-109">function, taking </span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">g</span><span class="cmss-10x-x-109">, returning </span><span class="cmmi-10x-x-109">fg</span><span class="cmss-10x-x-109">,</span></li>
<li><span class="cmss-10x-x-109">and the </span><span class="cmtt-10x-x-109">div </span><span class="cmss-10x-x-109">function, taking </span><span class="cmmi-10x-x-109">f </span><span class="cmss-10x-x-109">and </span><span class="cmmi-10x-x-109">g</span><span class="cmss-10x-x-109">, returning </span><span class="cmmi-10x-x-109">f∕g</span><span class="cmss-10x-x-109">.</span></li>
</ul>
</section>
<section id="join-our-community-on-discord9" class="level3 likesectionHead">
<h2 class="likesectionHead sigil_not_in_toc" id="sigil_toc_id_137"><span id="x1-159000"></span><span class="cmss-10x-x-109">Join our community on Discord</span></h2>
<p><span class="cmss-10x-x-109">Read this book alongside other users, Machine Learning experts, and the author himself. Ask questions, provide solutions to other readers, chat with the author via Ask Me Anything sessions, and much more. Scan the QR code or visit the link to join the community.</span> <a href="https://packt.link/math" class="url"><span class="cmtt-10x-x-109">https://packt.link/math</span></a></p>
<p><img src="../media/file1.png" width="85" alt="PIC"/></p>
</section>
</section>
</body>
</html>