<html><head></head><body>
<section epub:type="chapter">&#13;
<section id="ch07lvl1sec37">&#13;
<div class="epub-source">&#13;
<h1 class="chapterTitle">Practicing Level of Detail Calculations</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">When we talk about <strong class="keyWord">Level of Detail</strong> (<strong class="keyWord">LOD</strong>) calculations in Tableau, we mean three expressions: <code class="inlineCode">FIXED</code>, <code class="inlineCode">INCLUDE</code>, and <code class="inlineCode">EXCLUDE</code>. These three expressions open up a world of options by providing the <a/>ability to create calculations that target specific levels of granularity. In older versions of Tableau, data granularity for a worksheet was established by the dimensions in a view. If the view contained dimensions for, for example, <strong class="keyWord">Region</strong>, <strong class="keyWord">State</strong>, and <strong class="keyWord">Postal Code</strong>, but the author wanted to create a <strong class="keyWord">City</strong>-level calculation, the <strong class="keyWord">City</strong> dimension would need to be included on the view. Furthermore, there was no mechanism for excluding or ignoring a given <strong class="keyWord">dimension</strong> on a view. Admittedly, the desired results could normally be obtained through some complex and sometimes convoluted use of table calculations, data blends, and so on. Fortunately, LODs greatly simplify these use case scenarios and, in some cases, enable what was previously impossible.</p>&#13;
    <p class="normal">In this chapter, we will discuss the following topics:</p>&#13;
    <ul><li class="bulletList">Introducing LODs</li>&#13;
      <li class="bulletList"><code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code></li>&#13;
      <li class="bulletList"><code class="inlineCode">INCLUDE</code></li>&#13;
      <li class="bulletList">Building practical applications with LODs</li>&#13;
    </ul><p class="normal">The early sections of this chapter are more theory-based, but don’t worry – you’ll get to explore these concepts in a practical way in the <em class="italic">Building practical applications with LODs</em> section. Let’s begin by introducing LODs and how they are used.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch07lvl1sec38">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Introducing LODs</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Tableau’s default is to show measures in a view based on the dimensions also present in the view. If you have a dashboard with <code class="inlineCode">Sales</code> data and dimensions like <code class="inlineCode">State</code> and <code class="inlineCode">City</code>, and you drag the <code class="inlineCode">State</code> and <code class="inlineCode">Sales</code> data onto the view, the <code class="inlineCode">Sales</code> data will be divided by <code class="inlineCode">State</code>, showing you <code class="inlineCode">Sales</code> per <code class="inlineCode">State</code>. If you want to divide the <code class="inlineCode">Sales</code> data further into smaller chunks, you <a/>might add the <code class="inlineCode">City</code> field, resulting in <code class="inlineCode">Sales</code> data per <code class="inlineCode">City</code>, per <code class="inlineCode">State</code>. LODs can manipulate this default behavior. </p>&#13;
    <p class="normal">After completing this chapter, you will be able to divide or partition measures by dimensions that are not in the view and show measures using fewer dimensions than are visible in the view.</p>&#13;
    <p class="normal">To do this, we will build and use two <strong class="keyWord">playgrounds</strong>. Delivering reports as required by one’s job duties may lead to a thorough knowledge of a limited set of capabilities; that is, a deep but narrow understanding. It can be difficult to set aside time (and justify that time) to explore the capabilities of Tableau that, on the surface, may seem to have no direct correlation to job duties. Playground environments can help overcome any difficulties and objections by providing efficient avenues of exploration. In this chapter, we’ll build two playground environments specifically for LODs, to help make the task of deep and broad understanding easier by providing an efficient avenue for exploration and understanding. You can always come back to the workbook accompanying this chapter and test functionality related to LODs.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch07lvl1sec39">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">FIXED and EXCLUDE</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">The first playground we will build will be for the purpose of exploring two of the three LOD functions: <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code>. We will use a set of parameters and associated calculated fields to efficiently explore how these functions work.</p>&#13;
    <h2 class="heading-2">Setting up the workbook</h2>&#13;
    <p class="normal">Much of the groundwork for this exercise has already been completed in the workbook associated with <a/>this chapter. The following steps will simply require you to open different calculations and parameters to see how they have been set up and why this works. Explanations are given along the way. If you do not have ready access to the workbook, you should be able to construct a similar one by referencing the following steps.</p>&#13;
    <p class="normal">To complete the initial setup of a worksheet, take the following steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to <a href="https://public.tableau.com/profile/marleen.meier" target="_blank"><span class="url">https://public.tableau.com/profile/marleen.meier</span></a> to locate and download the workbook associated with this chapter.</li>&#13;
      <li class="numberedList">Open the workbook <a/>associated with this chapter and navigate to the <code class="inlineCode">Fixed and Exclude</code> worksheet. The worksheet should look as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_01.png" alt=""/></figure><p class="packt_figref">Figure 7.1: The worksheet</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Select the <code class="inlineCode">Superstore</code> data source and inspect the parameter named <strong class="screenText">1st Dim</strong> by right-clicking and selecting <strong class="screenText">Edit</strong>:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_02.png" alt=""/></figure><p class="packt_figref">Figure 7.2: Parameter I</p>&#13;
    <p class="normal">The parameters named <strong class="keyWord">2nd Dim</strong>, <strong class="keyWord">3rd Dim</strong>, and <strong class="keyWord">4th Dim </strong>are identical to <strong class="keyWord">1st Dim</strong>.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Note that except for <strong class="keyWord">Order Date</strong> and <strong class="keyWord">Ship Date</strong>, every dimension in the dataset is included in the list of values (see <em class="italic">Figure 7.2</em>). For the purposes of this exercise, <strong class="keyWord">Category</strong>, <strong class="keyWord">Region</strong>, <strong class="keyWord">Segment</strong>, <strong class="keyWord">Ship Mode</strong>, and <strong class="keyWord">Sub-Category</strong> are particularly important <a/>because these are dimensions with fewer members. Dimensions with many members are more difficult to use in this context.</li>&#13;
      <li class="numberedList">Inspect the <strong class="keyWord">Choose Fixed Dims</strong>, <strong class="keyWord">Choose Excluded Dims 1</strong>, and <strong class="keyWord">Choose Excluded Dims 2</strong> parameters included in the workbook and note that we defined several integers under the <strong class="keyWord">Value</strong> column, each of which will later be visible as a string specified under the <strong class="keyWord">Displays As </strong>column in the parameter dropdown. The <strong class="keyWord">Value </strong>and <strong class="keyWord">Display As</strong> configurations for <strong class="screenText">Choose Fixed Dims</strong> are as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_03.png" alt=""/></figure><p class="packt_figref">Figure 7.3: Parameter II</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Inspect the calculated field named <strong class="screenText">1st Dim</strong> (it is located under the <strong class="screenText">Practical: All</strong> folder in the <strong class="screenText">Data</strong> pane); this calculation makes use of the <code class="inlineCode">1st Dim</code> parameter and will <a/>cause a field to be displayed depending on the selection of the parameter. If the user selects <strong class="screenText">Category</strong> in the <strong class="screenText">1st Dim</strong> parameter<strong class="keyWord">, </strong>value <code class="inlineCode">1</code> will be activated (according to the values specified in<strong class="keyWord"> </strong><em class="italic">Figure 7.2</em>). Value <code class="inlineCode">1</code> then translates to the <strong class="screenText">Category </strong>field in the calculated <strong class="screenText">1st Dim</strong> field, as shown in the following screenshot:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_04.png" alt=""/></figure><p class="packt_figref">Figure 7.4: Calculated 1st Dim field</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">The calculated fields named <strong class="keyWord">2nd Dim</strong>, <strong class="keyWord">3rd Dim</strong>, and <strong class="keyWord">4th Dim</strong> are identical to <strong class="keyWord">1st Dim</strong> except that each references the parameter bearing its name; for example, the <strong class="keyWord">2nd Dim</strong> calculated field utilizes <code class="inlineCode">[Parameters].[2nd Dim]</code>.&#13;
    <p class="normal">These <code class="inlineCode">Case</code> statements, in <a/>conjunction with the associated parameters, will allow you to choose which dimensions to view from a dropdown in the view as described in <em class="italic">step 5</em>.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Inspect the following calculated fields, which enable you to choose which LODs to employ and thus to compare and contrast differences and similarities:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_05.png" alt=""/></figure><p class="packt_figref">Figure 7.5: Case Fixed</p>&#13;
    <p class="normal">The <strong class="keyWord">Case Fixed</strong> calculation shows that if the user selects <code class="inlineCode">1</code> in the <strong class="keyWord">Choose Fixed Dims</strong> parameter (which is being displayed as <strong class="keyWord">1st</strong>), <strong class="keyWord">1st Dim</strong> will be fixed—no matter <a/>what the dashboard setup. That means that <strong class="keyWord">SUM(Sales)</strong> will be partitioned over <strong class="keyWord">1st Dim</strong>, no matter if it is part of the dashboard:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_06.png" alt=""/></figure><p class="packt_figref">Figure 7.6: Case Exclude 1</p>&#13;
    <p class="normal">The <strong class="keyWord">Case</strong> <strong class="keyWord">Exclude 1</strong> calculation shows that if the user selects <code class="inlineCode">1</code> in the <strong class="keyWord">Choose Excluded Dims 1 </strong>parameter (which will be displayed as <strong class="keyWord">1st</strong>), <strong class="keyWord">1st Dim</strong> will be excluded from the calculation in the view. </p>&#13;
    <p class="normal">That means that <strong class="keyWord">SUM(Sales) </strong>won’t be partitioned over <strong class="keyWord">1st Dim</strong>, even if it is part of the view:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_07.png" alt=""/></figure><p class="packt_figref">Figure 7.7: Case Exclude 2</p>&#13;
    <p class="normal">The <strong class="keyWord">Case</strong> <strong class="keyWord">Exclude 2</strong> calculation shows that if the user selects <code class="inlineCode">1</code> in the <strong class="keyWord">Choose Excluded Dims 2</strong> parameter (which will be displayed as <strong class="keyWord">1st</strong>), <strong class="keyWord">1st Dim</strong> will be excluded from the calculation in the view. That means that <strong class="keyWord">SUM(Sales)</strong> won’t be partitioned over <strong class="keyWord">1st Dim</strong>, even if it is part of the view.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="9">Now, right-click and open the context filter on <strong class="screenText">Product Name</strong> for inspection. In the resulting dialog box, click the <strong class="screenText">Wildcard</strong> tab and note the settings, as shown in the <a/>following screenshot. The filter has been set to show only product names that start with <code class="inlineCode">S</code> (<strong class="screenText">Match value</strong> is not case-sensitive.):</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_08.png" alt=""/></figure><p class="packt_figref">Figure 7.8: Wildcard filter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">After clicking <strong class="keyWord">OK</strong>, right-click on the filter and click <strong class="screenText">Add to Context</strong>. Note that context filters are denoted in gray:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_09.png" alt=""/></figure><p class="packt_figref">Figure 7.9: Gray context filter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="11">Place the following dimensions on the <strong class="screenText">Rows</strong> shelf: <strong class="screenText">1st Dim</strong>, <strong class="screenText">2nd Dim</strong>, <strong class="screenText">3rd Dim</strong>, and <strong class="screenText">4th Dim</strong>.</li>&#13;
      <li class="numberedList">Drag <strong class="screenText">Measure Names</strong> onto <a/>the <strong class="screenText">Filters</strong> shelf and select <strong class="screenText">Sales</strong>, <strong class="screenText">Case Fixed</strong>, <strong class="screenText">Case Exclude 1</strong>, and <strong class="screenText">Case Exclude 2</strong>.</li>&#13;
      <li class="numberedList">Add <strong class="screenText">Measure Values</strong> to <strong class="screenText">Text</strong> and <strong class="screenText">Measure Names</strong> to <strong class="screenText">Columns</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_10.png" alt=""/></figure><p class="packt_figref">Figure 7.10: Measure Values</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="14">Display every parameter by right-clicking each one and selecting <strong class="keyWord">Show Parameter Control</strong>. Order the parameter controls as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_11.png" alt=""/></figure><p class="packt_figref">Figure 7.11: Final playground</p>&#13;
    <p class="normal">By following the previous <a/>steps, we are now ready to build various tables to compare the different LODs because the parameters will allow us to select different dimensions and the calculated fields that incorporate the <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> functions from Tableau. We will now continue using the playground and explain how LODs change calculated fields.</p>&#13;
    <h2 class="heading-2">Understanding FIXED</h2>&#13;
    <p class="normal">Now that the playground environment is complete, let’s build scenarios to better understand the <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> functions. We’ll begin with <code class="inlineCode">FIXED</code>. The <code class="inlineCode">FIXED</code> LOD considers only the <a/>dimensions to which it is directed. Thus, when fixed on a dimension, all other (if any) dimensions in the view are ignored. When the <code class="inlineCode">FIXED</code> LOD is used without defining any dimension, the result will be a calculation ignoring all (if any) dimensions in the view. </p>&#13;
    <p class="normal">Let’s jump into the exercise and see this for ourselves:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Using the worksheet described previously, set the parameters as shown here:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_12.png" alt=""/></figure><p class="packt_figref">Figure 7.12: First example</p>&#13;
    <p class="normal">What we achieve <a/>with the different parameters is that we show the <strong class="keyWord">SUM(Sales)</strong> per <strong class="keyWord">Region</strong> and each <strong class="keyWord">Region</strong> per <strong class="keyWord">Category</strong>, but we also fixed the <strong class="keyWord">SUM(Sales) </strong>calculation for the <strong class="keyWord">Category</strong> dimension in the <strong class="keyWord">Case Fixed</strong> column.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">The <strong class="screenText">Case Fixed</strong> column now displays the totals for each <strong class="screenText">Category</strong> and ignores <strong class="screenText">Region</strong> because we told the calculation to fix the <strong class="keyWord">2nd Dim</strong> (<strong class="keyWord">Region</strong>) and ignore the dimensions in the view itself. &#13;
    <p class="numberedList">The effect of this is visible by comparing the <strong class="screenText">Sales</strong> column and the <strong class="screenText">Case Fixed</strong> column:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_13.png" alt=""/></figure><p class="packt_figref">Figure 7.13: Case Fixed I</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Check for yourself and do the math for <strong class="keyWord">Furniture</strong>:&#13;
    <p class="center">10,072 + 14,249 + 4,494 + 18,564 = 47,379.</p>&#13;
    <p class="normal">Even though the <strong class="keyWord">Region</strong> is visible in the view, the <strong class="keyWord">SUM(Sales)</strong> in the <strong class="keyWord">Case Fixed</strong> column ignores the <strong class="keyWord">Region</strong> and shows the results as if the <strong class="keyWord">Category</strong> dimension is the <a/>only dimension in the view. We manipulated the granularity of the data. In the <strong class="keyWord">Case Fixed</strong> column, <strong class="keyWord">Region</strong> is there for informative purposes only but does not affect the calculation of <strong class="keyWord">SUM(Sales)</strong>.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Now change the <strong class="keyWord">Choose Fixed Dims</strong> parameter to <strong class="keyWord">1st</strong> and note that <strong class="screenText">Case Fixed</strong> now displays the totals for each <strong class="screenText">Region</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_14.png" alt=""/></figure><p class="packt_figref">Figure 7.14: Case Fixed II</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">This time, we fix the <a/>calculation in the <strong class="screenText">Case Fixed</strong> column to only take the <strong class="screenText">Region</strong> into account but ignore the <strong class="screenText">Category</strong>. Check for yourself and do the math for <strong class="screenText">Central</strong>: 10,072 + 16,340 + 13,995 = 40,406.&#13;
    <p class="normal">Change the <strong class="keyWord">Choose Fixed Dims</strong> parameter to <strong class="keyWord">Fixed: Nothing</strong> and note that the amount reflects the total <strong class="keyWord">SUM(Sales)</strong>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_15.png" alt=""/></figure><p class="packt_figref">Figure 7.15: Fixed: Nothing</p></li>&#13;
    </ol><p class="normal">This time, we fixed the calculation to nothing, meaning that we ignore every dimension in the view. Check for yourself and do the math by summing the <strong class="keyWord">Sales</strong> values; the sum will be 194,776.</p>&#13;
    <p class="normal">As is evident, the <code class="inlineCode">FIXED</code> LOD considers only the dimensions to which it is directed. Thus, when fixed on <strong class="keyWord">Category</strong>, <strong class="keyWord">Region</strong> is ignored. And, as demonstrated, when fixed on <strong class="keyWord">Region</strong>, <strong class="keyWord">Category</strong> is ignored. Lastly, when <strong class="keyWord">Choose Fixed Dims</strong> is set to <strong class="keyWord">Fixed: Nothing</strong>, the entire dataset that is <a/>not restricted by the context filter on <strong class="keyWord">Product Name</strong> is displayed.</p>&#13;
    <p class="normal">Next, let’s look at a couple of new features introduced with Tableau 2021.1 that pertain to <code class="inlineCode">FIXED</code> LODs.</p>&#13;
    <h3 class="heading-3">Table-scoped expressions</h3>&#13;
    <p class="normal">A quick way to write <a/>a <code class="inlineCode">FIXED</code> LOD expression when using a whole table as the scope is using code like the following:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">{MAX([Order Date])}&#13;
</code></pre>&#13;
    <p class="normal">If you use this calculation on the <code class="inlineCode">Superstore</code> dataset, you will achieve the exact same as writing:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">{FIXED: MAX([Order Date])}&#13;
</code></pre>&#13;
    <p class="normal">No matter what you show in the view, this field will always retrieve the latest data from the whole table. Cool, right?</p>&#13;
    <h3 class="heading-3">Quick LODs</h3>&#13;
    <p class="normal">Tableau 2021.1 allows us to create <code class="inlineCode">FIXED</code> LODs faster. Simply drag the desired measure on top of a dimension <a/>and press <em class="keystroke">Ctrl</em> (or <em class="keystroke">Cmd</em> on macOS). </p>&#13;
    <p class="normal">Now you will see the dimension highlighted in blue (see <strong class="keyWord">Region</strong> in <em class="italic">Figure 7.16</em>). Then drop the measure there and a new measure field (in this case, <strong class="keyWord">Sales (Region)</strong>) will be created.</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_16.png" alt=""/></figure><p class="packt_figref">Figure 7.16: Quick LOD</p>&#13;
    <p class="normal">Right-click <a/>on <strong class="screenText">Sales (Region)</strong> and note that a <code class="inlineCode">FIXED</code> LOD has been created:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_17.png" alt=""/></figure><p class="packt_figref">Figure 7.17: Quick LOD II</p>&#13;
    <p class="normal">If you’re working with Tableau 2021.1 or higher, you can use this shortcut for <code class="inlineCode">FIXED</code> LODs.</p>&#13;
    <p class="normal">The playground we built was <a/>not only meant for <code class="inlineCode">FIXED</code> but also for <code class="inlineCode">EXCLUDE</code>. Let us have a look at <code class="inlineCode">EXCLUDE</code> next.</p>&#13;
    <h2 class="heading-2">Understanding EXCLUDE</h2>&#13;
    <p class="normal">Let’s start understanding the <code class="inlineCode">EXCLUDE</code> LOD. The <code class="inlineCode">EXCLUDE</code> LOD will exclude any dimension to which it is <a/>directed. If your view contains <strong class="keyWord">Region</strong> and <strong class="keyWord">Category</strong> and you write an <code class="inlineCode">EXCLUDE</code> LOD on <strong class="keyWord">Category</strong>, only <strong class="keyWord">Region</strong> will be considered in the calculations. The following example will make this clearer—our goal in this exercise is to calculate <code class="inlineCode">SUM(Sales)</code> by using fewer dimensions than in the view. We want to exclude visible dimensions only from the calculation but still show the dimension values in the dashboard:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Set the parameters as shown in the following screenshot:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_18.png" alt=""/></figure><p class="packt_figref">Figure 7.18: Fixed: Nothing</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">You can observe the following results:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_19.png" alt=""/></figure><p class="packt_figref">Figure 7.19: Exclude I</p>&#13;
    <p class="normal"><strong class="screenText">Case Exclude 1</strong> displays <a/>the total of each <strong class="screenText">Category</strong> and <strong class="screenText">Segment</strong> and ignores <strong class="screenText">Region</strong>. For example, the total of the segment<strong class="keyWord"> Consumer</strong> within the category <strong class="keyWord">Furniture</strong> is $26,738. That total is repeated for each <strong class="screenText">Region</strong>. The relevant code that is generating these results is</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SUM({EXCLUDE [Region] : SUM([Sales])})&#13;
</code></pre></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Make the following changes to the parameters:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_20.png" alt=""/></figure><p class="packt_figref">Figure 7.20: Exclude II</p>&#13;
    <p class="normal">Any LOD calculation can be used with multiple dimensions in a view. In this case, <strong class="keyWord">Case Exclude 2</strong> ignores <a/>two dimensions: <strong class="keyWord">1st Dim</strong> and <strong class="keyWord">2nd Dim</strong>, which are associated with <strong class="keyWord">Region</strong> and <strong class="keyWord">Category</strong>. The associated code for <strong class="keyWord">Case Exclude 2</strong> is therefore:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SUM({EXCLUDE [Region],[Category] : SUM([Sales])})&#13;
</code></pre>&#13;
    <p class="normal">The associated code for <strong class="screenText">Case Fixed</strong> is:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SUM({FIXED [Segment]: SUM([Sales])})&#13;
</code></pre>&#13;
    <p class="normal"><strong class="screenText">Case Exclude 2</strong> and <strong class="screenText">Case Fixed</strong> now have identical results. This is because excluding the first two dimensions is the same as fixing on the third dimension. Only the third dimension <strong class="screenText">Segment</strong> is considered in both cases. </p>&#13;
    <p class="normal">You can observe the results in the following screenshot:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_21.png" alt=""/></figure><p class="packt_figref">Figure 7.21: Exclude II table</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Make the <a/>following changes to the parameters:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_22.png" alt=""/></figure><p class="packt_figref">Figure 7.22: Change 4th dimension</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">You can <a/>observe the results as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_23.png" alt=""/></figure><p class="packt_figref">Figure 7.23: Exclude III</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Note that <strong class="screenText">Case Exclude 2</strong> and <strong class="screenText">Case Fixed</strong> no longer have identical results. This is because <strong class="screenText">Ship Mode</strong> was introduced and <strong class="screenText">Case Exclude 2</strong> considers <strong class="screenText">Ship Mode</strong> whereas <strong class="screenText">Case Fixed</strong> does not.</li>&#13;
      <li class="numberedList">Experiment with other settings to further enhance your understanding of the <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> LODs.</li>&#13;
    </ol><p class="normal"><code class="inlineCode">EXCLUDE</code> will cause any dimension addressed in the LOD calculation to be removed from the calculation. Multiple <a/>dimensions can be part of an <code class="inlineCode">EXCLUDE</code> LOD and common use cases include the direct comparison of values at a lower level of aggregation (fields that are in the view) to a higher aggregate (as if dimensions would be removed from the view). Let us assume you want to visualize the sales of categories in different regions as well as the total sales in each region. You might also want to calculate the difference from a single category in a region to the region overall. Isn’t it so cool that LODs can solve this seemingly impossible scenario? I hope that the preceding exercise gave you a better feel for the <code class="inlineCode">EXCLUDE</code><strong class="keyWord"> </strong>LOD. </p>&#13;
    <p class="normal">As a quick interlude after those exercises on <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code>, let us take a closer look at Tableau’s order of operations. As you now <a/>know, getting the same result for <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> is not always the case – the order of operations will help us understand why.</p>&#13;
    <h2 class="heading-2">Understanding Tableau’s order of operations</h2>&#13;
    <p class="normal">The previous exercise led us to believe that the same results for <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> can be achieved by fixing the<a/> dimensions that are not excluded and vice versa. However, the order in which Tableau executes a <code class="inlineCode">FIXED</code> and an <code class="inlineCode">EXCLUDE</code> LOD differs and can hence cause unexpected results. To avoid this, I will show you what to consider when using either <code class="inlineCode">FIXED</code> or <code class="inlineCode">EXCLUDE</code> LODs.</p>&#13;
    <p class="normal">Let us have a look at the order of filtering:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Set the parameters as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_24.png" alt=""/></figure><p class="packt_figref">Figure 7.24: Set parameters</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Observe the results:&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_25.png" alt=""/></figure><p class="packt_figref">Figure 7.25: Same results</p>&#13;
    <p class="normal">Note that, as seen in <a/>the previous exercise, <strong class="screenText">Case Exclude 2</strong> and <strong class="screenText">Case Fixed</strong> are identical.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Right-click on the <strong class="screenText">Product Name</strong> filter and select <strong class="screenText">Remove from Context</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_26.png" alt=""/></figure><p class="packt_figref">Figure 7.26: Remove from Context</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Observe the <a/>results in the following screenshot:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_27.png" alt=""/></figure><p class="packt_figref">Figure 7.27: Without context filter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5"><strong class="screenText">Case Exclude 2</strong> and <strong class="screenText">Case Fixed</strong> are no longer identical. <strong class="screenText">Case Fixed</strong> is no longer impacted by the <strong class="screenText">Product Name</strong> filter because the context was removed.</li>&#13;
    </ol><p class="normal">The behavior difference observed between <code class="inlineCode">EXCLUDE</code> and <code class="inlineCode">FIXED</code> in the preceding exercise reflects the underlying filter <a/>order of operations. As shown in <em class="italic">Figure 7.27</em>, <strong class="keyWord">Context Filters</strong> will impact <code class="inlineCode">FIXED</code>, <code class="inlineCode">EXCLUDE</code>, and <code class="inlineCode">INCLUDE</code> calculations because the <strong class="keyWord">Context</strong> <strong class="keyWord">Filter</strong> is being applied first to the dataset, then the LOD. <strong class="keyWord">Dimension Filters</strong>, however, will only impact <code class="inlineCode">EXCLUDE</code> and <code class="inlineCode">INCLUDE</code> LODs because the <code class="inlineCode">FIXED</code> LOD will be applied to the dataset first and then the dimension filter, followed by the <code class="inlineCode">EXCLUDE</code> and <code class="inlineCode">INCLUDE</code> LODs.</p>&#13;
    <p class="normal">See the following diagram, a schematic representation of the order of operations in Tableau:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_28.png" alt=""/></figure><p class="packt_figref">Figure 7.28: Order of operations</p>&#13;
    <p class="normal"><em class="italic">Figure 7.28</em> is sourced from Tableau’s help pages, here: <a href="https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm" target="_blank"><span class="url">https://help.tableau.com/current/pro/desktop/en-us/order_of_operations.htm</span></a>.</p>&#13;
    <p class="normal">This page also contains more information on Tableau’s order of operations.</p>&#13;
    <p class="normal">We just saw that when using a context filter, <code class="inlineCode">EXCLUDE</code> and <code class="inlineCode">FIXED</code> LODs can result in the same numbers, whereas <a/>a dimension filter will cause the results to differ. This happens because Tableau executes the different requests after one another. As can be seen in the preceding diagram, the order of operations is:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Context filters</li>&#13;
      <li class="numberedList"><code class="inlineCode">FIXED</code> LOD</li>&#13;
      <li class="numberedList">Dimension filters</li>&#13;
      <li class="numberedList"><code class="inlineCode">INCLUDE</code> and <code class="inlineCode">EXCLUDE</code> LODs</li>&#13;
    </ol><p class="normal">This is important for you to know to choose the correct filter or LOD for your purpose.</p>&#13;
    <p class="normal">Next, we will use a new playground, this time to show how <code class="inlineCode">INCLUDE</code> LODs work.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch07lvl1sec40">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">INCLUDE</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">The second playground is mostly set up for you when using the accompanying workbook (<a href="https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07" target="_blank"><span class="url">https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/tree/main/Chapter07</span></a>). We will, however, add <a/>some calculated fields for the purpose of effective exploration. If you do not have ready access to the workbook, you should be able to construct a similar one by referencing the following information.</p>&#13;
    <h2 class="heading-2">Setting up the workbook</h2>&#13;
    <p class="normal">In the following, we <a/>will set up a worksheet with which we <a/>can practice the <code class="inlineCode">INCLUDE</code> LODs:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Open the workbook associated with this chapter and navigate to the <code class="inlineCode">Exploring Include</code> worksheet.</li>&#13;
      <li class="numberedList">The parameters and calculated fields named <strong class="keyWord">1st Dim</strong>, <strong class="keyWord">2nd Dim</strong>, <strong class="keyWord">3rd Dim</strong>, and <strong class="keyWord">4th Dim</strong> created in the previous exercises are also utilized for this worksheet.</li>&#13;
      <li class="numberedList">Right-click on the <strong class="keyWord">1st Dim</strong> parameter and choose <strong class="keyWord">Duplicate</strong>.</li>&#13;
      <li class="numberedList">Rename the duplicate <code class="inlineCode">Choose</code> <code class="inlineCode">Included Dims</code>.</li>&#13;
      <li class="numberedList">Create a new calculated field named <code class="inlineCode">Case</code><strong class="keyWord"> </strong><code class="inlineCode">Include</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">CASE [Choose Included Dims]&#13;
WHEN <span class="hljs-number">1</span> THEN AVG({INCLUDE [Category]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">2</span> THEN AVG({INCLUDE [City]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">3</span> THEN AVG({INCLUDE [Country]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">4</span> THEN AVG({INCLUDE [Customer ID]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">5</span> THEN AVG({INCLUDE [Customer Name]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">6</span> THEN AVG({INCLUDE [Order ID]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">7</span> THEN AVG({INCLUDE [Postal Code]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">8</span> THEN AVG({INCLUDE [Product ID]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">9</span> THEN AVG({INCLUDE [Product Name]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">10</span> THEN AVG({INCLUDE [Region]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">11</span> THEN AVG({INCLUDE [Segment]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">12</span> THEN AVG({INCLUDE [Ship Mode]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">13</span> THEN AVG({INCLUDE [State]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">14</span> THEN AVG({INCLUDE [Sub-Category]: SUM([Sales])})&#13;
WHEN <span class="hljs-number">15</span> THEN <span class="hljs-number">0</span>&#13;
END&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Case Include</strong> on the <strong class="keyWord">Detail</strong> shelf.</li>&#13;
      <li class="numberedList">Place the following measures and dimensions on their respective shelves:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_29.png" alt=""/></figure><p class="packt_figref">Figure 7.29: Exploring INCLUDE</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Display each <a/>of the following parameters <a/>by right-clicking each one and selecting <strong class="keyWord">Show Parameter Control</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_30.png" alt=""/></figure><p class="packt_figref">Figure 7.30: Parameters</p>&#13;
    <p class="normal">After you have finished <a/>the initial setup, we can finally start <a/>to investigate the <code class="inlineCode">INCLUDE</code> LOD.</p>&#13;
    <h2 class="heading-2">Understanding INCLUDE</h2>&#13;
    <p class="normal">Now that the playground environment is complete, let’s build a scenario to better understand <code class="inlineCode">INCLUDE</code>. By now, you can probably imagine that if the <code class="inlineCode">FIXED</code> and <code class="inlineCode">EXCLUDE</code> LODs remove <a/>dimensions from a calculation, <code class="inlineCode">INCLUDE</code> adds dimensions. Correct! It might happen that you want to include one or more dimensions in a calculation even though the view doesn’t show them. The next example will make use of this functionality to show an average per sub-category without showing the sub-category. One would want to do this because the sub-category has so many additional values that the dashboard will be harder to read, and it will take longer to draw quick conclusions. Nevertheless, it is of interest to know the average per sub-category because the number of sub-categories might differ per <strong class="keyWord">Region</strong> and other dimensions, and thus including it will give insights into the real average sales.</p>&#13;
    <p class="normal">Let’s see it in action:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Set the parameters on the right-hand side as shown here:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_31.png" alt=""/></figure><p class="packt_figref">Figure 7.31: Initial layout</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Add two reference lines<strong class="keyWord"> </strong>by clicking on <strong class="keyWord">Analytics</strong> and edit them using the following settings:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_32.png" alt=""/></figure><p class="packt_figref">Figure 7.32: Reference line settings</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Look at the <a/>following screenshot for the result. Note that both reference lines are equal:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_33.png" alt=""/></figure><p class="packt_figref">Figure 7.33: Sales per region and reference lines</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">If the reference lines are overlapping with each other, edit the formatting and set <strong class="screenText">Alignment</strong> to <strong class="screenText">Top</strong>. To <a/>access the formatting, click on the reference line in the view:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_34.png" alt=""/></figure><p class="packt_figref">Figure 7.34: Format Reference Line</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Now, set the parameters as shown here:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_35.png" alt=""/></figure><p class="packt_figref">Figure 7.35: Format Reference Line</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">In Tableau <a/>Desktop, you should now see the following. As before, both <strong class="keyWord">Reference Lines</strong> are equal:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_36.png" alt=""/></figure><p class="packt_figref">Figure 7.36: Reference Lines</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Change the <strong class="screenText">Choose Included Dims</strong> parameter to <strong class="keyWord">Category</strong>, <strong class="keyWord">Ship Mode</strong>, and <strong class="keyWord">Segment</strong>.</li>&#13;
      <li class="numberedList">Note that the <strong class="keyWord">Reference Lines</strong> equal one another for each of these settings. This is <a/>because <strong class="keyWord">Choose Included Dims</strong> is only introducing dimensions already represented in the view.</li>&#13;
      <li class="numberedList">Change the <strong class="keyWord">Choose Included Dims</strong> parameter to <strong class="keyWord">Sub-Category</strong> to see the additional reference line in its intended place:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_37.png" alt=""/></figure><p class="packt_figref">Figure 7.37: Showing an additional Reference Line</p>&#13;
    <p class="normal">The <strong class="keyWord">Include Dim Avg</strong> reference line now includes <strong class="keyWord">Sub-Category</strong> in the average and therefore differs from the <strong class="keyWord">Overall Avg</strong> reference line. The average is smaller because the total <strong class="keyWord">Sales </strong>amount is <a/>being divided over more points than are visible in the view. Adding <strong class="keyWord">Sub-Category</strong> to the LOD leads to more rows, which leads to a smaller average per row. Furthermore, note that the <strong class="keyWord">Sub-Category</strong> dimension is not used in the view. LODs do not require a calculation to reside in the view.</p>&#13;
    <p class="normal">To summarize, the <code class="inlineCode">INCLUDE</code> LOD can manipulate a visualization in a way that partitions can be added that are not used in the view itself. Also, the naming convention for all three LODs will be your best mnemonic in understanding them: <code class="inlineCode">Fixed</code> to fix the fields used, <code class="inlineCode">Include</code> to add “missing” fields, and <code class="inlineCode">Exclude</code> to remove unwanted fields from the calculations that are <a/>already present.</p>&#13;
    <p class="normal">To get more hands-on training, we will continue with a few practical applications.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch07lvl1sec41">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Building practical applications with LODs</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">The first portion of this chapter was designed to demonstrate how LODs work. The remainder will be <a/>dedicated to practical <a/>applications. Specifically, we will consider three typical challenges that previously were solved using other Tableau capabilities, such as table calculations and data blending.</p>&#13;
    <p class="normal">This exercise will look at a problem that occurs when mixing a table calculation that calculates the percentage of the total with a dimension filter. We will consider the problem, a solution using a LOD calculation, and finish with a commentary section on the germane points of the solution.</p>&#13;
    <h2 class="heading-2">Using the LOD FIXED calculation</h2>&#13;
    <p class="normal">Did you ever encounter a situation where you wanted to calculate the <strong class="keyWord">Percent of Total </strong>while only showing a <a/>subset of the <strong class="keyWord">Total</strong> dimension in your view? Well, you are not alone. But thanks to LODs, you will soon know how to solve this problem. The following steps will guide you through the exercise:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Open the workbook associated with this chapter and navigate to the worksheet entitled <code class="inlineCode">The Problem</code>.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">2012_World_Pop</code> dataset.</li>&#13;
      <li class="numberedList">Create a calculated field named <code class="inlineCode">Percent of Total</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">SUM([Population]) / TOTAL(SUM([Population]))&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Right-click on <strong class="keyWord">Percent of Total</strong> and select <strong class="keyWord">Default Properties</strong> | <strong class="keyWord">Number Format</strong> | <strong class="keyWord">Percentage</strong>.</li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Country</strong> on the <strong class="keyWord">Columns</strong> shelf, <strong class="keyWord">Measure Names</strong> on the <strong class="keyWord">Rows</strong> shelf, and <strong class="keyWord">Measure Values</strong> on the<strong class="keyWord"> Text</strong> shelf.</li>&#13;
      <li class="numberedList">Remove <strong class="keyWord">Number of Records</strong> from the <strong class="keyWord">Measure Values</strong> shelf.</li>&#13;
      <li class="numberedList">Right-click on <strong class="keyWord">Percent of Total</strong> and set it to <strong class="keyWord">Compute Using</strong> | <strong class="keyWord">Country</strong>.</li>&#13;
      <li class="numberedList">Create a filter on <strong class="screenText">Country</strong> such that only <strong class="screenText">Afghanistan</strong> displays:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_38.png" alt=""/></figure><p class="packt_figref">Figure 7.38: Population of Afghanistan</p>&#13;
    <p class="normal"><strong class="keyWord">Afghanistan</strong> displays the percentage of the total as 100%. Obviously, this does not represent Afghanistan’s <a/>percentage of the total population of the world. Let’s investigate a possible solution—to solve the issue with a LOD, follow along with the exercise steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Duplicate the worksheet entitled <code class="inlineCode">The Problem</code> and rename it <code class="inlineCode">Solution LOD</code>.</li>&#13;
      <li class="numberedList">Create a calculated field named <code class="inlineCode">Percent of Total LOD</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">SUM([Population])/SUM({ FIXED : SUM([Population])})&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Place <strong class="screenText">Percent of Total LOD</strong> on the <strong class="screenText">Measure Values</strong> shelf and note that the displayed percentage equals <strong class="screenText">0.43%</strong>. If <strong class="keyWord">0</strong> displays, change the number formatting to percentage:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_39.png" alt=""/></figure><p class="packt_figref">Figure 7.39: Percent of total</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Remove the <strong class="keyWord">Percent of Total</strong> table calculation that was previously created from the <strong class="keyWord">Measure Values</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_40.png" alt=""/></figure><p class="packt_figref">Figure 7.40: Percent of total LOD</p>&#13;
    <p class="normal">As you can see, problem solved! To better understand what is happening in the background, let’s look <a/>at a query that Tableau generates for the worksheet entitled <code class="inlineCode">The Problem</code>. Generated queries can be viewed by clicking <strong class="keyWord">Help</strong> | <strong class="keyWord">Settings and Performance</strong> | <strong class="keyWord">Start Performance Recording</strong>. (See <em class="chapterRef">Chapter 11</em>, <em class="italic">Designing Dashboards and Best Practices for Visualizations</em>, for additional information regarding viewing Tableau’s generated queries.)</p>&#13;
    <p class="normal">The SQL statement is as follows:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SELECT &#13;
['<span class="hljs-number">2012</span>_World_Pop$'].[Country] AS [Country],&#13;
SUM(['<span class="hljs-number">2012</span>_World_Pop$'].[Population]) AS [SUM:Population:ok] &#13;
FROM&#13;
[dbo].['<span class="hljs-number">2012</span>_World_Pop$'] ['<span class="hljs-number">2012</span>_World_Pop$'] &#13;
WHERE&#13;
(['<span class="hljs-number">2012</span>_World_Pop$'].[Country] = 'Afghanistan') &#13;
GROUP BY&#13;
['<span class="hljs-number">2012</span>_World_Pop$'].[Country]]&#13;
</code></pre>&#13;
    <p class="normal">Note that the <code class="inlineCode">WHERE</code> clause in the query is limiting the returned dataset to only those rows that have <code class="inlineCode">Afghanistan</code> as <strong class="keyWord">Country</strong>. This <code class="inlineCode">WHERE</code> clause was generated because of placing <strong class="keyWord">Country</strong> on the <strong class="keyWord">Filters</strong> shelf. By limiting the returned data, the processing requirements are shifted from Tableau to the underlying data source engine. In other words, the data source engine does the work of executing the query, and Tableau thus works with a smaller dataset. The reasoning behind this design is that data source engines are specifically engineered to efficiently query large datasets and typically have underlying hardware to support such activities. Furthermore, limiting the rows of data returned to Tableau can reduce inefficiencies due to latency.</p>&#13;
    <p class="normal">Inefficiencies are further reduced because Tableau works from the cache whenever possible. Often, a user can perform various operations without generating a call to the underlying data source. However, in the preceding case, if a user were to select a different <strong class="keyWord">Country</strong> from the filter, Tableau would generate a new query to the data source. For example, if a user interacts with the filter and deselects <code class="inlineCode">Afghanistan</code> and selects <code class="inlineCode">Albania</code>, a new query with a corresponding <code class="inlineCode">WHERE</code> clause is generated. Although the logic of Tableau’s reliance on the data source engine is demonstrable, the problem proposed in the preceding example remains. What can a Tableau author do to calculate the percent of the whole regardless of filtering?</p>&#13;
    <p class="normal">A solution is to create a table calculation that can also be used as a filter. The difference is that unlike in the worksheet <code class="inlineCode">The Problem</code>, the query generated by Tableau to the data source returns the entire dataset. When a table calculation is used in a filter, the filtering does not take place until the underlying data is returned. In other words, Tableau performs the filtering. This preserves a percent of the total percentages regardless of which <a/>country population totals the user chooses to view. But a potential issue with table calculations is that the returned dataset may be quite large, which may cause performance challenges. Latency may be experienced due to the increased time required to return a large dataset, and Tableau may perform more slowly because of additional processing responsibilities to filter the dataset.</p>&#13;
    <p class="normal">Our proposed solution, an LOD calculation, can address these challenges. Let’s look at the SQL queries created by the <code class="inlineCode">Percent of Total LOD</code> calculated field in the <code class="inlineCode">Solution LOD</code> worksheet:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SELECT &#13;
[t0].[Country] AS [Country], &#13;
[t1].[ measure <span class="hljs-number">0</span>] AS&#13;
[TEMP(Calculation_418553293854285824)(<span class="hljs-number">2417030171</span>)(<span class="hljs-number">0</span>)],&#13;
[t0].[TEMP(Calculation_418553293854285824)(<span class="hljs-number">616435453</span>)(<span class="hljs-number">0</span>)] AS&#13;
[TEMP(Calculation_418553293854285824)(<span class="hljs-number">616435453</span>)(<span class="hljs-number">0</span>)] &#13;
FROM &#13;
( SELECT&#13;
['<span class="hljs-number">2012</span>_World_Pop$'].[Country] AS [Country], SUM(['<span class="hljs-number">2012</span>_World_Pop$'].[Population])&#13;
AS [TEMP(Calculation_418553293854285824)(<span class="hljs-number">616435453</span>)(<span class="hljs-number">0</span>)] &#13;
FROM&#13;
[dbo].['<span class="hljs-number">2012</span>_World_Pop$'] ['<span class="hljs-number">2012</span>_World_Pop$'] &#13;
WHERE &#13;
(['<span class="hljs-number">2012</span>_World_Pop$'].[Country]= 'Afghanistan') &#13;
GROUP BY &#13;
['<span class="hljs-number">2012</span>_World_Pop$'].[Country] ) [t0] &#13;
CROSS JOIN&#13;
( SELECT SUM(['<span class="hljs-number">2012</span>_World_Pop$'].[Population]) AS [ measure <span class="hljs-number">0</span>] FROM&#13;
[dbo].['<span class="hljs-number">2012</span>_World_Pop$'] ['<span class="hljs-number">2012</span>_World_Pop$'] &#13;
GROUP BY () ) [t1]&#13;
</code></pre>&#13;
    <p class="normal">Note the term <code class="inlineCode">CROSS JOIN</code>; the LOD calculation generates a query that instructs the underlying data <a/>source engine to return data in such a way as to allow Tableau to divide the population values of one or more countries by the world population total, thus returning the correct percentage of the total.</p>&#13;
    <h2 class="heading-2">Using the LOD INCLUDE calculation</h2>&#13;
    <p class="normal">Next, we will <a/>practice the <code class="inlineCode">INCLUDE</code> LOD calculation. In this exercise, we will create a worksheet that displays the following:</p>&#13;
    <ul><li class="bulletList">Total sales per region</li>&#13;
      <li class="bulletList">The average of total sales across all regions</li>&#13;
      <li class="bulletList">The average of total sales across all states in each region</li>&#13;
    </ul><p class="normal">Using a LOD calculation to display these values is straightforward. Let’s explore. Follow along with the exercise steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Select the <code class="inlineCode">Practical Include</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> dataset.</li>&#13;
      <li class="numberedList">Create a calculated field named <code class="inlineCode">Per State INCLUDE</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">{INCLUDE [State]:SUM([Sales])}&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Drag <strong class="keyWord">Region</strong> to the <strong class="keyWord">Columns</strong> shelf, <strong class="keyWord">SUM(Sales)</strong> to the <strong class="keyWord">Rows</strong> shelf, and <strong class="keyWord">AVG(Per State INCLUDE)</strong> to the <strong class="keyWord">Details</strong> shelf. Be sure to change <strong class="keyWord">Per State INCLUDE</strong> to an average aggregation.</li>&#13;
      <li class="numberedList">Add two <strong class="keyWord">Reference Lines</strong> by right-clicking on the <strong class="keyWord">Sales</strong> axis and selecting <strong class="keyWord">Add Reference Line</strong>. Use the following settings:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_41.png" alt=""/></figure><p class="packt_figref">Figure 7.41: Reference lines</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Complete <a/>the worksheet by formatting it as desired:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_42.png" alt=""/></figure><p class="packt_figref">Figure 7.42: Average per Region and State</p>&#13;
    <p class="normal">As you can see, thanks to the LOD, we can display a line chart per <strong class="keyWord">Region</strong>, as well as one for the whole dataset. This is <a/>possible because we included the <strong class="keyWord">State</strong> dimension in our <strong class="keyWord">Per State INCLUDE</strong> calculation. Using this calculated field to create a reference line allows Tableau to show not only the average per (visible) <strong class="keyWord">Region</strong> but also the average per <strong class="keyWord">State</strong> (invisible) per <strong class="keyWord">Region</strong>.</p>&#13;
    <h2 class="heading-2">Using the LOD EXCLUDE calculation</h2>&#13;
    <p class="normal">In this exercise, we <a/>will create a worksheet using the <code class="inlineCode">Superstore</code> dataset, which will calculate the percentage of sales generated by each city in a region.</p>&#13;
    <p class="normal">Follow along with the exercise steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Select the <code class="inlineCode">Practical Exclude</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> dataset.</li>&#13;
      <li class="numberedList">Create the following calculated fields:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_43.png" alt=""/></figure><p class="packt_figref">Figure 7.43: Region Values and % Per Region LODs</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Place <strong class="keyWord">Region</strong> and <strong class="keyWord">City</strong> on the <strong class="keyWord">Rows</strong> shelf.</li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Measure Names</strong> on the <strong class="keyWord">Columns</strong> shelf and <strong class="keyWord">Measure Values</strong> on the <strong class="keyWord">Text </strong>shelf.</li>&#13;
      <li class="numberedList">Remove all instances <a/>of measures from the <strong class="keyWord">Measure Values</strong> shelf except <strong class="keyWord">Sales</strong>, <strong class="keyWord">Region Values</strong>, and <strong class="keyWord">% Per Region LOD.</strong></li>&#13;
      <li class="numberedList">In order for <strong class="keyWord">% Per Region LOD</strong> to display as a percentage, the number formatting must be adjusted. Simply right-click on the calculation in the <strong class="keyWord">Data</strong> pane and select <strong class="screenText">Default Properties</strong> | <strong class="screenText">Number Format</strong> | <strong class="screenText">Percentage</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_44.png" alt=""/></figure><p class="packt_figref">Figure 7.44: Change Number Format</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Place an <a/>instance of <strong class="keyWord">AGG(% Per Region LOD)</strong> on the <strong class="keyWord">Filter</strong> shelf and adjust to display at least <code class="inlineCode">0.1</code> (or 10%):</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_45.png" alt=""/></figure><p class="packt_figref">Figure 7.45: % filter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="9">Observe the current view, with <strong class="screenText">Region</strong> and <strong class="screenText">City</strong> on the <strong class="screenText">Rows</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_46.png" alt=""/></figure><p class="packt_figref">Figure 7.46: Jacksonville still visible</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">Now, place <strong class="screenText">State</strong> on <a/>the <strong class="screenText">Rows</strong> shelf between <strong class="screenText">Region</strong> and <strong class="screenText">City</strong>. Note that <strong class="screenText">Jacksonville</strong> disappears:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_07_47.png" alt=""/></figure><p class="packt_figref">Figure 7.47: Jacksonville disappears when Region is added to Rows</p>&#13;
    <p class="normal">This is happening because <strong class="screenText">Jacksonville</strong> exists in two states of the <strong class="screenText">South</strong> region, in <strong class="screenText">Florida</strong> as well as in <strong class="screenText">North Carolina</strong>. You can see this replacing the <strong class="screenText">% Per Region LOD</strong> filter with <strong class="screenText">City</strong>: <strong class="screenText">Jacksonville</strong>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_07_48.png" alt=""/></figure><p class="packt_figref">Figure 7.48: Jacksonville existing within two states</p>&#13;
    <p class="normal">Our <strong class="keyWord">Region Values</strong> calculation excluded <strong class="keyWord">City</strong> and <strong class="keyWord">State</strong>, and so the <strong class="keyWord">% Per Region LOD </strong>will consider the <strong class="keyWord">SUM(Sales)</strong> for whatever is visible in the view, divided by the <strong class="keyWord">Region Values</strong>. With <strong class="keyWord">Region</strong> and <strong class="keyWord">City</strong> in the view only, the <strong class="keyWord">SUM(Sales)</strong> for Jacksonville is <strong class="keyWord">44,713</strong> (see <em class="italic">Figure 7.48</em>). That number divided by the <strong class="keyWord">Region Values</strong> of <strong class="keyWord">391,722</strong> (see <em class="italic">Figure 7.46</em>) is &gt; 10%. But then we added <strong class="keyWord">State</strong> to the view, changing the <strong class="keyWord">SUM(Sales)</strong> to <strong class="keyWord">39,133</strong> for <strong class="keyWord">Jacksonville</strong> in <strong class="keyWord">Florida</strong> and <strong class="keyWord">5,580 </strong>for <strong class="keyWord">Jacksonville</strong> in <strong class="keyWord">North Carolina</strong> (see <em class="italic">Figure 7.50</em>). Neither one of <a/>them, when divided by <strong class="keyWord">391,722</strong> for the <strong class="keyWord">Region Values</strong>, is above 10% and will therefore drop from the view due to our filter.</p>&#13;
    <p class="normal">LODs are one of the more advanced topics when using Tableau, but they are very powerful and worth spending the time to understand. For more practical examples, I would recommend you <a/>check out the following website: <a href="https://www.tableau.com/about/blog/LOD-expressions" target="_blank"><span class="url">https://www.tableau.com/about/blog/LOD-expressions</span></a>. I remember that when I first started using Tableau, I did not think that I would ever want to show data based on dimensions that were not in my view or that I would want to exclude dimensions. But I needed to do that so many times, for example, when adding a calculation of the distance to the average of total rows to my dashboard or when a dimension had multiple max dates and you wanted to show the measure of each individual max date only. I have gone back to the documentation on LODs more often than you can imagine, and I can only encourage you to do the same; the more you read about LODs, the easier it will be to grasp the concept and use them naturally. The added flexibility LODs bring to your dashboard is incredible.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch07lvl1sec42">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Summary</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">We began this chapter by exploring why LODs are so impactful and why their inclusion in Tableau was so lauded. Next, we built two playgrounds to explore how the three LODs—<code class="inlineCode">FIXED</code>, <code class="inlineCode">EXCLUDE</code>, and <code class="inlineCode">INCLUDE</code>—work. Tableau’s default is to base calculations on the dimensions visible in the view. For example, if you have states in your view, the sales amount will be presented by state. If you are adding cities, the sales amount will be adjusted by state, by city. But, if you want to manipulate this default logic, you can use LODs. They allow you to calculate measures based on any dimension, no matter whether that dimension is represented in the view or not. We also saw that <code class="inlineCode">FIXED</code> LODs are higher in the order of operations in Tableau than <code class="inlineCode">EXCLUDE</code> and <code class="inlineCode">INCLUDE</code> LODs. This is important to remember so that you use the correct LOD and/or filter in your dashboard.</p>&#13;
    <p class="normal">In the next chapter, we’ll turn our attention to the visual side of Tableau and explore different chart types and less common but very useful visualizations.</p>&#13;
    <h2 class="heading-1">Learn more on Discord</h2>&#13;
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>&#13;
    <p class="normal"><a href="https://packt.link/tableau" target="_blank"><span class="url">https://packt.link/tableau</span></a></p>&#13;
    <p class="normal"><img src="../images/QR_Code2044012316175764640.png" alt=""/></p>&#13;
  </div>&#13;
&#13;
&#13;
</div>&#13;
</section>&#13;
</section>&#13;
</body></html>