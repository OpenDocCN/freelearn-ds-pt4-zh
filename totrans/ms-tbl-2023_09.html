<html><head></head><body>
<section epub:type="chapter">&#13;
<section id="ch09lvl1sec49">&#13;
<div class="epub-source">&#13;
<h1 class="chapterTitle">Working with Maps</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">When I conduct Tableau classes and workshops for people who are using Tableau for the first time, I find that demonstrating <strong class="keyWord">mapping</strong> is always a big hit, sometimes resulting in murmurs of appreciation and surprise. People have told me on multiple occasions that Tableau’s mapping capability was the key feature that caused them to take notice of and consider Tableau’s offerings more seriously. Tableau’s out-of-the-box mapping capabilities are powerful and flexible. You may be surprised at how much you can accomplish without ever leaving the user interface. But these out-of-the-box capabilities are just the tip of the iceberg. With proper guidance (which I will attempt to provide in this chapter), you can expand beyond the native mapping functionality and explore techniques that will greatly enhance your workbooks’ functionality and aesthetics.</p>&#13;
    <p class="normal">In this chapter, we will discuss the following topics:</p>&#13;
    <ul><li class="bulletList">Extending Tableau’s mapping capabilities without leaving Tableau</li>&#13;
      <li class="bulletList">Creating custom polygons</li>&#13;
      <li class="bulletList">Heatmaps</li>&#13;
      <li class="bulletList">Dual axes and map layering</li>&#13;
      <li class="bulletList">Extending Tableau mapping with other technology</li>&#13;
      <li class="bulletList">Swapping maps</li>&#13;
      <li class="bulletList">Custom geocoding</li>&#13;
    </ul><p class="normal">The default mapping capability of Tableau is a big selling point. Take any city, region, country, or other geographical location, place it on a Tableau worksheet, and you get a nice map; add a measure like <strong class="keyWord">Sales</strong> to the <strong class="keyWord">Color</strong> shelf and your map colors change according to sales figures. In the following section, we will go a step further and enhance this capability with the less obvious features Tableau has to offer, like measuring distances on a map and plotting additional data (for example, weather data) in the background.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec50">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Extending Tableau’s mapping capabilities without leaving Tableau</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">In our everyday lives, a map can be helpful for better understanding the world around us. For instance, maps are often used on websites, television, or in printed media to present <a/>demographic information. In such instances, the mapping requirement is <strong class="keyWord">static</strong> since the immediate goal does not require movement. Some businesses only have static mapping requirements—for example, a retail chain might create a visualization that includes a map to better understand sales performance in a given region. In such cases, movement between locations is not a direct need.</p>&#13;
    <p class="normal">Often, however, a map is needed to navigate from point A to point B. This kind of mapping requirement is more complicated, because it encompasses static needs (what restaurant is nearby?), but must also deliver additional information, such as routes and distances (how can I get to that restaurant?). These <strong class="keyWord">dynamic</strong> mapping needs assume that movement is <em class="italic">required</em> to fulfill a demand. Many businesses need to understand routes and mileage, that is, how to get from point A to point B and the distances involved. These dynamic mapping requirements can vary greatly but most of these needs share at least two things in common: routes and distances.</p>&#13;
    <p class="normal">In the following exercise, we will consider flight routes and associated distances in Australia. Specifically, we will cover how to extract longitude and latitude numbers from Tableau and use that information in conjunction with trigonometry to calculate the mileage between various points. Along the way, we will utilize data blending, table calculations, mapping, and <strong class="keyWord">Level of Detail</strong> (<strong class="keyWord">LOD</strong>) calculations for a robust exercise that touches on many advanced features.</p>&#13;
    <p class="normal">Please take the following steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to <a href="https://public.tableau.com/profile/marleen.meier" target="_blank"><span class="url">https://public.tableau.com/profile/marleen.meier</span></a> to locate and download the workbook associated with this chapter.</li>&#13;
      <li class="numberedList">Open the workbook and navigate to the <code class="inlineCode">Map</code> worksheet.</li>&#13;
      <li class="numberedList">Select <strong class="keyWord">Transit Data</strong> in the <strong class="keyWord">Data</strong> pane and double-click on <strong class="keyWord">City</strong>, then change <strong class="screenText">City</strong> from <strong class="screenText">Detail</strong> to <strong class="screenText">Label</strong> in the <strong class="screenText">Marks</strong> card.</li>&#13;
      <li class="numberedList">In the following screenshot, note that the cities <strong class="screenText">Mackay</strong> and <strong class="screenText">Brisbane</strong> are the only cities that display. This issue depends on your country setting, but the following is an example of an issue that may be encountered. If you see it, click on <strong class="keyWord">14 unknown</strong>, in the bottom-right corner:&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_01.png" alt=""/></figure><p class="packt_figref">Figure 9.1: Australia</p>&#13;
    <p class="normal">Caveat: if you <a/>are in the <strong class="keyWord">United States</strong>, Melbourne in Florida will display. If you are in another country, you may get different results.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Select <strong class="screenText">Edit Locations...</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_02.png" alt=""/></figure><p class="packt_figref">Figure 9.2: Edit Locations…</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Change <strong class="screenText">Country/Region</strong> to <strong class="screenText">Fixed</strong> | <strong class="screenText">Australia</strong>:&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_03.png" alt=""/></figure><p class="packt_figref">Figure 9.3: Select Australia</p>&#13;
    <p class="normal"><strong class="keyWord">Australia</strong> is <a/>now displayed on the map:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_04.png" alt=""/></figure><p class="packt_figref">Figure 9.4: Australia</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Navigate to the <code class="inlineCode">Miles</code> worksheet and place the <strong class="screenText">Trip ID</strong> and <strong class="screenText">City</strong> fields on the <strong class="screenText">Rows</strong> shelf, and <strong class="screenText">Latitude (generated)</strong> and <strong class="screenText">Longitude (generated)</strong> on the <strong class="screenText">Text</strong> shelf, as <a/>seen in the following screenshot:&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_05.png" alt=""/></figure><p class="packt_figref">Figure 9.5: Distances</p>&#13;
    <p class="normal">Your screen should look like the preceding screenshot. Note that the crosstab is pretty cluttered. Ideally, <strong class="keyWord">Latitude</strong> and <strong class="keyWord">Longitude</strong> should be displayed in separate columns. Unfortunately, we can’t do this with the generated latitude and longitude because, although they are listed under the <strong class="keyWord">Measures</strong> portion of the <strong class="keyWord">Data</strong> pane, Tableau doesn’t treat them as measures. In order to complete the exercise, we will need to be able to access the latitude and longitude coordinates from a separate data source.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">To do this, begin by clicking on the <code class="inlineCode">Map</code> worksheet tab.</li>&#13;
      <li class="numberedList">Right-click on the visualization and select <strong class="keyWord">View Data</strong>. Copy all the data in the <strong class="keyWord">Summary</strong> tab of the resulting dialog box, by selecting every cell and clicking <strong class="keyWord">Copy</strong>.</li>&#13;
      <li class="numberedList">Close the dialog box and press <em class="keystroke">Ctrl</em> + <em class="keystroke">V</em> (<em class="keystroke">Command</em> + <em class="keystroke">V</em> for Mac) to create a new dataset in Tableau. Rename the resulting dataset (now called <code class="inlineCode">Clipboard_[timestamp]</code>) to <code class="inlineCode">Lat</code> <code class="inlineCode">Long</code>. Also, name the worksheet <code class="inlineCode">Lat</code><strong class="keyWord"> </strong><code class="inlineCode">Long</code>.</li>&#13;
      <li class="numberedList">In the <code class="inlineCode">Lat Long</code> worksheet, rename <code class="inlineCode">Latitude</code> <code class="inlineCode">(generated)</code> and <code class="inlineCode">Longitude</code><strong class="keyWord"> </strong><code class="inlineCode">(generated)</code> to <code class="inlineCode">Lat</code> and <code class="inlineCode">Long</code>.</li>&#13;
      <li class="numberedList">Return to the <code class="inlineCode">Miles</code> worksheet and, within the <code class="inlineCode">Transit Data</code> data source, create two <a/>calculated fields: one called <code class="inlineCode">LAT</code>, containing the code <code class="inlineCode">AVG([Lat Long].[Lat])</code>, and one called <code class="inlineCode">LONG</code>, containing the code <code class="inlineCode">AVG([Lat Long].[Long])</code>.</li>&#13;
      <li class="numberedList">Remove <strong class="keyWord">Latitude (generated)</strong> and <strong class="keyWord">Longitude (generated)</strong> from <strong class="keyWord">Text</strong> on the <strong class="keyWord">Marks</strong> card.</li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Measure Names</strong> on the <strong class="keyWord">Columns</strong> shelf and the <strong class="keyWord">Filter</strong> shelf and select <strong class="keyWord">Lat</strong> and <strong class="keyWord">Long</strong>. Also, place <strong class="keyWord">Measure Values</strong> on the <strong class="keyWord">Text</strong> shelf. Now, we have the ability to treat latitude and longitude as true measures.</li>&#13;
      <li class="numberedList">Create two more calculated fields: one called <code class="inlineCode">Lookup</code><strong class="keyWord"> </strong><code class="inlineCode">Lat</code>, containing the code <code class="inlineCode">Lookup(Lat,-1)</code>, and one called <code class="inlineCode">Lookup</code><strong class="keyWord"> </strong><code class="inlineCode">Long</code>, containing the code <code class="inlineCode">Lookup(Long, -1)</code>. Place the two newly created calculated fields on the <strong class="keyWord">Measure Values</strong> shelf.</li>&#13;
      <li class="numberedList">Create a calculated field named <code class="inlineCode">Great</code><strong class="keyWord"> </strong><code class="inlineCode">Circle</code><strong class="keyWord"> </strong><code class="inlineCode">Distance</code><strong class="keyWord"> </strong><code class="inlineCode">Formula</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-number">3959</span> <span class="hljs-operator">*</span> <span class="hljs-built_in">ACOS</span> (&#13;
<span class="hljs-built_in">SIN</span>(RADIANS([Lat])) <span class="hljs-operator">*</span> <span class="hljs-built_in">SIN</span>(RADIANS([Lookup Lat]))<span class="hljs-operator">+</span> <span class="hljs-built_in">COS</span>(RADIANS([Lat])) <span class="hljs-operator">*</span> <span class="hljs-built_in">COS</span>(RADIANS([Lookup Lat])) <span class="hljs-operator">*</span> <span class="hljs-built_in">COS</span>(RADIANS([Lookup Long]) <span class="hljs-operator">-</span> RADIANS([Long]))&#13;
)&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">For kilometers, change <code class="inlineCode">3959</code> to <code class="inlineCode">6378</code>. This number represents the radius of the Earth and it needs to be updated from miles to kilometers.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="17">Place the newly created calculated field <strong class="keyWord">Great Circle Distance Formula</strong> on the <strong class="keyWord">Measure Values</strong> shelf.</li>&#13;
      <li class="numberedList">Change the calculation for <strong class="keyWord">Great Circle Distance Formula</strong> so that it computes using <strong class="keyWord">City </strong>by clicking on the field itself and selecting<strong class="keyWord"> Compute Using: City</strong>.</li>&#13;
      <li class="numberedList">Adjust the following calculations accordingly:</li>&#13;
    </ol><table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><strong class="keyWord">Name</strong></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal"><strong class="keyWord">Code</strong></p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">Lookup Lat</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <pre class="programlisting code"><code class="hljs-code">IFNULL(LOOKUP(Lat,<span class="hljs-number">-1</span>), LOOKUP(Lat,<span class="hljs-number">1</span>))&#13;
</code></pre>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">Lookup Long</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <pre class="programlisting code"><code class="hljs-code">IFNULL(LOOKUP(Long,<span class="hljs-number">-1</span>), LOOKUP(Long,<span class="hljs-number">1</span>))&#13;
</code></pre>&#13;
          </td>&#13;
        </tr></tbody></table><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="20">Select the <code class="inlineCode">Map</code> worksheet and set the <strong class="screenText">Marks</strong> type to <strong class="screenText">Line</strong>.</li>&#13;
      <li class="numberedList">Place <strong class="screenText">Trip ID</strong> on the <strong class="screenText">Detail</strong> shelf.</li>&#13;
      <li class="numberedList">Drag <strong class="screenText">City</strong> to the <a/>bottom of the <strong class="screenText">Marks</strong> card view.</li>&#13;
      <li class="numberedList">Place the <strong class="screenText">Great Circle Distance Formula</strong> field on the <strong class="screenText">Tooltip</strong> shelf. Double-check that it is still set to <strong class="keyWord">Compute Using: City</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_06.png" alt="Chart&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.6: Australia distances</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="24">Create two more calculated fields, one called <code class="inlineCode">Source City</code>, containing the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">{ FIXED [Trip ID]:<span class="hljs-built_in">MIN</span>(IF [Dest<span class="hljs-operator">/</span>Orig]<span class="hljs-operator">=</span><span class="hljs-string">'Source'</span> <span class="hljs-keyword">THEN</span> City <span class="hljs-keyword">END</span>)}&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">The second calculated <a/>field should be called <code class="inlineCode">Destination City</code> and contain the following code:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">{ FIXED [Trip ID]:<span class="hljs-built_in">MIN</span>(IF [Dest<span class="hljs-operator">/</span>Orig]<span class="hljs-operator">=</span><span class="hljs-string">'Destination'</span> <span class="hljs-keyword">THEN</span> City <span class="hljs-keyword">END</span>)}&#13;
</code></pre></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="25">Use the newly created calculated fields to format as desired. In particular, notice that in the following screenshot, <strong class="screenText">Source City</strong> is on the <strong class="screenText">Color</strong> shelf and <strong class="screenText">Destination City</strong> is used on the <strong class="screenText">Tooltip</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_07.png" alt="Chart&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.7: Flights</p>&#13;
    <p class="normal">To sum up what we have done here, initially, we added a dataset to Tableau. We then needed to copy the latitudes and longitudes per city out of the workbook in order to create a second data source, which we then used as a blend to look up latitude and longitude values. With <a/>the help of LOD calculations, we could identify the source and destination cities, and lastly, we were able to measure the distance between cities by using the so-called great circle formula. Each color in the visualization represents a starting city; for example, all green lines measure distances from Perth to other cities. By hovering over a line, the source and destination city, as well as the distance measured in miles (or kilometers), will show.</p>&#13;
    <p class="normal">If you wanted to analyze shipment routes or any other distances between two points, you now know exactly how to visualize this kind of data in Tableau.</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_08.png" alt="Chart, diagram, radar chart&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.8: U.S. Flight Departure Delays</p>&#13;
    <p class="normal">In <em class="italic">Figure 9.8</em>, you can see another, similar visualization, which is definitely worth checking <a/>out (try to replicate it!): <a href="https://www.tableau.com/solutions/workbook/big-data-more-common-now-ever" target="_blank"><span class="url">https://www.tableau.com/solutions/workbook/big-data-more-common-now-ever</span></a>.</p>&#13;
    <p class="normal">In the next section, we will discuss how to leverage a combination of maps and polygons to further extend our Tableau toolbox.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec51">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Creating custom polygons</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Geographic areas for <a/>which Tableau natively provides polygons include worldwide airport codes, cities, countries, regions, territories, states, provinces, and some postcodes and <a/>second-level administrative districts (county-equivalents): U.S. area codes, <strong class="keyWord">Core-Based Statistical Areas</strong> (<strong class="keyWord">CBSAs</strong>), <strong class="keyWord">Metropolitan Statistical Areas</strong> (<strong class="keyWord">MSAs</strong>), congressional districts, and ZIP codes. This means, for<a/> example, that a filled map can easily be created for the countries of the world. Simply copy a list of the world’s countries (<em class="keystroke">Ctrl</em> + <em class="keystroke">C</em>) and paste that list into Tableau by pressing <em class="keystroke">Ctrl</em> + <em class="keystroke">V</em> while your mouse is located on an empty worksheet in Tableau Desktop. A new data source will be added to the top right under <strong class="keyWord">Data</strong>. Next, set the <strong class="keyWord">View</strong> type in Tableau to <strong class="keyWord">Filled Map</strong> and place the country list on the <strong class="keyWord">Detail </strong>shelf. Tableau will automatically draw polygons for each of those data points:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_09.png" alt=""/></figure><p class="packt_figref">Figure 9.9: Native polygons</p>&#13;
    <p class="normal">There are some geographic types for which Tableau will not automatically provide polygons. These <a/>include telephone area codes. For these geographic types, Tableau will draw a symbol map but not a filled map, like so:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_10.png" alt="Map  Description automatically generated"/></figure><p class="packt_figref">Figure 9.10: Filled map failed</p>&#13;
    <p class="normal">Even though the filled map <strong class="keyWord">Marks</strong> type is chosen, Tableau is not able to fill the map because the outlines of those areas are unknown to Tableau. Furthermore, special mapping needs may arise that require polygons to be drawn for areas that are not typically included on maps. For example, an organization may define sales regions that don’t follow the usual <a/>map boundaries. Or, a Tableau author may import an image of a basketball court or football pitch into Tableau and draw polygons to represent particular parts of the playing area. An alternative, which we discussed in more detail in <em class="chapterRef">Chapter 8</em>, <em class="italic">Going Beyond the Basics</em>, could be mapping bookshelves in a store.</p>&#13;
    <p class="normal">But other than drawing polygons yourself, there are also file types that support drawing polygons. One of those file types is <code class="inlineCode">.shp</code>. In the next exercise, we will make use of such a file and create polygons for Texas.</p>&#13;
    <h2 class="heading-2">Polygons for Texas</h2>&#13;
    <p class="normal">By processing an <a/>example of the aforementioned <code class="inlineCode">.shp </code>file type, Tableau can create polygons. Let’s try this out and show the population of Texas as polygons on a map of Texas:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Open the <strong class="keyWord">Texas Department of Transportation</strong> page: <a href="https://gis-txdot.opendata.arcgis.com/datasets/txdot-city-boundaries/explore?location=30.990445%2C-100.168292%2C6.68" target="_blank"><span class="url">https://gis-txdot.opendata.arcgis.com/datasets/txdot-city-boundaries/explore?location=30.990445%2C-100.168292%2C6.68</span></a>.</li>&#13;
      <li class="numberedList">Use the <strong class="keyWord">Download</strong> dropdown and download <strong class="screenText">Shapefile</strong>:&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_11.png" alt=""/></figure><p class="packt_figref">Figure 9.11: Texas data</p>&#13;
    <p class="normal">In your <code class="inlineCode">download</code> directory, you should find multiple files:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_12.png" alt=""/></figure><p class="packt_figref">Figure 9.12: Texas city boundaries</p>&#13;
    <p class="normal">If you were to open a <code class="inlineCode">.shp</code> file in a text editor, you would see the following:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_13.png" alt=""/></figure><p class="packt_figref">Figure 9.13: .shp in a text editor</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Luckily, Tableau <a/>has native capabilities to read <code class="inlineCode">.shp</code> files. In the workbook associated with this chapter, navigate to the <code class="inlineCode">City</code> <code class="inlineCode">Limits</code> worksheet and select <strong class="keyWord">Data</strong> | <strong class="keyWord">New Data Source</strong> | <strong class="keyWord">Text File</strong>.</li>&#13;
      <li class="numberedList">Navigate to your <code class="inlineCode">downloads</code> directory or the path where you saved the Texas shapefiles and select the <code class="inlineCode">.shp</code> file:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_14.png" alt=""/></figure><p class="packt_figref">Figure 9.14: Loading a spatial file</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">In the next screenshot, you can see how Tableau was able to read the <code class="inlineCode">.shp</code> file and how it <a/>created an additional field called <strong class="screenText">Geometry</strong> that indicates that we are looking at polygons and multipolygons in this file:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_15.png" alt=""/></figure><p class="packt_figref">Figure 9.15: Geometry</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Open a new worksheet and drag <strong class="screenText">Geometry</strong> onto the empty canvas:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_16.png" alt=""/></figure><p class="packt_figref">Figure 9.16: Adding geometry</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">And look at that! Tableau created polygons around areas in Texas right away:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_17.png" alt=""/></figure><p class="packt_figref">Figure 9.17: Texas polygons</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Feel free to <a/>adjust the formatting via <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="keyWord">Dark</strong>.</li>&#13;
      <li class="numberedList">Put the <strong class="screenText">City Nm</strong> field on <strong class="screenText">Detail</strong> and <strong class="screenText">Pop2010</strong> on <strong class="screenText">Color</strong> in the <strong class="screenText">Marks</strong> card. (The color used in <em class="italic">Figure 9.17</em> is <strong class="keyWord">Temperature Diverging</strong>.)</li>&#13;
      <li class="numberedList">Your worksheet should look as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_18.png" alt=""/></figure><p class="packt_figref">Figure 9.18: Texas city boundaries</p>&#13;
    <p class="normal">You can see that we have a nice dark map now with polygons on top. The polygons define the area per city name (using the field <strong class="keyWord">City Nm</strong>) as published by the government of Texas. By placing the measure of the population in 2010 (using the field <strong class="keyWord">Pop2010</strong>) on the <strong class="keyWord">Color</strong> shelf, we can also see that the areas with red polygons had the highest number of inhabitants in 2010 and dark green the least.</p>&#13;
    <p class="normal">You might not like <a/>the polygons or maybe you are wondering if a spatial file like a <code class="inlineCode">.shp </code>will only allow you to use polygons. Luckily, the answer is we can change the map, no matter whether it’s a spatial file or not. I really like heatmaps to display geographical density, so let’s use them in the next section.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec52">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Heatmaps</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">I want to share a feature with you that was part of an earlier Tableau release and has proven to be very useful <a/>when working with geographical data. It is the <strong class="keyWord">Marks</strong> type <strong class="keyWord">Density</strong> with which you can create heatmaps. This new feature is not limited to maps; you can also use it for any other type of chart. However, it is most efficient for dense data where patterns cannot be spotted easily.</p>&#13;
    <p class="normal">The following steps will illustrate an example of creating a <strong class="keyWord">heatmap</strong>:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Open the <code class="inlineCode">Citylimits</code> tab in the workbook related to this chapter. If you did not complete the previous exercise, please open the <code class="inlineCode">Citylimits</code> tab from the solutions workbook of this chapter.</li>&#13;
      <li class="numberedList">Duplicate the worksheet, and call it <code class="inlineCode">City Limits (2)</code>.</li>&#13;
      <li class="numberedList">Set the <strong class="screenText">Marks</strong> card type to <strong class="screenText">Density</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_19.png" alt=""/></figure><p class="packt_figref">Figure 9.19: Texas city density</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Click on <strong class="keyWord">Color</strong> in <a/>the <strong class="keyWord">Marks</strong> card and select any color you like. I chose <strong class="keyWord">Density Gold Dark</strong>.</li>&#13;
      <li class="numberedList">Decrease <strong class="screenText">Size</strong> in the <strong class="screenText">Marks</strong> card by dragging the slider to the left. Drag until you like the size of the circles on your map:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_20.png" alt=""/></figure><p class="packt_figref">Figure 9.20: Heatmap</p>&#13;
    <p class="normal">Heatmaps can show you a spatial concentration and are perfect for very dense datasets. In the preceding figure, you can see that we lost the surroundings of the city, the polygon structure; however, we <a/>can still see the densely populated areas and now every city has the same size, making it easier to compare smaller with bigger geographic locations. And we were able to prove that a spatial file does not need to be used with polygons.</p>&#13;
    <p class="normal">In the Tableau 2020.4 release, another feature was added: map layers. What they are and what they are used for will be described in the next section.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec53">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Dual axes and layering maps</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">You might recall that on <a/>many different occasions throughout the previous <a/>chapters, we used dual axes. A dual axis visualization can also be achieved with maps, and, even better, since the Tableau 2020.4 release, maps can be layered. We simply add another layer with the same structure (which, in this case, is a map), and per layer, we can display different data.</p>&#13;
    <p class="normal">We will look at two <a/>exercises, the first one being about the use of dual axes and the second <a/>one including include map layers.</p>&#13;
    <h2 class="heading-2">Using dual axes</h2>&#13;
    <p class="normal">Let’s get <a/>started:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">First, we need a dataset. I simply created one in Excel myself; feel free to create your own, copy what you see in the following screenshot, or download the file from this book’s GitHub repository (<a href="https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/blob/main/Chapter09/Freight.xlsx" target="_blank"><span class="url">https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/blob/main/Chapter09/Freight.xlsx</span></a>). Name the file <code class="inlineCode">freight</code>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_21.png" alt="Graphical user interface, application, table, Excel&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.21: Excel</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Connect the new dataset to Tableau and open a new worksheet called <code class="inlineCode">Dual-axis map</code>.</li>&#13;
      <li class="numberedList">Double-click on <strong class="screenText">Origin Country</strong> and the following map will appear:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_22.png" alt=""/></figure><p class="packt_figref">Figure 9.22: Dual-axis map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Change the <strong class="screenText">Marks</strong> card <a/>type to a filled map and drag <strong class="screenText">Goods</strong> onto the <strong class="screenText">Color</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_23.png" alt=""/></figure><p class="packt_figref">Figure 9.23: Dual-axis map II</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Click on <strong class="screenText">Longitude</strong> in the <strong class="screenText">Columns</strong> shelf, press <em class="keystroke">Ctrl</em> (or <em class="keystroke">Command</em> on Mac), and simultaneously <a/>move the field to its right. You should have copied a second copy of the <strong class="screenText">Longitude</strong> field to the <strong class="screenText">Columns</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_24.png" alt=""/></figure><p class="packt_figref">Figure 9.24: Copying Longitude</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">You can also see that the <strong class="screenText">Marks</strong> card maintains two layers now, plus an additional <strong class="screenText">All</strong> layer, just like dual axes on a bar chart would:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_25.png" alt=""/></figure><p class="packt_figref">Figure 9.25: Marks card</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">On the bottom <a/>layer, replace <strong class="screenText">Goods</strong> with <strong class="screenText">Origin</strong> on the <strong class="screenText">Color</strong> shelf and see how the second map now shows colored dots representing cities:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_26.png" alt=""/></figure><p class="packt_figref">Figure 9.26: Dual-axis map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Click on the right <strong class="screenText">Longitude</strong> field in the <strong class="screenText">Columns</strong> shelf and select <strong class="keyWord">Dual Axis</strong>.</li>&#13;
    </ol><p class="normal">You created your first layered map! Each country’s color represents the types of goods it ships. The dots indicate the cities for train, ship, plane, or truck transport:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_27.png" alt=""/></figure><p class="packt_figref">Figure 9.27: Dual-axis map</p>&#13;
    <p class="normal">After completing the first <a/>basic exercise, we will move on to a more complex one, using the newer map layering functionality.</p>&#13;
    <h2 class="heading-2">Adding map layers</h2>&#13;
    <p class="normal">We want to visualize <a/>the transport routes with a line from the start to the destination city. We also want to show the time to delivery as well as the weight of the shipment. We will continue using the <code class="inlineCode">freight</code> dataset from before; we just need to do some adjustments:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">The <code class="inlineCode">freight</code> dataset does not have longitudes or latitudes, which are crucial for some of Tableau’s spatial calculated fields, like <code class="inlineCode">MAKEPOINT</code>, which we will need later on. Open Google Maps and type in a city from the dataset, for example, <code class="inlineCode">Lisbon</code>. In the URL, you will be able to find the longitude and latitude:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_28.png" alt=""/></figure><p class="packt_figref">Figure 9.28: Google Maps</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Copy them <a/>and add them to a separate Excel sheet, as shown in the following screenshot, and call it <code class="inlineCode">latlong</code>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_29.png" alt="Map&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.29: Excel</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">We needed to use a new Excel sheet because we have to create a spatial field for destinations as well as the origin. Since some cities are an origin as well as a destination, we will create two inner joins; both times, the initial <code class="inlineCode">freight</code> Excel sheet will connect to the recently created <code class="inlineCode">latlong</code> Excel sheet (if you downloaded the data from GitHub, the <code class="inlineCode">latlong</code> table is the second tab in the <code class="inlineCode">Freight.xlsx</code>): </li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_30.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.30: Join</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">The only difference <a/>will be that the first join is made on <strong class="screenText">Origin</strong> and <strong class="screenText">City</strong> and the second on <strong class="screenText">Destination</strong> and <strong class="screenText">City</strong>. Rename the <strong class="screenText">latlong</strong> data sources by double-clicking on the name, to avoid confusion:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_31.png" alt=""/></figure><p class="packt_figref">Figure 9.31: Join II</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Open a new workbook and name it <code class="inlineCode">4-layer map</code>. Create a calculated field called <code class="inlineCode">Line</code>, with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">MAKELINE(MAKEPOINT([Lat (Origin)], [Long (Origin)]), MAKEPOINT([Lat (Destination)], [Long (Destination)]))&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">The Tableau description shows that to make a point based on a spatial location, Tableau needs the longitude and latitude, or coordinates.</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_32.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.32: MAKEPOINT</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Create another <a/>calculated field called <code class="inlineCode">Days to delivery</code>, with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">[Delivered]<span class="hljs-operator">-</span>[Ordered]&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Double-click on <strong class="keyWord">City</strong> from the <strong class="keyWord">Origin</strong> file and a map will appear, but you will encounter <strong class="screenText">12 unknown</strong>. Click on the error and then <strong class="screenText">Edit Locations…</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_33.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.33: Unknown cities</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="9">You will see that Tableau uses <strong class="keyWord">United Kingdom</strong> (it might be different for you) as a default country to find every city, but Tableau is unsuccessful because we have <a/>cities all over Europe in our dataset. Instead of a <strong class="screenText">Fixed</strong> location, use the <strong class="screenText">From field</strong> option and select <strong class="screenText">Origin Country</strong>. Now this field will be used as a country per city in our dataset:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_34.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.34: Origin Country</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">Tableau automatically adds <strong class="screenText">Origin Country</strong> to the view on the <strong class="screenText">Detail</strong> shelf and displays the cities correctly now. You can also achieve the previous step by placing <strong class="screenText">Origin Country</strong> on the <strong class="screenText">Detail</strong> shelf directly:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_35.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.35: Origin cities</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="11">Since one of our goals is to draw lines between the <strong class="keyWord">Origin</strong> and <strong class="keyWord">Destination</strong> cities, it only <a/>makes sense to also add <strong class="keyWord">Destination</strong>, correct? Double-click on <strong class="keyWord">Destination</strong> to add it to the visualization.</li>&#13;
      <li class="numberedList">We now have all <strong class="keyWord">Origin</strong> and <strong class="keyWord">Destination</strong> cities in our view, but we won’t be able to distinguish between them because they are all on the same layer. Therefore, drag the just-added <strong class="screenText">Destination</strong> field from the <strong class="screenText">Detail</strong> shelf to the upper-left corner of your view, until the <strong class="screenText">Add a Marks Layer</strong> sign appears:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_36.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.36: Freight II</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="13">You will now <a/>see that the <strong class="screenText">Marks</strong> card shows two layers:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_37.png" alt="Graphical user interface, text, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.37: Marks</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="14">Rename the <code class="inlineCode">Destination</code> layer to <code class="inlineCode">Destination</code> <code class="inlineCode">Country</code> by double-clicking on the name.</li>&#13;
      <li class="numberedList">Add another layer by dragging <strong class="keyWord">Line</strong> onto <strong class="keyWord">Add a Marks Layer</strong> and add <strong class="screenText">Days to Delivery</strong> to <strong class="screenText">Color</strong>. Name this layer <code class="inlineCode">Line</code> and select the <strong class="screenText">Automatic</strong> type from the <strong class="screenText">Marks</strong> card dropdown:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_38.png" alt="Graphical user interface, text, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.38: Marks layer</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="16">Add another layer <a/>by dragging <strong class="keyWord">City</strong> onto <strong class="keyWord">Add a Marks Layer</strong> and call it <code class="inlineCode">City (2)</code>. Add <strong class="screenText">Destination Country</strong> to <strong class="screenText">Detail</strong>. Select the <strong class="screenText">Automatic</strong> type from the <strong class="screenText">Marks</strong> card dropdown:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_39.png" alt="Graphical user interface, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.39: Marks layer</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="17">Lastly, go back to the <strong class="keyWord">Destination Country</strong> layer, change <strong class="screenText">Destination Country</strong> to <strong class="screenText">Detail</strong>, and put <strong class="screenText">Weight</strong> on <strong class="screenText">Color</strong>. Select <strong class="screenText">Map</strong> from the <strong class="screenText">Marks</strong> card dropdown:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_40.png" alt="Graphical user interface, text, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.40: Marks layer</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="18">Sort by dragging <a/>and dropping the layers in the following order: <strong class="screenText">Line</strong>, <strong class="screenText">City</strong>, <strong class="screenText">City (2)</strong>, and <strong class="screenText">Destination Country</strong>. Your worksheet should now look as follows:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_41.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.41: Map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="19">In order to make the visualization a bit easier to interpret, put <strong class="screenText">Origin</strong> on the <strong class="screenText">Filters</strong> shelf and <a/>select only a few origins of your choosing.</li>&#13;
      <li class="numberedList">And to distinguish the <strong class="keyWord">Origin</strong> from the <strong class="keyWord">Destination</strong>, open the <strong class="keyWord">City</strong> and <strong class="keyWord">City (2)</strong> map layers and change <strong class="keyWord">City</strong> and <strong class="keyWord">City (Destination)</strong> respectively from <strong class="keyWord">Detail</strong> to <strong class="keyWord">Shape</strong>. Select one shape for the <strong class="keyWord">Origin</strong> and another for the <strong class="keyWord">Destination</strong>, for example, filled circles for <strong class="keyWord">Origin</strong> and crosses for <strong class="keyWord">Destination</strong>. You can also color the shapes by clicking on the <strong class="keyWord">Color</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_42.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.42: Final layered map</p>&#13;
    <p class="normal">Now, let’s look at what we have created. We can see that goods are being transported from every circle to a cross city. Both cities are connected by a yellow-to-red range colored line. More yellow-toned means that the delivery was fast, and more red-toned means that the delivery took <a/>longer. The destination country is colored in a turquoise-to-dark-blue color range. The darker the color, the more weight has been transported there. We can easily spot that Italy received the heaviest transport, coming from Istanbul and being delivered within 6 days. The slowest delivery was from Budapest to Warsaw, which took 26 days.</p>&#13;
    <p class="normal">I hope that this exercise showed you the benefits of layered maps. Each layer allows you to use <strong class="keyWord">Color</strong>, <strong class="keyWord">Shape</strong>, <strong class="keyWord">Size</strong>, <strong class="keyWord">Label</strong>, and other <strong class="keyWord">Marks</strong> in its unique way, opening new paths for your analysis. In the next section, we will go even further and use external technology for maps in Tableau.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec54">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Extending Tableau mapping with other technology</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Next, we will consider how to extend Tableau’s mapping capabilities with other tools. Tableau’s developers <a/>were careful to create a mapping <a/>interface that is readily extensible. Some areas of this extensibility, such as connecting to a <strong class="keyWord">Web Map Service</strong> (<strong class="keyWord">WMS</strong>) server, are available directly from the interface; we’ll explore that next.</p>&#13;
    <h2 class="heading-2">Using custom maps with a WMS</h2>&#13;
    <p class="normal">The easiest way <a/>to bring a custom map into Tableau is <a/>directly from Desktop. We need a properly formatted URL that points to a WMS server. Tableau Desktop can connect to any WMS server that supports the WMS 1.0.0, 1.1.0, or 1.1.1 standards.</p>&#13;
    <div class="note">&#13;
      <p class="normal">A good place to find a list of such URLs is <a href="http://directory.spatineo.com" target="_blank"><span class="url">http://directory.spatineo.com</span></a>, which provides information on a ton of different mapping services.</p>&#13;
    </div>&#13;
    <p class="normal">The following exercise was inspired by Jeffrey A. Shaffer’s article <em class="italic">Building weather radar in Tableau in under 1 minute</em>, which can be accessed here: <a href="https://www.dataplusscience.com/TableauWeatherRadar.html" target="_blank"><span class="url">https://www.dataplusscience.com/TableauWeatherRadar.html</span></a>. However, we will include a different map and our source is the <em class="italic">NASA Earth Observation</em> data (<a href="https://neo.gsfc.nasa.gov/" target="_blank"><span class="url">https://neo.gsfc.nasa.gov/</span></a>). In this exercise, we will see that by plotting additional data—in the form of background images—underneath your dataset, you will be able to make better decisions for your business. For example, if your sales figures are dependent on good (or bad) weather or your production is at risk of close-by wildfires, you will be able to see this all in one Tableau dashboard:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Open the workbook associated with this chapter and navigate to the <code class="inlineCode">WMS Server</code> worksheet via the Desktop.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> data source.</li>&#13;
      <li class="numberedList">Place <strong class="keyWord">State/Province</strong> on the <strong class="keyWord">Detail</strong> shelf.</li>&#13;
      <li class="numberedList">Copy the <a href="http://neo.gsfc.nasa.gov/wms/wms" target="_blank"><span class="url">http://neo.gsfc.nasa.gov/wms/wms</span></a> URL, then in Tableau, navigate to <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="screenText">Add WMS Map</strong>. Paste the URL and click <strong class="screenText">OK</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_43.png" alt="Graphical user interface, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.43: Add WMS Map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">In the <strong class="screenText">Marks</strong> card, set the <strong class="screenText">View</strong> type to <strong class="screenText">Map</strong>.</li>&#13;
      <li class="numberedList">Click on <a/>the <strong class="screenText">Color</strong> shelf to turn on <strong class="screenText">Border</strong>, set <a/>the color to white, and set <strong class="screenText">Opacity</strong> to <strong class="screenText">0%</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_44.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.44: Active fires map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">You can now see the active fires from the last month. But, by clicking on <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Layers</strong>, more options will appear. Take a look at the left-hand side of your <a/>screen and select any other info <a/>domain you are interested in; how about <strong class="screenText">Average Land Surface Temperature</strong>?</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_45.png" alt=""/></figure><p class="packt_figref">Figure 9.45: Land Surface Temperature map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Or <strong class="screenText">Cloud Fraction</strong> (don’t forget to first deselect a map before you select a new one):</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_46.png" alt=""/></figure><p class="packt_figref">Figure 9.46: Cloud Fraction map</p>&#13;
    <p class="normal">This feature will give you endless ways to analyze data related to geographic locations. Let’s say you own an online store. You could check if the sale of specific products is higher in specific areas, for example, umbrellas in rainy areas and sun protection in hotter regions. You can then continue to analyze if the market is already satisfied or if it makes sense to invest in marketing for those regions. Or maybe you want to move stock to regions where <a/>more sales are expected due to a weather change. Feel free to <a/>share your findings on Tableau Public and make sure to use the tag <strong class="keyWord">#MasteringTableau</strong>.</p>&#13;
    <div class="note">&#13;
      <p class="normal">Before we proceed, here’s a note on tiling and zooming. Since high-resolution maps may be many gigabytes, it’s impractical to require you to download an entire map in order to zoom in on one small area. Tiles solve this problem by enabling multiple zoom levels. A zoom level of 0 results in a single tile (often a 256 x 256-pixel PNG image) that displays the entire map. As the zoom levels increase, the number of map tiles increases exponentially. Also, a proportionally smaller section of the map displays; that is, as the zoom level increases, the area of the entire map that displays decreases and the total number of tiles required to fill the display remains constant. This helps control the amount of data downloaded at any given time.</p>&#13;
    </div>&#13;
    <p class="normal">Next, we’ll explore Mapbox.</p>&#13;
    <h2 class="heading-2">Exploring Mapbox</h2>&#13;
    <p class="normal">Mapbox provides <a/>custom maps and integrates natively with Tableau. To learn how to build your own custom maps, you can check out its website here: <a href="https://www.mapbox.com/" target="_blank"><span class="url">https://www.mapbox.com/</span></a>. Starting <a/>with Tableau 2019.3, multiple Mapbox styles are even available by default:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_47.png" alt="Graphical user interface, application  Description automatically generated"/></figure><p class="packt_figref">Figure 9.47: Background Maps</p>&#13;
    <p class="normal">Next to that, Mapbox itself provides an extended mapping service with an accompanying web application that enables users to customize maps. This customizability encompasses fonts, colors, background images, and more. Mapbox provides basic services free of charge but, of course, more maps and greater bandwidth needs will require an upgrade with an accompanying fee.</p>&#13;
    <p class="normal">This exercise will <a/>show you how to connect to <strong class="keyWord">Mapbox</strong>:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to <a href="https://www.mapbox.com" target="_blank"><span class="url">https://www.mapbox.com</span></a> and create an account.</li>&#13;
      <li class="numberedList">After completing the signup and logging in to <strong class="keyWord">Mapbox</strong>, click on the <strong class="screenText">Studio</strong> link:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_48.png" alt="Graphical user interface  Description automatically generated"/></figure><p class="packt_figref">Figure 9.48: Mapbox</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Click <strong class="keyWord">New Style</strong> and start creating a map. I chose <strong class="keyWord">Monochrome</strong> | <strong class="keyWord">Dark</strong> | <strong class="keyWord">Customize Monochrome</strong>.</li>&#13;
      <li class="numberedList">The Mapbox editor should open. Adjust the map based on your needs:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_49.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.49: Mapbox integration</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Click <strong class="screenText">Share</strong> (in the top-right corner) once you are done. Select <strong class="screenText">Third party</strong> | <strong class="screenText">Tableau</strong> and copy the URL:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_50.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.50: Mapbox integration</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">In the workbook <a/>associated with this chapter, navigate to the <code class="inlineCode">Mapbox Classic</code> worksheet and select <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="keyWord">Add</strong> <strong class="keyWord">Mapbox Map</strong>.</li>&#13;
      <li class="numberedList">Add a <strong class="keyWord">Style Name</strong> (I used <code class="inlineCode">MasteringTableau</code>) and copy the URL. Click <strong class="keyWord">OK</strong>.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> data source, double-click on <strong class="keyWord">State</strong>, and select the <strong class="keyWord">MasteringTableau</strong> map style via the <strong class="screenText">Map</strong> | <strong class="screenText">Background Maps</strong> | <strong class="screenText">MasteringTableau</strong> path:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_51.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.51: Background Maps</p>&#13;
    <p class="normal">As you can see, Tableau makes use <a/>of the map we previously created in Mapbox. Great! So, this means you can customize your map just the way you like it.</p>&#13;
    <p class="normal">A manual on how to create custom maps and everything else you need to know about Mapbox can be found here: <a href="https://docs.mapbox.com/studio-manual/guides/" target="_blank"><span class="url">https://docs.mapbox.com/studio-manual/guides/</span></a>.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec55">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Swapping maps</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">We will now create a <a/>dashboard that allows the end user to choose between the various maps we just discussed. The technique used for this exercise is <a/>known as <strong class="keyWord">sheet swapping</strong>. However, a deeper dive into this technique is presented in <em class="chapterRef">Chapter 11</em>, <em class="italic">Designing Dashboard and Best Practices for Visualizations</em>.</p>&#13;
    <p class="normal">Let’s look at the necessary steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to the <code class="inlineCode">MapSwap</code> sheet in the workbook associated with this chapter. Double-click on <strong class="keyWord">State</strong>. Set the <strong class="screenText">Marks</strong> card view to <strong class="screenText">Map</strong>, click on <strong class="screenText">Color</strong>, set <strong class="screenText">Opacity</strong> to <strong class="screenText">0%</strong>, and lastly, set <strong class="screenText">Border</strong> to <strong class="screenText">Automatic</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_52.png" alt="A picture containing graphical user interface  Description automatically generated"/></figure><p class="packt_figref">Figure 9.52: Color</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Duplicate the <strong class="keyWord">MapSwap</strong> sheet twice:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_53.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.53: Duplicate MapSwap sheet</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Select the <strong class="keyWord">MapSwap</strong> sheet and navigate to <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="keyWord">Normal</strong>.</li>&#13;
      <li class="numberedList">Select the <strong class="keyWord">MapSwap (2)</strong> sheet and navigate to <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="keyWord">Dark</strong>.</li>&#13;
      <li class="numberedList">Select the <strong class="keyWord">MapSwap (3)</strong> sheet and navigate to <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Maps</strong> | <strong class="keyWord">Satellite</strong>.</li>&#13;
      <li class="numberedList">Create a <a/>parameter called <strong class="screenText">Show Sheet</strong> like so:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_54.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.54: Parameter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Right-click on the parameter in the <strong class="keyWord">Data</strong> pane and select <strong class="keyWord">Show Parameter</strong> <strong class="keyWord">Control</strong>.</li>&#13;
      <li class="numberedList">Create a calculated field called <code class="inlineCode">Show Sheet Filter</code> like the following:&#13;
        <pre class="programlisting code"><code class="hljs-code">[<span class="hljs-keyword">Show</span> Sheet]&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">MapSwap</code> worksheet and place <strong class="screenText">Show Sheet Filter</strong> on the <strong class="screenText">Filters</strong> shelf. Select <strong class="screenText">Select from list</strong> and <strong class="screenText">Normal</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_55.png" alt="A picture containing diagram&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 9.55: Sheet filter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">Select the <code class="inlineCode">MapSwap (2)</code> worksheet and place <strong class="screenText">Show Sheet Filter</strong> on the <strong class="screenText">Filters</strong> shelf. This <a/>time, select <strong class="screenText">Custom value list</strong> and type <code class="inlineCode">Dark</code>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_56.png" alt="Graphical user interface, text, application, chat or text message  Description automatically generated"/></figure><p class="packt_figref">Figure 9.56: Custom value list</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="11">Repeat the previous step on the <code class="inlineCode">MapSwap (3)</code> sheet and type <code class="inlineCode">Satellite</code> instead of <code class="inlineCode">Dark</code>.</li>&#13;
      <li class="numberedList">Create a dashboard and call it <code class="inlineCode">db_MapSwap</code>. Place a vertical container on the dashboard.</li>&#13;
      <li class="numberedList">Place all three <strong class="keyWord">MapSwap</strong> sheets in the vertical container and hide their titles.</li>&#13;
      <li class="numberedList">Select a different map style and see how your map changes:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_57.png" alt="Map  Description automatically generated"/></figure><p class="packt_figref">Figure 9.57: Swap map</p>&#13;
    <p class="normal">You might have seen a <a/>feature like dark/light or day/night backgrounds on your own computer or maybe on websites like YouTube or IDEs like PyCharm. With the <strong class="keyWord">MapSwap</strong> function, you can now offer the same comfort to your users on your Tableau dashboards.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec56">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Custom geocoding</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Before we close this <a/>chapter, I wanted to share a quick tip that I saw on LinkedIn some weeks ago. The post describing the following exercise came from Klaus Schulte, a German professor and 2018 <em class="italic">Iron Viz</em> Champion.</p>&#13;
    <p class="normal">He shared that he had built a grid map by using custom geocoding. Let’s try to replicate it!</p>&#13;
    <p class="normal">Download hex map data somewhere or create it yourself. For this exercise, you can use the hex map data from my Tableau Public or GitHub: <a href="https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/blob/main/Chapter09/hexmap.xlsx" target="_blank"><span class="url">https://github.com/PacktPublishing/Mastering-Tableau-2023-Fourth-Edition/blob/main/Chapter09/hexmap.xlsx</span></a>. If you want to create it yourself, please review the polygon exercise in <em class="chapterRef">Chapter 8</em>, <em class="italic">Going Beyond the Basics</em>. You can create the file the same way we created the book polygons:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Place the <code class="inlineCode">hexmap</code> file in the <code class="inlineCode">Mapsources</code> folder of your Tableau repository.</li>&#13;
      <li class="numberedList">Connect Tableau Desktop to the default <code class="inlineCode">Superstore</code> data.</li>&#13;
      <li class="numberedList">Double-click on <strong class="screenText">State/Province</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_58.png" alt=""/></figure><p class="packt_figref">Figure 9.58: Normal map</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Click on <strong class="keyWord">State/Province</strong> in the <strong class="keyWord">Data</strong> pane and select <strong class="keyWord">Geographic Role</strong> | <strong class="keyWord">Hexmap.xlsx</strong>.</li>&#13;
      <li class="numberedList">Click on <strong class="keyWord">Map</strong> | <strong class="keyWord">Background Layers</strong> and set the <strong class="keyWord">Washout (%)</strong> to <code class="inlineCode">100%</code>.</li>&#13;
      <li class="numberedList">The result will look like this: </li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_09_59.png" alt=""/></figure><p class="packt_figref">Figure 9.59: XX(will be <em class="italic">Figure 9.59</em>)</p>&#13;
    <p class="normal">So why this effort? Because <a/>a grid map distributes the states evenly, if you did this without it, you wouldn’t be able to distinguish between states in close proximity and would miss some far away:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_09_60.png" alt=""/></figure><p class="packt_figref">Figure 9.60: If no grid map</p>&#13;
    <p class="normal">Thank you Klaus for this <a/>great tip! By the way, a hex map is not only applicable to the U.S.. Try it with Europe, Africa, South America, or the <strong class="keyWord">Asia-Pacific</strong> (<strong class="keyWord">APAC</strong>) region as well! Whenever you work with variances in size, a grid map comes in handy.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch09lvl1sec57">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Summary</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">In this chapter, we explored how to extend Tableau’s mapping capabilities without leaving the interface by capturing Tableau-generated latitude and longitude data and how to look this up on Google. We created polygons and a heatmap for Texas based on a <code class="inlineCode">.shp</code> file as well as a dashboard with a dual map axis and another dashboard with 4 map layers. Next, we explored various ways to extend Tableau’s mapping using other technology. We connected to a WMS server and then explored the Mapbox offering, followed by an excursion to the world of polygons.</p>&#13;
    <p class="normal">In the next chapter, we will explore using Tableau for presentations. Specifically, we will look at how to get the best images out of Tableau, how to effectively and efficiently use Tableau with PowerPoint, and how to use Tableau directly for presentations without relying on third-party tools.</p>&#13;
    <h2 class="heading-1">Learn more on Discord</h2>&#13;
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>&#13;
    <p class="normal"><a href="https://packt.link/tableau" target="_blank"><span class="url">https://packt.link/tableau</span></a></p>&#13;
    <p class="normal"><img src="../images/QR_Code2044012316175764640.png" alt=""/></p>&#13;
  </div>&#13;
&#13;
&#13;
</div>&#13;
</section>&#13;
</section>&#13;
</body></html>