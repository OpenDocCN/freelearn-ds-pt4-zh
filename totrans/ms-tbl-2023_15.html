<html><head></head><body>
<section epub:type="chapter">&#13;
<section id="ch15lvl1sec97">&#13;
<div class="epub-source">&#13;
<h1 class="chapterTitle">Integrating Programming Languages</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">After 14 chapters full of Tableau functionality and exercises, what are we still missing? Correct, the one feature that opens a whole new universe of opportunities: programming integration! If you need a function that isn’t covered natively by Tableau’s calculated fields and you know how to code it, you can fall back on programming integrations. To be precise, two languages are supported: R and Python.</p>&#13;
    <p class="normal">Imagine the following scenario: you deal with a financial dataset and want to add an options pricing formula to your Tableau dashboard. You look up the formula and see that you have all the required variables, like strike price, stock price, and volatility, but you also need a probability density function, which you can’t find in Tableau. In this case, you can fall back to the programming integration and run the calculation in R or Python and send back the output—great, isn’t it? Now imagine a second scenario: you’re working on a sentiment analysis project. You could calculate the sentiment in Python outside of Tableau and then use the output as input for your model, but wouldn’t it be great if you could have it all in Tableau? Well, you can by using the programming tool integration.</p>&#13;
    <p class="normal">In this chapter, we will cover the following topics:</p>&#13;
    <ul><li class="bulletList">Integrating programming languages</li>&#13;
      <li class="bulletList">R installation and integration</li>&#13;
      <li class="bulletList">Implementing R functionality</li>&#13;
      <li class="bulletList">Python installation and integration</li>&#13;
      <li class="bulletList">Implementing Python functionality</li>&#13;
    </ul></div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec98">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Integrating programming languages</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">How does integration <a/>empower Tableau? It happens through calculated fields. Tableau dynamically interfaces with Rserve or TabPy to pass values and receive results. And Tableau Prep Builder also has R and Python integration as we saw in <em class="chapterRef">Chapter 3</em>, <em class="italic">Using Tableau Prep Builder</em>! So, let’s not waste any time and jump right in.</p>&#13;
    <p class="normal">Basic Tableau-to-R and Tableau-to-Python integration is quite simple: the view shows data based on a calculated field, with the help of which Tableau pushes data to Rserve or TabPy respectively and then retrieves the results via a table calculation:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_01.png" alt=""/></figure><p class="packt_figref">Figure 15.1: Tableau external services</p>&#13;
    <p class="normal">Naturally, whether you are viewing a workbook on Tableau Desktop or via Tableau Server, if you wish to run R and Python calculations, then Rserve or TabPy must be accessible.</p>&#13;
    <p class="normal">For a proper understanding of the integration, let’s also look at the Tableau/R workflow as an example. The terms <a/>used in the following diagram, which you may be unfamiliar with, will be explained throughout this chapter:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_02.png" alt=""/></figure><p class="packt_figref">Figure 15.2: Tableau/R workflow</p>&#13;
    <p class="normal">The preceding screenshot can be used likewise for Python. Let’s begin with R since it was the first available integration.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec99">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">R installation and integration</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">To adequately understand how Tableau and R work together, it’s important to grasp the big picture. To facilitate that understanding, we’ll cover high-level concepts and information in this section before delving into calculated fields and R scripting details.</p>&#13;
    <p class="normal">Installing R is typically not difficult, but it does involve more than simply double-clicking on an executable. To successfully <a/>connect Tableau with R, you will need to make <a/>sure that permissions are correctly set and that various components—some required and some that are just nice to have—are correctly implemented. We will cover the basics, review a couple of the typical challenges faced during installation, and provide troubleshooting guidance.</p>&#13;
    <p class="normal">Perform the following steps to install R:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Download R by visiting <a href="http://www.r-project.org/" target="_blank"><span class="url">http://www.r-project.org/</span></a>, click on the <strong class="keyWord">download R</strong> hyperlink, and choose a CRAN mirror. Note that R works best in a Linux or Unix environment; however, to learn R and begin working with Tableau/R functionality to complete the exercises in this chapter, installing the Windows version is adequate.</li>&#13;
      <li class="numberedList">Install R by double-clicking on the downloaded executable.</li>&#13;
      <li class="numberedList">Open R.</li>&#13;
    </ol><p class="normal">Various issues may <a/>arise when installing R. For example, you may experience problems due to insufficient permissions for the R working directory. This issue may first become <a/>evident when attempting to install R packages. To rectify the problem, determine the working directory in R with the <code class="inlineCode">getwd()</code> function. Next, either change the working directory via <code class="inlineCode">setwd()</code> or, at the operating system level—whichever you feel more comfortable with—set the appropriate read and execute permissions for the working directory.</p>&#13;
    <p class="normal">Issues can also arise due to security system and port configuration problems. By default, Tableau will connect to Rserve via port <code class="inlineCode">6311</code>. Alternatively, within Tableau, you can specify a different port when connecting to R.</p>&#13;
    <div class="note">&#13;
      <p class="normal">The documentation at <a href="http://www.r-project.org/" target="_blank"><span class="url">http://www.r-project.org/</span></a> provides detailed information regarding overcoming a variety of installation challenges.</p>&#13;
    </div>&#13;
    <p class="normal">Although not required, RStudio Desktop provides a better user interface than the default R GUI that installs with R. RStudio includes a console that features intelligent code completion (that is, IntelliSense), a workspace browser that provides easy access to files, packages, and help, a data viewer, and much more all within a single, unified environment:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_03.png" alt=""/></figure><p class="packt_figref">Figure 15.3: RStudio</p>&#13;
    <p class="normal">The open-source edition of RStudio is <a/>sufficient for many uses. You can download the application via <a href="https://posit.co/download/rstudio-desktop/" target="_blank"><span class="url">https://posit.co/download/rstudio-desktop/</span></a>. Just choose for yourself which one <a/>you like better out of the Desktop and R GUI versions.</p>&#13;
    <p class="normal">Open R:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_04.png" alt=""/></figure><p class="packt_figref">Figure 15.4: R GUI</p>&#13;
    <p class="normal">To establish a connection <a/>with Tableau, you will need to start Rserve. Technically, Rserve is a separate package; however, by default, it is installed with R:</p>&#13;
    <ul><li class="bulletList">To make sure that the Rserve package is installed, within R, enter the following command:&#13;
        <pre class="programlisting code"><code class="hljs-code">rownames<span class="hljs-punctuation">(</span>installed.packages<span class="hljs-punctuation">())</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="bulletList">Several packages should be listed, including RServe. If for some reason the Rserve package did not install with your instance of R, you can do so via:&#13;
        <pre class="programlisting code"><code class="hljs-code">install.packages<span class="hljs-punctuation">(</span><span class="hljs-string">"Rserve"</span><span class="hljs-punctuation">)</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="bulletList">To start <code class="inlineCode">Rserve</code>, enter <code class="inlineCode">library(Rserve); Rserve()</code>.</li>&#13;
    </ul><p class="normal">The semicolon (<code class="inlineCode">;</code>) represents a new line of code in R:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_05.png" alt=""/></figure><p class="packt_figref">Figure 15.5: Rserve initialization </p>&#13;
    <p class="normal">Now that you have <a/>successfully installed R and started Rserve, you are ready to connect Tableau <a/>to R. Within Tableau, select <strong class="screenText">Help</strong> | <strong class="screenText">Settings and Performance</strong> | <strong class="screenText">Manage Analytics Extension Connection…</strong>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_06.png" alt=""/></figure><p class="packt_figref">Figure 15.6: Analytics Extension</p>&#13;
    <p class="normal">The <strong class="screenText">Manage Analytics Extensions Connection</strong> screen will open; select <strong class="screenText">RServe</strong>. The default settings in the <a/>following screenshot will <a/>work for most local installations:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_07.png" alt=""/></figure><p class="packt_figref">Figure 15.7: Analytics Extensions connection</p>&#13;
    <p class="normal">While integrating Tableau with R doesn’t require any interaction with an R interface, you will probably want to try out your R code in a GUI, such as R GUI or RStudio, before embedding the code <a/>into Tableau. This will allow you to take advantage of useful <a/>accompanying features relevant to the R language, such as help, examples, and sample datasets tailored to R. Note that the calculated field editor in Tableau simply acts as a pass-through for R code and does not provide any support.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec00">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Implementing R functionality</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Now that we <a/>have successfully connected Tableau with R, let’s write some code in Tableau to invoke R. Within Tableau, open the <strong class="keyWord">Calculated Field Editor</strong>. Notice the class of functions beginning with <code class="inlineCode">SCRIPT_</code>, as shown in the following screenshot:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_08.png" alt=""/></figure><p class="packt_figref">Figure 15.8: SCRIPT_ functions</p>&#13;
    <p class="normal">The <code class="inlineCode">SCRIPT_</code> functions are used by Tableau to invoke R. The function names communicate the data type of the returned results; <code class="inlineCode">SCRIPT_REAL</code> returns float values, <code class="inlineCode">SCRIPT_BOOL</code> returns true or <a/>false values, and so forth.</p>&#13;
    <p class="normal">The syntax of a <code class="inlineCode">SCRIPT_</code> function is represented in the following diagram:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_09.png" alt=""/></figure><p class="packt_figref">Figure 15.9: R script syntax</p>&#13;
    <p class="normal">The preceding <a/>example code calculates the average profit, but we will get to more examples in the next sections. Let’s start by reproducing Tableau functionality using the R integration and hence prove that R is working properly.</p>&#13;
    <h2 class="heading-2">Reproducing native Tableau functionality in R</h2>&#13;
    <p class="normal">For our first <a/>exercise, we will use the <code class="inlineCode">AVG</code>, <code class="inlineCode">MEDIAN</code>, and <code class="inlineCode">STDEV</code> functions in Tableau and compare the results with the <code class="inlineCode">mean</code>, <code class="inlineCode">median</code>, and <code class="inlineCode">sd</code> R functions. This <a/>will allow you to practice the <code class="inlineCode">SCRIPT_</code> functions, begin to understand R syntax, and compare the results generated by Tableau with those generated by R.</p>&#13;
    <p class="normal">Perform the following steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to <a href="https://public.tableau.com/profile/marleen.meier/" target="_blank"><span class="url">https://public.tableau.com/profile/marleen.meier/</span></a> to locate and download the workbook associated with this chapter.</li>&#13;
      <li class="numberedList">Navigate to the <code class="inlineCode">median | mean | sd</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> data source.</li>&#13;
      <li class="numberedList">Create the following Tableau-centric calculations:<ul><li class="bulletList"><code class="inlineCode">Tab Avg</code>: <code class="inlineCode">WINDOW_AVG(SUM(Sales))</code></li>&#13;
          <li class="bulletList"><code class="inlineCode">Tab Median</code>: <code class="inlineCode">WINDOW_MEDIAN(SUM(Sales))</code></li>&#13;
          <li class="bulletList"><code class="inlineCode">Tab Stdev</code>: <code class="inlineCode">WINDOW_STDEV(SUM(Sales))</code></li>&#13;
        </ul></li>&#13;
      <li class="numberedList">Place the <strong class="screenText">Region</strong> dimension on the <strong class="screenText">Rows</strong> shelf and <strong class="screenText">Sales</strong> on the <strong class="screenText">Text</strong> shelf.</li>&#13;
      <li class="numberedList">Double-click on <strong class="screenText">Tab Avg</strong>, <strong class="screenText">Tab Median</strong>, and <strong class="screenText">Tab Stdev</strong>. They will now appear on the <strong class="screenText">Measures Values</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_10.png" alt=""/></figure><p class="packt_figref">Figure 15.10: Testing R</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Make sure <a/>R is installed, connected, <a/>and running as per the instructions in the <em class="italic">R installation and integration</em> section.</li>&#13;
      <li class="numberedList">If you haven’t installed the <code class="inlineCode">Rserve</code> package yet, type <code class="inlineCode">install.packages("Rserve")</code> into your R interface to install the <code class="inlineCode">Rserve</code> package.</li>&#13;
      <li class="numberedList">Next, type <code class="inlineCode">library(Rserve); Rserve()</code> into the R interface. You may see the following error:&#13;
        <pre class="programlisting code"><code class="hljs-code">Fatal error<span class="hljs-operator">:</span> you must specify <span class="hljs-string">'--save'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'--no-save'</span> or <span class="hljs-string">'--vanilla'</span>&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">In this case, type <code class="inlineCode">Rserve(args = "--no-save")</code>. R requires you to make a choice of saving, not saving, or a combination (vanilla) after your session ends (not saving is my preferred option but the other two will work too).</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">Connect R to Tableau as demonstrated in the <em class="italic">R installation and integration</em> section. After <a/>you have done so, return <a/>to Tableau and click the <strong class="screenText">Test Connection</strong> button to see if it works:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_11.png" alt=""/></figure><p class="packt_figref">Figure 15.11: Testing R connection</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="11">Click <strong class="screenText">OK</strong> to close the windows.</li>&#13;
      <li class="numberedList">Create the following R-centric calculations in Tableau. Note that R functions (such as <code class="inlineCode">mean</code>) are case-sensitive:<ul><li class="bulletList"><code class="inlineCode">R</code> <code class="inlineCode">-</code> <code class="inlineCode">mean</code>: <code class="inlineCode">SCRIPT_INT("mean(.arg1)", SUM(Sales))</code></li>&#13;
          <li class="bulletList"><code class="inlineCode">R</code> <code class="inlineCode">-</code> <code class="inlineCode">median</code>: <code class="inlineCode">SCRIPT_REAL ("median(.arg1)", SUM(Sales))</code></li>&#13;
          <li class="bulletList"><code class="inlineCode">R</code> <code class="inlineCode">-</code> <code class="inlineCode">sd</code>: <code class="inlineCode">SCRIPT_INT("sd(.arg1)", SUM(Sales))</code></li>&#13;
        </ul></li>&#13;
      <li class="numberedList">Place each of the R-calculated fields on the <strong class="screenText">Measure Values</strong> shelf and arrange them so that the same types of calculations are next to each other but alternating Tableau and R-centric; for example, <strong class="screenText">Tab Avg</strong> then <strong class="screenText">R – mean</strong> then <strong class="screenText">Tab Median</strong> then <strong class="screenText">R – median</strong> and so on. Since <code class="inlineCode">SCRIPT_</code> functions are categorized as table calculations (more on that later), be sure that each instance of the R-calculated fields as well as the Tableau-calculated fields use <strong class="keyWord">Compute Using</strong> set to <strong class="keyWord">Table (Down)</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_12.png" alt=""/></figure><p class="packt_figref">Figure 15.12: Tableau versus R output</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="14">Observe that the Tableau and R functions show identical results.</li>&#13;
    </ol><p class="normal">Note that <code class="inlineCode">INT</code> has been replaced with <code class="inlineCode">REAL</code> in the median calculations, demonstrating that, as the <a/>names suggest, <code class="inlineCode">SCRIPT_REAL</code> uses float <a/>values and <code class="inlineCode">SCRIPT_INT</code> uses integers. In the case of the median, the <code class="inlineCode">SCRIPT_INT</code> function results in a rounding difference – try it out and see for yourself!</p>&#13;
    <p class="normal">This was our very first exercise with R integration—easy, right? The purpose of this exercise was mainly to show you that the R calculation works and therefore we compared three of the same calculations, each one calculated by Tableau as well as R. Or in other words, replicating Tableau functionality to prove that the R integration works as expected. The next exercise will be something that we can’t do with Tableau’s built-in functionality (as of the time of writing). We are going to calculate a regression analysis with more than two variables.</p>&#13;
    <h2 class="heading-2">Using R for regression calculations</h2>&#13;
    <p class="normal">Succinctly stated, regression analysis is a technique for estimating variable relationships. There are several <a/>types of regression analyses, the most popular of which is linear regression. As demonstrated in the following screenshot, linear regression estimates a line that best fits the data and is a built-in function in Tableau.</p>&#13;
    <p class="normal">You only need two measures on <strong class="keyWord">Rows</strong> and <strong class="keyWord">Columns</strong> as well as a dimension to partition the points in your view. Then, you go to <strong class="keyWord">Analysis</strong> and drag the <strong class="keyWord">Trend Line</strong> onto your screen and select <strong class="keyWord">Linear</strong>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_13.png" alt=""/></figure><p class="packt_figref">Figure 15.13: Scatterplot</p>&#13;
    <p class="normal">Notice that this screenshot is from Tableau. You can access it by clicking on the <strong class="keyWord">Scatterplot</strong> worksheet in the workbook associated with this chapter. It’s a simple scatterplot with trend lines turned on. Trend lines, in Tableau, default to linear but also include logarithmic, exponential, and polynomial options, which are all examples of regression analysis. By accessing <strong class="keyWord">Worksheet</strong> | <strong class="keyWord">Export</strong> | <strong class="keyWord">Data</strong> in a visualization utilizing a trend line, you can generate an <strong class="keyWord">Access</strong> database with predictions and residuals for marks on the view. But this is a tedious process and does not give a robust, dynamic solution for implementing more vigorous uses of linear regression. Using R provides much more flexibility.</p>&#13;
    <p class="normal">Linear regression may use single or multiple variables. Single-variable equations are great for learning, but multiple-variable equations are typically necessary for real-world applications. The following exercise includes multiple-variable equations. Our goal for this exercise is to <a/>determine how closely a linear regression model of <strong class="keyWord">Profit</strong> fits <code class="inlineCode">COUNT(Quantity)</code>, <code class="inlineCode">SUM(Sales)</code>, and <code class="inlineCode">AVG(Discount)</code>:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to the <code class="inlineCode">Regression</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> data source.</li>&#13;
      <li class="numberedList">Build the basic layout by placing <strong class="keyWord">Profit</strong> on the <strong class="keyWord">Columns</strong> shelf and <strong class="keyWord">State</strong> on the <strong class="keyWord">Rows</strong> shelf and filtering to <strong class="screenText">Top 10</strong> by <strong class="screenText">Sum</strong> of <strong class="screenText">Profit</strong> by placing <strong class="keyWord">State </strong>on the<strong class="keyWord"> Filters</strong> shelf as well:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_14.png" alt=""/></figure><p class="packt_figref">Figure 15.14: Filter top 10</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Create a calculated field entitled <code class="inlineCode">Profit_Expected</code> utilizing the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL(" &#13;
x &lt;- lm(.arg1 ~ .arg2 + .arg3 + .arg4) &#13;
x$fitted",&#13;
<span class="hljs-built_in">SUM</span>(Profit), <span class="hljs-built_in">COUNT</span>(Quantity), <span class="hljs-built_in">SUM</span>(Sales), <span class="hljs-built_in">AVG</span>(Discount)&#13;
)&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">The details of this function will be explained shortly.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Create a calculated field entitled <code class="inlineCode">% Diff</code> that calculates the percent difference between <code class="inlineCode">SUM</code>(<code class="inlineCode">Profit</code>) and <code class="inlineCode">Profit_Expected</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-built_in">SUM</span>(Profit)<span class="hljs-operator">/</span>Profit_Expected <span class="hljs-operator">-</span> <span class="hljs-number">1</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Create a calculated field entitled <code class="inlineCode">Profit_Expected (residuals)</code> to return the difference between <code class="inlineCode">SUM</code><strong class="keyWord">(</strong><code class="inlineCode">Profit</code><strong class="keyWord">)</strong> and <code class="inlineCode">Profit_Expected</code> in terms of dollars:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL(" &#13;
x &lt;- lm(.arg1 ~ .arg2 + .arg3 + .arg4) &#13;
x$residuals", &#13;
<span class="hljs-built_in">SUM</span>(Profit),<span class="hljs-built_in">COUNT</span>(Quantity), <span class="hljs-built_in">SUM</span>(Sales), <span class="hljs-built_in">AVG</span>(Discount))&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Profit_Expected</strong> on the <strong class="keyWord">Columns</strong> shelf, next to<strong class="keyWord"> Profit</strong>. Then, click on either one and enable <strong class="keyWord">Dual Axis</strong>.</li>&#13;
      <li class="numberedList">Right-click on one axis and select <strong class="keyWord">Synchronize Axis</strong>.</li>&#13;
      <li class="numberedList">In the <strong class="keyWord">SUM(Profit)</strong> section on the <strong class="keyWord">Marks</strong> card, move <strong class="keyWord">% Diff</strong> onto the <strong class="keyWord">Color</strong> shelf. Select the <strong class="screenText">Red-Black Diverging</strong> palette as well as <code class="inlineCode">2</code> <strong class="screenText">Steps</strong> in <strong class="screenText">Stepped Color</strong>. This <a/>way, all positive values will be black and all negative ones red. Make sure that <strong class="screenText">Bar</strong> is selected as the view type.</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_15.png" alt=""/></figure><p class="packt_figref">Figure 15.15: Color coding</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">From the menu, select <strong class="keyWord">Analysis</strong> | <strong class="keyWord">Stack Marks</strong> | <strong class="keyWord">Off</strong>.</li>&#13;
      <li class="numberedList">In the <strong class="keyWord">Profit_Expected</strong> section on the <strong class="keyWord">Marks </strong>card, move <strong class="keyWord">Profit_Expected (residuals)</strong>, <strong class="keyWord">% Diff</strong>, and<strong class="keyWord"> Profit_Expected </strong>to the<strong class="keyWord"> Label</strong> shelf. Make sure that <strong class="keyWord">Gantt Bar</strong> is selected as the view type.</li>&#13;
      <li class="numberedList">Double-check that all table calculations (indicated by the triangle sign: <strong class="screenText">Profit_Expected (residuals)</strong>, <strong class="screenText">% Diff</strong>, and <strong class="screenText">Profit_Expected</strong>) are using <strong class="keyWord">State</strong> for the computation:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_16.png" alt=""/></figure><p class="packt_figref">Figure 15.16: Compute using</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="13">Click on <strong class="screenText">Label</strong> and <a/>the three dots in the <strong class="screenText">Text</strong> section and edit the label to your liking:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_17.png" alt=""/></figure><p class="packt_figref">Figure 15.17: Expected profits</p>&#13;
    <p class="normal">Adjust the size of the <strong class="keyWord">Bar</strong> and <strong class="keyWord">Gantt Bar</strong> as desired and observe the results:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_18.png" alt=""/></figure><p class="packt_figref">Figure 15.18: Regression</p>&#13;
    <p class="normal">The visualization in <em class="italic">Figure 15.18</em> shows a comparison of the actual profit, the expected profit, and the difference between the two. This calculation is especially helpful in retail markets but also in financial planning for any company.</p>&#13;
    <p class="normal">Now that we’ve <a/>completed the exercise, let’s take a moment to consider some of the code we used in this exercise:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau function calls the R engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">"x &lt;- lm(.arg1 ~ .arg2 +.arg3+.arg4); x$residuals"</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is an R expression that houses a variable, a function, and an argument, and then returns predicted values.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">x &lt;-</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is the variable to be populated by the subsequent R function.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">lm(.arg1 ~ .arg2 + .arg3 +.arg4)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This R function is used to fit linear models. It can be used to return regression based on variables provided by the argument.</p>&#13;
            <p class="normal">The information in the parentheses is called an argument and is used to fit the model. Specifically, the response is to the left of the tilde (<code class="inlineCode">~</code>), and the model is to the right. Thus, this is a multi-variable linear regression where <code class="inlineCode">.arg1 =</code> <code class="inlineCode">SUM(Profit)</code>, <code class="inlineCode">.arg2 = COUNT(Quantity)</code>, <code class="inlineCode">.arg3 = SUM(Sales)</code>, and <code class="inlineCode">.arg4 = AVG(Discount)</code>. In English, the argument could be read as <code class="inlineCode">SUM(Profit)</code>, and is modeled as the combined terms of <code class="inlineCode">COUNT(Quantity)</code>, <code class="inlineCode">SUM(Sales)</code>, and <code class="inlineCode">AVG(Discount)</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">x$fitted</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">The <code class="inlineCode">lm</code> function returns many values as part of its model object, including coefficients, residuals, rank, and fitted values. <code class="inlineCode">x$fitted</code> is referencing the fitted values generated as a result of passing data to the model.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">", SUM(Profit), COUNT(Quantity), SUM(Sales) , AVG(Discount))</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">These are the parameters used to populate the <code class="inlineCode">.arg#</code> variables. Note that the double-quote (<code class="inlineCode">"</code>) designates the end of the code passed to R, and the comma (<code class="inlineCode">,</code>) designates the second half of the Tableau function, that is, the expression.</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">After having successfully <a/>implemented the regression, we will now investigate a different statistical method that is often used to differentiate between subsets within a dataset, called clustering.</p>&#13;
    <h2 class="heading-2">Clustering in Tableau using R</h2>&#13;
    <p class="normal">Clustering is used to select smaller subsets of data with members sharing similar characteristics <a/>from a larger dataset. As an example, consider <a/>a marketing scenario. You have a large customer base to which you plan to send advertising material; however, cost prohibits you from sending material to every customer. Clustering the dataset will return groupings of customers with similar characteristics. You can then survey the results and choose a target group.</p>&#13;
    <p class="normal">Major methods for clustering include hierarchical and <em class="italic">k</em>-means. Hierarchical clustering is more thorough and thus more time-consuming. It generates a series of models that range from <em class="italic">1</em>, which includes all data points, to <em class="italic">n</em>, where each data point is an individual model. <em class="italic">k</em>-means clustering is a quicker method in which the user or another function defines the number of clusters. For example, a user may choose to create four clusters from a dataset of a thousand members.</p>&#13;
    <p class="normal">Clustering capabilities are included with Tableau. You can find this functionality under the <strong class="keyWord">Analytics</strong> tab. The clustering implementation in Tableau is based on four pillars:</p>&#13;
    <ul><li class="bulletList">Solid methodology</li>&#13;
      <li class="bulletList">Repeatable results</li>&#13;
      <li class="bulletList">A quick processing time</li>&#13;
      <li class="bulletList">Ease of use</li>&#13;
    </ul><p class="normal">Be sure to check out more details here (<a href="https://help.tableau.com/current/pro/desktop/en-us/clustering.htm" target="_blank"><span class="url">https://help.tableau.com/current/pro/desktop/en-us/clustering.htm</span></a>) and the tab <strong class="keyWord">Clustering (Tableau native)</strong> in the accompanying solutions workbook.</p>&#13;
    <p class="normal">There are numerous ways the Tableau development team could have approached clustering. R, for instance, provides many different clustering packages that use different approaches. A Tableau author may have good reason to choose one of these different approaches. For example, clustering results are always identical when using the native Tableau clustering capabilities. But they do not have to be. By using R for clustering, the <a/>underlying data and the view may remain <a/>unchanged, yet clustering could differ with each refresh because the function will stop at the best result (local minimum) before it has seen the whole dataset. The trade-off between using a so-called local minimum versus a global minimum for performance has been proven to be worth it. But depending on the order of numbers, the local minimum can differ each time you run the function. This could be advantageous to you if looking for edge cases where marks may switch between clusters. The following example explores such a case.</p>&#13;
    <p class="normal">Our goal in this exercise is to create four clusters out of the countries of the world based on birth rate and infant mortality rate:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to the <code class="inlineCode">Cluster (R)</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">World Indicators</code> data source (this dataset ships with Tableau and can be found under <strong class="keyWord">Saved Data Sources</strong>).</li>&#13;
      <li class="numberedList">Build the initial view by placing <strong class="screenText">Infant Mortality Rate</strong> on the <strong class="screenText">Columns</strong> shelf, <strong class="screenText">Birth Rate</strong> on the <strong class="screenText">Rows</strong> shelf, and <strong class="screenText">Country/Region</strong> on the <strong class="screenText">Details</strong> shelf.&#13;
    <p class="normal">Right-click on each axis and select <strong class="screenText">Logarithmic</strong> and deselect <strong class="screenText">Include Zero</strong>. This will spread the data points more uniformly and will help make the visualization more aesthetically pleasing and easier to read:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_19.png" alt=""/></figure><p class="packt_figref">Figure 15.19: Clustering</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Create a <a/>calculated field named <code class="inlineCode">Cluster</code> with <a/>the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_INT("&#13;
m &lt;- cbind(.arg1, .arg2); &#13;
kmeans(m,4,nstart=5)$cluster",&#13;
<span class="hljs-built_in">AVG</span>( [Life Expectancy Female] ), <span class="hljs-built_in">AVG</span>([Life Expectancy Male]))&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">The details of this code will be explained at the end of this exercise.</p>&#13;
    <p class="normal">Drag the <strong class="keyWord">Cluster</strong> field you just created to the <strong class="keyWord">Detail</strong> and the <strong class="keyWord">Color</strong> shelves. Note that the Rserve engine throws an error:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_20.png" alt=""/></figure><p class="packt_figref">Figure 15.20: Error handling</p>&#13;
    <p class="normal">This is because nulls exist in the underlying dataset. For example, the data does not include the <strong class="keyWord">Infant Mortality Rate</strong> for <em class="italic">Puerto Rico</em>.</p>&#13;
    <div class="note">&#13;
      <p class="normal">If you encounter this error with other measures, the same solution applies.</p>&#13;
    </div>&#13;
    <p class="normal">To rectify the <a/>error, drag an instance of <strong class="keyWord">Infant</strong> <strong class="keyWord">Mortality Rate</strong> <a/>onto the <strong class="keyWord">Filters</strong> shelf. Within the <strong class="keyWord">Filter</strong> dialog box, select the values as shown to remove all values below <code class="inlineCode">0.01</code>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_21.png" alt="Graphical user interface, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.21: Filter</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Make sure that you set <strong class="keyWord">Cluster</strong> to <strong class="keyWord">Discrete</strong> and <strong class="keyWord">Compute Using</strong> | <strong class="keyWord">Country/Region</strong> to avoid another error: <em class="italic">error in k-means (m, 4, nstart = 5): more cluster centers than distinct data points</em>.</li>&#13;
      <li class="numberedList">The resulting <a/>view should look like the <a/>following screenshot:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_22.png" alt="Chart, scatter chart&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.22: Clustering</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Press <em class="keystroke">F5</em> and observe that the clustering changes with each refresh.</li>&#13;
    </ol><p class="normal">Now that we’ve completed the exercise, let’s take a moment to consider some of the code we saw:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau functions calls the R engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">"m &lt;- cbind(.arg1, .arg2); kmeans(m,4,nstart=1)$cluster"</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is the R expression that houses a variable, a function, and an argument, and then returns clusters.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">m &lt;-</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is the variable to be populated by the subsequent R function.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">cbind</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This R function combines the following <code class="inlineCode">.arg#</code> variables into columns.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">(.arg1, .arg2)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">The variables within the parentheses are referred to as an argument. Each variable contains vector information. Specifically, <code class="inlineCode">.arg1 = AVG( [Infant Mortality Rate] )</code> and <code class="inlineCode">.arg2 = AVG([Birth Rate])</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">kmeans(m,4,nstart=1)$cluster"</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">kmeans</code> declares the method of clustering. <code class="inlineCode">m</code> contains the vector created by the <code class="inlineCode">cbind</code> argument. The <code class="inlineCode">4</code> integer declares the number of clusters. <code class="inlineCode">nstart</code> declares the number of random sets.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">", AVG( [Infant Mortality Rate] ), AVG([Birth Rate]))</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">These are the parameters used to populate the <code class="inlineCode">.arg#</code> variables. Note that the double-quote (<code class="inlineCode">"</code>) designates the end of the code passed to R, and the comma (<code class="inlineCode">,</code>) designates the second half of the Tableau function, that is, the expression.</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">What did we achieve? Well, we were able to categorize the countries in our dataset into four subgroups, based <a/>on life expectancy. We show the results of <a/>the clustering on a scatterplot with the two measures, infant mortality, and birth rate. This way, we can indirectly analyze four measures at the same time, which in this case are <strong class="keyWord">Infant Mortality Rate</strong>, <strong class="keyWord">Birth Rate</strong>, <strong class="keyWord">Country/Region</strong>, and <strong class="keyWord">Life Expectancy</strong>. The R clustering is based on a <em class="italic">k</em>-means approach, which differs from the Tableau default clustering and can be adjusted to any approach that it is possible to execute in R.</p>&#13;
    <p class="normal">Next, we are going to check out the world of quantiles.</p>&#13;
    <h2 class="heading-2">Introducing quantiles</h2>&#13;
    <p class="normal">Quantiles are often considered synonymous with quartiles. They are not. Quantiles are the sets that make <a/>up an evenly divided population of values. A quartile is a type of quantile—as is a quintile, a tercile, and a decile, for example. To understand how <a/>quantiles evenly divide a population of values, imagine multiplying a population by 1/4, 2/4, 3/4, and 4/4, and you get 4 quartiles. To get quintiles, you multiply the population by 1/5, 2/5, 3/5, 4/5, 5/5, and so forth.</p>&#13;
    <p class="normal">Tableau allows you to view quantiles by right-clicking on an axis and choosing <strong class="screenText">Add Reference Line</strong> | <strong class="screenText">Distribution</strong> | <strong class="screenText">Computation</strong> | <strong class="screenText">Quantiles</strong>:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_23.png" alt=""/></figure><p class="packt_figref">Figure 15.23: Terciles</p>&#13;
    <p class="normal">But you can also change the number of tiles to 4, 5, or any other number to create quartiles, quintiles, and so on. The functionality of quantiles thus accessed, however, is quite limited. Primarily, this is because reference lines do not generate measures that can be placed on shelves. This limits the visualization options. Generating quantiles via R greatly expands those options.</p>&#13;
    <p class="normal">Our goal for this exercise is to create <em class="italic">n</em> quantiles through R to view the customer distribution by sales. We will further expand the exercise by creating parameters that restrict the number <a/>of members in the total dataset to a given percentile range. Finally, we will fine-tune the visualization by adding jittering.</p>&#13;
    <p class="normal">Let’s have a look at the following steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to the <code class="inlineCode">Quantiles</code> worksheet.</li>&#13;
      <li class="numberedList">Select the <code class="inlineCode">Superstore</code> data source.</li>&#13;
      <li class="numberedList">Change the view type to <strong class="screenText">Shape</strong> on the <strong class="screenText">Marks</strong><strong class="keyWord"> </strong>card.</li>&#13;
      <li class="numberedList">Drag <strong class="screenText">Sales</strong> to the <strong class="screenText">Rows</strong> shelf, <strong class="screenText">Customer Name</strong> to the <strong class="screenText">Details</strong> shelf, and <strong class="screenText">Region</strong> to the <strong class="screenText">Color</strong> shelf:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_24.png" alt=""/></figure><p class="packt_figref">Figure 15.24: Quantiles</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Create and display a parameter entitled <code class="inlineCode">Number of quantiles</code> with the following settings:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_25.png" alt=""/></figure><p class="packt_figref">Figure 15.25: Quantile parameter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="6">Right-click on the created parameter and select<strong class="keyWord"> Show Parameter</strong>.</li>&#13;
      <li class="numberedList">Create a <a/>calculated field entitled <code class="inlineCode">Quantiles</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL("&#13;
x &lt;- .arg1;&#13;
y &lt;- .arg2[1];&#13;
m &lt;- c(1:y)/y;&#13;
n &lt;- length(x);&#13;
z &lt;- c(1:n); for (i in c(1:n)) z[i] &lt;- 0;&#13;
for (j in c(1:y)) for (i in c(1:n)) z[i] &lt;- if (x[i] &lt;= quantile(x,m)[j] &amp;&amp; z[i] == 0 ) j else z[i];&#13;
z;"&#13;
, <span class="hljs-built_in">SUM</span>(Sales), [Number <span class="hljs-keyword">of</span> quantiles])&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">The details of this code will be explained at the end of this exercise.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">Right-click on the newly created calculated field <code class="inlineCode">Quantiles</code> and select <strong class="keyWord">Convert</strong> <strong class="keyWord">to Discrete</strong>.</li>&#13;
      <li class="numberedList">Create and display two parameters, <strong class="screenText">Select Percentile Bottom Range</strong> and <strong class="screenText">Select Percentile Top Range</strong>. Use the following settings for both:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_26.png" alt=""/></figure><p class="packt_figref">Figure 15.26: Percentile parameter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="10">Right-click on both newly created parameters and select <strong class="keyWord">Show Parameter</strong>.</li>&#13;
      <li class="numberedList">Create a <a/>calculated field entitled <code class="inlineCode">Percentile</code> with the following code:&#13;
        <pre class="programlisting code"><code class="hljs-code">RANK_PERCENTILE(<span class="hljs-built_in">SUM</span>([Sales])) <span class="hljs-operator">&lt;</span> [<span class="hljs-keyword">Select</span> Percentile Top <span class="hljs-keyword">Range</span>] &#13;
<span class="hljs-keyword">AND</span>&#13;
RANK_PERCENTILE(<span class="hljs-built_in">SUM</span>([Sales])) <span class="hljs-operator">&gt;</span> [<span class="hljs-keyword">Select</span> Percentile Bottom <span class="hljs-keyword">Range</span>]&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Drag <strong class="keyWord">Quantiles</strong> to the <strong class="keyWord">Columns</strong> shelf and set <strong class="keyWord">Compute Using</strong> to <strong class="keyWord">Customer Name</strong>.</li>&#13;
      <li class="numberedList">Drag <strong class="keyWord">Percentile</strong> to the <strong class="keyWord">Filters</strong> shelf, click <strong class="keyWord">OK</strong>, then set <strong class="keyWord">Compute Using</strong> to <strong class="keyWord">Customer Name</strong>. Open the filter again and select the value <strong class="keyWord">True</strong>.&#13;
    <p class="normal">So, let’s recapture what we have done so far. We plotted the sales values per region, then we added an R script that creates quantiles out of the sales dot cloud. We also created a parameter that lets us select how many quantiles we want to see in the view since we learned that quantiles don’t always have to be quartiles but could also be terciles or quintiles, or more.</p>&#13;
    <p class="normal">Next up we will see this view in action, and we will add jittering.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="14">You may wish to add these additional steps to further enhance the visualization. To utilize jittering, create <a/>an index calculated field, <code class="inlineCode">Index()</code>, and place that field on the <strong class="keyWord">Columns</strong> shelf. Set <strong class="keyWord">Compute Using</strong> to <strong class="keyWord">Customer Name</strong>. Be sure to deselect <strong class="keyWord">Show Header</strong> so <strong class="keyWord">Index</strong> does not display in the view.</li>&#13;
      <li class="numberedList">Right-click on each axis and select <strong class="keyWord">Logarithmic </strong>and deselect <strong class="keyWord">Include Zero</strong>. You should see the following on your screen:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_27.png" alt=""/></figure><p class="packt_figref">Figure 15.27: Quantiles dashboard</p>&#13;
    <p class="normal">In the preceding figure, you can see that we decided to show four quantiles (utilizing the <strong class="keyWord">Number of quantiles</strong> parameter), which as such are called quartiles. By adding the <code class="inlineCode">Index()</code> function to columns, we were able to divide the quantiles into each of the four components. One conclusion from this dashboard could be that, in each of the four quantiles, the West region has the highest sales figures, and the South region has the lowest. However, the <a/>Central and South regions come remarkably close to each other in the third quantile. Based on this information, we could do some further analysis on what is going on in those regions specifically and why the Central region’s sales decreased in that quantile compared to the other regions.</p>&#13;
    <p class="normal">Now that we’ve completed the exercise, let’s take a moment to consider some of the code we looked at in this exercise:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau function calls the R engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">x &lt;- .arg1;</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">x</code> is the variable on which we’ll create quantiles. The variable, in this case, is <code class="inlineCode">[Sales]</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">y &lt;- .arg2[1];</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This variable sets the quantile count. <code class="inlineCode">[1]</code> forces a single number to be set and not a vector.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">m &lt;- c(1:y)/y;</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">m</code> distributes probabilities evenly from <code class="inlineCode">1:y</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">n &lt;- length(x);</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This sets the size of the loops. The loops are discussed below.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">z &lt;- c(1:n); for (i in c(1:n)) z[i] = 0;</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">z</code> sets the initial response vector by setting everything to 0.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">for (j in c(1:y)) for (i in c(1:n)) z[i] = if (x[i] &lt;= quantile(x,m)[j] &amp;&amp; z[i] == 0 ) j else z[i];</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">For each quantile, we go through the <code class="inlineCode">z</code> vector, and for each entry, we test whether the value of <code class="inlineCode">x</code> is less than the upper limit of that quantile. If <code class="inlineCode">x</code> has previously been set, we leave it. Otherwise, <code class="inlineCode">z[i]</code> = that quantile (<code class="inlineCode">j</code>).</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">In this exercise, you saw that by using R, a Tableau default functionality such as clustering can be extended and will give your dashboard users more freedom to answer new questions that come up while using the dashboard because it will be possible for them to change, for example, parameters and see the visualization changing. Now that we’ve learned about <a/>a few possible R use cases, it is time to discuss something worth your attention, the performance challenges that come along with using programming integrations with Tableau.</p>&#13;
    <h2 class="heading-2">Performance challenges</h2>&#13;
    <p class="normal">R scripts are table <a/>calculations. Like all table calculations, this means that you can only utilize <a/>fields that are on your view. Also, it’s important that you set partitioning and addressing correctly; otherwise, you may receive unexpected results.</p>&#13;
    <p class="normal">In the <em class="italic">Introducing quantiles</em> section, you may have noticed that the greater the number of quantiles set with the <strong class="keyWord">Number of quantiles</strong> parameter, the longer it takes the results to display. This is because R runs the loops in the <strong class="keyWord">Quantile</strong> calculated field one iteration for each quantile. For example, if the <strong class="keyWord">Number of quantiles</strong> parameter is set to <strong class="keyWord">1</strong>, the loop is instigated only once. If it is set to <strong class="keyWord">2</strong>, it runs twice, and so forth. The rule of thumb is that R code is executed once for every partition. The more partitions, the slower the performance. Therefore, when using R code, reduce the number of partitions whenever possible.</p>&#13;
    <p class="normal">This was the R part of this chapter. I hope you enjoyed it and that it has given you the inspiration to produce your own ideas to extend the functionality we have shared so far. We will now continue with the other very well-known programming language: Python. Luckily for us, Tableau also has an integration layer with Python.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec01">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Python installation and integration</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Python is an interpreted programming language and is very well known for its readability. The first <a/>release was in 1991, so quite some time ago (longer than most people would guess), and it was developed by Guido van Rossum. TabPy is an external service that <a/>will allow you to connect Python and Tableau—similar to Rserve. By using TabPy, you will be able to parse fields from your Tableau dashboard to Python, execute a calculation, and send back the result as a newly calculated field to Tableau. Or you can also call functions that you implemented <a/>in Python, again in a calculated field. A more extensive article on TabPy can be found here: <a href="https://tableaumagic.com/tableau-and-python-an-introduction" target="_blank"><span class="url">https://tableaumagic.com/tableau-and-python-an-introduction</span></a>.</p>&#13;
    <p class="normal">Installing Python is typically not difficult, but it does involve more than simply double-clicking on an executable. To successfully connect Tableau with Python, you might have to install some libraries and execute comments on the command line. The following paragraphs will guide you through this process.</p>&#13;
    <p class="normal">The easiest way to install Python is <a/>by performing the following steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Download, for example, Anaconda <a/>with the Python 3.10 version: <a href="https://www.anaconda.com" target="_blank"><span class="url">https://www.anaconda.com</span></a>. Any other Python interpreter will work too.&#13;
    <p class="normal">To integrate Python and Tableau, some additional steps are needed:</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Open, for example, Jupyter Notebook within Anaconda and write:&#13;
        <pre class="programlisting code"><code class="hljs-code">!pip install tabpy&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">Alternatively, execute the following command on the command line or Terminal (for Mac) in your Python directory:</p>&#13;
    <pre class="programlisting con"><code class="hljs-con">pip install tabpy&#13;
</code></pre></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Navigate to the directory where <code class="inlineCode">TabPy</code> has been installed via the command line or Terminal (for Mac) and type <code class="inlineCode">tabpy</code> into the command line or Terminal interface:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_28.png" alt=""/></figure><p class="packt_figref">Figure 15.28: Starting TabPy</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">You are now connected to the <code class="inlineCode">tabpy</code> server, which must remain open while running Tableau and Python combined.</li>&#13;
      <li class="numberedList">If you encounter any other issues with TabPy, for example, version incompatibilities, a quick Google search will go a long way.</li>&#13;
      <li class="numberedList">Open Tableau, select <strong class="screenText">Help</strong> | <strong class="screenText">Settings and Performance</strong> | <strong class="screenText">Manage Analytics Extension Connection</strong>, select <code class="inlineCode">localhost</code> for <strong class="screenText">Server</strong><strong class="keyWord">, </strong>and enter <code class="inlineCode">9004</code> for <strong class="screenText">Port</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_29.png" alt="Graphical user interface, text, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.29: Analytics Extension connection</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">As you can <a/>see in the previous screenshot, it is possible to set <a/>up usernames, passwords, and SSL if you have any security concerns or for a bigger enterprise-wide rollout.</li>&#13;
      <li class="numberedList">Click on <strong class="keyWord">Test Connection</strong> and you should see the following popup:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_30.png" alt=""/></figure><p class="packt_figref">Figure 15.30: Testing the analytics extension</p>&#13;
    <p class="normal">The full documentation on how to get TabPy up and running can be found at <a href="https://github.com/tableau/TabPy" target="_blank"><span class="url">https://github.com/tableau/TabPy</span></a>. If you don’t want to or cannot install TabPy on your machine, Tableau <a/>also offers a Docker container that will install the latest <a/>version of TabPy. You can find more information here: <a href="https://hub.docker.com/r/emhemh/tabpy/" target="_blank"><span class="url">https://hub.docker.com/r/emhemh/tabpy/</span></a>.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec02">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Implementing Python functionality</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">Just like R, TabPy makes use of the <code class="inlineCode">SCRIPT_</code> functions in Tableau. In the next sections, we will practice working <a/>with TabPy and will look at multiple use cases. Tableau calculations using TabPy look very similar to R’s. For TabPy, it is important to add a <code class="inlineCode">return</code> statement to the calculated field and notice that arguments are noted with an underscore instead of a dot:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_31.png" alt=""/></figure><p class="packt_figref">Figure 15.31: Python TabPy syntax</p>&#13;
    <p class="normal">This will be manifested in the next exercises; we will first investigate random number generators.</p>&#13;
    <h2 class="heading-2">Random and random normal</h2>&#13;
    <p class="normal">Many calculations are easily accessible via the calculated fields, others via the table calculations—and then there are some hidden functions. Hidden because those are not (yet) fully supported or tested; therefore, use them with care. If you tried to find the function <code class="inlineCode">Random</code>, for example, you would not be able to. But you can still use the <code class="inlineCode">Random()</code> function, as can be seen here:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_32.png" alt="Graphical user interface, text, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.32: Random</p>&#13;
    <p class="normal">Another option is using TabPy to get the <code class="inlineCode">Random</code> function. We will look at random as well as random normal with the variables <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code>. This will let us draw random numbers from a distribution, a method often used in statistics and quantitative modeling, among other areas, to simulate, reproduce, or calculate probabilities; <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code> are the mean and standard deviation defining the distribution.</p>&#13;
    <h3 class="heading-3">Generating random numbers</h3>&#13;
    <p class="normal">Perform the following <a/>steps to create a dot <a/>cloud of random variables with a specific underlying distribution, defined by the mean and standard deviation:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Create an Excel sheet with one <code class="inlineCode">Index</code> column and rows with the numbers 1-1,000. This is needed to have an initial dataset with the number of rows we want to use for the random number generator.</li>&#13;
      <li class="numberedList">Save the file and connect Tableau to this Excel sheet. You should see one imported measure called <strong class="keyWord">Index</strong> (just like the header in your Excel file).</li>&#13;
      <li class="numberedList">Connect Tableau to Python as described in <em class="italic">Python installation and integration</em>.</li>&#13;
      <li class="numberedList">Create a calculated field called <code class="inlineCode">Random</code>, which should look as follows:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL<span class="hljs-punctuation">(</span><span class="hljs-string">"</span>&#13;
<span class="hljs-string">from numpy import random as rd </span>&#13;
<span class="hljs-string">return rd.random(_arg1[0]).tolist()"</span><span class="hljs-punctuation">,</span>&#13;
SIZE<span class="hljs-punctuation">()</span>&#13;
<span class="hljs-punctuation">)</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Drag <strong class="keyWord">Index</strong> to <strong class="keyWord">Rows</strong> and <strong class="keyWord">Random</strong> to <strong class="keyWord">Columns</strong>.</li>&#13;
      <li class="numberedList">Disable <strong class="keyWord">Aggregate Measures</strong> on the <strong class="keyWord">Analysis</strong> tab.</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_33.png" alt=""/></figure><p class="packt_figref">Figure 15.33: Random visualized</p>&#13;
    <p class="normal">In the preceding <a/>screenshot, you can see the 1,000 random <a/>data points. Let’s consider some of the code used in this exercise that allowed us to generate this visualization:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau function calls the Python engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">"from numpy import random as rd</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this part of the code, we need the Python library <code class="inlineCode">numpy</code>, and from that library, we need the module <code class="inlineCode">random</code>, which we will load with the shorter name <code class="inlineCode">rd</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">return</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This command is simply needed to return a value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">rd.random(_arg1[0]).tolist()"</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this step, we call the module <code class="inlineCode">rd</code> that we imported before. From the <code class="inlineCode">rd</code> module, we retrieve the <code class="inlineCode">random</code> function. The <code class="inlineCode">_arg1[0]</code> is needed to activate the function given a certain value. And lastly, we put all the retrieved values in a list of values by adding <code class="inlineCode">.tolist()</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SIZE()</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is the value that will be replacing <code class="inlineCode">_arg1</code> and <code class="inlineCode">_arg1</code> is required by the <code class="inlineCode">random</code> function. We use <code class="inlineCode">SIZE()</code> to fulfill the requirement because it will return the number of rows in the partition and is sufficient to get a random number back from the function.</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">We got exactly 1,000 numbers because our initial Excel sheet had 1,000 rows. By using calculated fields, you <a/>can add columns to a data frame <a/>but no rows. Therefore, we need a data source that will provide us with the data schema. In the next section, we will learn how to specify a random number drawn from a normal distribution.</p>&#13;
    <h3 class="heading-3">Random normal</h3>&#13;
    <p class="normal">Now, let’s reproduce a random variable with a normal distribution. This technique is often used in statistical <a/>modeling to calculate probabilities. The <a/>random normal values can be used instead of or in addition to observations you already collected. Once we know how to use a normal distribution, you can extend this knowledge and create other distributions in Tableau as well:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Reuse the workbook from the previous exercise.</li>&#13;
      <li class="numberedList">Create a <code class="inlineCode">Random Normal</code> calculated field:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL<span class="hljs-punctuation">(</span><span class="hljs-string">"</span>&#13;
<span class="hljs-string">from numpy import random as rd </span>&#13;
<span class="hljs-string">mu, sigma = 0, 1</span>&#13;
<span class="hljs-string">return (rd.normal(mu, sigma, _arg1[0])).tolist()</span>&#13;
<span class="hljs-string">"</span><span class="hljs-punctuation">,</span>&#13;
SIZE<span class="hljs-punctuation">()</span>&#13;
<span class="hljs-punctuation">)</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Place <strong class="keyWord">Random Normal</strong> on <strong class="keyWord">Columns</strong> and <strong class="keyWord">Index</strong> on <strong class="keyWord">Rows</strong>.</li>&#13;
      <li class="numberedList">Disable <strong class="keyWord">Aggregate Measures</strong> on the <strong class="keyWord">Analysis</strong> tab.</li>&#13;
      <li class="numberedList">Select a <strong class="keyWord">Marks</strong> type of <strong class="keyWord">Circle</strong>. You can now see a plot with the 1,000 data points normally distributed:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_34.png" alt=""/></figure><p class="packt_figref">Figure 15.34: Normal distribution visualized</p>&#13;
    <p class="normal">To give your <a/>users more flexibility, you can also add parameters to your <a/>view that interact with the Python integration. For example, create the following two parameters:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_35.png" alt="Graphical user interface, application&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.35: The sigma and mu parameters</p>&#13;
    <p class="normal">Then, create a calculated field called<strong class="keyWord"> </strong><code class="inlineCode">Random Normal Param</code> like:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL(<span class="hljs-string">"</span>&#13;
<span class="hljs-string">from numpy import random as rd </span>&#13;
<span class="hljs-string">mu, sigma = _arg2, _arg3</span>&#13;
<span class="hljs-string">return (rd.normal(mu, sigma, _arg1[0])).tolist()</span>&#13;
<span class="hljs-string">"</span>,&#13;
SIZE(), [mu], [sigma]&#13;
)&#13;
</code></pre>&#13;
    <p class="normal">Add the parameter control to your view so your users can decide which variables they want to pass to Python:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_36.png" alt=""/></figure><p class="packt_figref">Figure 15.36: Final normal distribution worksheet</p>&#13;
    <p class="normal">Compared to our prior visualization with the normal distribution, you can see in the preceding screenshot that by changing the <code class="inlineCode">mu</code> parameter to 10, we change the mean to 10 and thus can <a/>move the whole dot cloud in any direction. With the <a/>random number being available in Tableau, you can, for example, visualize a Monte Carlo simulation, which is used in many real-life applications because it can model possible probability outcomes and thus helps interested parties understand the impact of risk and uncertainty.</p>&#13;
    <div class="note">&#13;
      <p class="normal">More information on how to calculate a Monte Carlo simulation in Tableau can be found here – <a href="https://jacksontwo.com/exploring-python-tableau" target="_blank"><span class="url">https://jacksontwo.com/exploring-python-tableau</span></a> – and more general Monte Carlo content can be found here: <a href="https://www.ibm.com/topics/monte-carlo-simulation" target="_blank"><span class="url">https://www.ibm.com/topics/monte-carlo-simulation</span></a>.</p>&#13;
    </div>&#13;
    <p class="normal">Before moving on, let’s again consider some of the key lines of code that were used in this exercise:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau function calls the Python engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">"from numpy import random as rd</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this part of the code, we need the Python library <code class="inlineCode">numpy</code>, and from that library, we need the module <code class="inlineCode">random</code>, which we will load with the shorter name <code class="inlineCode">rd</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">mu, sigma = _arg2,_arg3</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This part defines that we will refer to <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code> with <code class="inlineCode">_arg2 </code>and <code class="inlineCode">_arg3</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">return</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This command is simply needed to return a value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">rd.normal(mu, sigma, _arg1[0])).tolist()</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this step, we call the module <code class="inlineCode">rd</code> that we imported before. From the <code class="inlineCode">rd</code> module, we retrieve the <code class="inlineCode">random</code> function. The <code class="inlineCode">_arg1[0]</code> is needed to activate the function given a certain value. Optional values are <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code>. This time, we will use those two as well. And lastly, we put all the retrieved values in a list of values by adding <code class="inlineCode">.tolist()</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SIZE(), [mu], [sigma]</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This is the value that will be replacing <code class="inlineCode">_arg1</code>, <code class="inlineCode">_arg2</code>, and <code class="inlineCode">_arg3</code>. Just like before, we use <code class="inlineCode">SIZE()</code> to activate the function. The optional values <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code> will be pointing to the parameter we created before.</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">After finishing the first two exercises with TabPy, we learned how we can use a random number in Tableau. Next, we <a/>changed the random number to a random number <a/>drawn from a normal distribution and added parameters to the dashboard such that the user can change <code class="inlineCode">mu</code> and <code class="inlineCode">sigma</code> of the normal distribution. Of course, you can change the function in TabPy to other distributions as well.</p>&#13;
    <p class="normal">The next topic is more advanced. We will use TabPy to execute a sentiment analysis on newspaper headlines from 2003 to 2021.</p>&#13;
    <h2 class="heading-2">Calculating sentiment analysis</h2>&#13;
    <p class="normal">Alongside machine learning <a/>and artificial intelligence, another term is being used increasingly: <strong class="keyWord">Natural Language Processing</strong> (<strong class="keyWord">NLP</strong>). This is the process of machines understanding words <a/>and their meaning. Sentiment analysis falls into this category; the <a/>technique has different flavors but one of them is to measure polarity, that is, whether the speaker has a positive or negative opinion. Use cases are, for example, datasets of reviews, tweets, comments, plots, lyrics, and so on. Let’s have a look!</p>&#13;
    <p class="normal">This exercise is based on the idea of Brit Cava, who used the Makeover Monday data from the top 100 songs’ lyrics to try out the Tableau-Python integration. You can find the blog post here: <a href="https://www.tableau.com/about/blog/2016/12/using-python-sentiment-analysis-tableau-63606" target="_blank"><span class="url">https://www.tableau.com/about/blog/2016/12/using-python-sentiment-analysis-tableau-63606</span></a>. Let’s reproduce it with this Australian Broadcasting Corporation dataset containing one million news headlines: <a href="https://www.kaggle.com/datasets/therohk/million-headlines" target="_blank"><span class="url">https://www.kaggle.com/datasets/therohk/million-headlines</span></a>.</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Navigate to the <code class="inlineCode">Sentiment</code> <code class="inlineCode">Analysis</code> tab in the workbook associated with the chapter.</li>&#13;
      <li class="numberedList">Connect to the <code class="inlineCode">Headlines</code> data source.</li>&#13;
      <li class="numberedList">Connect Tableau to Python.</li>&#13;
      <li class="numberedList">Create a <code class="inlineCode">Sentiment Score</code> calculated field. The formatting, for example, indented text, is important:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL<span class="hljs-punctuation">(</span><span class="hljs-string">"</span>&#13;
<span class="hljs-string">from nltk.sentiment import SentimentIntensityAnalyzer </span>&#13;
<span class="hljs-string">text = _arg1</span>&#13;
<span class="hljs-string">scores = []</span>&#13;
<span class="hljs-string">sid = SentimentIntensityAnalyzer() </span>&#13;
<span class="hljs-string">for word in text:</span>&#13;
<span class="hljs-string">    ss = sid.polarity_scores(word) </span>&#13;
<span class="hljs-string">scores.append(ss['compound'])</span>&#13;
<span class="hljs-string">return scores "</span>&#13;
<span class="hljs-punctuation">,</span>ATTR<span class="hljs-punctuation">([</span>headline_text<span class="hljs-punctuation">]))</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Create a <code class="inlineCode">Color Coding</code> calculated field:&#13;
        <pre class="programlisting code"><code class="hljs-code">IIF <span class="hljs-punctuation">([</span>Sentiment Scores<span class="hljs-punctuation">]</span> <span class="hljs-operator">&gt;=</span> <span class="hljs-number">0</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'Positivity'</span><span class="hljs-punctuation">,</span> <span class="hljs-string">'Negativity'</span><span class="hljs-punctuation">)</span>&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Place <strong class="keyWord">publish_date</strong> on the <strong class="keyWord">Rows</strong> shelf, as well as <strong class="keyWord">MONTH(publish_date).</strong></li>&#13;
      <li class="numberedList">Put <strong class="keyWord">Sentiment Score</strong> on <strong class="keyWord">Columns</strong>.</li>&#13;
      <li class="numberedList">Add <strong class="keyWord">Color Coding</strong> to the <strong class="keyWord">Color</strong> shelf. And <strong class="keyWord">headline_text</strong> to <strong class="keyWord">Details</strong>. Lastly, drag an average line from the <strong class="keyWord">Analytics</strong> pane on the view (<strong class="screenText">Per Cell</strong>):</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_37.png" alt=""/></figure><p class="packt_figref">Figure 15.37: Sentiment Score</p>&#13;
    <p class="normal">Limit the data <a/>as needed, considering <a/>the performance of your PC. I am showing 2019-2021 and only Jan, Feb, Nov, and Dec to compare the differences between the beginning and end of the years:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_38.png" alt=""/></figure><p class="packt_figref">Figure 15.38: Worksheet</p>&#13;
    <p class="normal">So far, we have loaded the dataset and created a Python calculation that uses a pre-trained sentiment analyzer that tells us if a headline is written negative or positive. In the preceding figure, we <a/>brought everything <a/>together, and you can see that in every month in 2021, the negative news is dominating, with February being the worst (an average score of -10.45) and December being the most positive (an average score of -0.14). We will continue now with a check on what the news is most often reporting about.</p>&#13;
    <p class="normal">To know the topics that were most often discussed in the ABC news, we must count the words used. Perhaps there is a way to do this in Tableau, by splitting the <strong class="keyWord">headline_text</strong> field into one word each, pivoting and counting but it will surely be a tedious process. And there are enough libraries out there to remove things like stop words and reduce words to their core, for example, horse = horses. Therefore, we will deploy another model. Please follow the steps: </p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">Create a <code class="inlineCode">Start</code> parameter. This one will help us later to define the period we want to search in:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_39.png" alt=""/></figure><p class="packt_figref">Figure 15.39: Start</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">Also, create an <code class="inlineCode">End</code> parameter:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_40.png" alt=""/></figure><p class="packt_figref">Figure 15.40: End</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">Show both <a/>parameters on <a/>a new tab in your Tableau workbook called <code class="inlineCode">most common words</code>.</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_41.png" alt=""/></figure><p class="packt_figref">Figure 15.41: Worksheet</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="4">Next, you will have to write code in your Python IDE of choice (e.g., Jupyter Notebook). For now, <a/>copy the following code. The explanation will follow at the end of this section (don’t forget <a/>to change the location in this line <code class="inlineCode">df = pd.read_csv('abcnews-date-text.csv')</code> to exactly where your copy of the file is located:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> tabpy.tabpy_tools.client <span class="hljs-keyword">import</span> Client&#13;
client = Client(<span class="hljs-string">'http://localhost:9004/'</span>)&#13;
<span class="hljs-keyword">def</span> <span class="hljs-title">common_words</span>(<span class="hljs-params">_arg1, _arg2</span>):&#13;
    &#13;
    <span class="hljs-comment">#load all required libraries</span>&#13;
    <span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd&#13;
    <span class="hljs-keyword">import</span> nltk&#13;
    <span class="hljs-keyword">from</span> nltk.corpus <span class="hljs-keyword">import</span> stopwords&#13;
    <span class="hljs-keyword">from</span> nltk.tokenize <span class="hljs-keyword">import</span> word_tokenize&#13;
    <span class="hljs-keyword">from</span> nltk.probability <span class="hljs-keyword">import</span> FreqDist&#13;
    <span class="hljs-keyword">from</span> nltk.sentiment <span class="hljs-keyword">import</span> SentimentIntensityAnalyzer &#13;
    df = pd.read_csv(<span class="hljs-string">'abcnews-date-text.csv'</span>)&#13;
    df[<span class="hljs-string">'publish_date'</span>] = pd.to_datetime(df[<span class="hljs-string">'publish_date'</span>], <span class="hljs-built_in">format</span>=<span class="hljs-string">'%Y%m%d'</span>)&#13;
    &#13;
    <span class="hljs-comment">#convert the Tableau input date to a readable format</span>&#13;
    _arg1 = pd.to_datetime(_arg1, <span class="hljs-built_in">format</span>=<span class="hljs-string">'%Y-%m-%d'</span>)[<span class="hljs-number">0</span>]&#13;
    _arg2 = pd.to_datetime(_arg2, <span class="hljs-built_in">format</span>=<span class="hljs-string">'%Y-%m-%d'</span>)[<span class="hljs-number">0</span>]&#13;
    df = df.set_index(<span class="hljs-string">'publish_date'</span>)&#13;
    <span class="hljs-comment">#empty lists to be filled</span>&#13;
    scores = []&#13;
    filtered_sentence = []&#13;
    &#13;
    <span class="hljs-comment"># Select the rows between two dates</span>&#13;
    in_range_df = df[df.index.isin(pd.date_range(_arg1, _arg2))]&#13;
    <span class="hljs-comment">#loading english stop words</span>&#13;
    stop_words = <span class="hljs-built_in">set</span>(stopwords.words(<span class="hljs-string">'english'</span>))&#13;
    text = in_range_df[<span class="hljs-string">'headline_text'</span>]&#13;
    <span class="hljs-comment">#most used words</span>&#13;
    <span class="hljs-keyword">for</span> row <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>(in_range_df)):&#13;
        text =  in_range_df[<span class="hljs-string">'headline_text'</span>][row]&#13;
        word_tokens = word_tokenize(text)&#13;
        <span class="hljs-keyword">for</span> w <span class="hljs-keyword">in</span> word_tokens:&#13;
            <span class="hljs-keyword">if</span> w <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> stop_words:&#13;
                filtered_sentence.append(w)&#13;
    <span class="hljs-comment">#calculate the frequency of each word</span>&#13;
    fdist = FreqDist(filtered_sentence)&#13;
    <span class="hljs-comment">#extract the N most common words</span>&#13;
    most_common_words = fdist.most_common(<span class="hljs-number">3</span>)&#13;
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">str</span>(most_common_words)&#13;
client.deploy(<span class="hljs-string">'common_words'</span>, common_words,<span class="hljs-string">'Retrieves the most common words'</span>, override = <span class="hljs-literal">True</span>)&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">Since the <a/>indentation is especially <a/>important, here is a screenshot of how it should look; you can also see that I specified the location <a/>of the <code class="inlineCode">abcnews</code> file to be ‘<code class="inlineCode">/Users/marleenmeier/Downloads/abcnews-date-text.csv</code>' since <a/>my file is located there:</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_42.png" alt="Text&#13;&#10;&#13;&#10;Description automatically generated with medium confidence"/></figure><p class="packt_figref">Figure 15.42: Code</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="5">Now run the Python script.</li>&#13;
      <li class="numberedList">Go back to the most common words tab in your Tableau dashboard and create the following calculated field <code class="inlineCode">common words</code>:&#13;
        <pre class="programlisting code"><code class="hljs-code">MODEL_EXTENSION_STR(<span class="hljs-string">"common_words"</span>, <span class="hljs-string">"_arg1, _arg2"</span>, [Start], [End])&#13;
</code></pre>&#13;
      &#13;
    <div class="note">&#13;
      <p class="normal">You can also use the <code class="inlineCode">SCRIPT_STR</code> function like we did in the previous exercise, but for deployed TabPy models, Tableau provides this easier syntax of <code class="inlineCode">MODEL_EXTENSION</code> functions too.</p>&#13;
    </div></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">Drag <strong class="screenText">common words</strong> into the <strong class="screenText">Rows</strong> and see your first results; between January 2014 and December 2015, the word <em class="italic">new</em> appeared 4,909 times in the headlines <a/>of ABC news, <em class="italic">police</em> 4,307 times, and <em class="italic">man</em> 4,171 times. You see the top 3 because it is specified <a/>as such in the code, which we will check out in a bit. You can, however, change it to any number!</li>&#13;
      <li class="numberedList">Play with the <strong class="screenText">Start</strong> and <strong class="screenText">End</strong> dates and see what happens! Here are two more examples; also notice the word count itself, the top 1 word in 2020 (<em class="italic">coronavirus</em>, 8,383 times) was used two times more often than the top 1 word between 2014 and 2015 (<em class="italic">new</em>, 4,909 times):</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_43.png" alt=""/></figure><p class="packt_figref">Figure 15.43: Words II</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_44.png" alt=""/></figure><p class="packt_figref">Figure 15.44: Words III</p>&#13;
    <p class="normal">If you want to continue working on this, you could add the top N as a model input parameter, as well <a/>as the sentiment score if you <a/>wanted to see the top N for a specific sentiment only.</p>&#13;
    <p class="normal">In this exercise, we were able to show that Tableau can analyze text data for its sentiment, something we have not seen before. To do so, we needed to connect Tableau with Python, which is possible by using the external service TabPy. Python can make use of libraries such as <code class="inlineCode">nltk.sentiment</code>—which we used in this case. A thorough description of this package can be found here: <a href="https://www.nltk.org/api/nltk.sentiment.html" target="_blank"><span class="url">https://www.nltk.org/api/nltk.sentiment.html</span></a>. There are many other libraries for sentiment analysis but <code class="inlineCode">nltk</code> is used a lot for demonstration purposes and learning. Feel free to try other libraries as well!</p>&#13;
    <p class="normal">Let’s demystify <a/>some of the new code instances <a/>we included in this exercise:</p>&#13;
    <table class="table-container"><tbody><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">SCRIPT_REAL</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This Tableau function calls the Python engine and returns a float value.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">from nltk.sentiment import SentimentIntensityAnalyzer</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this part of the code, we need the Python library <code class="inlineCode">nltk</code>, and from that library, we need the module <code class="inlineCode">sentiment</code> from which we will load the function <code class="inlineCode">SentimentIntensityAnalyzer</code>.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">scores = []</code></p>&#13;
            <p class="normal"><code class="inlineCode">text = _arg1</code></p>&#13;
            <p class="normal"><code class="inlineCode">sid = SentimentIntensityAnalyzer() </code></p>&#13;
            <p class="normal"><code class="inlineCode">ss = sid.polarity_scores(word)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This part defines that our <code class="inlineCode">_arg1</code> will be called <code class="inlineCode">text</code>, <code class="inlineCode">scores</code> will be an empty list (and filled later in the code), <code class="inlineCode">sid</code> will refer to the <code class="inlineCode">SentimentIntensityAnalyzer</code> function, and lastly, <code class="inlineCode">ss</code> will be the reference to the scores per word.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">scores.append(ss['compound'])</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this step, we will fill the empty <code class="inlineCode">scores</code> table with the polarity scores.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">return scores</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Here, we are returning the now-filled <code class="inlineCode">scores</code> table as output to Tableau.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">ATTR([Dialog])</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Our <code class="inlineCode">_arg1</code> is specified as the field <code class="inlineCode">Dialog</code> from the Tableau workbook.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">from tabpy.tabpy_tools.client import Client</code></p>&#13;
            <p class="normal"><code class="inlineCode">client = Client('http://localhost:9004/')</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this part of the code, we connect Tableau to the Python instance.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">import pandas as pd</code></p>&#13;
            <p class="normal"><code class="inlineCode">import nltk</code></p>&#13;
            <p class="normal"><code class="inlineCode">from nltk.corpus import stopwords</code></p>&#13;
            <p class="normal"><code class="inlineCode">from nltk.tokenize import word_tokenize</code></p>&#13;
            <p class="normal"><code class="inlineCode">from nltk.probability import FreqDist</code></p>&#13;
            <p class="normal"><code class="inlineCode">from nltk.sentiment import SentimentIntensityAnalyzer</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Here we load all the required libraries.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">df = pd.read_csv('abcnews-date-text.csv')</code></p>&#13;
            <p class="normal"><code class="inlineCode">df['publish_date'] = pd.to_datetime(df['publish_date'], format='%Y%m%d')</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Next, we read the <code class="inlineCode">abcnews</code> file.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">_arg1 = pd.to_datetime(_arg1, format='%Y-%m-%d')[0]</code></p>&#13;
            <p class="normal"><code class="inlineCode">_arg2 = pd.to_datetime(_arg2, format='%Y-%m-%d')[0]</code></p>&#13;
            <p class="normal"><code class="inlineCode">df = df.set_index('publish_date')</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Then, we must convert the input into a readable format for our model.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">scores = []</code></p>&#13;
            <p class="normal"><code class="inlineCode">filtered_sentence = []</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">This part is to create two lists that we will fill in the <code class="inlineCode">for</code> loop.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">in_range_df = df[df.index.isin(pd.date_range(_arg1, _arg2))]</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Now we will filter the data to be between our start and end date.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">stop_words = set(stopwords.words('english'))</code></p>&#13;
            <p class="normal"><code class="inlineCode">text = in_range_df['headline_text']</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Luckily, English stop words are available at our disposal; we are loading them in this step.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">for row in range(0, len(in_range_df)): </code></p>&#13;
            <p class="normal"><code class="inlineCode">text = in_range_df['headline_text'][row]</code></p>&#13;
            <p class="normal"><code class="inlineCode">word_tokens = word_tokenize(text)</code></p>&#13;
            <p class="normal"><code class="inlineCode">for w in word_tokens:</code></p>&#13;
            <p class="normal"><code class="inlineCode">if w not in stop_words: filtered_sentence.append(w)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">In this part of the code, we are converting the remaining headers into a token, which is needed to calculate the frequency, and finally, the non-stop-word words will be stored in the <code class="inlineCode">filtered_sentence</code> list.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">fdist = FreqDist(filtered_sentence)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">By using one of the libraries, we loaded in the beginning, we can now ask to retrieve the frequency for each word.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode"> most_common_words = fdist.most_common(3)</code></p>&#13;
            <p class="normal"><code class="inlineCode"> return str(most_common_words)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">And since we have the frequency now, we can load the most often-used words.</p>&#13;
          </td>&#13;
        </tr><tr><td class="table-cell">&#13;
            <p class="normal"><code class="inlineCode">client.deploy('common_words', common_words,'Retrieves the most common words', override = True)</code></p>&#13;
          </td>&#13;
          <td class="table-cell">&#13;
            <p class="normal">Lastly, we will deploy the model such that we can call it from Tableau Desktop.</p>&#13;
          </td>&#13;
        </tr></tbody></table><p class="normal">We have seen embedded Python code now; you create a calculated field and use fields from your dataset <a/>as input. But what if you wanted to <a/>use a large model with many lines of code and many different variables, or upfront training of your model? Would this exceed TabPy’s capabilities? No! Because next to embedded code, we are also able to write Python scripts outside of Tableau.</p>&#13;
    <h2 class="heading-2">Deploying models with TabPy</h2>&#13;
    <p class="normal">At times, your <a/>script will just be too long to be <a/>used in a calculated field, or you’ll need upfront training on a different dataset or an extended dataset rather than the one you have in Tableau. In this case, we can use TabPy in a slightly different way. You can write a model outside of Tableau—in Python and deploy it to Tableau such that you can call it from within the desktop.</p>&#13;
    <p class="normal">In the upcoming example, we will build a recommender system that predicts the likelihood of a Pima woman having diabetes when inputting 7 parameters (age, BMI, pregnancies, blood pressure, glucose, insulin, and skin thickness). The dataset is from a 1988 study by <em class="italic">J.W. Smith, J.E. Everhart, W.C. Dickson, W.C. Knowler, and R.S. Johannes</em>, accessible at the following link: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2245318/" target="_blank"><span class="url">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2245318/</span></a>.</p>&#13;
    <p class="normal">We will begin with the code in the Jupyter Notebook or your preferred <strong class="keyWord">Integrated Development Environment</strong> (<strong class="keyWord">IDE</strong>). Please follow along with the next steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">We start the code by importing the <code class="inlineCode">tabpy</code> client, which is needed to establish a Python-Tableau connection:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">from</span> tabpy.tabpy_tools.client <span class="hljs-keyword">import</span> Client&#13;
client = Client(<span class="hljs-string">'http://localhost:9004/'</span>)&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Next, we import all the libraries and data needed. Make sure to replace the dataset name with the full path of your file location (for example, <code class="inlineCode">H:/Documents/Diabetes.csv</code> instead of <code class="inlineCode">Diabetes.csv</code>):&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np&#13;
<span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd&#13;
<span class="hljs-keyword">from</span> sklearn <span class="hljs-keyword">import</span> ensemble&#13;
<span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split&#13;
df = pd.read_csv(<span class="hljs-string">"Diabetes.csv"</span>, sep = <span class="hljs-string">','</span>)&#13;
df = df[[<span class="hljs-string">'</span><span class="hljs-string">Pregnancies'</span>, <span class="hljs-string">'Glucose'</span>, <span class="hljs-string">'BloodPressure'</span>, <span class="hljs-string">'SkinThickness'</span>, <span class="hljs-string">'Insulin'</span>, <span class="hljs-string">'BMI'</span>, <span class="hljs-string">'Age'</span>, <span class="hljs-string">'Outcome'</span>]]&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">Now we split the dataset into four; two test datasets that will help us check how accurate our model is, as well as two training datasets to train the model:&#13;
        <pre class="programlisting code"><code class="hljs-code">X_train, X_test, y_train, y_test = train_test_split(df.drop([<span class="hljs-string">'Outcome'</span>], axis = <span class="hljs-string">'</span><span class="hljs-string">columns'</span>),df[<span class="hljs-string">'Outcome'</span>], test_size = <span class="hljs-number">0.2</span>)&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">If you are interested in more detail and the math behind this code, please check <a href="https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html" target="_blank"><span class="url">https://scikit-learn.org/stable/modules/generated/sklearn.ensemble.GradientBoostingClassifier.html</span></a>.</li>&#13;
      <li class="numberedList">Next, we will load the <code class="inlineCode">GradientBoosting</code> model from <code class="inlineCode">sklearn</code> and fit our data; then; we <a/>can immediately <a/>visualize the score, which can be interpreted as the percentage of the total that our model predicted the correct value for:&#13;
        <pre class="programlisting code"><code class="hljs-code">gb = ensemble.GradientBoostingClassifier()&#13;
gb.fit(X_train, y_train)&#13;
gbscore = gb.score(X_test, y_test)&#13;
<span class="hljs-built_in">print</span>(<span class="hljs-string">'gradient boost: '</span> + <span class="hljs-built_in">str</span>(<span class="hljs-built_in">round</span>(gbscore*<span class="hljs-number">100</span>,<span class="hljs-number">2</span>)))&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">And this is the full code in Jupyter:&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_45.png" alt="Graphical user interface, text&#13;&#10;&#13;&#10;Description automatically generated"/></figure><p class="packt_figref">Figure 15.45: Python script</p>&#13;
    <p class="normal">To conclude this first phase, our model predicted the right outcome in 72.08% of cases, either having diabetes or not having diabetes. This is a fairly good result. To further improve it, we could add more data (in terms of rows), extend <a/>our input <a/>variables (in terms of columns), or create new features like ratios between variables (hidden information could be emphasized this way). But for now, we can continue working with the model, because eventually, we want to predict the likelihood as a percentage of someone having diabetes. Let’s switch over to Tableau:</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="7">We won’t need a dataset for this exercise because all our data lives in the Jupyter Notebook. In Tableau, you can just select one randomly, as we won’t use it. In a new Tableau worksheet called <code class="inlineCode">Diabetes</code>, create the following seven parameters:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_46.png" alt=""/></figure><p class="packt_figref">Figure 15.46: Age and BloodPressure parameters</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_47.png" alt=""/></figure><p class="packt_figref">Figure 15.47: BMI and Insulin parameters</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_48.png" alt=""/></figure><p class="packt_figref">Figure 15.48: SkinThickness and Glucose parameters</p>&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_49.png" alt=""/></figure><p class="packt_figref">Figure 15.49: The Pregnancies parameter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="8">After you <a/>have created all seven <a/>parameters, select all of them and click <strong class="screenText">Show Parameter</strong>:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_50.png" alt=""/></figure><p class="packt_figref">Figure 15.50: Show Parameter</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="9">Please go back to Jupyter now and execute the two last missing pieces of code that will create a function to call our model:&#13;
        <pre class="programlisting code"><code class="hljs-code"><span class="hljs-keyword">def</span> <span class="hljs-title">diabetes_predictor</span>(<span class="hljs-params">_arg1, _arg2, _arg3, _arg4, _arg5,_arg6,_arg7</span>):&#13;
    <span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd&#13;
    row = {<span class="hljs-string">'Pregnancies'</span>: _arg1, <span class="hljs-string">'Glucose'</span>: _arg2, <span class="hljs-string">'BloodPressure'</span>:&#13;
           _arg3, <span class="hljs-string">'SkinThickness'</span>: _arg4, <span class="hljs-string">'Insulin'</span>: _arg5, <span class="hljs-string">'BMI'</span>:_arg6,&#13;
           <span class="hljs-string">'Age'</span>: _arg7}&#13;
    test_data = pd.DataFrame(data = row,index=[<span class="hljs-number">0</span>])&#13;
    predprob_diabetes = gb.predict_proba(test_data)&#13;
    <span class="hljs-keyword">return</span> [probability[<span class="hljs-number">1</span>] <span class="hljs-keyword">for</span> probability <span class="hljs-keyword">in</span> predprob_diabetes]&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">And lastly, the <a/>line that will <a/>deploy the function to TabPy:&#13;
        <pre class="programlisting code"><code class="hljs-code">client.deploy(<span class="hljs-string">'diabetes_predictor'</span>, diabetes_predictor,<span class="hljs-string">'Predicts the chances of a Pima female having diabetes'</span>, override = <span class="hljs-literal">True</span>)&#13;
</code></pre>&#13;
      </li>&#13;
      <li class="numberedList">This looks as follows in Jupyter:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_51.png" alt=""/></figure><p class="packt_figref">Figure 15.51: Deploying the function</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="12">To check if your model has been deployed, type <code class="inlineCode">https://localhost:9004/endpoints</code> in your browser. This will list all the models that have been deployed to TabPy on your machine:&#13;
    <figure class="mediaobject"><img src="../images/B18435_15_52.png" alt=""/></figure><p class="packt_figref">Figure 15.52: Deploying the function</p>&#13;
    <p class="normal">Go back to <a/>Tableau and <a/>double-check if the connection to TabPy is still active.</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="13">Create a calculated field called <code class="inlineCode">Diabetes predictor</code> like so:&#13;
        <pre class="programlisting code"><code class="hljs-code">SCRIPT_REAL<span class="hljs-punctuation">(</span><span class="hljs-string">"</span>&#13;
<span class="hljs-string">return tabpy.query('diabetes_predictor',_arg1,_arg2,_arg3,_arg4,_arg5,_arg6,</span>&#13;
<span class="hljs-string">_arg7)['response']"</span><span class="hljs-punctuation">,</span>&#13;
<span class="hljs-punctuation">[</span>Pregnancies<span class="hljs-punctuation">],</span> <span class="hljs-punctuation">[</span>Glucose<span class="hljs-punctuation">],</span> <span class="hljs-punctuation">[</span>BloodPressure<span class="hljs-punctuation">],</span> <span class="hljs-punctuation">[</span>SkinThickness<span class="hljs-punctuation">],</span> <span class="hljs-punctuation">[</span>Insulin<span class="hljs-punctuation">],</span> &#13;
<span class="hljs-punctuation">[</span>BMI<span class="hljs-punctuation">],[</span>Age<span class="hljs-punctuation">]</span>&#13;
<span class="hljs-punctuation">)</span>&#13;
</code></pre>&#13;
      &#13;
    <p class="normal">You can see here that since we did all the coding in Python, we only tell Tableau to return a TabPy query called <code class="inlineCode">diabetes_predictor</code>, then add all the <em class="italic">n</em> references to variables that are required for the function, and lastly add <code class="inlineCode">['response']</code> at the end.</p>&#13;
    <p class="normal">Or, since deployed models on TabPy also support the functions <code class="inlineCode">MODEL_EXTENSION_BOOL</code>, <code class="inlineCode">MODEL_EXTENSION_INT</code>, <code class="inlineCode">MODEL_EXTENSION_REAL</code>, and <code class="inlineCode">MODEL_EXTENSION_STR</code>, you can also use this:</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">MODEL_EXTENSION_REAL(<span class="hljs-string">"diabetes_predictor"</span>, <span class="hljs-string">"_arg1, _arg2, _arg3, _arg4, _arg5, _arg6, _arg7"</span>, &#13;
[Pregnancies], [Glucose], [BloodPressure], [SkinThickness], [Insulin], [BMI],[Age]&#13;
)&#13;
</code></pre>&#13;
    <p class="normal">The second <a/>code is a bit shorter <a/>and more intuitive; however, both work!</p></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="14">Now place the field <strong class="screenText">Diabetes predictor</strong><strong class="keyWord"> </strong>on the <strong class="screenText">Text</strong> shelf and observe the outcome:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_53.png" alt=""/></figure><p class="packt_figref">Figure 15.53: Interactive TabPy Diabetes worksheet</p>&#13;
    <p class="normal">By sliding the parameters to the left and right, you will see that the likelihood of diabetes changes. The calculated field sends the data of the parameters via TabPy to Python, where your data will be fitted to the model. And the result will be sent back, and you can see it. Of course, you can build a whole dashboard around it. Examples can be found on the Tableau website: <a href="https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916" target="_blank"><span class="url">https://www.tableau.com/about/blog/2017/1/building-advanced-analytics-applications-tabpy-64916</span></a>.</p>&#13;
    <p class="normal">If you want to learn <a/>more about the Python <a/>language itself, a good source of information is, for example, <a href="https://www.w3schools.com/python/default.asp" target="_blank"><span class="url">https://www.w3schools.com/python/default.asp</span></a>. The web page will, step by step, guide you through the Python syntax. But Tableau makes it even easier because a set of functions has already been written for you.</p>&#13;
    <h2 class="heading-2">Predeployed TabPy functions</h2>&#13;
    <p class="normal">Not everyone likes to program outside of Tableau and that’s why Tableau has produced a set of widely used, pre-deployed functions you can use out of the box. You will still need to execute <a/>one line of code, once! But that is all you need to do in Python itself. The available functions are ANOVA, T-test, sentiment analysis, and PCA but Tableau has mentioned on multiple occasions that more functions might be coming soon. You can find the documentation here: <a href="https://tableau.github.io/TabPy/docs/tabpy-tools.html" target="_blank"><span class="url">https://tableau.github.io/TabPy/docs/tabpy-tools.html</span></a>.</p>&#13;
    <p class="normal">But let’s walk through the steps:</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="1">In your Jupyter Notebook, execute <code class="inlineCode">tabpy-deploy-models</code> and see that the four functions are installed:</li>&#13;
    </ol><figure class="mediaobject"><img src="../images/B18435_15_54.png" alt=""/></figure><p class="packt_figref">Figure 15.54: Deploying TabPy default models</p>&#13;
    <ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="2">You can double-check this by typing <code class="inlineCode">http://localhost:9004/endpoints</code> in your browser, where you should see all deployed models.&#13;
    <p class="normal">And that’s it; calling the function in a calculated field in Tableau is now as easy as the following (using <code class="inlineCode">ttest</code> as an example function being called):</p>&#13;
    <pre class="programlisting code"><code class="hljs-code">tabpy.query(<span class="hljs-string">'ttest'</span>, _arg1, _arg2)[<span class="hljs-string">'response'</span>]&#13;
</code></pre></li>&#13;
    </ol><ol class="numberedList" style="list-style-type: decimal;"><li class="numberedList" value="3">I challenge you to compare the Sentiment Score from the TabPy default deployed model with the one we created: do they differ? And if so, how?</li>&#13;
    </ol><p class="normal">From Python, you can connect directly to, for example:</p>&#13;
    <ul><li class="bulletList">DataRobot (<a href="https://www.tableau.com/solutions/datarobot" target="_blank"><span class="url">https://www.tableau.com/solutions/datarobot</span></a>)</li>&#13;
      <li class="bulletList">Dataiku (<a href="https://www.dataiku.com/partners/tableau/" target="_blank"><span class="url">https://www.dataiku.com/partners/tableau/</span></a>)</li>&#13;
      <li class="bulletList">MATLAB (<a href="https://www.mathworks.com/products/reference-architectures/tableau.html" target="_blank"><span class="url">https://www.mathworks.com/products/reference-architectures/tableau.html</span></a>)</li>&#13;
    </ul><p class="normal">These are all paid third-party tools that help make your data analysis easier. And if you can make a connection from R and Python to another external tool, you can also leverage that <a/>capability back to Tableau via Rserve and TabPy, respectively. If you are interested in this type of connection or if you want to refresh the topic of deploying functions, you can check out this video – <a href="https://youtu.be/0BN_Y2CxdYY" target="_blank"><span class="url">https://youtu.be/0BN_Y2CxdYY</span></a> – in which Nathan Mannheimer, a former product manager for advanced analytics at Tableau, explains everything we have discussed as well.</p>&#13;
    <p class="normal">What are your personal goals with programming integration? If you have a great idea, feel free to share it with the Tableau community.</p>&#13;
    <h2 class="heading-2">Honing your R and Python skills</h2>&#13;
    <p class="normal">Some of you <a/>might feel overwhelmed by using code and are looking <a/>for a simpler way to learn before using R or Python in Tableau. The website <a href="http://www.geeksforgeeks.org" target="_blank"><span class="url">www.geeksforgeeks.org</span></a> introduces you to both and lets you practice on-site programming without any installation. </p>&#13;
    <h2 class="heading-2">Einstein Discovery</h2>&#13;
    <p class="normal">If you are a Salesforce user and bought the Einstein Discovery license, you can use another out-of-the-box <a/>set of models. AI-driven models ship with Einstein Discovery and can be integrated with Tableau workflows. This combination can be leveraged to <a/>generate powerful insights for your Salesforce data. You can, for example, forecast sales from data in Salesforce and load it directly into Tableau, then share those insights on your known Tableau Server instance and hence keep all dashboards in one place. Since Salesforce and Tableau are both part of the Salesforce suite, I wanted to mention this; however, it is also yet another kind of software that requires additional licenses, and therefore I decided not to go in-depth on its use (indeed, with what you’ve learned in this chapter you can replicate much of the functionality with none of the additional cost). If you are interested in learning <a/>more, I recommend you check out the following page and subpages on tableau.com: <a href="https://www.tableau.com/products/einstein-discovery" target="_blank"><span class="url">https://www.tableau.com/products/einstein-discovery</span></a>.</p>&#13;
    </div>&#13;
</div>&#13;
</section>&#13;
<section id="ch15lvl1sec03">&#13;
<div class="epub-source">&#13;
<h1 class="heading-1">Summary</h1>&#13;
<div class="Basic-Text-Frame">&#13;
    <p class="normal">This chapter just scratched the surface regarding the options of working with R and Python. After finishing this chapter, you should now be able to connect to Python and R from Tableau and recognize and write the basic syntax for both programming languages in Tableau. Most importantly, you are now skilled enough to leverage the power of R and Python functions in Tableau from a simple mean calculation to regressions, all the way to implementing your own machine learning model. Although we covered the installation, integration, and workflow, as well as some of the more popular functions and use cases, there is much more to explore. In fact, the possibilities of Tableau’s programming integration remain largely uncharted territory in the BI community. </p>&#13;
    <p class="normal">The intrepid in data visualization are pushing the envelope, but there is much to be done. For those readers looking to enhance their career options, expertise in both packages could offer great advantages. And there is more to come!</p>&#13;
    <p class="normal">During the Tableau Conference 2023, the company sent a clear message, Tableau will continue to develop its advanced analytics and AI capabilities. Newly announced products like Tableau GPT and, with it, Tableau Pulse make me feel impatient for the amazing features to come. Find a summary of what to expect here: <a href="https://www.tableau.com/blog/data-innovations-tableau-conference-2023" target="_blank"><span class="url">https://www.tableau.com/blog/data-innovations-tableau-conference-2023</span></a>.</p>&#13;
    <p class="normal">While the next chapter is sadly the last chapter of this book, we’ve still got time to explore another hot topic. Alongside advanced analytics, data governance is an increasingly useful area to explore. Regulations and increasing data security risks force companies to put more emphasis on well-structured guidelines and quality checks. We will introduce you to the other side of Tableau in <em class="chapterRef">Chapter 16</em>, <em class="italic">Developing Data Governance Practices</em>.</p>&#13;
    <h2 class="heading-1">Learn more on Discord</h2>&#13;
    <p class="normal">To join the Discord community for this book – where you can share feedback, ask questions to the author, and learn about new releases – follow the QR code below:</p>&#13;
    <p class="normal"><a href="https://packt.link/tableau" target="_blank"><span class="url">https://packt.link/tableau</span></a></p>&#13;
    <p class="normal"><img src="../images/QR_Code2044012316175764640.png" alt=""/></p>&#13;
  </div>&#13;
&#13;
&#13;
</div>&#13;
</section>&#13;
</section>&#13;
</body></html>