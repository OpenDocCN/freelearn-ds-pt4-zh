<html><head></head><body><div id="sbo-rt-content"><div id="_idContainer095">
			<h1 id="_idParaDest-206"><em class="italic"><a id="_idTextAnchor220"/>Chapter 10</em>: Pachyderm Language Clients</h1>
			<p>In previous chapters, we have learned how to use Pachyderm through the <strong class="source-inline">pachctl</strong> <strong class="bold">Command-Line Interface</strong> (<strong class="bold">CLI</strong>). We have deployed and managed multiple Pachyderm pipelines by using mostly <strong class="source-inline">pachctl</strong>. We briefly looked into the Pachyderm <strong class="bold">User Interface</strong> (<strong class="bold">UI</strong>)—or the dashboard—as well, although we did not use it extensively. The Pachyderm CLI enables you to perform all Pachyderm management operations and, in general, provides more functionality than the Pachyderm UI. </p>
			<p>However, many users may decide to take Pachyderm even further by using Pachyderm <strong class="bold">Application Programming Interfaces</strong> (<strong class="bold">APIs</strong>) directly without relying on <strong class="source-inline">pachctl</strong> or the dashboard. Many Pachyderm users develop scripts and call the Pachyderm API directly from these scripts. As of today, Pachyderm provides two official Pachyderm programming language clients, <strong class="bold">Golang</strong> (<strong class="bold">Go</strong>) and Python, to enable advanced users to extend Pachyderm functionality further. </p>
			<p>In addition, if you are familiar with <strong class="bold">Protocol Buffers</strong> (<strong class="bold">Protobuf</strong>), an open source platform that enables cross-platform development, you can leverage the Pachyderm <strong class="source-inline">pps.proto</strong> file to access Pachyderm through such languages as C, C++, and Java.</p>
			<p>In this chapter, you will learn how to use both Python and Go Pachyderm clients. You will learn how to run basic operations by using both of these clients, including how to create repositories and pipelines. </p>
			<p>This chapter is intended to demonstrate how to use official Pachyderm language clients. </p>
			<p>We will cover the following topics:</p>
			<ul>
				<li>Using the Pachyderm Go client</li>
				<li>Cloning the Pachyderm source repository</li>
				<li>Using the Pachyderm Python client </li>
			</ul>
			<h1 id="_idParaDest-207"><a id="_idTextAnchor221"/>Technical requirements</h1>
			<p>You should have already installed the components listed next.</p>
			<p>For a local macOS installation, you will need the following:</p>
			<ul>
				<li>macOS Mojave, Catalina, Big Sur, or later</li>
				<li>Docker Desktop for Mac 10.14</li>
				<li><strong class="source-inline">minikube</strong> v1.9.0 or later</li>
				<li><strong class="source-inline">pachctl</strong> 2.0.0 or later</li>
				<li>Pachyderm 2.0.0 or later</li>
			</ul>
			<p>For a local Windows installation, you will need the following:</p>
			<ul>
				<li>Windows Pro 64-bit v10 or later</li>
				<li><strong class="bold">Windows Subsystem for Linux</strong> (<strong class="bold">WSL</strong>) 2 or later</li>
				<li>Microsoft PowerShell v6.2.1 or later</li>
				<li>Hyper-V </li>
				<li><strong class="source-inline">minikube</strong> v1.9.0 or later</li>
				<li><strong class="source-inline">kubectl</strong> v1.18 or later</li>
				<li><strong class="source-inline">pachctl</strong> 2.0.0 or later</li>
				<li>Pachyderm 2.0.0 or later</li>
			</ul>
			<p>For an <strong class="bold">Amazon Elastic Kubernetes Service</strong> (<strong class="bold">Amazon EKS</strong>) installation, you will need the following:</p>
			<ul>
				<li><strong class="source-inline">kubectl</strong> v1.18 or later</li>
				<li><strong class="source-inline">eksctl</strong></li>
				<li><strong class="source-inline">aws-iam-authenticator</strong></li>
				<li><strong class="source-inline">pachctl</strong> 2.0.0 or later</li>
				<li>Pachyderm 2.0.0 or later</li>
			</ul>
			<p>For a Microsoft <strong class="bold">Azure Kubernetes Service</strong> (<strong class="bold">AKS</strong>) cloud installation, you will need the following:</p>
			<ul>
				<li><strong class="source-inline">kubectl</strong> v1.18 or later</li>
				<li>The Azure CLI</li>
				<li><strong class="source-inline">pachctl</strong> 2.0.0 or later</li>
				<li>Pachyderm 2.0.0 or later</li>
				<li><strong class="source-inline">jq</strong> 1.5 or later</li>
			</ul>
			<p>For a <strong class="bold">Google Kubernetes Engine</strong> (<strong class="bold">GKE</strong>) cloud installation, you will need the following:</p>
			<ul>
				<li>Google Cloud <strong class="bold">Software Development kit</strong> (<strong class="bold">SDK</strong>) v124.0.0 or later</li>
				<li><strong class="source-inline">kubectl</strong> v1.18 or later</li>
				<li><strong class="source-inline">pachctl</strong> 2.0.0 or later</li>
				<li>Pachyderm 2.0.0 or later</li>
			</ul>
			<h2 id="_idParaDest-208"><a id="_idTextAnchor222"/>Downloading the source files</h2>
			<p>All<a id="_idIndexMarker833"/> scripts for this chapter are available at <a href="https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter10-Pachyderm-Language-Clients">https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter10-Pachyderm-Language-Clients</a>.</p>
			<p>We will use the image processing example that we had in <a href="B17085_06_Final_SB_Epub.xhtml#_idTextAnchor156"><em class="italic">Chapter 6</em></a>, <em class="italic">Creating Your First Pipeline</em>. If you do not have them already, download the files for this example from here: <a href="https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter06-Creating-Your-First-Pipeline">https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter06-Creating-Your-First-Pipeline</a>.</p>
			<h1 id="_idParaDest-209"><a id="_idTextAnchor223"/>Using the Pachyderm Go client</h1>
			<p>The Pachyderm<a id="_idIndexMarker834"/> Go client enables you to communicate with Pachyderm through the Go API. Go is a popular programming language that has been developed by Google and has become widely popular among the developer community in recent years. In this chapter, we will learn how to enable the Pachyderm Go client and how to run basic Pachyderm operations using the Go client.</p>
			<p>The main source files that you can use for reference are located in the <a href="https://github.com/pachyderm/pachyderm/tree/master/src/client">https://github.com/pachyderm/pachyderm/tree/master/src/client</a> directory of the Pachyderm source repository. These files include all the methods that you can use to communicate with Pachyderm objects and primitives—specifically, the following files:</p>
			<ul>
				<li><a href="https://github.com/pachyderm/pachyderm/blob/master/src/client/client.go">https://github.com/pachyderm/pachyderm/blob/master/src/client/client.go</a></li>
				<li><a href="https://github.com/pachyderm/pachyderm/blob/master/src/client/pfs.go">https://github.com/pachyderm/pachyderm/blob/master/src/client/pfs.go</a> </li>
				<li><a href="https://github.com/pachyderm/pachyderm/blob/master/src/client/pps.go">https://github.com/pachyderm/pachyderm/blob/master/src/client/pps.go</a> </li>
			</ul>
			<p>These files<a id="_idIndexMarker835"/> include most of the important Pachyderm methods and the ones that we will use in the following sections.</p>
			<h2 id="_idParaDest-210"><a id="_idTextAnchor224"/>Installing Go on your computer</h2>
			<p>To get<a id="_idIndexMarker836"/> started, we<a id="_idIndexMarker837"/> need to verify that we have a valid Go installation in our environment. Go is supported in all major operating systems, including Microsoft Windows, Linux, and macOS. Check that you have Go installed on your computer by running the following command:</p>
			<p class="source-code"><strong class="bold">go version</strong></p>
			<p>You should see an output similar to this:</p>
			<p class="source-code"><strong class="bold">go version go1.16.4 darwin/amd64</strong></p>
			<p>If you do not have Go installed on your machine, follow these next steps to install it:</p>
			<ol>
				<li>Go to <a href="https://golang.org/doc/install">https://golang.org/doc/install</a> and download the version of Go for your operating system.</li>
				<li>Open the downloaded package and follow the prompts to install Go in your system. You should see the following screen when you are done:</li>
			</ol>
			<div>
				<div id="_idContainer093" class="IMG---Figure">
					<img src="Images/B17085_10_001.jpg" alt="Figure 10.1 – Go installation &#13;&#10;" width="955" height="683"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.1 – Go installation </p>
			<ol>
				<li value="3">Follow the instructions for your operating system to verify that Go was installed as described in <a href="https://golang.org/doc/install">https://golang.org/doc/install</a>.</li>
				<li>Restart your Terminal and run <strong class="source-inline">go version</strong> again to verify your installation. You<a id="_idIndexMarker838"/> should <a id="_idIndexMarker839"/>see an output similar to this:<p class="source-code">go version go1.16.4 darwin/amd64</p></li>
			</ol>
			<p>Now that we have Go installed, let's configure <strong class="source-inline">$GOPATH</strong>.</p>
			<h2 id="_idParaDest-211"><a id="_idTextAnchor225"/>Configuring $GOPATH</h2>
			<p>If you<a id="_idIndexMarker840"/> have <a id="_idIndexMarker841"/>never used Go before, you need to make sure that you have your <strong class="source-inline">$GOPATH</strong> directory properly set up; otherwise, none of the scripts described in this section will work. When you installed Go, it might have already been configured. However, you might still want to configure the following:</p>
			<ol>
				<li value="1">Verify that you have the following in either <strong class="source-inline">~/.bash_profile</strong>, <strong class="source-inline">~/.profile</strong>, or <strong class="source-inline">~/.zsh_profile</strong> file: <p class="source-code">export GOPATH="$HOME/go"</p><p class="source-code">PATH="$GOPATH/bin:$PATH"</p></li>
				<li>If your respective shell configuration file did not have this configuration, add it, and then<a id="_idIndexMarker842"/> source your shell configuration <a id="_idIndexMarker843"/>file, like this:<p class="source-code"><strong class="bold">source ~/.&lt;shell-profile&gt;</strong></p></li>
				<li>Check your <strong class="source-inline">$GOPATH</strong> directory by running the following command:<p class="source-code"><strong class="bold">go env</strong></p></li>
			</ol>
			<p>This command prints your Go environment configuration. If you are on macOS, your <strong class="source-inline">$GOPATH</strong> directory should be <strong class="source-inline">`GOPATH="/Users/&lt;username&gt;/go"`.</strong></p>
			<ol>
				<li value="4">If you don't have it already, create a <strong class="source-inline">src</strong> directory under your <strong class="source-inline">$GOPATH</strong> directory, as follows:<p class="source-code">mkdir $<strong class="source-inline">GOPATH/src</strong></p></li>
				<li>Under <strong class="source-inline">$GOPATH/src</strong>, create a <strong class="source-inline">github.com</strong> directory, as follows:<p class="source-code">mkdir $GOPATH/src/github.com</p></li>
			</ol>
			<p>You will need to clone the Pachyderm repository into this directory, as described in the next chapter.</p>
			<ol>
				<li value="6">Update to the latest version of <strong class="source-inline">grpc</strong>, as follows:<p class="source-code"><strong class="bold">go get google.golang.org/grpc</strong></p></li>
			</ol>
			<p>After you have configured <strong class="source-inline">$GOPATH</strong>, you need to clone the Pachyderm source repository.</p>
			<h2 id="_idParaDest-212"><a id="_idTextAnchor226"/>Cloning the Pachyderm source repository</h2>
			<p>Before you<a id="_idIndexMarker844"/> can use Pachyderm language clients, you need to have a copy of the Pachyderm source repository on your machine to be able to use the APIs. You will run the client methods against an existing Pachyderm cluster. The Pachyderm repository is stored in GitHub at <a href="https://github.com/pachyderm/pachyderm">https://github.com/pachyderm/pachyderm</a>. In addition, you need to make sure that you switch to the branch and tag that matches your <strong class="source-inline">pachd</strong> and <strong class="source-inline">pachctl</strong> version. In this section, we will learn how to clone the Pachyderm repository and how to switch to the required branch and tag.</p>
			<p>To be able to run Go modules used in the scripts in this section, you need to clone the Pachyderm repository under the <strong class="source-inline">$GOPATH</strong> directory on your computer. On Mac, Go is installed under <strong class="source-inline">/Users/&lt;username&gt;/go</strong>, and you can clone the Pachyderm repository at <strong class="source-inline">/ Users/&lt;username&gt;/go/src/github.com/</strong>.</p>
			<p>To clone the Pachyderm repository, complete the following steps:</p>
			<ol>
				<li value="1">Go to <a href="https://github.com/pachyderm/pachyderm">https://github.com/pachyderm/pachyderm</a>.</li>
				<li>Click on the <strong class="bold">Code</strong> tab, as shown in the following screenshot: </li>
			</ol>
			<div>
				<div id="_idContainer094" class="IMG---Figure">
					<img src="Images/B17085_10_002.jpg" alt="Figure 10.2 – Pachyderm source repository&#13;&#10;" width="1177" height="250"/>
				</div>
			</div>
			<p class="figure-caption">Figure 10.2 – Pachyderm source repository</p>
			<ol>
				<li value="3">In the drop-down menu, select an option to clone with <strong class="bold">HTTPS</strong> or <strong class="bold">SSH</strong>, and click the <strong class="bold">Clone</strong> icon.<p class="callout-heading">Important note</p><p class="callout">If you decide to clone <a id="_idIndexMarker845"/>with <strong class="bold">Secure Shell</strong> (<strong class="bold">SSH</strong>) and this is your first time cloning from GitHub, you will likely need to configure an SSH key pair. For more information, see <a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh</a>.</p></li>
				<li>Go to your <a id="_idIndexMarker846"/>terminal and run the <strong class="source-inline">git clone</strong> command with the <strong class="bold">HyperText Transfer Protocol Secure</strong> (<strong class="bold">HTTPS</strong>) or SSH address you copied in <em class="italic">Step 3</em>, as follows:<p class="source-code"><strong class="bold">git clone git@github.com:pachyderm/pachyderm.git</strong></p></li>
			</ol>
			<p>You should <a id="_idIndexMarker847"/>see an output similar to this:</p>
			<p class="source-code">Cloning into 'pachyderm'...</p>
			<p class="source-code">remote: Enumerating objects: 226153, done.</p>
			<p class="source-code">remote: Counting objects: 100% (171/171), done.</p>
			<p class="source-code">...</p>
			<p>The Pachyderm source code will be cloned to the <strong class="source-inline">pachyderm</strong> directory.</p>
			<ol>
				<li value="5">Go to the <strong class="source-inline">pachyderm</strong> directory by running the following command:<p class="source-code"><strong class="bold">cd pachyderm</strong></p></li>
				<li>Check the branch you are on by running the following command:<p class="source-code"><strong class="bold">git branch</strong></p></li>
				<li>Get a list of tags by running the following command:<p class="source-code"><strong class="bold">git fetch –tags</strong></p></li>
				<li>Verify the version of <strong class="source-inline">pachctl</strong> and <strong class="source-inline">pachd</strong> that you are using by running the following command:<p class="source-code"><strong class="bold">pachctl version</strong></p></li>
				<li>Your output might look like this:<p class="source-code">COMPONENT           VERSION</p><p class="source-code">pachctl             2.0.1</p><p class="source-code">pachd               2.0.1</p></li>
				<li>Check out the tag that corresponds to the version of <strong class="source-inline">pachctl</strong> and <strong class="source-inline">pachd</strong> that you are using. In this example, we need to check out the <strong class="source-inline">2.0.1</strong> tag:<p class="source-code"><strong class="bold">git checkout tags/v2.0.1</strong></p></li>
				<li>Check that you have switched to the correct version by running the following command:<p class="source-code">git branch</p></li>
			</ol>
			<p>You should see the following output:</p>
			<p class="source-code">* (HEAD detached at v2.0.1)</p>
			<p class="source-code">  master</p>
			<p>We now have <a id="_idIndexMarker848"/>valid Pachyderm source code that we will use to access our Pachyderm cluster. Next, let's connect to Pachyderm with the Go client.</p>
			<h2 id="_idParaDest-213"><a id="_idTextAnchor227"/>Connecting to Pachyderm with the Go client </h2>
			<p>You must<a id="_idIndexMarker849"/> have <a id="_idIndexMarker850"/>a running Pachyderm cluster to be able to use the Go API client. If you have followed previous sections, you likely have one running on a cloud platform of your choice or locally. If not, go back to <a href="B17085_04_Final_SB_Epub.xhtml#_idTextAnchor096"><em class="italic">Chapter 4</em></a>, <em class="italic">Installing Pachyderm Locally</em>, or <a href="B17085_05_Final_SB_Epub.xhtml#_idTextAnchor123"><em class="italic">Chapter 5</em></a>, <em class="italic">Installing Pachyderm on a Cloud Platform</em>, and deploy a cluster.</p>
			<p>We will use the <strong class="source-inline">access.go</strong> script to access Pachyderm. Let's look at the script to understand how it works. The first part of the script imports the required components, as we can see here:</p>
			<p class="source-code">package main</p>
			<p class="source-code"> import (</p>
			<p class="source-code">     "fmt"</p>
			<p class="source-code">     "log"</p>
			<p class="source-code">     "github.com/gogo/protobuf/types"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/client"</p>
			<p class="source-code">)</p>
			<p>The second part of the script defines a <strong class="source-inline">main</strong> function. You must use the <strong class="source-inline">main</strong> function with Go; otherwise, it won't work. The <strong class="source-inline">main</strong> function defines the <strong class="bold">Internet Protocol</strong> (<strong class="bold">IP</strong>) address <a id="_idIndexMarker851"/>and<a id="_idIndexMarker852"/> port of your cluster. In the following code example, it is <strong class="source-inline">localhost</strong> or <strong class="source-inline">127.0.0.1</strong>. <strong class="source-inline">30650</strong> is the <strong class="source-inline">pachd</strong> port:</p>
			<p class="source-code"> func main() {</p>
			<p class="source-code">      c, err := client.NewFromURI("grpc://localhost:30650")</p>
			<p class="source-code">      if err != nil {</p>
			<p class="source-code">          log.Fatal(err)</p>
			<p class="source-code">      }</p>
			<p>The third part of the script, shown here, gets the version of your cluster:</p>
			<p class="source-code">     version, err := c.VersionAPIClient.GetVersion(c.Ctx(), &amp;types.Empty{})</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     fmt.Println(version)</p>
			<p class="source-code">}</p>
			<p>To connect to a Pachyderm cluster, you need to know the IP address of your cluster. If running these examples on a local machine, <strong class="source-inline">grpc://localhost:30650</strong> should work.</p>
			<p>Now, let's run the script. Follow these next steps:</p>
			<ol>
				<li value="1">Unless you have a load balancer deployed that enables access to your cluster, you also need to make sure that you run Pachyderm port-forwarding all the time you are accessing your cluster through the API. To start Pachyderm port-forwarding, run the following command in a separate terminal window:<p class="source-code"><strong class="bold">pachctl port-forward</strong></p></li>
				<li>Run the <strong class="source-inline">access.go</strong> script, as follows:<p class="source-code"><strong class="bold">go run access.go</strong></p></li>
			</ol>
			<p>This is an example response that you should get:</p>
			<p class="source-code">major:2 micro:1</p>
			<p>We have successfully accessed our cluster through the Go API. Our cluster is running<a id="_idIndexMarker853"/> version 2.0.1. Your version<a id="_idIndexMarker854"/> might be different. </p>
			<p>Now, let's use the Go API to create a Pachyderm repository.</p>
			<h2 id="_idParaDest-214"><a id="_idTextAnchor228"/>Creating a repository with the Go client</h2>
			<p>Now that we <a id="_idIndexMarker855"/>know <a id="_idIndexMarker856"/>how to connect to Pachyderm, let's create a repository with the code we have in the <strong class="source-inline">create-repo.go</strong> script. </p>
			<p>Here is what the script imports:</p>
			<p class="source-code">package main</p>
			<p class="source-code"> import (</p>
			<p class="source-code">     "fmt"</p>
			<p class="source-code">     "log"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/client"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/pfs"</p>
			<p class="source-code">)</p>
			<p>The next part of the script defines a <strong class="source-inline">main</strong> function that performs the following operations:</p>
			<ol>
				<li value="1">Connects to the Pachyderm cluster.</li>
				<li>Creates a repository called <strong class="source-inline">photos</strong>.</li>
				<li>Lists <a id="_idIndexMarker857"/>the <a id="_idIndexMarker858"/>repositories on this cluster.</li>
			</ol>
			<p>Here is how it looks:</p>
			<p class="source-code">func main() {</p>
			<p class="source-code">     c, err := client.NewOnUserMachine("user")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         log.Fatal(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if _, err := c.PfsAPIClient.CreateRepo(</p>
			<p class="source-code">         c.Ctx(),</p>
			<p class="source-code">         &amp;pfs.CreateRepoRequest{</p>
			<p class="source-code">             Repo:        client.NewRepo("photos"),</p>
			<p class="source-code">             Description: "A repository that stores images.",</p>
			<p class="source-code">             Update:      true,</p>
			<p class="source-code">         },</p>
			<p class="source-code">     ); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     repos, err := c.ListRepo()</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         log.Fatal(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     fmt.Println(repos)</p>
			<p class="source-code"> }</p>
			<p>You must run port-forwarding and make sure you replace the IP address listed in the<a id="_idIndexMarker859"/> script<a id="_idIndexMarker860"/> with the IP address of your cluster. If you are running the cluster in <strong class="source-inline">minikube</strong>, you probably don't need to change anything. </p>
			<ol>
				<li value="4">Run the <strong class="source-inline">create-repo.go</strong> script, as follows:<p class="source-code"><strong class="bold">go run create-repo.go</strong></p></li>
			</ol>
			<p>This command returns the following output:</p>
			<p class="source-code">[repo:&lt;name:"photos" type:"user" &gt; created:&lt;seconds:1637264349 nanos:440180000 &gt; description:"A repository that stores images." auth_info:&lt;permissions:REPO_READ permissions:REPO_INSPECT_COMMIT permissions:REPO_LIST_COMMIT permissions:REPO_LIST_BRANCH permissions:REPO_LIST_FILE permissions:REPO_INSPECT_FILE permissions:REPO_ADD_PIPELINE_READER permissions:REPO_REMOVE_PIPELINE_READER permissions:PIPELINE_LIST_JOB permissions:REPO_WRITE permissions:REPO_DELETE_COMMIT permissions:REPO_CREATE_BRANCH permissions:REPO_DELETE_BRANCH permissions:REPO_ADD_PIPELINE_WRITER permissions:REPO_MODIFY_BINDINGS permissions:REPO_DELETE roles:"repoOwner" &gt; ]</p>
			<p>Now<a id="_idIndexMarker861"/> that<a id="_idIndexMarker862"/> we have created a repository, let's put some data into it.</p>
			<h2 id="_idParaDest-215"><a id="_idTextAnchor229"/>Putting data into a Pachyderm repository with the Go client</h2>
			<p>In the <a id="_idIndexMarker863"/>previous section, we<a id="_idIndexMarker864"/> created a Pachyderm<a id="_idIndexMarker865"/> repository called <strong class="source-inline">photos</strong>. Let's add the files that we have used in <a href="B17085_06_Final_SB_Epub.xhtml#_idTextAnchor156"><em class="italic">Chapter 6</em></a>, <em class="italic">Creating Your First Pipeline,</em> to this repository. We will use the <strong class="source-inline">put-files.go</strong> script to add the files. Here is what the script imports:</p>
			<p class="source-code">package main</p>
			<p class="source-code"> import (</p>
			<p class="source-code">     "fmt"</p>
			<p class="source-code">     "log"</p>
			<p class="source-code">     "os"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/client"</p>
			<p class="source-code">)</p>
			<p>The next part of the script connects to the Pachyderm cluster and adds the <strong class="source-inline">landscape.png</strong>, <strong class="source-inline">red_vase.png</strong>, and <strong class="source-inline">hand.png</strong> files to the <strong class="source-inline">master</strong> branch of the <strong class="source-inline">photos</strong> repository.</p>
			<p>Here is the part that connects to the repository. Make sure you replace the IP address with the address of your cluster:</p>
			<p class="source-code">func main() {</p>
			<p class="source-code">     c, err := client.NewOnUserMachine("user")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         log.Fatal(err)</p>
			<p class="source-code">     }</p>
			<p>This<a id="_idIndexMarker866"/> part <a id="_idIndexMarker867"/>adds<a id="_idIndexMarker868"/> the files:</p>
			<p class="source-code">     myCommit := client.NewCommit("photos","master", "")</p>
			<p class="source-code">     f1, err := os.Open("landscape.png")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.PutFile(myCommit, "landscape.png", f1); err != nil {</p>
			<p class="source-code">         panic(err)}</p>
			<p class="source-code">     f2, err := os.Open("brown_vase.png")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.PutFile(myCommit, "brown_vase.png", f2); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     f3, err := os.Open("hand.png")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.PutFile(myCommit, "hand.png", f3); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p>And the<a id="_idIndexMarker869"/> last <a id="_idIndexMarker870"/>part, shown <a id="_idIndexMarker871"/>here, lists the files in the master branch of the <strong class="source-inline">photos</strong> repository:</p>
			<p class="source-code">    files, err := c.ListFileAll(myCommit, "/")</p>
			<p class="source-code">    if err != nil {</p>
			<p class="source-code">        panic(err)</p>
			<p class="source-code">    }</p>
			<p class="source-code">    fmt.Println(files)</p>
			<p class="source-code">}</p>
			<p>Let's run this script with the following command:</p>
			<p class="source-code"><strong class="bold">go run put-files.go</strong></p>
			<p>This script returns the following output:</p>
			<p class="source-code">[file:&lt;commit:&lt;branch:&lt;repo:&lt;name:"photos" type:"user" &gt; name:"master" &gt; id:"2c15226b838f48cabd2ae13b43c26517" &gt; path:"/brown_vase.png" datum:"default" &gt; file_type:FILE committed:&lt;seconds:1637299733 nanos:503150000 &gt; size_bytes:93481 hash:"\2061\023\026\376O&amp;\323\313\212\215\226Ra\346\245=Er\r_@E\023\360\352\240\275}\204\235\346"  file:&lt;commit:&lt;branch:&lt;repo:&lt;name:"photos" type:"user" &gt; name:"master" &gt; id:"2c15226b838f48cabd2ae13b43c26517" &gt; path:"/hand.png" datum:"default" &gt; file_type:FILE committed:&lt;seconds:1637299733 nanos:503150000 &gt; size_bytes:856063 hash:"\014X\224\032\0251\260(\263\267\234\345{\016\353a\0310\3579\354\323\372\013\357yFg\274\256\000}"  file:&lt;commit:&lt;branch:&lt;repo:&lt;name:"photos" type:"user" &gt; name:"master" &gt; id:"2c15226b838f48cabd2ae13b43c26517" &gt; path:"/landscape.png" datum:"default" &gt; file_type:FILE committed:&lt;seconds:1637299733 nanos:503150000 &gt; size_bytes:54009 hash:"\320:\265\036\3363z&amp;\264\324]\364unfv\243\300\001[\206\347\344b\257\274\366\220JnR\004" ]</p>
			<p>Great! We<a id="_idIndexMarker872"/> have a repository <a id="_idIndexMarker873"/>with <a id="_idIndexMarker874"/>data in it. Now, let's learn how to create a pipeline.</p>
			<h2 id="_idParaDest-216"><a id="_idTextAnchor230"/>Creating pipelines with the Go client</h2>
			<p>Finally, we<a id="_idIndexMarker875"/> can<a id="_idIndexMarker876"/> create pipelines for our example from <a href="B17085_06_Final_SB_Epub.xhtml#_idTextAnchor156"><em class="italic">Chapter 6</em></a>, <em class="italic">Creating Your First Pipeline</em>. </p>
			<p>Here is what the <strong class="source-inline">create-pipeline.go</strong> script imports:</p>
			<p class="source-code">package main</p>
			<p class="source-code"> import (</p>
			<p class="source-code">     "fmt"</p>
			<p class="source-code">     "log"</p>
			<p class="source-code"> </p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/client"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/pps""</p>
			<p class="source-code"> )</p>
			<p>The second part of the script connects to the Pachyderm cluster by using the <strong class="source-inline">pachd</strong> IP address, as follows:</p>
			<p class="source-code">func main() {</p>
			<p class="source-code">     c, err := client.NewFromAddress("127.0.0.1:30650")</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         log.Fatal(err)</p>
			<p class="source-code">     }</p>
			<p>The next <a id="_idIndexMarker877"/>part <a id="_idIndexMarker878"/>of the script creates a <strong class="source-inline">contour</strong> pipeline. You can see that the script uses the <strong class="source-inline">svekars/contour-histogram:1.0</strong> image and gets the data from the <strong class="source-inline">photos</strong> repository with the <strong class="source-inline">/</strong> glob pattern. One important thing to note in the example shown here is that you need to specify the <strong class="source-inline">parallelism_spec</strong> for all pipelines:</p>
			<p class="source-code">if err := c.CreatePipeline(</p>
			<p class="source-code">         "contour",</p>
			<p class="source-code">         "svekars/contour-histogram:1.0 ",</p>
			<p class="source-code">         []string{"python3", "/contour.py"},</p>
			<p class="source-code">         []string{},</p>
			<p class="source-code">         &amp;pps.ParallelismSpec{</p>
			<p class="source-code">             Constant: 1,</p>
			<p class="source-code">         },</p>
			<p class="source-code">         client.NewPFSInput("photos", "/"),</p>
			<p class="source-code">         "",</p>
			<p class="source-code">         false,</p>
			<p class="source-code">     ); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p>Next, the<a id="_idIndexMarker879"/> script <a id="_idIndexMarker880"/>creates a <strong class="source-inline">histogram</strong> pipeline, as follows:</p>
			<p class="source-code">if err := c.CreatePipeline(</p>
			<p class="source-code">         "histogram",</p>
			<p class="source-code">         "svekars/contour-histogram:1.0",</p>
			<p class="source-code">         []string{"python3", "/histogram.py"},</p>
			<p class="source-code">         []string{},</p>
			<p class="source-code">         &amp;pps.ParallelismSpec{</p>
			<p class="source-code">             Constant: 1,</p>
			<p class="source-code">         },</p>
			<p class="source-code">         client.NewPFSInput("contour", "/"),</p>
			<p class="source-code">         "",</p>
			<p class="source-code">         false,</p>
			<p class="source-code">     ); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p>And finally, the script lists all the created pipelines, as follows:</p>
			<p class="source-code">     pipelines, err := c.ListPipeline(true)</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     fmt.Println(pipelines)</p>
			<p class="source-code"> }</p>
			<p>Run the following command:</p>
			<p class="source-code"><strong class="bold">go run create-pipeline.go</strong></p>
			<p>Here <a id="_idIndexMarker881"/>is<a id="_idIndexMarker882"/> an example response:</p>
			<p class="source-code"><strong class="bold">[pipeline:&lt;name:"histogram" &gt; version:1</strong> spec_commit:&lt;branch:&lt;repo:&lt;name:"histogram" type:"spec" &gt; name:"master" &gt; id:"44945b0d0e2944e3b1015617e224e3e3" &gt; state:PIPELINE_STARTING job_counts:&lt;key:1 value:1 &gt; last_job_state:JOB_CREATED parallelism:1 type:PIPELINE_TYPE_TRANSFORM details:&lt;transform:&lt;image:"svekars/contour-histogram:1.0" cmd:"python3" cmd:"/histogram.py" &gt; parallelism_spec:&lt;constant:1 &gt; created_at:&lt;seconds:1637300756 nanos:806783300 &gt; output_branch:"master" input:&lt;pfs:&lt;name:"contour" repo:"contour" repo_type:"user" branch:"master" glob:"/" &gt; &gt; salt:"0715a02027ba4489a79bd8a400f349ad" datum_tries:3 reprocess_spec:"until_success" &gt;  </p>
			<p class="source-code"><strong class="bold">pipeline:&lt;name:"contour" &gt; version:1</strong> spec_commit:&lt;branch:&lt;repo:&lt;name:"contour" type:"spec" &gt; name:"master" &gt; id:"f3f8bf226e5a4dda8a9f27da10b7fd87" &gt; state:PIPELINE_STARTING job_counts:&lt;key:1 value:1 &gt; last_job_state:JOB_CREATED parallelism:1 type:PIPELINE_TYPE_TRANSFORM details:&lt;transform:&lt;image:"svekars/contour-histogram:1.0 " cmd:"python3" cmd:"/contour.py" &gt; parallelism_spec:&lt;constant:1 &gt; created_at:&lt;seconds:1637300756 nanos:592992600 &gt; output_branch:"master" input:&lt;pfs:&lt;name:"photos" repo:"photos" repo_type:"user" branch:"master" glob:"/" &gt; &gt; salt:"98c0a867ea56439eb1f2466fbf1aa838" datum_tries:3 reprocess_spec:"until_success" &gt; ]</p>
			<p>You can see that the script has created two of our pipelines, as intended. We have the whole example uploaded in one file called <strong class="source-inline">contour-go-example.go</strong> in the chapter's GitHub repository. Now that you have learned how to do it, you can just run that one<a id="_idIndexMarker883"/> script to create a whole contour pipeline <a id="_idIndexMarker884"/>example from one command. Next, we'll learn how to clean up our cluster.</p>
			<h2 id="_idParaDest-217"><a id="_idTextAnchor231"/>Cleaning up the cluster with the Go client</h2>
			<p>The <strong class="source-inline">cleanup.go</strong> script <a id="_idIndexMarker885"/>cleans up your cluster and deletes all the pipelines, data, and repositories. Only run it if you do not want to preserve the data anymore.</p>
			<p>This script only needs to import the client from the Pachyderm repository. For this, the following code is required:</p>
			<p class="source-code">package main</p>
			<p class="source-code"> import (</p>
			<p class="source-code">     "fmt"</p>
			<p class="source-code">     "log"</p>
			<p class="source-code">     "github.com/pachyderm/pachyderm/v2/src/client"</p>
			<p class="source-code"> )</p>
			<p>The next part of the script deletes all the repositories and pipelines. We set the <strong class="source-inline">force </strong>flag to <strong class="source-inline">true</strong> for all pipelines and repositories so that Pachyderm does not interrupt deletion due to downstream pipeline dependencies. The code is illustrated in the following snippet: </p>
			<p class="source-code">     if err := c.DeleteRepo("contour", true); err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.DeleteRepo("photos", true); err != nil {</p>
			<p class="source-code">          panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.DeleteRepo("histogram", true); err != nil {</p>
			<p class="source-code">           panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.DeletePipeline("contour", true); err != nil {</p>
			<p class="source-code">           panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     if err := c.DeletePipeline("histogram", true); err != nil {</p>
			<p class="source-code">           panic(err)</p>
			<p class="source-code">     }</p>
			<p>And the final <a id="_idIndexMarker886"/>part of the script returns empty lists since we delete all the pipelines and repositories, as illustrated in the following code snippet:</p>
			<p class="source-code">pipelines, err := c.ListPipeline(true)</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         panic(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     fmt.Println(pipelines)</p>
			<p class="source-code">     repos, err := c.ListRepo()</p>
			<p class="source-code">     if err != nil {</p>
			<p class="source-code">         log.Fatal(err)</p>
			<p class="source-code">     }</p>
			<p class="source-code">     fmt.Println(repos)</p>
			<p class="source-code"> }</p>
			<p>Run the following command:</p>
			<p class="source-code"><strong class="bold">go run cleanup.go</strong></p>
			<p>This command returns the following output:</p>
			<p class="source-code">[]</p>
			<p class="source-code">[]</p>
			<p>In this section, we have learned how to use the Go client to create Pachyderm pipelines and <a id="_idIndexMarker887"/>repositories. Next, let's learn how to do this with the Pachyderm Python client.</p>
			<h1 id="_idParaDest-218"><a id="_idTextAnchor232"/>Using the Pachyderm Python client</h1>
			<p>Python is <a id="_idIndexMarker888"/>probably one of the most popular languages within the software engineering and data science community. Pachyderm provides an officially supported Python client through the <strong class="source-inline">python-pachyderm</strong> package. You can find the Python Pachyderm source repository on GitHub at <a href="https://github.com/pachyderm/python-pachyderm">https://github.com/pachyderm/python-pachyderm</a> and <a id="_idIndexMarker889"/>on <a id="_idIndexMarker890"/>the <strong class="bold">Python Package Index</strong> (<strong class="bold">PyPI</strong>) at <a href="https://pypi.org/project/python-pachyderm/">https://pypi.org/project/python-pachyderm/</a>. </p>
			<p>The main files that you can use as a Python client reference are located in the <a href="https://github.com/pachyderm/python-pachyderm/tree/master/src/python_pachyderm/mixin">https://github.com/pachyderm/python-pachyderm/tree/master/src/python_pachyderm/mixin</a> directory of the Pachyderm source repository—most notably, the following files:</p>
			<ul>
				<li><a href="https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/client.py">https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/client.py </a></li>
				<li><a href="https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/mixin/pfs.py">https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/mixin/pfs.py</a> </li>
				<li><a href="https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/mixin/pps.py">https://github.com/pachyderm/python-pachyderm/blob/master/src/python_pachyderm/mixin/pps.py</a> </li>
			</ul>
			<p>Before you proceed, you must have the following components configured on your machine:</p>
			<ul>
				<li>A copy of the Pachyderm repository (see the <em class="italic">Cloning the Pachyderm source repository</em> section). With Python Pachyderm, you can clone your repository to any directory on your machine. It does not have to be <strong class="source-inline">$GOPATH</strong>.</li>
				<li>Python 3.6 or later installed on your machine. </li>
				<li>Access to an active Pachyderm cluster. If it's a local installation, you need to have Pachyderm port-forwarding running all the time you work with the repository through the APIs. If it's a cloud installation, you need to either have a load balancer running to enable access to your cluster, or you might be able to use Pachyderm port-forwarding as well.</li>
			</ul>
			<p>We have<a id="_idIndexMarker891"/> reviewed the prerequisites for this section. Now, let's install the <strong class="source-inline">python-pachyderm</strong> client.</p>
			<h2 id="_idParaDest-219"><a id="_idTextAnchor233"/>Installing the Pachyderm Python client</h2>
			<p>Before you<a id="_idIndexMarker892"/> can start using the Pachyderm Python client, you need to install it on your machine.</p>
			<p>To install the Python Pachyderm client, complete the following steps:</p>
			<ol>
				<li value="1">Open a terminal window.</li>
				<li>If you are on macOS or Linux, run the following command:<p class="source-code"><strong class="bold">pip install python-pachyderm</strong></p></li>
			</ol>
			<p>  You should see the following output:</p>
			<p class="source-code">Collecting python-pachyderm</p>
			<p class="source-code">  Downloading python-pachyderm-6.2.0.tar.gz (409 kB)</p>
			<p class="source-code">  ...</p>
			<p class="source-code">Successfully installed grpcio-1.38.0 protobuf-3.17.0 python-pachyderm-6.2.0</p>
			<p>Your version of the <strong class="source-inline">python-pachyderm</strong> package might be different.</p>
			<p>Now that we have <strong class="source-inline">python-pachyderm</strong> installed, let's connect to Pachyderm by using <strong class="source-inline">python-pachyderm</strong>.</p>
			<h2 id="_idParaDest-220"><a id="_idTextAnchor234"/>Connecting to your Pachyderm cluster with the Python client</h2>
			<p>To get <a id="_idIndexMarker893"/>started, let's <a id="_idIndexMarker894"/>use the <strong class="source-inline">access.py</strong> script to connect to your cluster. Make sure port-forwarding is running on your machine. Here is the script:</p>
			<p class="source-code">import python_pachyderm</p>
			<p class="source-code">client = python_pachyderm.Client()</p>
			<p class="source-code">print(client.get_remote_version())</p>
			<p>This script connects to <strong class="source-inline">pachd</strong>, which runs on <a href="https://localhost:30650">https://localhost:30650</a>, by using the <strong class="source-inline">python_pachyderm.Client()</strong> invocation and prints the version of Pachyderm that you are running. </p>
			<p>Let's run this script and see what output it returns.</p>
			<p>Run the <strong class="source-inline">access.py</strong> script with the following command:</p>
			<p class="source-code">python access.py</p>
			<p>You should see output similar to this:</p>
			<p class="source-code">major: 2</p>
			<p class="source-code">micro: 1</p>
			<p>This output means that we are on version 2.0.1. Your output might be different.</p>
			<p>Now that we know how to access the cluster, let's go ahead and create a Pachyderm repository.</p>
			<h2 id="_idParaDest-221"><a id="_idTextAnchor235"/>Creating a Pachyderm repository with the Python client</h2>
			<p>We will<a id="_idIndexMarker895"/> use<a id="_idIndexMarker896"/> the <strong class="source-inline">create-repo.py</strong> script to create a Pachyderm repository called <strong class="source-inline">photos</strong>. </p>
			<p>Here is the code of the script:</p>
			<p class="source-code">import python_pachyderm</p>
			<p class="source-code">client = python_pachyderm.Client()</p>
			<p class="source-code">client.create_repo("photos")</p>
			<p class="source-code">print(list(client.list_repo()))</p>
			<p>Run the <strong class="source-inline">create-repo.py</strong> script with the following command:</p>
			<p class="source-code">python create-repo.py</p>
			<p>Here is an example output:</p>
			<p class="source-code">[repo {</p>
			<p class="source-code">  name: "photos"</p>
			<p class="source-code">  type: "user"</p>
			<p class="source-code">}</p>
			<p class="source-code">created {</p>
			<p class="source-code">  seconds: 1637207890</p>
			<p class="source-code">  nanos: 80987000</p>
			<p class="source-code">}</p>
			<p class="source-code">auth_info {</p>
			<p class="source-code">  permissions: REPO_READ</p>
			<p class="source-code">  permissions: REPO_INSPECT_COMMIT</p>
			<p class="source-code">...</p>
			<p>Now that <a id="_idIndexMarker897"/>we <a id="_idIndexMarker898"/>have a repository created, let's put some data into it.</p>
			<h2 id="_idParaDest-222"><a id="_idTextAnchor236"/>Putting data into a Pachyderm repository with the Python client</h2>
			<p>We<a id="_idIndexMarker899"/> will <a id="_idIndexMarker900"/>put the same<a id="_idIndexMarker901"/> files we used in <a href="B17085_06_Final_SB_Epub.xhtml#_idTextAnchor156"><em class="italic">Chapter 6</em></a>, <em class="italic">Creating Your First Pipeline,</em> to the <strong class="source-inline">photos</strong> repository we have just created. Here is the script that we will use:</p>
			<p class="source-code">import python_pachyderm</p>
			<p class="source-code">client = python_pachyderm.Client()</p>
			<p class="source-code">with client.commit('photos', 'master') as i:</p>
			<p class="source-code">     client.put_file_url(i, 'landscape.png', 'https://i.imgur.com/zKo9Mdl.jpg')</p>
			<p class="source-code">     client.put_file_url(i, 'hand.png', 'https://i.imgur.com/HtZ8FyG.png')</p>
			<p class="source-code">     client.put_file_url(i, 'red_vase.png', 'https://i.imgur.com/d45jop9.jpg') print(list(client.list_file(("photos","master"), "/")))</p>
			<p>The <a id="_idIndexMarker902"/>script <a id="_idIndexMarker903"/>uses the <strong class="source-inline">client.commit</strong> method<a id="_idIndexMarker904"/> to start a commit to the master branch of the <strong class="source-inline">photos</strong> repository, and the <strong class="source-inline">client.put_file_bytes</strong> adds three files to the repository. Note that <strong class="source-inline">client.list_file</strong> needs to be a <strong class="source-inline">list</strong> and not a <strong class="source-inline">string</strong> for the command to work correctly.</p>
			<p>Let's run this script.</p>
			<p>Run the <strong class="source-inline">put-files.py</strong> script with the following command:</p>
			<p class="source-code"><strong class="bold">python put-files.py</strong></p>
			<p>Here is the system response that you should get:</p>
			<p class="source-code">[file {</p>
			<p class="source-code">  commit {</p>
			<p class="source-code">    branch {</p>
			<p class="source-code">      repo {</p>
			<p class="source-code">        name: "photos"</p>
			<p class="source-code">        type: "user"</p>
			<p class="source-code">      }</p>
			<p class="source-code">      name: "master"</p>
			<p class="source-code">    }</p>
			<p class="source-code">    id: "e29c6f5c49244ce193fe5f86c9df0297"</p>
			<p class="source-code">  }</p>
			<p class="source-code">  path: "/hand.png"</p>
			<p class="source-code">  datum: "default"</p>
			<p class="source-code">}</p>
			<p class="source-code">file_type: FILE</p>
			<p class="source-code">committed {</p>
			<p class="source-code">  seconds: 1637208291</p>
			<p class="source-code">  nanos: 161527000</p>
			<p class="source-code">}</p>
			<p class="source-code">size_bytes: 856063</p>
			<p class="source-code">hash: "\014X\224\032\0251\260(\263\267\234\345{\016\353a\0310\3579\354\323\372\013\357yFg\274\256\000}"  </p>
			<p class="source-code">...</p>
			<p class="source-code">]</p>
			<p>The <a id="_idIndexMarker905"/>preceding <a id="_idIndexMarker906"/>output is truncated. You <a id="_idIndexMarker907"/>should see the same output for each file that we added to the repository.</p>
			<p>Now that we have added the files, let's create pipelines for this example.</p>
			<h2 id="_idParaDest-223"><a id="_idTextAnchor237"/>Creating pipelines with the Pachyderm Python client</h2>
			<p>Now that <a id="_idIndexMarker908"/>we have a repository and files <a id="_idIndexMarker909"/>uploaded to it, let's use the <strong class="source-inline">create-pipeline.py</strong> script to create two pipelines from the example we had in <a href="B17085_06_Final_SB_Epub.xhtml#_idTextAnchor156"><em class="italic">Chapter 6</em></a>, <em class="italic">Creating Your First Pipeline</em>. </p>
			<p><strong class="source-inline">python-pachyderm</strong> provides two methods to create pipelines, as outlined here: </p>
			<ul>
				<li><strong class="source-inline">create_pipeline</strong>: This method is for all languages and is equivalent to the <strong class="source-inline">pachctl create pipeline</strong> method.</li>
				<li><strong class="source-inline">create_python_pipeline</strong>: This pipeline is designed to be run with Python code and provides a slightly<a id="_idIndexMarker910"/> different <strong class="bold">User Experience</strong> (<strong class="bold">UX</strong>). You can read more about this method in the Pachyderm documentation, at <a href="https://docs.pachyderm.com">https://docs.pachyderm.com</a>.</li>
			</ul>
			<p>We will use the standard <strong class="source-inline">create_pipeline</strong> method to create this pipeline.</p>
			<p>The first part of the script creates a <strong class="source-inline">contour</strong> pipeline, as follows:</p>
			<p class="source-code">import python_pachyderm</p>
			<p class="source-code">from python_pachyderm.service import pps_proto</p>
			<p class="source-code">client = python_pachyderm.Client()</p>
			<p class="source-code"> client.create_pipeline(</p>
			<p class="source-code">     pipeline_name="contour",</p>
			<p class="source-code">     transform=pps_proto.Transform(</p>
			<p class="source-code">         cmd=["python3", "contour.py"],</p>
			<p class="source-code">         image="svekars/contour-histogram:1.0",</p>
			<p class="source-code">     ),</p>
			<p class="source-code">     input=pps_proto.Input(</p>
			<p class="source-code">         pfs=pps_proto.PFSInput(glob="/", repo="photos")</p>
			<p class="source-code">     ),</p>
			<p class="source-code"> )</p>
			<p>The second part of the script creates a <strong class="source-inline">histogram</strong> pipeline, as follows:</p>
			<p class="source-code">client.create_pipeline(</p>
			<p class="source-code">     pipeline_name="histogram",</p>
			<p class="source-code">     transform=pps_proto.Transform(</p>
			<p class="source-code">         cmd=["python3", "histogram.py"],</p>
			<p class="source-code">         image="svekars/contour-histogram:1.0",</p>
			<p class="source-code">     ),</p>
			<p class="source-code">     input=pps_proto.Input(</p>
			<p class="source-code">         pfs=pps_proto.PFSInput(glob="/", repo="contour")</p>
			<p class="source-code">     ),</p>
			<p class="source-code"> )</p>
			<p>And the<a id="_idIndexMarker911"/> last <a id="_idIndexMarker912"/>part of the script returns a list of pipelines that were created, as illustrated in the following code snippet:</p>
			<p class="source-code"> Print(list(client.list_pipeline()))</p>
			<p>Let's run this script.</p>
			<p>Run the <strong class="source-inline">create-pipeline.py</strong> script with the following command:</p>
			<p class="source-code"><strong class="bold">python create-pipeline.py</strong></p>
			<p>Here is a fragment of the output:</p>
			<p class="source-code">[pipeline {</p>
			<p class="source-code">  name: "histogram"</p>
			<p class="source-code">}</p>
			<p class="source-code">version: 1</p>
			<p class="source-code">spec_commit {</p>
			<p class="source-code">  branch {</p>
			<p class="source-code">    repo {</p>
			<p class="source-code">      name: "histogram"</p>
			<p class="source-code">      type: "spec"</p>
			<p class="source-code">    }</p>
			<p class="source-code">    name: "master"</p>
			<p class="source-code">  }</p>
			<p class="source-code">  id: "94286ef36318425c8177bd4e0f959c57"</p>
			<p class="source-code">}</p>
			<p class="source-code">state: PIPELINE_STARTING</p>
			<p class="source-code">job_counts {</p>
			<p class="source-code">  key: 1</p>
			<p class="source-code">  value: 1</p>
			<p class="source-code">}...</p>
			<p>In this section, we <a id="_idIndexMarker913"/>have learned how to create <a id="_idIndexMarker914"/>pipelines by using the <strong class="source-inline">python-pachyderm</strong> client. Next, let's clean up our cluster.</p>
			<h2 id="_idParaDest-224"><a id="_idTextAnchor238"/>Cleaning up the cluster with the Python client</h2>
			<p>We have <a id="_idIndexMarker915"/>successfully recreated our contour and histogram pipeline example. The whole example is available as one file called <strong class="source-inline">contour-histogram-example.py</strong> in the GitHub repository. You can download it at <a href="https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter10-Pachyderm-Language-Clients">https://github.com/PacktPublishing/Reproducible-Data-Science-with-Pachyderm/tree/main/Chapter10-Pachyderm-Language-Clients</a> and recreate it as many times as needed. </p>
			<p>In this section, we will clean up our cluster so that we have a clean installation for <a href="B17085_11_Final_SB_Epub.xhtml#_idTextAnchor241"><em class="italic">Chapter 11</em></a>, <em class="italic">Using Pachyderm Notebooks</em>. We will use the <strong class="source-inline">cleanup.py</strong> script for that, as follows:</p>
			<p class="source-code">import python_pachyderm</p>
			<p class="source-code">client.delete_repo("photos", force=True)</p>
			<p class="source-code">client.delete_pipeline(pipeline_name="contour", force=True, keep_repo=False)</p>
			<p class="source-code">client.delete_pipeline(pipeline_name="histogram", force=True, keep_repo=False)</p>
			<p class="source-code">print(list(client.list_repo()))</p>
			<p class="source-code">print(list(client.list_pipeline()))</p>
			<p>This script uses the <strong class="source-inline">delete_all_pipelines</strong> method, which deletes all pipelines in the cluster. You can also use <strong class="source-inline">delete_all</strong> to delete all objects and primitives in the cluster.</p>
			<p>Let's run this script.</p>
			<p>Run the <strong class="source-inline">cleanup.py</strong> script with the following command:</p>
			<p class="source-code"><strong class="bold">python cleanup.py</strong></p>
			<p>This command should return the following output:</p>
			<p class="source-code">[]</p>
			<p class="source-code">[]</p>
			<p>That's it! We<a id="_idIndexMarker916"/> have successfully cleaned up our cluster.</p>
			<h1 id="_idParaDest-225"><a id="_idTextAnchor239"/>Summary</h1>
			<p>In this chapter, we've learned about how to use the two officially supported Pachyderm language clients—the Pachyderm Go client and the Python client. We've learned how to clone the Pachyderm repository and switch to the correct branch and tag. We've learned how to connect, create repositories, put files into repositories, and create pipelines, as well as delete all the objects after we are done. There is much more that you can do with these two language clients, but the examples in this chapter give you a general idea about how to use them.</p>
			<p>In the next chapter, we will learn how to integrate Pachyderm with JupyterHub, a popular data science <strong class="bold">Integrated Development Environment</strong> (<strong class="bold">IDE</strong>) for which Pachyderm has a special plugin. We will also work more with the <strong class="source-inline">python-pachyderm</strong> client. </p>
			<h1 id="_idParaDest-226"><a id="_idTextAnchor240"/>Further reading</h1>
			<ul>
				<li>Setting up Ingress with Traefik to access the Pachyderm UI: <a href="https://docs.pachyderm.com/latest/deploy-manage/deploy/ingress/pach-ui-ingress/#traefik-ingress-controller-on-pachyderm-uis-cluster-in-one-diagram">https://docs.pachyderm.com/latest/deploy-manage/deploy/ingress/pach-ui-ingress/#traefik-ingress-controller-on-pachyderm-uis-cluster-in-one-diagram</a></li>
				<li><em class="italic">Connecting to GitHub with SSH</em>: <a href="https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh">https://docs.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh</a></li>
				<li>Go documentation: <a href="https://golang.org/doc/">https://golang.org/doc/</a></li>
				<li>Python 3 documentation: <a href="https://docs.python.org/3/">https://docs.python.org/3/</a></li>
				<li>Python Pachyderm client documentation: <a href="https://python-pachyderm.readthedocs.io/en/stable/">https://python-pachyderm.readthedocs.io/en/stable/</a></li>
			</ul>
		</div>
	</div></body></html>